/*! my-project-name 2015-08-27 */
function Namespace(a){a=a.split(".");for(var b=window,c=0;c<a.length;c++)"undefined"==typeof b[a[c]]&&(b[a[c]]={}),b=b[a[c]]}function getDesignColors(){for(var a=0,b=state.designer.sides,c=0;c<b.length;c++){for(var d=b[c],e=d.elements,f=[],g=0;g<e.length;g++){var h=e[g];if(h instanceof ui.text.TextElement&&(0!=h.stroke&&f.push(h.strokeColor),f.push(h.color)),h instanceof ui.svg.SvgElement||h instanceof ui.bitmap.BitmapElement)for(var i=0;i<h.colors.length;i++)f.push(h.colors[i])}a+=f.unique().length}return a}function completeZeros(a){var b=a;if("none"==b||"-1"==b)return a;for(;6>b.length;)b="0"+b;return b}function getUrlParam(a){return window.isUrlParams||(window.onpopstate=function(){var a,b=/\+/g,c=/([^&=]+)=?([^&]*)/g,d=window.location.search.substring(1);for(window.isUrlParams={};a=c.exec(d);)window.isUrlParams[decodeURIComponent(a[1].replace(b," "))]=decodeURIComponent(a[2].replace(b," "))})(),window.isUrlParams[a]}function normalizeColorStrings(a){var b=["name_color","number_color"];if(a){if("string"==typeof a)a=getColorString(a);else if(a.length)for(b=0;b<a.length;b++)a[b]=normalizeColorStrings(a[b]);else for(var c in a)0<=c.indexOf("color")&&0>b.indexOf(c)?"string"==typeof a[c]?a[c]=getColorString(a[c]):normalizeColorStrings(a[c]):"object"==typeof a[c]&&normalizeColorStrings(a[c]);return a}}function getColorString(a,b){if(!a||"-1"==a)return b?"000000":"#000000";var c=a.color||a.html_color||a.value||a;return c&&"string"==typeof c?"none"==c.toLowerCase()?"none":("0"==c&&(c="000000"),"1"==c&&(c="000000"),"ffffffff"==c.toLowerCase()?"none":c.match(/^#?[0-9a-f]{3,6}$/i)?("#"==c.charAt(0)&&(c=c.substring(1)),3==c.length&&(c=c.charAt(0)+c.charAt(0)+c.charAt(1)+c.charAt(1)+c.charAt(2)+c.charAt(2)),c=completeZeros(c),b||(c="#"+c),c.toUpperCase()):a):b?"000000":"#000000"}function colorsAreClose(a,b,c){return c||(c=.05),base.colorUtils.compareColors(a,b)<c}function isHexColorString(a){return a.match(/^#[0-9a-f]{3,6}$/i)}function htmlEscape(a){return a?String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a}function htmlUnescape(a){var b=document.createElement("div");return b.innerHTML=a,0===b.childNodes.length?"":b.childNodes[0].nodeValue}function textToHtml(a){return a?a.replace(/\n/g,"<br />"):a}function findMatch(a,b){for(var c=0;c<a.length;c++)if(b(a[c]))return a[c];return null}function deleteMatches(a,b){for(var c=0;c<a.length;c++)b(a[c])&&(a.splice(c,1),c--);return a}function findMatchIndex(a,b){for(var c=0;c<a.length;c++)if(b(a[c]))return c;return-1}function arrangeHierarchy(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=c(a[e]);if(b(a[e]),f)for(var g=0;g<a.length;g++)b(a[g])==f&&("undefined"==typeof a[g].children&&(a[g].children=[]),a[g].children.push(a[e]),a[e].parent=a[g]);else d.push(a[e])}return d}function changeJITImageSize(a,b,c){if(!a)return a;var d=a.substring(0,a.lastIndexOf("/"))+"/";return c||(c=a.substring(a.lastIndexOf("."))),a.match(/\/\d+\.\w+$/)?d+b+c:a.match(/\/\d+\.\d+\.\w+$/)?d+(b+"."+b)+c:a}function fixImageUrl(a){if(!a||0>a.toUpperCase().indexOf("REPLACE_DOMAIN_WITH"))return a;var b=ezdVars.CdnDomain,c=ezdVars.SSLCdnDomain;return a=a.replace("http://REPLACE_DOMAIN_WITH","http://"+b),a=a.replace("https://REPLACE_DOMAIN_WITH","https://"+(c?c:b)),a=document.location.href.startsWith("file")?a.replace("REPLACE_DOMAIN_WITH","http://"+b):a.replace("REPLACE_DOMAIN_WITH","//"+b)}function getHtmlContent(a,b,c){var d=ezdVars.DesignerLocation;d||(d="..");var e=RegExp("{ezdLocation}","gi"),f=RegExp("{kioskLocation}","gi");$.get(b,function(d){d=d.replace(e,ezdVars.DesignerLocation),d=d.replace(f,ezdVars.KioskLocation||""),a.html(d),c&&(console.log("载入了编辑器模版： "+b),c())})}function setUpTaskQueue(){window.taskQueueInterval=setInterval(executeNextTask,20)}function addTaskToQueue(a){taskQueue.push(a)}function executeNextTask(){if(0<taskQueue.length){var a=taskQueue.shift();a.parameter?a.functionCall(a.parameter):a.functionCall()}}function stopTaskQueue(){clearInterval(window.taskQueueInterval)}function setUpPrefills(){var a=$(".prefill");a.on("focus",prefillFocus),a.on("blur",prefillBlur),a.each(function(){$(this).val($(this).attr("data-prefill"))})}function prefillFocus(a){a=$(a.currentTarget);var b=a.attr("data-prefill");a.val()==b&&a.val("")}function prefillBlur(a){a=$(a.currentTarget);var b=a.attr("data-prefill");a.val()&&0!=a.val().length||a.val(b)}function searchInArray(a,b,c){if(null==a)return!1;for(var d=0;d<a.length;d++)if(null!=c){if(a[d][c]==b)return a[d]}else if(a[d]==b)return a[d];return!1}function deleteInArray(a,b){if(null==a)return!1;for(var c=null,d=0;d<a.length;d++)if(a[d]==b){c=d;break}null!=c&&a.splice(c,1)}function searchString(a,b,c){if(null==a)return!1;for(var d=0;d<a.length;d++)if(null!=c){if(a[d][c]&&a[d][c].toLowerCase()==b.toLowerCase())return a[d]}else if(a[d]&&a[d].toLowerCase()==b.toLowerCase())return a[d];return!1}function getElementsInArray(a,b,c){if(null==a)return!1;for(var d=[],e=0;e<a.length;e++)null!=c?a[e][c]&&a[e][c].toLowerCase()==b.toLowerCase()&&d.push(a[e]):a[e]==b&&d.push(a[e]);return d}function deserializeXmlToArray(a,b){return values=[],a.find(b).each(function(){var a={};$.each(this.attributes,function(b,c){a[c.name]=c.value}),values.push(a)}),values}function addTask(a){var b={name:a};return b.startTime=new Date,b.id=Math.floor(1e4*Math.random()),b.backgroundColor="#"+("000000"+(16777215*Math.random()<<0).toString(16)).slice(-6),$("#tasksContainer").append('<div class="taskStart" id="task'+b.id+'" style="background-color: '+b.backgroundColor+'">'+a+"</div>"),tasks.push(b),b.id}function taskComplete(a,b){var c=findMatch(tasks,function(b){return b.id==a}),d=new Date-c.startTime,e=Math.round(d/10)/100+"s",f=$("#task"+c.id);b||(b=0),d>b&&($("#tasksContainer").append('<div class="taskStart" id="task'+c.id+'" style="background-color: '+c.backgroundColor+'">'+c.name+" completed in "+e+"</div>"),f.text(c.name+" completed in "+e),f.removeClass("taskStart"),f.addClass("taskComplete"))}function ajaxShowOverlay(){var a=ezdVars.DesignerLocation;a||(a=".."),numOverlays++;var b=$("#ajaxOverlay"),c=Math.max($(document).height(),$(window).height());b.css("height",c+"px"),0==$("#overlaySpinner").length&&b.append("<img id='overlaySpinner' src='"+(a+"/common/js/fb/fancybox_loading.gif")+"' style='position:relative;top:45%;left:"+((window.innerWidth?window.innerWidth:document.body.clientWidth)/2+"px")+"' />"),b.fadeIn("fast")}function ajaxHideOverlay(){numOverlays--,0===numOverlays&&$("#ajaxOverlay").fadeOut("fast")}function isImageLoaded(a){return!a.complete||"undefined"!=typeof a.naturalWidth&&0==a.naturalWidth?!1:!0}function getImageData(a,b,c,d){var e=new Image;e.setAttribute("crossOrigin","anonymous"),e.src=a,e.onload=function(){if(c){try{if(b){var d=document.createElement("canvas");if(d.getContext&&d.getContext("2d")){d.width=e.width,d.height=e.height,d.getContext("2d").drawImage(e,0,0);var f=d.toDataURL("image/png")}}}catch(g){}d={width:e.naturalWidth,height:e.naturalHeight,url:a},f&&(d.dataUrl=f),c(d)}},e.onerror=d}function areImagesLoaded(a){if(!a||0==a.length)return!0;for(var b=0;b<a.length;b++)if(!isImageLoaded(a[b]))return!1;return!0}function OnPreviewPicLoad(a,b,c){a=$(a.currentTarget);var d=a.width()||a[0].width,e=a.height()||a[0].height;b=b||a.parent().width(),c=c||a.parent().height(),c=ScaleImage(d,e,b,c,!0),c.width&&a.width(c.width),c.height&&a.height(c.height),a.css("left",c.targetleft),a.css("top",c.targettop)}function ScaleImage(a,b,c,d,e){var f={width:0,height:0,fScaleToTargetWidth:!0};if(0>=a||0>=b||0>=c||0>=d)return f;var g=a*d/b;return(e=g>c?e:!e)?(f.width=Math.floor(c),f.height=Math.floor(b*c/a),f.fScaleToTargetWidth=!0):(f.width=Math.floor(g),f.height=Math.floor(d),f.fScaleToTargetWidth=!1),f.targetleft=Math.floor((c-f.width)/2),f.targettop=Math.floor((d-f.height)/2),f}function ScaleImageFloat(a,b,c,d,e){var f={width:0,height:0,fScaleToTargetWidth:!0};if(0>=a||0>=b||0>=c||0>=d)return f;var g=a*d/b;return(e=g>c?e:!e)?(f.width=c,f.height=b*c/a,f.fScaleToTargetWidth=!0):(f.width=g,f.height=d,f.fScaleToTargetWidth=!1),f.targetleft=(c-f.width)/2,f.targettop=(d-f.height)/2,f}function componentToHex(a){return a=a.toString(16).trim(),1==a.length?"0"+a:a}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function floodFillScanline(a,b,c,d,e,f,g,h,i,j){var k=[[a,a,b,null,!0,!0]];f(a,b,c,d,g,i);for(var l,m,n,o;k.length;){if(l=k.pop(),a=!0===l[3],m=!1===l[3],n=l[0],b=l[2],l[4])for(;n>0&&e(n-1,b,c,d,g,h,i,j);)n--,f(n,b,c,d,g,i);if(o=l[1],l[5])for(;c-1>o&&e(o+1,b,c,d,g,h,i,j);)o++,f(o,b,c,d,g,i);l[0]--,l[1]++;var p=function(a,b,m){for(var p,q=n,r=!1,s=n;o>=s;s++)p=(b||s<l[0]||s>l[1])&&e(s,a,c,d,g,h,i,j),!r&&p?(q=s,r=!0):r&&!p&&(k.push([q,s-1,a,m,q==n,!1]),r=!1),r&&f(s,a,c,d,g,i),b||s!=l[0]||(s=l[1]);r&&k.push([q,s-1,a,m,q==n,!0])};d>b&&p(b+1,!m,!0),b>0&&p(b-1,!a,!1)}}function clone(a){if(null==a||"object"!=typeof a)return a;var b,c=a.constructor();for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}function isSideDefined(a,b){for(var c=0;c<b.length;c++)if(b[c].name===a)return!0;return!1}function desaturatePicture(a){var b=document.createElement("canvas");b.id="desaturared",ctx=b.getContext("2d"),ctx.drawImage(a,2,2),b.width=a.naturalWidth,b.height=a.naturalHeight,ctx.drawImage(a,0,0),a=ctx.getImageData(0,0,b.width,b.height);for(var c=a.data,d=0,e=c.length;e>d;d+=4){var f=.3*c[d]+.59*c[d+1]+.11*c[d+2];c[d]=f,c[d+1]=f,c[d+2]=f}return ctx.putImageData(a,0,0),b.toDataURL()}function swap(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function partition(a,b,c){for(var d=a[Math.floor((c+b)/2)],e=b,f=c;f>=e;){for(;a[e]<d;)e++;for(;a[f]>d;)f--;f>=e&&(swap(a,e,f),e++,f--)}return e}function quickSort(a,b,c){var d;return a.length>1&&(d=partition(a,b,c),d-1>b&&quickSort(a,b,d-1),c>d&&quickSort(a,d,c)),a}function getUrlHashParameterStr(){var a=window.location.href;if(a.indexOf("#")>0){var b=a.substr(a.indexOf("#"),a.length-1);return b}}function PCA(){for(var a="北京市$市辖区,东城区,西城区,崇文区,宣武区,朝阳区,丰台区,石景山区,海淀区,门头沟区,房山区,通州区,顺义区,昌平区,大兴区,怀柔区,平谷区|市辖县,密云县,延庆县#天津市$市辖区,和平区,河东区,河西区,南开区,河北区,红桥区,塘沽区,汉沽区,大港区,东丽区,西青区,津南区,北辰区,武清区,宝坻区|市辖县,宁河县,静海县,蓟县#河北省$石家庄市,市辖区,长安区,桥东区,桥西区,新华区,井陉矿区,裕华区,井陉县,正定县,栾城县,行唐县,灵寿县,高邑县,深泽县,赞皇县,无极县,平山县,元氏县,赵县,辛集市,藁城市,晋州市,新乐市,鹿泉市|唐山市,市辖区,路南区,路北区,古冶区,开平区,丰南区,丰润区,滦县,滦南县,乐亭县,迁西县,玉田县,唐海县,遵化市,迁安市|秦皇岛市,市辖区,海港区,山海关区,北戴河区,青龙满族自治县,昌黎县,抚宁县,卢龙县|邯郸市,市辖区,邯山区,丛台区,复兴区,峰峰矿区,邯郸县,临漳县,成安县,大名县,涉县,磁县,肥乡县,永年县,邱县,鸡泽县,广平县,馆陶县,魏县,曲周县,武安市|邢台市,市辖区,桥东区,桥西区,邢台县,临城县,内丘县,柏乡县,隆尧县,任县,南和县,宁晋县,巨鹿县,新河县,广宗县,平乡县,威县,清河县,临西县,南宫市,沙河市|保定市,市辖区,新市区,北市区,南市区,满城县,清苑县,涞水县,阜平县,徐水县,定兴县,唐县,高阳县,容城县,涞源县,望都县,安新县,易县,曲阳县,蠡县,顺平县,博野县,雄县,涿州市,定州市,安国市,高碑店市|张家口市,市辖区,桥东区,桥西区,宣化区,下花园区,宣化县,张北县,康保县,沽源县,尚义县,蔚县,阳原县,怀安县,万全县,怀来县,涿鹿县,赤城县,崇礼县|承德市,市辖区,双桥区,双滦区,鹰手营子矿区,承德县,兴隆县,平泉县,滦平县,隆化县,丰宁满族自治县,宽城满族自治县,围场满族蒙古族自治县|沧州市,市辖区,新华区,运河区,沧县,青县,东光县,海兴县,盐山县,肃宁县,南皮县,吴桥县,献县,孟村回族自治县,泊头市,任丘市,黄骅市,河间市|廊坊市,市辖区,安次区,广阳区,固安县,永清县,香河县,大城县,文安县,大厂回族自治县,霸州市,三河市|衡水市,市辖区,桃城区,枣强县,武邑县,武强县,饶阳县,安平县,故城县,景县,阜城县,冀州市,深州市#山西省$太原市,市辖区,小店区,迎泽区,杏花岭区,尖草坪区,万柏林区,晋源区,清徐县,阳曲县,娄烦县,古交市|大同市,市辖区,城区,矿区,南郊区,新荣区,阳高县,天镇县,广灵县,灵丘县,浑源县,左云县,大同县|阳泉市,市辖区,城区,矿区,郊区,平定县,盂县|长治市,市辖区,城区,郊区,长治县,襄垣县,屯留县,平顺县,黎城县,壶关县,长子县,武乡县,沁县,沁源县,潞城市|晋城市,市辖区,城区,沁水县,阳城县,陵川县,泽州县,高平市|朔州市,市辖区,朔城区,平鲁区,山阴县,应县,右玉县,怀仁县|晋中市,市辖区,榆次区,榆社县,左权县,和顺县,昔阳县,寿阳县,太谷县,祁县,平遥县,灵石县,介休市|运城市,市辖区,盐湖区,临猗县,万荣县,闻喜县,稷山县,新绛县,绛县,垣曲县,夏县,平陆县,芮城县,永济市,河津市|忻州市,市辖区,忻府区,定襄县,五台县,代县,繁峙县,宁武县,静乐县,神池县,五寨县,岢岚县,河曲县,保德县,偏关县,原平市|临汾市,市辖区,尧都区,曲沃县,翼城县,襄汾县,洪洞县,古县,安泽县,浮山县,吉县,乡宁县,大宁县,隰县,永和县,蒲县,汾西县,侯马市,霍州市|吕梁市,市辖区,离石区,文水县,交城县,兴县,临县,柳林县,石楼县,岚县,方山县,中阳县,交口县,孝义市,汾阳市#内蒙古自治区$呼和浩特市,市辖区,新城区,回民区,玉泉区,赛罕区,土默特左旗,托克托县,和林格尔县,清水河县,武川县|包头市,市辖区,东河区,昆都仑区,青山区,石拐区,白云矿区,九原区,土默特右旗,固阳县,达尔罕茂明安联合旗|乌海市,市辖区,海勃湾区,海南区,乌达区|赤峰市,市辖区,红山区,元宝山区,松山区,阿鲁科尔沁旗,巴林左旗,巴林右旗,林西县,克什克腾旗,翁牛特旗,喀喇沁旗,宁城县,敖汉旗|通辽市,市辖区,科尔沁区,科尔沁左翼中旗,科尔沁左翼后旗,开鲁县,库伦旗,奈曼旗,扎鲁特旗,霍林郭勒市|鄂尔多斯市,东胜区,达拉特旗,准格尔旗,鄂托克前旗,鄂托克旗,杭锦旗,乌审旗,伊金霍洛旗|呼伦贝尔市,市辖区,海拉尔区,阿荣旗,莫力达瓦达斡尔族自治旗,鄂伦春自治旗,鄂温克族自治旗,陈巴尔虎旗,新巴尔虎左旗,新巴尔虎右旗,满洲里市,牙克石市,扎兰屯市,额尔古纳市,根河市|巴彦淖尔市,市辖区,临河区,五原县,磴口县,乌拉特前旗,乌拉特中旗,乌拉特后旗,杭锦后旗|乌兰察布市,市辖区,集宁区,卓资县,化德县,商都县,兴和县,凉城县,察哈尔右翼前旗,察哈尔右翼中旗,察哈尔右翼后旗,四子王旗,丰镇市|兴安盟,乌兰浩特市,阿尔山市,科尔沁右翼前旗,科尔沁右翼中旗,扎赉特旗,突泉县|锡林郭勒盟,二连浩特市,锡林浩特市,阿巴嘎旗,苏尼特左旗,苏尼特右旗,东乌珠穆沁旗,西乌珠穆沁旗,太仆寺旗,镶黄旗,正镶白旗,正蓝旗,多伦县|阿拉善盟,阿拉善左旗,阿拉善右旗,额济纳旗#辽宁省$沈阳市,市辖区,和平区,沈河区,大东区,皇姑区,铁西区,苏家屯区,东陵区,新城子区,于洪区,辽中县,康平县,法库县,新民市|大连市,市辖区,中山区,西岗区,沙河口区,甘井子区,旅顺口区,金州区,长海县,瓦房店市,普兰店市,庄河市|鞍山市,市辖区,铁东区,铁西区,立山区,千山区,台安县,岫岩满族自治县,海城市|抚顺市,市辖区,新抚区,东洲区,望花区,顺城区,抚顺县,新宾满族自治县,清原满族自治县|本溪市,市辖区,平山区,溪湖区,明山区,南芬区,本溪满族自治县,桓仁满族自治县|丹东市,市辖区,元宝区,振兴区,振安区,宽甸满族自治县,东港市,凤城市|锦州市,市辖区,古塔区,凌河区,太和区,黑山县,义县,凌海市,北宁市|营口市,市辖区,站前区,西市区,鲅鱼圈区,老边区,盖州市,大石桥市|阜新市,市辖区,海州区,新邱区,太平区,清河门区,细河区,阜新蒙古族自治县,彰武县|辽阳市,市辖区,白塔区,文圣区,宏伟区,弓长岭区,太子河区,辽阳县,灯塔市|盘锦市,市辖区,双台子区,兴隆台区,大洼县,盘山县|铁岭市,市辖区,银州区,清河区,铁岭县,西丰县,昌图县,调兵山市,开原市|朝阳市,市辖区,双塔区,龙城区,朝阳县,建平县,喀喇沁左翼蒙古族自治县,北票市,凌源市|葫芦岛市,市辖区,连山区,龙港区,南票区,绥中县,建昌县,兴城市#吉林省$长春市,市辖区,南关区,宽城区,朝阳区,二道区,绿园区,双阳区,农安县,九台市,榆树市,德惠市|吉林市,市辖区,昌邑区,龙潭区,船营区,丰满区,永吉县,蛟河市,桦甸市,舒兰市,磐石市|四平市,市辖区,铁西区,铁东区,梨树县,伊通满族自治县,公主岭市,双辽市|辽源市,市辖区,龙山区,西安区,东丰县,东辽县|通化市,市辖区,东昌区,二道江区,通化县,辉南县,柳河县,梅河口市,集安市|白山市,市辖区,八道江区,抚松县,靖宇县,长白朝鲜族自治县,江源县,临江市|松原市,市辖区,宁江区,前郭尔罗斯蒙古族自治县,长岭县,乾安县,扶余县|白城市,市辖区,洮北区,镇赉县,通榆县,洮南市,大安市|延边朝鲜族自治州,延吉市,图们市,敦化市,珲春市,龙井市,和龙市,汪清县,安图县#黑龙江省$哈尔滨市,市辖区,道里区,南岗区,道外区,香坊区,动力区,平房区,松北区,呼兰区,依兰县,方正县,宾县,巴彦县,木兰县,通河县,延寿县,阿城市,双城市,尚志市,五常市|齐齐哈尔市,市辖区,龙沙区,建华区,铁锋区,昂昂溪区,富拉尔基区,碾子山区,梅里斯达斡尔族区,龙江县,依安县,泰来县,甘南县,富裕县,克山县,克东县,拜泉县,讷河市|鸡西市,市辖区,鸡冠区,恒山区,滴道区,梨树区,城子河区,麻山区,鸡东县,虎林市,密山市|鹤岗市,市辖区,向阳区,工农区,南山区,兴安区,东山区,兴山区,萝北县,绥滨县|双鸭山市,市辖区,尖山区,岭东区,四方台区,宝山区,集贤县,友谊县,宝清县,饶河县|大庆市,市辖区,萨尔图区,龙凤区,让胡路区,红岗区,大同区,肇州县,肇源县,林甸县,杜尔伯特蒙古族自治县|伊春市,市辖区,伊春区,南岔区,友好区,西林区,翠峦区,新青区,美溪区,金山屯区,五营区,乌马河区,汤旺河区,带岭区,乌伊岭区,红星区,上甘岭区,嘉荫县,铁力市|佳木斯市,市辖区,永红区,向阳区,前进区,东风区,郊区,桦南县,桦川县,汤原县,抚远县,同江市,富锦市|七台河市,市辖区,新兴区,桃山区,茄子河区,勃利县|牡丹江市,市辖区,东安区,阳明区,爱民区,西安区,东宁县,林口县,绥芬河市,海林市,宁安市,穆棱市|黑河市,市辖区,爱辉区,嫩江县,逊克县,孙吴县,北安市,五大连池市|绥化市,市辖区,北林区,望奎县,兰西县,青冈县,庆安县,明水县,绥棱县,安达市,肇东市,海伦市|大兴安岭地区,呼玛县,塔河县,漠河县#上海市$市辖区,黄浦区,卢湾区,徐汇区,长宁区,静安区,普陀区,闸北区,虹口区,杨浦区,闵行区,宝山区,嘉定区,浦东新区,金山区,松江区,青浦区,南汇区,奉贤区|市辖县,崇明县#江苏省$南京市,市辖区,玄武区,白下区,秦淮区,建邺区,鼓楼区,下关区,浦口区,栖霞区,雨花台区,江宁区,六合区,溧水县,高淳县|无锡市,市辖区,崇安区,南长区,北塘区,锡山区,惠山区,滨湖区,江阴市,宜兴市|徐州市,市辖区,鼓楼区,云龙区,九里区,贾汪区,泉山区,丰县,沛县,铜山县,睢宁县,新沂市,邳州市|常州市,市辖区,天宁区,钟楼区,戚墅堰区,新北区,武进区,溧阳市,金坛市|苏州市,市辖区,沧浪区,平江区,金阊区,虎丘区,吴中区,相城区,常熟市,张家港市,昆山市,吴江市,太仓市|南通市,市辖区,崇川区,港闸区,海安县,如东县,启东市,如皋市,通州市,海门市|连云港市,市辖区,连云区,新浦区,海州区,赣榆县,东海县,灌云县,灌南县|淮安市,市辖区,清河区,楚州区,淮阴区,清浦区,涟水县,洪泽县,盱眙县,金湖县|盐城市,市辖区,亭湖区,盐都区,响水县,滨海县,阜宁县,射阳县,建湖县,东台市,大丰市|扬州市,市辖区,广陵区,邗江区,维扬区,宝应县,仪征市,高邮市,江都市|镇江市,市辖区,京口区,润州区,丹徒区,丹阳市,扬中市,句容市|泰州市,市辖区,海陵区,高港区,兴化市,靖江市,泰兴市,姜堰市|宿迁市,市辖区,宿城区,宿豫区,沭阳县,泗阳县,泗洪县#浙江省$杭州市,市辖区,上城区,下城区,江干区,拱墅区,西湖区,滨江区,萧山区,余杭区,桐庐县,淳安县,建德市,富阳市,临安市|宁波市,市辖区,海曙区,江东区,江北区,北仑区,镇海区,鄞州区,象山县,宁海县,余姚市,慈溪市,奉化市|温州市,市辖区,鹿城区,龙湾区,瓯海区,洞头县,永嘉县,平阳县,苍南县,文成县,泰顺县,瑞安市,乐清市|嘉兴市,市辖区,秀城区,秀洲区,嘉善县,海盐县,海宁市,平湖市,桐乡市|湖州市,市辖区,吴兴区,南浔区,德清县,长兴县,安吉县|绍兴市,市辖区,越城区,绍兴县,新昌县,诸暨市,上虞市,嵊州市|金华市,市辖区,婺城区,金东区,武义县,浦江县,磐安县,兰溪市,义乌市,东阳市,永康市|衢州市,市辖区,柯城区,衢江区,常山县,开化县,龙游县,江山市|舟山市,市辖区,定海区,普陀区,岱山县,嵊泗县|台州市,市辖区,椒江区,黄岩区,路桥区,玉环县,三门县,天台县,仙居县,温岭市,临海市|丽水市,市辖区,莲都区,青田县,缙云县,遂昌县,松阳县,云和县,庆元县,景宁畲族自治县,龙泉市#安徽省$合肥市,市辖区,瑶海区,庐阳区,蜀山区,包河区,长丰县,肥东县,肥西县|芜湖市,市辖区,镜湖区,弋江区,鸠江区,三山区,芜湖县,繁昌县,南陵县|蚌埠市,市辖区,龙子湖区,蚌山区,禹会区,淮上区,怀远县,五河县,固镇县|淮南市,市辖区,大通区,田家庵区,谢家集区,八公山区,潘集区,凤台县|马鞍山市,市辖区,金家庄区,花山区,雨山区,当涂县|淮北市,市辖区,杜集区,相山区,烈山区,濉溪县|铜陵市,市辖区,铜官山区,狮子山区,郊区,铜陵县|安庆市,市辖区,迎江区,大观区,宜秀区,怀宁县,枞阳县,潜山县,太湖县,宿松县,望江县,岳西县,桐城市|黄山市,市辖区,屯溪区,黄山区,徽州区,歙县,休宁县,黟县,祁门县|滁州市,市辖区,琅琊区,南谯区,来安县,全椒县,定远县,凤阳县,天长市,明光市|阜阳市,市辖区,颍州区,颍东区,颍泉区,临泉县,太和县,阜南县,颍上县,界首市|宿州市,市辖区,埇桥区,砀山县,萧县,灵璧县,泗县|巢湖市,市辖区,居巢区,庐江县,无为县,含山县,和县|六安市,市辖区,金安区,裕安区,寿县,霍邱县,舒城县,金寨县,霍山县|亳州市,市辖区,谯城区,涡阳县,蒙城县,利辛县|池州市,市辖区,贵池区,东至县,石台县,青阳县|宣城市,市辖区,宣州区,郎溪县,广德县,泾县,绩溪县,旌德县,宁国市#福建省$福州市,市辖区,鼓楼区,台江区,仓山区,马尾区,晋安区,闽侯县,连江县,罗源县,闽清县,永泰县,平潭县,福清市,长乐市|厦门市,市辖区,思明区,海沧区,湖里区,集美区,同安区,翔安区|莆田市,市辖区,城厢区,涵江区,荔城区,秀屿区,仙游县|三明市,市辖区,梅列区,三元区,明溪县,清流县,宁化县,大田县,尤溪县,沙县,将乐县,泰宁县,建宁县,永安市|泉州市,市辖区,鲤城区,丰泽区,洛江区,泉港区,惠安县,安溪县,永春县,德化县,金门县,石狮市,晋江市,南安市|漳州市,市辖区,芗城区,龙文区,云霄县,漳浦县,诏安县,长泰县,东山县,南靖县,平和县,华安县,龙海市|南平市,市辖区,延平区,顺昌县,浦城县,光泽县,松溪县,政和县,邵武市,武夷山市,建瓯市,建阳市|龙岩市,市辖区,新罗区,长汀县,永定县,上杭县,武平县,连城县,漳平市|宁德市,市辖区,蕉城区,霞浦县,古田县,屏南县,寿宁县,周宁县,柘荣县,福安市,福鼎市#江西省$南昌市,市辖区,东湖区,西湖区,青云谱区,湾里区,青山湖区,南昌县,新建县,安义县,进贤县|景德镇市,市辖区,昌江区,珠山区,浮梁县,乐平市|萍乡市,市辖区,安源区,湘东区,莲花县,上栗县,芦溪县|九江市,市辖区,庐山区,浔阳区,九江县,武宁县,修水县,永修县,德安县,星子县,都昌县,湖口县,彭泽县,瑞昌市|新余市,市辖区,渝水区,分宜县|鹰潭市,市辖区,月湖区,余江县,贵溪市|赣州市,市辖区,章贡区,赣县,信丰县,大余县,上犹县,崇义县,安远县,龙南县,定南县,全南县,宁都县,于都县,兴国县,会昌县,寻乌县,石城县,瑞金市,南康市|吉安市,市辖区,吉州区,青原区,吉安县,吉水县,峡江县,新干县,永丰县,泰和县,遂川县,万安县,安福县,永新县,井冈山市|宜春市,市辖区,袁州区,奉新县,万载县,上高县,宜丰县,靖安县,铜鼓县,丰城市,樟树市,高安市|抚州市,市辖区,临川区,南城县,黎川县,南丰县,崇仁县,乐安县,宜黄县,金溪县,资溪县,东乡县,广昌县|上饶市,市辖区,信州区,上饶县,广丰县,玉山县,铅山县,横峰县,弋阳县,余干县,鄱阳县,万年县,婺源县,德兴市#山东省$济南市,市辖区,历下区,市中区,槐荫区,天桥区,历城区,长清区,平阴县,济阳县,商河县,章丘市|青岛市,市辖区,市南区,市北区,四方区,黄岛区,崂山区,李沧区,城阳区,胶州市,即墨市,平度市,胶南市,莱西市|淄博市,市辖区,淄川区,张店区,博山区,临淄区,周村区,桓台县,高青县,沂源县|枣庄市,市辖区,市中区,薛城区,峄城区,台儿庄区,山亭区,滕州市|东营市,市辖区,东营区,河口区,垦利县,利津县,广饶县|烟台市,市辖区,芝罘区,福山区,牟平区,莱山区,长岛县,龙口市,莱阳市,莱州市,蓬莱市,招远市,栖霞市,海阳市|潍坊市,市辖区,潍城区,寒亭区,坊子区,奎文区,临朐县,昌乐县,青州市,诸城市,寿光市,安丘市,高密市,昌邑市|济宁市,市辖区,市中区,任城区,微山县,鱼台县,金乡县,嘉祥县,汶上县,泗水县,梁山县,曲阜市,兖州市,邹城市|泰安市,市辖区,泰山区,岱岳区,宁阳县,东平县,新泰市,肥城市|威海市,市辖区,环翠区,文登市,荣成市,乳山市|日照市,市辖区,东港区,岚山区,五莲县,莒县|莱芜市,市辖区,莱城区,钢城区|临沂市,市辖区,兰山区,罗庄区,河东区,沂南县,郯城县,沂水县,苍山县,费县,平邑县,莒南县,蒙阴县,临沭县|德州市,市辖区,德城区,陵县,宁津县,庆云县,临邑县,齐河县,平原县,夏津县,武城县,乐陵市,禹城市|聊城市,市辖区,东昌府区,阳谷县,莘县,茌平县,东阿县,冠县,高唐县,临清市|滨州市,市辖区,滨城区,惠民县,阳信县,无棣县,沾化县,博兴县,邹平县|菏泽市,市辖区,牡丹区,曹县,单县,成武县,巨野县,郓城县,鄄城县,定陶县,东明县#河南省$郑州市,市辖区,中原区,二七区,管城回族区,金水区,上街区,惠济区,中牟县,巩义市,荥阳市,新密市,新郑市,登封市|开封市,市辖区,龙亭区,顺河回族区,鼓楼区,禹王台区,金明区,杞县,通许县,尉氏县,开封县,兰考县|洛阳市,市辖区,老城区,西工区,廛河回族区,涧西区,吉利区,洛龙区,孟津县,新安县,栾川县,嵩县,汝阳县,宜阳县,洛宁县,伊川县,偃师市|平顶山市,市辖区,新华区,卫东区,石龙区,湛河区,宝丰县,叶县,鲁山县,郏县,舞钢市,汝州市|安阳市,市辖区,文峰区,北关区,殷都区,龙安区,安阳县,汤阴县,滑县,内黄县,林州市|鹤壁市,市辖区,鹤山区,山城区,淇滨区,浚县,淇县|新乡市,市辖区,红旗区,卫滨区,凤泉区,牧野区,新乡县,获嘉县,原阳县,延津县,封丘县,长垣县,卫辉市,辉县市|焦作市,市辖区,解放区,中站区,马村区,山阳区,修武县,博爱县,武陟县,温县,济源市,沁阳市,孟州市|濮阳市,市辖区,华龙区,清丰县,南乐县,范县,台前县,濮阳县|许昌市,市辖区,魏都区,许昌县,鄢陵县,襄城县,禹州市,长葛市|漯河市,市辖区,源汇区,郾城区,召陵区,舞阳县,临颍县|三门峡市,市辖区,湖滨区,渑池县,陕县,卢氏县,义马市,灵宝市|南阳市,市辖区,宛城区,卧龙区,南召县,方城县,西峡县,镇平县,内乡县,淅川县,社旗县,唐河县,新野县,桐柏县,邓州市|商丘市,市辖区,梁园区,睢阳区,民权县,睢县,宁陵县,柘城县,虞城县,夏邑县,永城市|信阳市,市辖区,浉河区,平桥区,罗山县,光山县,新县,商城县,固始县,潢川县,淮滨县,息县|周口市,市辖区,川汇区,扶沟县,西华县,商水县,沈丘县,郸城县,淮阳县,太康县,鹿邑县,项城市|驻马店市,市辖区,驿城区,西平县,上蔡县,平舆县,正阳县,确山县,泌阳县,汝南县,遂平县,新蔡县#湖北省$武汉市,市辖区,江岸区,江汉区,硚口区,汉阳区,武昌区,青山区,洪山区,东西湖区,汉南区,蔡甸区,江夏区,黄陂区,新洲区|黄石市,市辖区,黄石港区,西塞山区,下陆区,铁山区,阳新县,大冶市|十堰市,市辖区,茅箭区,张湾区,郧县,郧西县,竹山县,竹溪县,房县,丹江口市|宜昌市,市辖区,西陵区,伍家岗区,点军区,猇亭区,夷陵区,远安县,兴山县,秭归县,长阳土家族自治县,五峰土家族自治县,宜都市,当阳市,枝江市|襄樊市,市辖区,襄城区,樊城区,襄阳区,南漳县,谷城县,保康县,老河口市,枣阳市,宜城市|鄂州市,市辖区,梁子湖区,华容区,鄂城区|荆门市,市辖区,东宝区,掇刀区,京山县,沙洋县,钟祥市|孝感市,市辖区,孝南区,孝昌县,大悟县,云梦县,应城市,安陆市,汉川市|荆州市,市辖区,沙市区,荆州区,公安县,监利县,江陵县,石首市,洪湖市,松滋市|黄冈市,市辖区,黄州区,团风县,红安县,罗田县,英山县,浠水县,蕲春县,黄梅县,麻城市,武穴市|咸宁市,市辖区,咸安区,嘉鱼县,通城县,崇阳县,通山县,赤壁市|随州市,市辖区,曾都区,广水市|恩施土家族苗族自治州,恩施市,利川市,建始县,巴东县,宣恩县,咸丰县,来凤县,鹤峰县|省直辖行政单位,仙桃市,潜江市,天门市,神农架林区#湖南省$长沙市,市辖区,芙蓉区,天心区,岳麓区,开福区,雨花区,长沙县,望城县,宁乡县,浏阳市|株洲市,市辖区,荷塘区,芦淞区,石峰区,天元区,株洲县,攸县,茶陵县,炎陵县,醴陵市|湘潭市,市辖区,雨湖区,岳塘区,湘潭县,湘乡市,韶山市|衡阳市,市辖区,珠晖区,雁峰区,石鼓区,蒸湘区,南岳区,衡阳县,衡南县,衡山县,衡东县,祁东县,耒阳市,常宁市|邵阳市,市辖区,双清区,大祥区,北塔区,邵东县,新邵县,邵阳县,隆回县,洞口县,绥宁县,新宁县,城步苗族自治县,武冈市|岳阳市,市辖区,岳阳楼区,云溪区,君山区,岳阳县,华容县,湘阴县,平江县,汨罗市,临湘市|常德市,市辖区,武陵区,鼎城区,安乡县,汉寿县,澧县,临澧县,桃源县,石门县,津市市|张家界市,市辖区,永定区,武陵源区,慈利县,桑植县|益阳市,市辖区,资阳区,赫山区,南县,桃江县,安化县,沅江市|郴州市,市辖区,北湖区,苏仙区,桂阳县,宜章县,永兴县,嘉禾县,临武县,汝城县,桂东县,安仁县,资兴市|永州市,市辖区,零陵区,冷水滩区,祁阳县,东安县,双牌县,道县,江永县,宁远县,蓝山县,新田县,江华瑶族自治县|怀化市,市辖区,鹤城区,中方县,沅陵县,辰溪县,溆浦县,会同县,麻阳苗族自治县,新晃侗族自治县,芷江侗族自治县,靖州苗族侗族自治县,通道侗族自治县,洪江市|娄底市,市辖区,娄星区,双峰县,新化县,冷水江市,涟源市|湘西土家族苗族自治州,吉首市,泸溪县,凤凰县,花垣县,保靖县,古丈县,永顺县,龙山县#广东省$广州市,市辖区,荔湾区,越秀区,海珠区,天河区,白云区,黄埔区,番禺区,花都区,南沙区,萝岗区,增城市,从化市|韶关市,市辖区,武江区,浈江区,曲江区,始兴县,仁化县,翁源县,乳源瑶族自治县,新丰县,乐昌市,南雄市|深圳市,市辖区,罗湖区,福田区,南山区,宝安区,龙岗区,盐田区|珠海市,市辖区,香洲区,斗门区,金湾区|汕头市,市辖区,龙湖区,金平区,濠江区,潮阳区,潮南区,澄海区,南澳县|佛山市,市辖区,禅城区,南海区,顺德区,三水区,高明区|江门市,市辖区,蓬江区,江海区,新会区,台山市,开平市,鹤山市,恩平市|湛江市,市辖区,赤坎区,霞山区,坡头区,麻章区,遂溪县,徐闻县,廉江市,雷州市,吴川市|茂名市,市辖区,茂南区,茂港区,电白县,高州市,化州市,信宜市|肇庆市,市辖区,端州区,鼎湖区,广宁县,怀集县,封开县,德庆县,高要市,四会市|惠州市,市辖区,惠城区,惠阳区,博罗县,惠东县,龙门县|梅州市,市辖区,梅江区,梅县,大埔县,丰顺县,五华县,平远县,蕉岭县,兴宁市|汕尾市,市辖区,城区,海丰县,陆河县,陆丰市|河源市,市辖区,源城区,紫金县,龙川县,连平县,和平县,东源县|阳江市,市辖区,江城区,阳西县,阳东县,阳春市|清远市,市辖区,清城区,佛冈县,阳山县,连山壮族瑶族自治县,连南瑶族自治县,清新县,英德市,连州市|东莞市|中山市|潮州市,市辖区,湘桥区,潮安县,饶平县|揭阳市,市辖区,榕城区,揭东县,揭西县,惠来县,普宁市|云浮市,市辖区,云城区,新兴县,郁南县,云安县,罗定市#广西壮族自治区$南宁市,市辖区,兴宁区,青秀区,江南区,西乡塘区,良庆区,邕宁区,武鸣县,隆安县,马山县,上林县,宾阳县,横县|柳州市,市辖区,城中区,鱼峰区,柳南区,柳北区,柳江县,柳城县,鹿寨县,融安县,融水苗族自治县,三江侗族自治县|桂林市,市辖区,秀峰区,叠彩区,象山区,七星区,雁山区,阳朔县,临桂县,灵川县,全州县,兴安县,永福县,灌阳县,龙胜各族自治县,资源县,平乐县,荔蒲县,恭城瑶族自治县|梧州市,市辖区,万秀区,蝶山区,长洲区,苍梧县,藤县,蒙山县,岑溪市|北海市,市辖区,海城区,银海区,铁山港区,合浦县|防城港市,市辖区,港口区,防城区,上思县,东兴市|钦州市,市辖区,钦南区,钦北区,灵山县,浦北县|贵港市,市辖区,港北区,港南区,覃塘区,平南县,桂平市|玉林市,市辖区,玉州区,容县,陆川县,博白县,兴业县,北流市|百色市,市辖区,右江区,田阳县,田东县,平果县,德保县,靖西县,那坡县,凌云县,乐业县,田林县,西林县,隆林各族自治县|贺州市,市辖区,八步区,昭平县,钟山县,富川瑶族自治县|河池市,市辖区,金城江区,南丹县,天峨县,凤山县,东兰县,罗城仫佬族自治县,环江毛南族自治县,巴马瑶族自治县,都安瑶族自治县,大化瑶族自治县,宜州市|来宾市,市辖区,兴宾区,忻城县,象州县,武宣县,金秀瑶族自治县,合山市|崇左市,市辖区,江洲区,扶绥县,宁明县,龙州县,大新县,天等县,凭祥市#海南省$海口市,市辖区,秀英区,龙华区,琼山区,美兰区|三亚市,市辖区|省直辖县级行政单位,五指山市,琼海市,儋州市,文昌市,万宁市,东方市,定安县,屯昌县,澄迈县,临高县,白沙黎族自治县,昌江黎族自治县,乐东黎族自治县,陵水黎族自治县,保亭黎族苗族自治县,琼中黎族苗族自治县,西沙群岛,南沙群岛,中沙群岛的岛礁及其海域#重庆市$市辖区,万州区,涪陵区,渝中区,大渡口区,江北区,沙坪坝区,九龙坡区,南岸区,北碚区,万盛区,双桥区,渝北区,巴南区,黔江区,长寿区|市辖县,綦江县,潼南县,铜梁县,大足县,荣昌县,璧山县,梁平县,城口县,丰都县,垫江县,武隆县,忠县,开县,云阳县,奉节县,巫山县,巫溪县,石柱土家族自治县,秀山土家族苗族自治县,酉阳土家族苗族自治县,彭水苗族土家族自治县|县级市,江津市,合川市,永川市,南川市#四川省$成都市,市辖区,锦江区,青羊区,金牛区,武侯区,成华区,龙泉驿区,青白江区,新都区,温江区,金堂县,双流县,郫县,大邑县,蒲江县,新津县,都江堰市,彭州市,邛崃市,崇州市|自贡市,市辖区,自流井区,贡井区,大安区,沿滩区,荣县,富顺县|攀枝花市,市辖区,东区,西区,仁和区,米易县,盐边县|泸州市,市辖区,江阳区,纳溪区,龙马潭区,泸县,合江县,叙永县,古蔺县|德阳市,市辖区,旌阳区,中江县,罗江县,广汉市,什邡市,绵竹市|绵阳市,市辖区,涪城区,游仙区,三台县,盐亭县,安县,梓潼县,北川羌族自治县,平武县,江油市|广元市,市辖区,市中区,元坝区,朝天区,旺苍县,青川县,剑阁县,苍溪县|遂宁市,市辖区,船山区,安居区,蓬溪县,射洪县,大英县|内江市,市辖区,市中区,东兴区,威远县,资中县,隆昌县|乐山市,市辖区,市中区,沙湾区,五通桥区,金口河区,犍为县,井研县,夹江县,沐川县,峨边彝族自治县,马边彝族自治县,峨眉山市|南充市,市辖区,顺庆区,高坪区,嘉陵区,南部县,营山县,蓬安县,仪陇县,西充县,阆中市|眉山市,市辖区,东坡区,仁寿县,彭山县,洪雅县,丹棱县,青神县|宜宾市,市辖区,翠屏区,宜宾县,南溪县,江安县,长宁县,高县,珙县,筠连县,兴文县,屏山县|广安市,市辖区,广安区,岳池县,武胜县,邻水县,华蓥市|达州市,市辖区,通川区,达县,宣汉县,开江县,大竹县,渠县,万源市|雅安市,市辖区,雨城区,名山县,荥经县,汉源县,石棉县,天全县,芦山县,宝兴县|巴中市,市辖区,巴州区,通江县,南江县,平昌县|资阳市,市辖区,雁江区,安岳县,乐至县,简阳市|阿坝藏族羌族自治州,汶川县,理县,茂县,松潘县,九寨沟县,金川县,小金县,黑水县,马尔康县,壤塘县,阿坝县,若尔盖县,红原县|甘孜藏族自治州,康定县,泸定县,丹巴县,九龙县,雅江县,道孚县,炉霍县,甘孜县,新龙县,德格县,白玉县,石渠县,色达县,理塘县,巴塘县,乡城县,稻城县,得荣县|凉山彝族自治州,西昌市,木里藏族自治县,盐源县,德昌县,会理县,会东县,宁南县,普格县,布拖县,金阳县,昭觉县,喜德县,冕宁县,越西县,甘洛县,美姑县,雷波县#贵州省$贵阳市,市辖区,南明区,云岩区,花溪区,乌当区,白云区,小河区,开阳县,息烽县,修文县,清镇市|六盘水市,钟山区,六枝特区,水城县,盘县|遵义市,市辖区,红花岗区,汇川区,遵义县,桐梓县,绥阳县,正安县,道真仡佬族苗族自治县,务川仡佬族苗族自治县,凤冈县,湄潭县,余庆县,习水县,赤水市,仁怀市|安顺市,市辖区,西秀区,平坝县,普定县,镇宁布依族苗族自治县,关岭布依族苗族自治县,紫云苗族布依族自治县|铜仁地区,铜仁市,江口县,玉屏侗族自治县,石阡县,思南县,印江土家族苗族自治县,德江县,沿河土家族自治县,松桃苗族自治县,万山特区|黔西南布依族苗族自治州,兴义市,兴仁县,普安县,晴隆县,贞丰县,望谟县,册亨县,安龙县|毕节地区,毕节市,大方县,黔西县,金沙县,织金县,纳雍县,威宁彝族回族苗族自治县,赫章县|黔东南苗族侗族自治州,凯里市,黄平县,施秉县,三穗县,镇远县,岑巩县,天柱县,锦屏县,剑河县,台江县,黎平县,榕江县,从江县,雷山县,麻江县,丹寨县|黔南布依族苗族自治州,都匀市,福泉市,荔波县,贵定县,瓮安县,独山县,平塘县,罗甸县,长顺县,龙里县,惠水县,三都水族自治县#云南省$昆明市,市辖区,五华区,盘龙区,官渡区,西山区,东川区,呈贡县,晋宁县,富民县,宜良县,石林彝族自治县,嵩明县,禄劝彝族苗族自治县,寻甸回族彝族自治县,安宁市|曲靖市,市辖区,麒麟区,马龙县,陆良县,师宗县,罗平县,富源县,会泽县,沾益县,宣威市|玉溪市,市辖区,红塔区,江川县,澄江县,通海县,华宁县,易门县,峨山彝族自治县,新平彝族傣族自治县,元江哈尼族彝族傣族自治县|保山市,市辖区,隆阳区,施甸县,腾冲县,龙陵县,昌宁县|昭通市,市辖区,昭阳区,鲁甸县,巧家县,盐津县,大关县,永善县,绥江县,镇雄县,彝良县,威信县,水富县|丽江市,市辖区,古城区,玉龙纳西族自治县,永胜县,华坪县,宁蒗彝族自治县|思茅市,市辖区,翠云区,普洱哈尼族彝族自治县,墨江哈尼族自治县,景东彝族自治县,景谷傣族彝族自治县,镇沅彝族哈尼族拉祜族自治县,江城哈尼族彝族自治县,孟连傣族拉祜族佤族自治县,澜沧拉祜族自治县,西盟佤族自治县|临沧市,市辖区,临翔区,凤庆县,云县,永德县,镇康县,双江拉祜族佤族布朗族傣族自治县,耿马傣族佤族自治县,沧源佤族自治县|楚雄彝族自治州,楚雄市,双柏县,牟定县,南华县,姚安县,大姚县,永仁县,元谋县,武定县,禄丰县|红河哈尼族彝族自治州,个旧市,开远市,蒙自县,屏边苗族自治县,建水县,石屏县,弥勒县,泸西县,元阳县,红河县,金平苗族瑶族傣族自治县,绿春县,河口瑶族自治县|文山壮族苗族自治州,文山县,砚山县,西畴县,麻栗坡县,马关县,丘北县,广南县,富宁县|西双版纳傣族自治州,景洪市,勐海县,勐腊县|大理白族自治州,大理市,漾濞彝族自治县,祥云县,宾川县,弥渡县,南涧彝族自治县,巍山彝族回族自治县,永平县,云龙县,洱源县,剑川县,鹤庆县|德宏傣族景颇族自治州,瑞丽市,潞西市,梁河县,盈江县,陇川县|怒江傈僳族自治州,泸水县,福贡县,贡山独龙族怒族自治县,兰坪白族普米族自治县|迪庆藏族自治州,香格里拉县,德钦县,维西傈僳族自治县#西藏自治区$拉萨市,市辖区,城关区,林周县,当雄县,尼木县,曲水县,堆龙德庆县,达孜县,墨竹工卡县|昌都地区,昌都县,江达县,贡觉县,类乌齐县,丁青县,察雅县,八宿县,左贡县,芒康县,洛隆县,边坝县|山南地区,乃东县,扎囊县,贡嘎县,桑日县,琼结县,曲松县,措美县,洛扎县,加查县,隆子县,错那县,浪卡子县|日喀则地区,日喀则市,南木林县,江孜县,定日县,萨迦县,拉孜县,昂仁县,谢通门县,白朗县,仁布县,康马县,定结县,仲巴县,亚东县,吉隆县,聂拉木县,萨嘎县,岗巴县|那曲地区,那曲县,嘉黎县,比如县,聂荣县,安多县,申扎县,索县,班戈县,巴青县,尼玛县|阿里地区,普兰县,札达县,噶尔县,日土县,革吉县,改则县,措勤县|林芝地区,林芝县,工布江达县,米林县,墨脱县,波密县,察隅县,朗县#陕西省$西安市,市辖区,新城区,碑林区,莲湖区,灞桥区,未央区,雁塔区,阎良区,临潼区,长安区,蓝田县,周至县,户县,高陵县|铜川市,市辖区,王益区,印台区,耀州区,宜君县|宝鸡市,市辖区,渭滨区,金台区,陈仓区,凤翔县,岐山县,扶风县,眉县,陇县,千阳县,麟游县,凤县,太白县|咸阳市,市辖区,秦都区,杨凌区,渭城区,三原县,泾阳县,乾县,礼泉县,永寿县,彬县,长武县,旬邑县,淳化县,武功县,兴平市|渭南市,市辖区,临渭区,华县,潼关县,大荔县,合阳县,澄城县,蒲城县,白水县,富平县,韩城市,华阴市|延安市,市辖区,宝塔区,延长县,延川县,子长县,安塞县,志丹县,吴起县,甘泉县,富县,洛川县,宜川县,黄龙县,黄陵县|汉中市,市辖区,汉台区,南郑县,城固县,洋县,西乡县,勉县,宁强县,略阳县,镇巴县,留坝县,佛坪县|榆林市,市辖区,榆阳区,神木县,府谷县,横山县,靖边县,定边县,绥德县,米脂县,佳县,吴堡县,清涧县,子洲县|安康市,市辖区,汉滨区,汉阴县,石泉县,宁陕县,紫阳县,岚皋县,平利县,镇坪县,旬阳县,白河县|商洛市,市辖区,商州区,洛南县,丹凤县,商南县,山阳县,镇安县,柞水县#甘肃省$兰州市,市辖区,城关区,七里河区,西固区,安宁区,红古区,永登县,皋兰县,榆中县|嘉峪关市,市辖区|金昌市,市辖区,金川区,永昌县|白银市,市辖区,白银区,平川区,靖远县,会宁县,景泰县|天水市,市辖区,秦城区,北道区,清水县,秦安县,甘谷县,武山县,张家川回族自治县|武威市,市辖区,凉州区,民勤县,古浪县,天祝藏族自治县|张掖市,市辖区,甘州区,肃南裕固族自治县,民乐县,临泽县,高台县,山丹县|平凉市,市辖区,崆峒区,泾川县,灵台县,崇信县,华亭县,庄浪县,静宁县|酒泉市,市辖区,肃州区,金塔县,安西县,肃北蒙古族自治县,阿克塞哈萨克族自治县,玉门市,敦煌市|庆阳市,市辖区,西峰区,庆城县,环县,华池县,合水县,正宁县,宁县,镇原县|定西市,市辖区,安定区,通渭县,陇西县,渭源县,临洮县,漳县,岷县|陇南市,市辖区,武都区,成县,文县,宕昌县,康县,西和县,礼县,徽县,两当县|临夏回族自治州,临夏市,临夏县,康乐县,永靖县,广河县,和政县,东乡族自治县,积石山保安族东乡族撒拉族自治县|甘南藏族自治州,合作市,临潭县,卓尼县,舟曲县,迭部县,玛曲县,碌曲县,夏河县#青海省$西宁市,市辖区,城东区,城中区,城西区,城北区,大通回族土族自治县,湟中县,湟源县|海东地区,平安县,民和回族土族自治县,乐都县,互助土族自治县,化隆回族自治县,循化撒拉族自治县|海北藏族自治州,门源回族自治县,祁连县,海晏县,刚察县|黄南藏族自治州,同仁县,尖扎县,泽库县,河南蒙古族自治县|海南藏族自治州,共和县,同德县,贵德县,兴海县,贵南县|果洛藏族自治州,玛沁县,班玛县,甘德县,达日县,久治县,玛多县|玉树藏族自治州,玉树县,杂多县,称多县,治多县,囊谦县,曲麻莱县|海西蒙古族藏族自治州,格尔木市,德令哈市,乌兰县,都兰县,天峻县#宁夏回族自治区$银川市,市辖区,兴庆区,西夏区,金凤区,永宁县,贺兰县,灵武市|石嘴山市,市辖区,大武口区,惠农区,平罗县|吴忠市,市辖区,利通区,盐池县,同心县,青铜峡市|固原市,市辖区,原州区,西吉县,隆德县,泾源县,彭阳县|中卫市,市辖区,沙坡头区,中宁县,海原县#新疆维吾尔自治区$乌鲁木齐市,市辖区,天山区,沙依巴克区,新市区,水磨沟区,头屯河区,达坂城区,东山区,乌鲁木齐县|克拉玛依市,市辖区,独山子区,克拉玛依区,白碱滩区,乌尔禾区|吐鲁番地区,吐鲁番市,鄯善县,托克逊县|哈密地区,哈密市,巴里坤哈萨克自治县,伊吾县|昌吉回族自治州,昌吉市,阜康市,米泉市,呼图壁县,玛纳斯县,奇台县,吉木萨尔县,木垒哈萨克自治县|博尔塔拉蒙古自治州,博乐市,精河县,温泉县|巴音郭楞蒙古自治州,库尔勒市,轮台县,尉犁县,若羌县,且末县,焉耆回族自治县,和静县,和硕县,博湖县|阿克苏地区,阿克苏市,温宿县,库车县,沙雅县,新和县,拜城县,乌什县,阿瓦提县,柯坪县|克孜勒苏柯尔克孜自治州,阿图什市,阿克陶县,阿合奇县,乌恰县|喀什地区,喀什市,疏附县,疏勒县,英吉沙县,泽普县,莎车县,叶城县,麦盖提县,岳普湖县,伽师县,巴楚县,塔什库尔干塔吉克自治县|和田地区,和田市,和田县,墨玉县,皮山县,洛浦县,策勒县,于田县,民丰县|伊犁哈萨克自治州,伊宁市,奎屯市,伊宁县,察布查尔锡伯自治县,霍城县,巩留县,新源县,昭苏县,特克斯县,尼勒克县|塔城地区,塔城市,乌苏市,额敏县,沙湾县,托里县,裕民县,和布克赛尔蒙古自治县|阿勒泰地区,阿勒泰市,布尔津县,富蕴县,福海县,哈巴河县,青河县,吉木乃县|省直辖行政单位,石河子市,阿拉尔市,图木舒克市,五家渠市#香港特别行政区$香港,香港特别行政区#澳门特别行政区$澳门,澳门特别行政区#台湾省$台北市,中正区,大同区,中山区,松山区,大安区,万华区,信义区,士林区,北投区,内湖区,南港区,文山区|高雄市,新兴区,前金区,芩雅区,盐埕区,鼓山区,旗津区,前镇区,三民区,左营区,楠梓区,小港区|基隆市,仁爱区,信义区,中正区,中山区,安乐区,暖暖区,七堵区|台中市,中区,东区,南区,西区,北区,北屯区,西屯区,南屯区|台南市,中西区,东区,南区,北区,安平区,安南区|新竹市,东区,北区,香山区|嘉义市,东区,西区|县,台北县(板桥市),宜兰县(宜兰市),新竹县(竹北市),桃园县(桃园市),苗栗县(苗栗市),台中县(丰原市),彰化县(彰化市),南投县(南投市),嘉义县(太保市),云林县(斗六市),台南县(新营市),高雄县(凤山市),屏东县(屏东市),台东县(台东市),花莲县(花莲市),澎湖县(马公市)#其它$亚洲,阿富汗,巴林,孟加拉国,不丹,文莱,缅甸,塞浦路斯,印度,印度尼西亚,伊朗,伊拉克,日本,约旦,朝鲜,科威特,老挝,马尔代夫,黎巴嫩,马来西亚,以色列,蒙古,尼泊尔,阿曼,巴基斯坦,巴勒斯坦,菲律宾,沙特阿拉伯,新加坡,斯里兰卡,叙利亚,泰国,柬埔寨,土耳其,阿联酋,越南,也门,韩国,中国,中国香港,中国澳门,中国台湾|非洲,阿尔及利亚,安哥拉,厄里特里亚,法罗群鸟,加那利群岛(西)(拉斯帕尔马斯),贝宁,博茨瓦纳,布基纳法索,布隆迪,喀麦隆,加那利群岛(西)(圣克鲁斯),佛得角,中非,乍得,科摩罗,刚果,吉布提,埃及,埃塞俄比亚,赤道几内亚,加蓬,冈比亚,加纳,几内亚,南非,几内亚比绍,科特迪瓦,肯尼亚,莱索托,利比里亚,利比亚,马达加斯加,马拉维,马里,毛里塔尼亚,毛里求斯,摩洛哥,莫桑比克,尼日尔,尼日利亚,留尼旺岛,卢旺达,塞内加尔,塞舌尔,塞拉利昂,索马里,苏丹,斯威士兰,坦桑尼亚,圣赤勒拿,多哥,突尼斯,乌干达,扎伊尔,赞比亚,津巴布韦,纳米比亚,迪戈加西亚,桑给巴尔,马约特岛,圣多美和普林西比|欧洲,阿尔巴尼亚,安道尔,奥地利,比利时,保加利亚,捷克,丹麦,芬兰,法国,德国,直布罗陀(英),希腊,匈牙利,冰岛,爱尔兰,意大利,列支敦士登,斯洛伐克,卢森堡,马耳他,摩纳哥,荷兰,挪威,波兰,葡萄牙,马其顿,罗马尼亚,南斯拉夫,圣马力诺,西班牙,瑞典,瑞士,英国,科罗地亚,斯洛文尼亚,梵蒂冈,波斯尼亚和塞哥维那,俄罗斯联邦,亚美尼亚共和国,白俄罗斯共和国,格鲁吉亚共和国,哈萨克斯坦共和国,吉尔吉斯坦共和国,乌兹别克斯坦共和国,塔吉克斯坦共和国,土库曼斯坦共和国,乌克兰,立陶宛,拉脱维亚,爱沙尼亚,摩尔多瓦,阿塞拜疆|美洲,安圭拉岛,安提瓜和巴布达,阿根廷,阿鲁巴岛,阿森松,巴哈马,巴巴多斯,伯利兹,百慕大群岛,玻利维亚,巴西,加拿大,开曼群岛,智利,哥伦比亚,多米尼加联邦,哥斯达黎加,古巴,多米尼加共和国,厄瓜多尔,萨尔瓦多,法属圭亚那,格林纳达,危地马拉,圭亚那,海地,洪都拉斯,牙买加,马提尼克(法),墨西哥,蒙特塞拉特岛,荷属安的列斯群岛,尼加拉瓜,巴拿马,巴拉圭,秘鲁,波多黎哥,圣皮埃尔岛密克隆岛(法),圣克里斯托弗和尼维斯,圣卢西亚,福克兰群岛,维尔京群岛(英),圣文森特岛(英),维尔京群岛(美),苏里南,特立尼达和多巴哥,乌拉圭,美国,委内瑞拉,格陵兰岛,特克斯和凯科斯群岛,瓜多罗普|大洋洲,澳大利亚,科克群岛,斐济,法属波里尼西亚、塔希提,瓦努阿图,关岛,基里巴斯,马里亚纳群岛,中途岛,瑙鲁,新咯里多尼亚群岛,新西兰,巴布亚新几内亚,东萨摩亚,西萨摩亚,所罗门群岛,汤加,对诞岛,威克岛,科科斯岛,夏威夷,诺福克岛,帕劳,纽埃岛,图瓦卢,托克鲁,密克罗尼西亚,马绍尔群岛,瓦里斯加富士那群岛",b={},c=[],d=a.split("#"),e=0;e<d.length;e++){var f=d[e],g=f.split("$"),h=g[0];c.push(h),b[h]={};for(var i=g[1],j=i.split("|"),k=0;k<j.length;k++){for(var l,m=j[k],n=m.split(","),o=[],p=0;p<n.length;p++)0==p?l=n[p]:o.push(n[p]);b[h][l]=o}}this.provinces=c,this.hashData=b}function HistoryManager(a){function b(a){if(l.debug("function HistoryManager.addEvent"),!k)return!1;var b=a.side.snapshot,c=a.side.snapshots;return b<c.length-1&&(c=c.splice(0,b+1),a.side.snapshots=c),c.push(a),a.side.snapshot=c.length-1,eventManager.trigger("undoStackChanged"),b}function c(){var a=e();return clone(a.data.distressObj)}function d(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e={},f=0;f<d.historyProps.length;f++)e[d.historyProps[f]]=clone(d[d.historyProps[f]]);b.push(e)}return b}function e(){var a=h(i.activeSide.name);return a?a:(console.log("历史纪录管理: 找不到Side "+i.activeSide.name),!1)}function f(a,b){var c={del:[],add:[],change:[],distress:{needChange:!1}};typeof b.distress!=typeof a.distress?c.distress.needChange=!0:"undefined"!=typeof b.distress&&b.distress.distress_id!=a.distress.distress_id&&(c.distress.needChange=!0),c.distress.needChange&&(c.distress.obj=b.distress);for(var d,e=0;e<a.side.data.canvas.elements.length;e++)(d=searchInArray(b.elements,a.side.data.canvas.elements[e].id,"id"))?c.change.push(d):c.del.push(a.side.data.canvas.elements[e].id);for(e=0;e<b.elements.length;e++)searchInArray(a.side.data.canvas.elements,b.elements[e].id,"id")||c.add.push(b.elements[e].data);return c}function g(a){return k?void l.addSnapshot("elementEdited"):!1}function h(a){for(var b=0;b<j.length;b++)if(j[b].name.toUpperCase()==a.toUpperCase())return j[b];return!1}var i=a,j=[],k=!0,l=this,m=!1,n={};this.canUndo=function(){var a=e();return a.snapshots&&a.snapshots.length&&0<a.snapshot},this.canRedo=function(){var a=e();return a.snapshots&&a.snapshots.length&&a.snapshot<a.snapshots.length-1},this.resetSide=function(a){(a=h(a))&&(a.snapshots=[],a.snashot=0)},this.start=function(){for(var a=[],b=0;b<i.product.sides.length;b++)a.push({name:i.sides[b].name,index:b,data:i.sides[b],snapshots:[],snapshot:0});for(j=a,a=0;a<j.length;a++)j[a].snapshots.push({elements:d(j[a].data.boundingBox.elements),event:"init",side:j[a]});m=!1,n={},eventManager.trigger("undoStackChanged")},this.goToSnapshot=function(a){this.debug("function HistoryManager.goToSnapshot"),l.enable=!1;var b=e(),c=b.snapshot,d=b.snapshots;if(a==c)console.log("历史记录管理: 没有操作快照 "+a);else{if("undefined"!=typeof d[a]){for(c=f(d[c],d[a]),d=0;d<c.change.length;d++){var g,h=c.change[d],j=i.getElementById(h.id);for(g in h)j.object.canReportEdition=!1,j.object[g]!=h[g]&&(j.object[g]=h[g]),j.object.canReportEdition=!0,delete j.object.previewHtml;eventManager.trigger("layersChanged"),eventManager.trigger("rendered",[])}for(d=0;d<c.del.length;d++)h=i.getElementById(c.del[d]),"undefined"!=typeof h&&i.deleteElements(h.object);if(c.add.length){g=[];for(var k=eventManager.on("renderFromRedoComplete",function(){l.enable=!0,k()}),d=0;d<c.add.length;d++)g.push({side:b.data,element:c.add[d]}),c.add[d].width=c.add[d].object.width,c.add[d].height=c.add[d].object.height,c.add[d].x=c.add[d].object.x-c.add[d].object.width/2,c.add[d].y=c.add[d].object.y-c.add[d].object.height/2,c.add[d].rotate=c.add[d].object.rotation,c.add[d].z=c.add[d].object.z,c.add[d].colors&&(c.add[d].colors=c.add[d].object.colors),c.add[d].url&&(c.add[d].image.url=c.add[d].object.url);i.renderElements(g)}else l.enable=!0;return c.distress.needChange&&i.distressProxy(b.data,c.distress.obj),b.snapshot=a,i.activeSide.boundingBox.hide(),eventManager.trigger("undoStackChanged"),eventManager.trigger("undoSnapshotDone"),c}console.log("历史记录管理: "+a+" 是无效的")}},this.addSnapshot=function(a){k&&(a={side:e(),distress:c(),elements:d(i.activeSide.boundingBox.elements),event:a},b(a))},this.startEvent=function(a){if(k){if(m)return!1;m=!0,n={side:e(),distress:c(),event:a,elements:[]}}},this.endEvent=function(){k&&(n.elements=clone(d(i.activeSide.boundingBox.elements)),b(n),n=null,m=!1)},this.debug=function(a){},Object.defineProperties(this,{history:{get:function(){return j}},back:{get:function(){var a=e();0<a.snapshot&&(a=this.goToSnapshot(a.snapshot-1),eventManager.trigger("undoRedo",a))}},next:{get:function(){var a=e();a.snapshot<a.snapshots.length&&(a=this.goToSnapshot(a.snapshot+1),eventManager.trigger("undoRedo",a))}},enable:{get:function(){return k},set:function(a){k=a}}}),eventManager.on("elementEdited",g),eventManager.on("elementsDeleted",g),eventManager.on("elementAdded",g)}function EmptyUI(){}function BaseEZD(a){function b(){"undefined"!=typeof P&&P.start()}function c(a,b){!function(a,b){service.getDistress(b,function(b){var c=K(a);w(c,b)})}(a,b)}function d(a){if($("#designerContainer").css("width",a.width),$("#designerContainer").css("height",a.height),$("#designerContainer").css("margin-top","-10px"),$("#raphael").css("width",a.width),$("#raphael").css("height",a.height),S.setSize(a.width,a.height),Y.width=a.width,Y.height=a.height,Q){H(Q);for(var b=0;b<X.sides.length;b++)X.sides[b].workArea.setSize(a.width,a.height);J(Q,Q.activeRegion)}}function e(a){fa=0,1!=ba&&U.doZoom(),T=eventManager.on("elementRendered",p),eventManager.trigger("needDesign",a)}function f(a,b){for(var c=0;c<a.sides.length;c++){var d=a.sides[c];if(d=searchString(b.sides,d.location,"location"))for(d=d.elements;d.length;)m(d[0]);
}for(c=0;c<b.sides.length;c++)if(d=b.sides[c],!searchString(a.sides,d.location,"location")){var e=searchString(X.sides,d.location,"name");e?(e.canvas=d,a.sides.push(d)):a.noSides.push(d)}return a}function g(a,b){if(1==b.canvases.length){for(var c=a.name.charAt(0).toUpperCase()+a.name.slice(1),d=b.canvases[0],e=0;e<b.elements.length;e++)b.elements[e].location=c;d.location=c,d.region_name=a.activeRegion.name,d.side=a}}function h(a){g(Q,a),i(a.elements);for(var b={noSides:[],sides:[],information:a.information,rendered:0,product:a.product},c=a.canvases,d=0;d<c.length;d++){var e={location:c[d].location,canvas:c[d],rendered:0,elements:getElementsInArray(a.elements,c[d].location,"location").sort(function(a,b){return a.z<b.z?-1:a.z>b.z?1:0}),needRender:!0},h=searchInArray(X.sides,c[d].location.toLowerCase(),"name");h?(h.canvas=e,e.side=h,b.sides.push(e),"undefined"!=typeof P&&P.resetSide(h.name)):b.noSides.push(e)}for(O=f(b,O),d=0;d<O.sides.length;d++)a=K(O.sides[d].location),a.elements.length||v(a);j(Q)}function i(a){for(var b=0;b<a.length;b++){var c=a[b],d=436/Q.boundingBox.region.width,e=2*c.width,f=2*c.height,e=e/d,f=f/d,g=2*c.y/d;c.x=2*c.x/d,c.y=g,c.width=e,c.height=f}}function j(a){_={width:2*a.defaultRegion.region[2],height:2*a.defaultRegion.region[3]}}function k(){return O.product.product_id!=X.description.product_id?!0:!1}function l(a,b){for(var c=0,d=0,e=function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:a})},f=0;f<aa.length;f++)!function(){var g=aa[f];if(!g.artID&&!g.art_id){if(c++,formData=new FormData,formData.append("file",e(g.original_art_path)),g.colors&&g.colors.length){for(var h="",i=0,j=0;j<g.colors.length;j++){var k=getColorString(g.colors[j],!0);0>h.indexOf(k)&&(i++,h+=","+k)}0<h.length&&(h=h.substring(1)),formData.append("colorLength",i),formData.append("colors",h)}service.saveUserArt(state.currentUserToken,state.activeUserToken,formData,function(b){g.artID=g.art_id=b.ArtID,g.art_name=b.ArtName,g.art||(g.art={}),g.art.art_name=b.ArtName,g.type="image",d++,d==aa.length&&(aa=[],a())},b)}}();0==c&&a&&a()}function m(a){var b;a:{for(b=0;b<O.sides.length;b++)if(O.sides[b].location.toUpperCase()==a.location.toUpperCase()){b=O.sides[b];break a}b=!1}if(!b)return console.error("Canvas don't exist!"),!1;b.side.boundingBox.removeChild(a.object);for(var c=0;c<b.elements.length;c++){var d=b.elements[c];d.id==a.id&&b.elements.splice(c,1)}for(c=0;c<b.side.elements.length;c++)d=b.side.elements[c],d.id==a.id&&b.side.elements.splice(c,1);eventManager.trigger("elementDeleted",a.id),b.side.boundingBox.elements=searchInArray(X.sides,b.side.sideId,"sideId").elements}function n(a,b){var c;if("undefined"==typeof b.id&&(b.id=V++),"text"===b.type){var d=_.width/(2*a.defaultRegion.region[2]);c=b.width/d;var e=b.height/d,f=b.x/d+c/2,d=b.y/d+e/2,g=0;b.rotate&&(g=parseInt(b.rotate));var h=parseInt(b.sweep);if(h>0&&"arcdown"==b.shape&&(h*=-1),b.x=f,b.y=d,b.width=c,b.height=e,b.rotation=g,b.lines||(b.lines=1),getDesignColors()+1>10)return alert("您添加的设计颜色数量超过了10种，为了保证印刷质量，请保证设计颜色数量不超过10种。\n或咨询客服：400-920-2085 协助您解决。"),!1;b.object=new ui.text.TextElement(b,a.workArea,b.value,f,d,c,e,g,parseFloat(b.kerning),b.fill_color,parseFloat(b.stroke_width),b.stroke_color,parseInt(b.wrap_mode),parseInt(b.wrap_amount),h,parseInt(b.z),parseInt(b.fliph),parseInt(b.flipv),b.fontObject,b.lines),b.isNew&&(b.object.isNew=b.isNew),b.alignment&&(b.object.alignment=parseInt(b.alignment)),b.line_height&&(b.object.lineHeight=parseInt(b.line_height)),b.object.width=b.width,b.object.height=b.height,b.object.id=b.id,c=b}else if("image"===b.type){if(d=_.width/(2*a.defaultRegion.region[2]),c=b.width/d,e=b.height/d,f=b.x/d+c/2,d=b.y/d+e/2,g=0,b.rotate&&(g=parseInt(b.rotate)),b.object=new ui.bitmap.BitmapElement(b,a.workArea,b.image.src,f,d,c,e,g,parseInt(b.z),parseInt(b.fliph),parseInt(b.flipv)),b.colors){for(c=[],e=0;e<b.colors.length;e++)c.push(getColorString(b.colors[e]));if(b.object.colors=c,getDesignColors()+c.length>10)return"ColorOverflowError"}b.object.id=b.id,0==b.art_id&&aa.push(b),c=b}else"vector"===b.type?(d=_.width/(2*a.defaultRegion.region[2]),c=b.width/d,e=b.height/d,f=b.x/d+c/2,d=b.y/d+e/2,g=0,h=b.canvas_art_rendered,b.rotate&&(g=parseInt(b.rotate)),b.x=f,b.y=d,b.width=c,b.height=e,b.rotation=g,b.object={},b.canvas_art_rendered=h,c=document.getElementById("designGroup"+a.sideId),b.object=new ui.svg.SvgElement(b.svg,c,b),c=b):"embroideryText"===b.type?c=q(a,b,ja):"embroideryArt"===b.type&&(c=r(a,b));return eventManager.trigger("designLiveEdition"),c}function o(a){T(),C(a),da=0,ca=[],eventManager.trigger("elementAdded",a),Q.boundingBox.selectElement(a),eventManager.trigger("designColorsChanged"),M(0,O)}function p(a){if(da++,C(a),da==ca.length){for(T(),Y.ajaxCallEnded(),Y.ajaxCallEnded(),O.state="ready",O.elements=[],ca=[],a=da=0;a<X.sides.length;a++)X.sides[a].canvas.needRender&&(X.sides[a].canvas.needRender=!1,k()&&y(X.sides[a]));O.product={product_id:X.description.product_id,product_style_id:X.information.product_style_id},console.debug("trigger rendered 2"),M(0,O),P.enable=!0,U.addSnapshotEvent("designRenderedComplete",[]),da=0,ca=[]}}function q(a,b){return getImageData(state.dsUtils.getEmbroideryUrl(b,"embroideryText",ja),!1,function(c){var d,e,f,g=_.width/(2*a.defaultRegion.region[2]);d=b.width/g,e=b.height/g,f=b.x/g+d/2;var g=b.y/g+e/2,h=0;b.rotate&&(h=parseInt(b.rotate)),b.object=new ui.text.EmbroideryTextElement(b,a.workArea,c.url,f,g,d,e,h,parseInt(b.z),parseInt(b.fliph),parseInt(b.flipv)),b.object.id=b.id,b.object.sleep=!0,b.object.color1=b.color1,b.object.color2=b.color2,b.object.color3=b.color3,b.object.color4=b.color4,b.object.slant=b.slant,b.object.sequence=b.sequence,b.object.shape=b.shape,b.object.circle_radius=b.circle_radius,b.object.bottom_curve_type=b.bottom_curve_type,b.object.top_curve_type=b.top_curve_type,b.object.bottom_curve=b.bottom_curve,b.object.top_curve=b.top_curve,b.object.word_spacing=b.word_spacing,b.object.line_spacing=b.line_spacing,b.object.letter_spacing=b.letter_spacing,b.object.alignment=b.alignment,b.object.font=b.fontObject.font,b.object.font_id=b.fontObject.font_id,b.object.fontSize=b.fontSize,b.object.value=b.value,b.object.sleep=!1}),b}function r(a,b){return getImageData(state.dsUtils.getEmbroideryUrl(b,"embroideryArt"),!1,function(c){var d,e,f,g=_.width/(2*a.defaultRegion.region[2]);d=b.width/g,e=b.height/g,f=b.x/g+d/2;var g=b.y/g+e/2,h=0;for(b.rotate&&(h=parseInt(b.rotate)),b.object=new ui.bitmap.EmbroideryArtElement(b,a.workArea,c.url,f,g,d,e,h,parseInt(b.z),parseInt(b.fliph),parseInt(b.flipv)),b.object.id=b.id,c=[],d=0;d<b.colors.length;d++)c.push(b.colors[d].value);b.object.colors=c}),b}function s(a,b,c){1!=ba&&U.doZoom(),a={productId:a,productStyleId:b,styles:[]},c&&(a.data=state.productXml),eventManager.trigger("needProduct",a)}function t(a){X.regions=clone(a.regions),X.information=clone(a.information),x(a),Q=K(Q.name);var b=new Image;b.onload=function(){S.clear(),Q.imageLoaded=!0,X.information["image_width_"+Q.name]=b.width,X.information["image_height_"+Q.name]=b.height;var a=Y.width/ia*X.information["image_width_"+Q.name],c=Y.height/ia*X.information["image_height_"+Q.name];S.image(fixImageUrl(Q.defaultRegion.imgurl),.5*(Y.width-a),.5*(Y.height-c),a,c),eventManager.trigger("productColorChanged")},b.src=fixImageUrl(Q.defaultRegion.imgurl)}function u(a){var b;if(!(b=K(a.side)))return!1;var c=document.getElementById("svg"+b.sideId),d=c.getElementsByTagName("g")[0];d.setAttribute("id","designGroup"+b.sideId);var e,f=f=document.createElementNS("http://www.w3.org/2000/svg","clipPath");b.boundingBox.visibleRegion=!1,e=document.createElementNS("http://www.w3.org/2000/svg","filter"),e.setAttribute("id","coverFilter"+b.sideId),e.setAttribute("filterUnits","objectBoundingBox"),e.setAttribute("x","0%"),e.setAttribute("y","0%"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),f=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix"),f.setAttribute("in","SourceGraphic"),f.setAttribute("type","matrix"),f.setAttribute("values","-1 0 0 0 1 0 -1 0 0 1 0 0 -1 0 1 0 0 0 1 0"),e.appendChild(f),c.appendChild(e),f=document.createElementNS("http://www.w3.org/2000/svg","mask"),f.setAttribute("maskUnits","userSpaceOnUse"),f.setAttribute("id","designMask"+b.sideId);var g="-"+a.region[0]+"px",h="-"+a.region[1]+"px";f.setAttribute("x",0),f.setAttribute("y",0),f.setAttribute("width",Y.width),f.setAttribute("height",Y.height),e=document.createElementNS("http://www.w3.org/2000/svg","image"),e.setAttribute("id","coverMaskImage"+b.sideId),e.setAttribute("x",g),e.setAttribute("y",h),e.setAttribute("filter","url('#coverFilter"+b.sideId+"')"),e.setAttribute("width",Y.width),e.setAttribute("height",Y.height);var i=new Image;i.onload=function(){var a=$("<canvas/>")[0],b=a.getContext("2d");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0,i.width,i.height),b.getImageData(0,0,i.width,i.height)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a.mask.value),d.setAttribute("mask","url('#designMask"+b.sideId+"')"),c.appendChild(f),f.appendChild(e)}function v(a){var b="shape"==a.activeRegion.mask.type?0:1,c=a.workArea.canvas.getElementById("designGroup"+a.sideId);1==b?c.setAttribute("mask","url('#designMask"+a.sideId+"')"):c.removeAttribute("mask"),delete a.distressObj}function w(a,b){a.distressObj=b;var c=document.getElementById("svg"+a.sideId),d=a.activeRegion.region[3]>a.activeRegion.region[2]?a.activeRegion.region[3]:a.activeRegion.region[2],e=Y.width,d=d*a.boundingBox.zoomScale*ba*(1!=ba?a.defaultRegion.region[2]/a.activeRegion.region[2]:1);Y.width>ia&&(d*=Y.width/ia);var f="shape"==a.activeRegion.mask.type?0:1;if(a.workArea.canvas.getElementsByTagName("mask").length==f){c.getElementsByTagName("g")[0].setAttribute("id","designGroup"+a.sideId);var g=document.createElementNS("http://www.w3.org/2000/svg","mask");g.setAttribute("maskUnits","userSpaceOnUse"),g.setAttribute("id","distressMask"+a.sideId),g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("width",e),g.setAttribute("height",e),e=document.createElementNS("http://www.w3.org/2000/svg","image"),e.setAttribute("id","distressImage"+a.sideId),1==f&&e.setAttribute("mask","url('#designMask"+a.sideId+"')"),e.setAttribute("x","0"),e.setAttribute("y","0"),c.appendChild(g),g.appendChild(e)}c=a.workArea.canvas.getElementById("distressImage"+a.sideId),c.setAttribute("height",d),c.setAttribute("width",d),d=a.workArea.canvas.getElementById("designGroup"+a.sideId),14==a.distressObj.distress_id?(1==f&&d.setAttribute("mask","url('#designMask"+a.sideId+"')"),document.getElementById("distressMask"+a.sideId).remove()):(c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a.distressObj.distress_small_path_jpg),d.setAttribute("mask","url('#distressMask"+a.sideId+"')"))}function x(a){if("undefined"!=typeof X.sides)for(var b=0;b<a.sides.length;b++){var c=a.sides[b],d=K(c.name);"undefined"!=typeof d.distressObj&&(c.distressObj=clone(d.distressObj))}for(X=a,a={},b=0;b<X.regions.length;b++)d=X.regions[b],d.regionId=b,d.regionIndex=b,c=K(d.side),d.sideIndex=c.sideId,1!=a[c.name]&&(a[c.name]=!1),1==d.is_default&&(a[c.name]=!0,c.defaultRegion=d,1!=d.side_order&&X.defaultRegion||(X.defaultRegion=d));for(b=0;b<X.regions.length;b++)d=X.regions[b],c=K(d.side),a[c.name]||(c.defaultRegion=d);X.defaultRegion||(X.defaultRegion=X.regions[0])}function y(a,b){var c="undefined"==typeof a?Q:a;c.boundingBox.hide();var d,e=c.boundingBox.getDesignRectangle(!1,0,!1);return"undefined"==typeof e?!1:(d=c.boundingBox.zoomScale,Y.width>ia&&(d/=ia/Y.width),e.w/=d,e.h/=d,e.w>c.activeRegion.region[2]&&(d=(c.activeRegion.region[2]*c.boundingBox.zoomScale/(ia/Y.width)-5)/e.w,c.boundingBox.resizeTo(e.w*d,e.h*d),e=c.boundingBox.getDesignRectangle(!1,0,!1),e.w/=c.boundingBox.zoomScale,e.h/=c.boundingBox.zoomScale,b=!1),e.h>c.activeRegion.region[3]&&(d=(c.activeRegion.region[3]*c.boundingBox.zoomScale-5)/e.h,c.boundingBox.resizeTo(e.w*d,e.h*d),b=!1),e=c.boundingBox.getDesignRectangle(!1,0,!1),e.y+e.h>c.boundingBox.region.height&&(b=!1),1!=b&&(e=c.boundingBox.getDesignRectangle(!1,0,!1),c.boundingBox.translateTo(c.boundingBox.zoomScale/(ia/Y.width)*((c.activeRegion.region[2]-e.w)/2+.5*e.w),c.boundingBox.zoomScale/(ia/Y.width)*((c.activeRegion.region[3]-e.h)/2+.5*e.h))),void Q.boundingBox.hide())}function z(a){if(a.length)for(var b=Q.boundingBox.getDesignRectangle(!1,0,!1,a),c=-b.x+Q.activeRegion.region[2]/2-b.w/2,b=-b.y+Q.activeRegion.region[3]/2-b.h/2,d=0;d<a.length;d++)a[d].x+=c*Q.boundingBox.zoomScale,a[d].y+=b*Q.boundingBox.zoomScale}function A(a){for(var b,c=0;c<X.sides.length;c++)fixImageUrl(X.sides[c].defaultRegion.imgurl)===a.url&&(b=X.sides[c]);if(b&&(b.imageLoaded=!0,!b.offsetFixed)){var c=b.name,d=.5*(ia-a.width);a=.5*(ia-a.height);for(var e=0;e<X.regions.length;e++){var f=X.regions[e];c.toLowerCase()===f.side.toLowerCase()&&(f.region[0]+=d,f.region[1]+=a,eventManager.trigger("productRegionsChanged"))}b.offsetFixed=!0,b.boundingBox&&J(b,b.activeRegion)}}function B(){for(var a=0;a<X.sides.length;a++)getImageData(fixImageUrl(X.sides[a].defaultRegion.imgurl),!1,A)}function C(a){var b=K(a.data.location);b?(b.elements.push(a),b.canvas.elements.push(a.data),a=searchInArray(X.sides,b.sideId,"sideId").elements,b.boundingBox.elements=a):console.debug("OMG esto no puede pasar")}function D(a){if(da++,C(a),da===ca.length){T(),a=[];for(var b=0;b<ca.length;b++)eventManager.trigger("elementsAdded",[ca[b].element]),a.push(ca[b].element.object);M(0,O),z(a),Q.boundingBox.selectElement(a),da=0,ca=[],setTimeout(function(){P.enable=!0,U.addSnapshotEvent("copySelectionElementRenderedComplete",[])},100)}}function E(a){if(da++,C(a),da==ca.length){for(T(),a=0;a<ca.length;a++)eventManager.trigger("elementsAdded",[ca[a].element]);da=0,ca=[],U.addSnapshotEvent("renderFromChangeProductComplete",[]),eventManager.trigger("renderFromRedoComplete",[]),M(5,O)}}function F(a){if(da++,C(a),da==ca.length){for(T(),a=0;a<X.sides.length;a++)y(X.sides[a]);da=0,ca=[],U.addSnapshotEvent("renderFromChangeProductComplete",[]),b(),M(0,O)}}function G(){for(var a=da=0;a<ca.length;a++)n(ca[a].side,ca[a].element)}function H(a){null!=Q&&(I(Q,"hidden"),Q.boundingBox.hide()),Q=a;var b=new Image;b.onload=function(){S.clear(),a.imageLoaded=!0,X.information["image_width_"+a.name]=b.width,X.information["image_height_"+a.name]=b.height;var c=Y.width/ia*X.information["image_width_"+a.name],d=Y.height/ia*X.information["image_height_"+a.name];S.clear(),S.image(fixImageUrl(a.defaultRegion.imgurl),.5*(Y.width-c),.5*(Y.height-d),c,d),U.keepOriginalZoom()},b.src=fixImageUrl(a.defaultRegion.imgurl),ezdVars.ArtToolsMode||$("#raphael").css("background-color",""),I(a,"visible"),eventManager.trigger("undoStackChanged")}function I(a,b){a.div.show(),a.div.css("top","visible"===b?"0px":"-1000px")}function J(a,b){var c=a.defaultRegion.region[2]/b.region[2],d=[b.region[0],b.region[1],b.region[2],b.region[3]],e=-d[0]*c,f=-d[1]*c;if(a.boundingBox.xOffset=e,a.boundingBox.yOffset=f,a.boundingBox.zoomScale=c/(Y.width/ia),a.boundingBox.region={x:0,y:0,width:d[2]*c,height:d[3]*c},c*=ia,a.workArea.setViewBox(e,f,c,c),a.boundingBox.updateScale(),a.activeRegion=b,(e=K(b.side))&&($("#designMask"+e.sideId).remove(),e=document.getElementById("svg"+e.sideId).getElementsByTagName("g")[0],e.removeAttribute("style"),e.removeAttribute("mask")),"shape"==b.mask.type){if(e=K(b.side)){f=document.getElementById("svg"+e.sideId),c=ba,d=f.getElementsByTagName("g")[0],d.setAttribute("id","designGroup"+e.sideId);var g,h=ezdVars.DemoOval?"OVAL":"RECT",i=ezdVars.RegionAngle||0,j=e.defaultRegion.region[2]/b.region[2],k=k=document.createElementNS("http://www.w3.org/2000/svg","clipPath");"RECT"==h?(g=document.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("id","designRectMask"+e.sideId),g.setAttributeNS(null,"x",0),g.setAttributeNS(null,"y",0),g.setAttributeNS(null,"height",b.region[3]*c*j),g.setAttributeNS(null,"width",b.region[2]*c*j),g.setAttributeNS(null,"transform","rotate("+i+" "+b.region[2]*c*j*.5+" "+b.region[3]*c*j*.5+")"),g.setAttributeNS(null,"fill","#FFFFFF")):"ROUND"==h?(g=document.createElementNS("http://www.w3.org/2000/svg","rect"),g.setAttribute("id","designRectMask"+b.sideId),g.setAttributeNS(null,"x",0),g.setAttributeNS(null,"y",0),g.setAttributeNS(null,"height",b.region[3]*c*j),g.setAttributeNS(null,"width",b.region[2]*c*j),g.setAttributeNS(null,"ry",50*c*j),g.setAttributeNS(null,"rx",50*c*j),g.setAttributeNS(null,"transform","rotate("+i+" "+b.region[2]*c*j*.5+" "+b.region[3]*c*j*.5+")"),g.setAttributeNS(null,"fill","#FFFFFF")):"OVAL"==h&&(g=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),g.setAttribute("id","designRectMask"+e.sideId),g.setAttributeNS(null,"cx",b.region[2]*c*j*.5),g.setAttributeNS(null,"cy",b.region[3]*c*j*.5),g.setAttributeNS(null,"ry",b.region[3]*c*j*.5),g.setAttributeNS(null,"rx",b.region[2]*c*j*.5),g.setAttributeNS(null,"transform","rotate("+i+" "+b.region[2]*c*j*.5+" "+b.region[3]*c*j*.5+")"),g.setAttributeNS(null,"fill","#FFFFFF")),d.setAttribute("style","clip-path:url('#designMask"+e.sideId+"')"),k.setAttribute("id","designMask"+e.sideId),f.appendChild(k),k.appendChild(g)}}else u(b);"undefined"!=typeof a.distressObj&&w(a,a.distressObj),a.boundingBox.enforceBoundaries&&y(a,!0)}function K(a){for(var b=0;b<X.sides.length;b++)if(X.sides[b].name.toUpperCase()==a.toUpperCase())return X.sides[b];return!1}function L(a){var b,c;if(!(b=searchInArray(X.regions,a,"regionId"))||!(c=K(b.side)))return!1;B(),H(c);var d;return(d=K(b.side))&&b.name!=("undefined"==typeof d.activeRegion?"NOTSET":d.activeRegion.name)&&(R=b,J(Q,b)),j(c),R}function M(a,b){console.debug("************** Event事件 **************"),console.debug("事件： ",ea[a]),console.debug("数据 = ",b),eventManager.trigger(ea[a],b),("DESIGN_UPDATED"==ea[a]||"rendered"==ea[a])&&eventManager.trigger("updatePricePreview",!0)}function N(){for(var a=0;a<O.sides.length;a++){var b=O.sides[0];b.elements=b.elements.sort(function(a,b){return a.z<b.z?-1:a.z>b.z?1:0});for(var c=0;c<b.elements.length;c++)b.elements[c].z=c}}console.log("baseEZD init");var O,P,Q,R,S,T,U=this,V=1,W={},X={},Y=a,Z={},_={width:500,height:500},aa=[],ba=1,ca=[],da=0,ea="rendered DESIGN_READY PRODUCT_READY ELEMENT_READY DESIGN_UPDATED designChanged productColorChanged".split(" "),fa=0,ga=!1,ha=0,ia=500,ja={slant:"slant",sequence:"sequence",shape:"shape",circle_radius:"circleRadius",bottom_curve_type:"bottomCurveType",top_curve_type:"topCurveType",bottom_curve:"bottomCurve",top_curve:"topCurve",word_spacing:"wordSpace",line_spacing:"lineSpace",letter_spacing:"letterSpace",alignment:"alignment",font_size:"fontSize"};Object.defineProperties(this,{width:{get:function(){return Y.width}},height:{get:function(){return Y.height}},store:{get:function(){return Z}},setCanvasSize:{set:function(a){d(a)}},originalCanvasSize:{get:function(){return ia}},zoom:{get:function(){return ba}},product:{get:function(){return X}},sides:{get:function(){return X.sides}},regions:{get:function(){return X.regions}},canvas:{get:function(){return _canvas}},canvasProduct:{get:function(){return S}},design:{set:function(a){e(a)},get:function(){return O}},scale:{set:function(a){(k=a)&&y()},get:function(){return k}},activeSide:{get:function(){return Q}},proportion:{get:function(){return _}},hm:{get:function(){return P}},activeRegion:{get:function(){return R}},initObject:{get:function(){return{container:Y.container}}},config:{get:function(){return Y}}}),this.updateLayers=function(){},this.renderElements=function(a){ca=a,da=0,T=eventManager.on("elementRendered",E),G()},this.deleteElements=function(a){a="undefined"==typeof a.length?[a]:a;for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);for(c=0;c<b.length;c++)m(U.getElementById(b[c]));eventManager.trigger("undoSnapshotDone"),eventManager.trigger("elementsDeleted"),M(4,O)},this.getElementById=function(a){for(var b=0;b<O.sides.length;b++){var c=searchInArray(O.sides[b].elements,a,"id");if(c)return c}return!1},this.getElementID=function(a,b){for(var c=0;c<O.sides.length;c++)for(var d=O.sides[c],e=0;e<d.elements.length;e++){var f=d.elements[e];if(f.table_name==b&&(f.canvas_text_id==a||f.canvas_art_id==a))return f.id}},this.addEmbroideryText=function(a){var b,c=_.width/(2*Q.defaultRegion.region[2]),d=125/Q.defaultRegion.region[2],e=100/d,d=20/d,f=c*Q.boundingBox.getRegionCenter().x-.5*e,c=c*(Q.boundingBox.getRegionCenter().y+fa)-.5*d,e={x:f,y:c,z:Q.boundingBox.elements.length,width:e,location:Q.name,height:d,type:"embroideryText",table_name:"canvas_text",id:V++};for(b in a)e[b]||(e[b]=a[b]);return T=eventManager.on("elementRendered",o),a=n(Q,e),e.element=a,e},this.addNewText=function(a,b,c){var d=_.width/(2*Q.defaultRegion.region[2]),e=125/Q.defaultRegion.region[2],f=100/e,e=20/e,g=d*Q.boundingBox.getRegionCenter().x-.5*f,d=d*(Q.boundingBox.getRegionCenter().y+fa)-.5*e;if(fa+=5,f={type:"text",kerning:0,lineHeight:0,rotation:0,x:g,y:d,sweep:0,width:f,height:e,location:Q.name,value:c||"文字",fill_color:"#000000",stroke_width:0,stroke_color:"#000000",shadow_color:"#000000",shadow_value:0,fontObject:a,wrap_mode:0,sweep:0,wrap_amount:0,fliph:0,flipv:0,table_name:"canvas_text",isNew:!0,z:Q.boundingBox.elements.length,id:V++},b)for(var h in b)f[h]=b[h];return a.font_family=a.fontFamily,T=eventManager.on("elementRendered",o),h=n(Q,f),h.isNew=!0,h.fontId=820,h.fontStyleId=6,f.element=h,f},this.deleteElement=function(a){return(a=this.getElementById(a))?void m(a):!1},this.addClipArt=function(a){a.width||(a.width=200),a.height||(a.height=200),a.width/=ba,a.height/=ba;var b={x:0,y:0,width:a.width,height:a.height,rotation:0};b.x=Q.boundingBox.region.x+Q.boundingBox.region.width/2,b.y=Q.boundingBox.region.y+Q.boundingBox.region.height/2,Q.boundingBox.checkElementSize(b,!0),b.width*=.8,b.height*=.8,b.x-=b.width/2,b.y-=b.height/2;var c="needSvg",d=a.art_id,e=[];if("raster"==a.art_type)a.art_type="image",c="needImage";else for(var f=0;f<a.art_colors.length;f++)e.push(getColorString(a.art_colors[f],!0));return b={art_id:d,x:b.x,y:b.y,z:Q.boundingBox.elements.length,width:b.width,height:b.height,type:"emb"==a.art_type?"embroideryArt":a.art_type,art_path:a.art_path,original_art_path:a.art_path,table_name:"canvas_art",resizeBox:!0,location:Q.name,art:{art_name:a.art_name,width:a.width,height:a.height},canvas_art_rendered:a.thumb_jit,colors:a.forceColors?a.art_colors:[],id:V++},"embroideryArt"==b.type&&(b.colors=a.art_colors),T=eventManager.on("elementRendered",o),"needImage"==c?(b.image={url:b.art_path,src:b.art_path},n(Q,b)):eventManager.trigger(c,b),b},this.selectRegion=function(a){return a!=this.activeSide.activeRegion.regionId?L(a):void 0},this.loadLocalImage=function(a,b,c){for(var d=0,e=0;e<ezd.activeSide.elements.length;e++)var f=ezd.activeSide.elements[e],d=d>f.z?d:f.z+1;var e=Q.activeRegion.region[2]<Q.activeRegion.region[3]?Q.activeRegion.region[2]:Q.activeRegion.region[3],g=c.width>c.height?e/c.width:e/c.height,e=.5*(Q.activeRegion.region[2]-c.width*g*.7),f=.5*(Q.activeRegion.region[3]-c.height*g*.7),h=c.width*g*.7,g=c.height*g*.7,i=0;c.artID&&(i=c.artID),a={art_id:i,x:e,y:f,z:d,width:h,height:g,art_width:c.art_width,art_height:c.art_height,type:"image",art_path:a,original_art_path:a,resizeBox:!1,input:b,colors:c.colors,location:ezd.activeSide.name,table_name:"canvas_art",is_user:!0,art_type:"raster",image:{url:a,src:a},art:{art_name:c.artName}},T=eventManager.on("elementRendered",o);var j=n(Q,a);return"ColorOverflowError"!=j?j:void setTimeout(function(){alert("您上传的图片颜色数量超过了10种，为了保证印刷质量，请上传小于10种颜色的图片。\n或咨询客服：400-920-2085 协助您解决。"),state.designer.activeSide.boundingBox.removeSelection()},1e3)},this.getDesign=function(a){e(a)},this.hideBB=function(){},function(a){Z={domain:a.ApiDomain||"open.dev.jzw.la",publisherId:a.PublisherID||3,AppToken:a.AppToken||306,ezdPath:a.DesignerLocation||"/designer/html5"},Y.productId=a.ProductID,Y.productStyleId=a.ProductStyleID}(ezdVars),s(Y.productId,Y.productStyleId,!0),parseInt(1*ezdVars.DesignID)&&(ga=!0,ha=ezdVars.DesignID),"undefined"!=typeof HistoryManager&&(P=new HistoryManager(U)),S=new Raphael(Y.container[0],Y.width,Y.height),d(Y),eventManager.on("productLoaded",function(a){if("undefined"==typeof X.description||a.description.product_id!=X.description.product_id){for($("#raphael").empty(),x(a),a=0;a<X.sides.length;a++){var d=X.sides[a];$("#raphael").append('<div id="side'+d.sideId+'" class="raphaelSide"></div>');var f=new Raphael(document.getElementById("side"+d.sideId),Y.width,Y.height);d.workArea=f,f.canvas.setAttribute("id","svg"+d.sideId),d.div=$("#side"+d.sideId),d.elements=[],d.imageLoaded=!1,f=new container.BoundingContainer(d.workArea,[],"side"+d.sideId),d.boundingBox=f,d.boundingBox.hide(),I(d,"hidden"),J(d,d.defaultRegion)}for(L(X.defaultRegion.regionId),a={noSides:[],sides:[],information:{width:Y.width,height:Y.height},rendered:0,state:"new",product:{product_id:X.description.product_id,product_style_id:X.information.product_style_id}},d=0;d<X.sides.length;d++){var f=X.sides[d],g={location:f.name.charAt(0).toUpperCase()+f.name.slice(1),canvas:f.defaultRegion,rendered:0,elements:[],side:f};f.canvas=g,g.canvas.location=g.location,a.sides.push(g)}if(null==O)O=a;else{for(g=[],d=[],f=0;f<O.sides.length;f++){var h=O.sides[f];g.push(h.canvas),d=d.concat(h.elements)}for(var i,f=0;f<d.length;f++){var g=d[f],h=U.getElementById(g.id),j=_.width/(.25*Q.defaultRegion.region[2]);if("text"==h.type)h.table_name="canvas_text",i={rotation:"rotate",text:"value",color:"fill_color",strokeColor:"stroke_color",stroke:"stroke_width",wrap:"wrap_mode",wrapAmmount:"wrap_amount",letterSpacing:"kerning"};else if(("vector"==h.type||"image"==h.type)&&("vector"==h.type&&(h.table_name="canvas_art",h.stroke_color=h.object.stroke,h.stroke_width=h.object.strokeColor),h.colors&&h.colors.length)){for(var k=0;k<h.colors.length;k++)g["color"+(k+1)]=h.object.colors[k];for(k=0;k<h.colors.length;k++)"none"==h.object.colors[k].toLocaleLowerCase()?h.object.colors[k]="none":h.object.colors[k]=h.object.colors[k].split("#")[1];g.colors=h.object.colors}for(var l in i)g[i[l]]=h.object[l];"text"==h.type&&(g.letterSpacing*=50,g.kerning*=50);var k=g.object.width*j,m=g.object.height*j,n=g.object.x*j-k/2,j=g.object.y*j-m/2;g.width=k,g.flipv=h.object.flipV,g.fliph=h.object.flipH,g.height=m,g.x=n,g.rotate=h.object.rotation,g.y=j}for(ca=[],i=0;i<X.sides.length;i++){for(l=X.sides[i],f=0;f<d.length;f++)g=d[f],l.name.toUpperCase()==g.location.toUpperCase()&&ca.push({side:l,element:g});"undefined"!=typeof l.distressObj&&c(l.name,l.distressObj.distress_id)}O=a,ca.length&&(T(),T=eventManager.on("elementRendered",F),G())}b(),console.debug("trigger rendered 1"),M(0),M(6)}else{for(i=0;i<X.sides.length;i++)a.sides[i]=X.sides[i],a.sides[i].offsetFixed=!1;t(a),B()}$("#designerContainer").find("svg").css("background-color","#"+X.information.html_color),ga&&(ga=!1,e(ha),ha=0)}),eventManager.on("elementLoaded",function(a){n(Q,a)}),eventManager.on("designLoaded",function(a){if(h(a),P.enable=!1,Q.activeRegion.name!=O.information.region_name){a:{a=O.information.region_name;for(var b=O.information.location,d=0;d<X.regions.length;d++)if(X.regions[d].name==a&&X.regions[d].side==b){a=X.regions[d];break a}a=!1}a&&L(a.regionId)}for(ca=[],a=da=0;a<O.sides.length;a++){if(b=O.sides[a],b.needRender){for(d=0;d<b.elements.length;d++)ca.push({side:b.side,element:b.elements[d]});b.elements=[]}1==b.canvas.is_distressed&&c(b.location,b.canvas.distress_id)}G()}),eventManager.on("elementSelected",function(a){Q.boundingBox.selectElement(Q.boundingBox.getChildrenById(a))}),this.parseProduct=function(a,b){s(a,b)},this.addSnapshotEvent=function(a,b){"undefined"!=typeof P&&P.addSnapshot(a)},this.startEvent=function(a){},this.chanPropertyEvent=function(){},this.resetEvent=function(){"undefined"!=typeof P&&P.start()},this.endEvent=function(){},this.zoomIn=function(){this.zoom&&1!=this.zoom||this.doZoom()},this.zoomOut=function(){this.zoom&&1==this.zoom||this.doZoom()},this.getDesignDimensions=function(a){for(var b=[],c=0;c<a.elements.length;c++)if("text"==a.elements[c].type){if(a.elements[c].object){var d=a.elements[c].object.element.getBBox();b.push(d)}}else a.elements[c].raphael&&(d=a.elements[c].raphael.getBBox(),b.push(d));for(var d=a=1e3,e=0,f=0,c=0;c<b.length;c++)b[c].x<a&&(a=b[c].x),b[c].y<d&&(d=b[c].y),b[c].x+b[c].width>e&&(e=b[c].x+b[c].width),b[c].y+b[c].height>f&&(f=b[c].y+b[c].height);return{x:a,y:d,w:e-a,h:f-d}},this.getSVG=function(a,b,c){var d=a.side;d.boundingBox.hide();var e=d.boundingBox.getDesignRectangle(!1,0,!1);if(d.boundingBox.hideRegion(),0<a.elements.length){1!=c&&(e.w=d.boundingBox.region.width,e.x=0,e.h+=e.y,e.y=0),a=1;try{var f=$("#side"+d.sideId+" svg")[0],g=$($.parseXML((new XMLSerializer).serializeToString($("#svg"+d.sideId)[0]))),f=$(g[0].documentElement)}catch(h){f=g=$("#side"+d.sideId+" svg").clone()}e.x*=a,e.y*=a,e.w*=a,e.h*=a,c=-e.x;var i=-e.y,j=1*a,k=1*a;g.find("#bbGroup").remove(),g.find("desc").remove(),g.find("defs").remove(),a=g.find("#designGroup"+d.sideId),f.attr("width",d.boundingBox.region.width),f.attr("height",d.boundingBox.region.height),f[0].style.height=d.boundingBox.region.height+"px",a.attr("transform","translate("+c+","+i+") scale("+j+","+k+")"),e=d.distressObj&&"0"!=d.distressObj.distress_uri,c=d.activeRegion.mask,e&&(i=g.find("#distressMask"+d.sideId),i.attr("width",b),i.attr("height",b)),c&&(f[0].removeAttribute("mask"),f.find("#designMask"+d.sideId).remove(),f.find("#coverFilter"+d.sideId).remove()),e||c||(g.find("#designMask"+d.sideId).remove(),g.find("#distressImage"+d.sideId).remove(),a.css("clip-path","")),f.attr("viewBox",null),f[0].removeAttribute("viewBox")}if(b=$(g[0].getElementsByTagName("style")),b.length){for(d="",f=0;f<b.length;f++)d+=$(b[f]).html()+"\n",f>0&&b[f].parentNode.removeChild(b[f]);b[0].textContent=d}return g[0]},this.isEmbroidery=function(){for(var a=0;a<this.sides.length;a++)if(this.sides[a].boundingBox.elements.length)for(var b=0;b<this.sides[a].boundingBox.elements.length;b++){var c=this.sides[a].boundingBox.elements[b];if("embroideryText"==c.type||"embroideryArt"==c.type)return!0}return!1},this.saveDesign=function(a){var b=this.zoom;1!=this.zoom&&this.doZoom(),aa=[];for(var c=0;c<O.sides.length;c++)for(var d=0;d<O.sides[c].elements.length;d++){var e=O.sides[c].elements[d].object;"image"!=e.data.type&&"bitmap"!=e.data.type||0!=e.data.art_id||aa.push(e.data)}if(aa.length)l(function(){U.saveDesign(a)});else{N();for(var f=[],d=0;d<O.sides.length;d++)f.push(O.sides[d].side.activeRegion);var g=null,h=null,i=d=null,j=null,c="未命名",k=e="",m=this.isEmbroidery()?1:0;"undefined"!=typeof a&&a&&(g=a.success,h=a.error,a.productStyleId&&(d=a.productStyleId),a.UserToken&&(i=a.UserToken),a.UserToken&&(j=a.UserToken),a.notes&&(e=htmlEscape(a.notes)),a.name&&(c=htmlEscape(a.name.replace("&","And"))),a.designId&&(k=a.designId)),!d&&X&&X.information&&(d=X.information.product_style_id),!i&&W&&(i=W.UserToken),!j&&W&&(j=W.UserToken);var n="<UserDesign>",o={},p="",n=n+('<designs designer_version="HTML5DS" admin="'+(ezdVars.Admin||"None")+'" is_embroidery="'+m+'" design_id="'+k+'" name="'+c+'" product_style_id="'+d+'" notes="'+e+'"/>');for(console.debug(n),d=0;d<O.sides.length;d++)if(O.sides[d].elements.length){e=this.getSideByName(O.sides[d].location),c=' distress_id="" is_distressed="0" ',e.distressObj&&"0"!=e.distressObj.distress_uri&&(c=' distress_id="'+e.distressObj.distress_id+'" is_distressed="1" '),e=f[d],k=this.getDesignDimensions(O.sides[d]),O.sides[d].boundingBox&&(k=O.sides[d].boundingBox.getDesignRectangle());var q=436,k=parseInt(k.h/(k.w/436)),r="";for(m&&(r=' embroidery_region_align="tl" height_cm="1" width_cm="1" justify_type="Left" envelope_type="Rectangle" width_compression="100" percent_pull_compression="100"'),n+='<canvases canvas_id="-1"  '+c+' region="'+e.name+'" region_id="'+e.product_region_id+'" location="'+O.sides[d].side.name+'" width="'+q+'" height="'+k+'" bgcolor="'+getColorString(ezd.product.information.html_color,!0)+'" shadow="false"'+r+" />",
c=0;c<O.sides[d].elements.length;c++){k=O.sides[d].elements[c],e=O.sides[d].elements[c].object,r={},q=436,q/=O.sides[d].side.boundingBox.region.width,r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height,r.x-=e.width/2+O.sides[d].side.boundingBox.region.x,r.y-=e.height/2+O.sides[d].side.boundingBox.region.y,r.x*=q,r.y*=q,r.width*=q,r.height*=q,r.z=e.z,r.x=parseInt(r.x),r.y=parseInt(r.y),r.width=parseInt(r.width),r.height=parseInt(r.height),r.fliph=e.flipH,r.flipv=e.flipV,r.rotate=e.rotation;var q="",s=e.type;if("bitmap"!=s||"embroideryArt"!=k.type&&"embroideryText"!=k.type||(s=k.type),"text"==s||"embroideryText"==s){var t="",t=0>e.arching?"arcdown":"arcup";r.kerning=50*e.letterSpacing,r.wrap_amount=e.wrapAmmount,r.wrap_mode=e.wrap,r.value=e.text,r.fill_color=getColorString(e.color,!0),r.stroke_width=2*e.stroke,e.strokeColor&&(r.stroke_color=getColorString(e.strokeColor,!0)),r.shape=t,r.sweep=Math.abs(e.arching),r.font_id=e.fontId?e.fontId:e.font_id,r.alignment=e.alignment,r.line_height=e.lineHeight}if("vector"==s){for(t=0;t<e.colors.length;t++){var u=e.colors[t],v=e.colorsMapped[t];r["color"+(t+1)]=getColorString(u,!0),r["color"+(t+1)+"_mapped"]=getColorString(v,!0)}e.stroke&&(r.stroke_width=e.stroke),e.strokeColor&&(r.stroke_color=getColorString(e.strokeColor,!0)),r.art_id=k.art_id}if(("image"==s||"bitmap"==s)&&(r.art_id=k.object.data.art_id,e.colors)){for(v=[],t=0;t<e.colors.length;t++)u=getColorString(e.colors[t],!0),findMatch(v,function(a){return a==u})||v.push(u);for(t=0;t<v.length;t++)r["color"+(t+1)]=v[t]}if("embroideryText"===s){r.value=e.value,r.font_id=e.font_id;for(var w in ja)e[w]&&(t=escape(e[w]),r[w]=t);r.color1=e.color1,r.color2=e.color2,r.color3=e.color3,r.color4=e.color4}if("embroideryArt"===s){for(t=0;t<e.colors.length;t++)u=e.colors[t],r["color"+(t+1)]=getColorString(u,!0);r.art_id=k.art_id}for(var x in r)r[x]&&(q+=" "+x+' = "'+htmlEscape(r[x])+'"');q+=' location = "'+O.sides[d].side.name.toUpperCase()+'"',"text"==s||"embroideryText"==s?q="<canvas_text "+q+"/>":"image"==s||"bitmap"==s||"embroideryArt"==s?q="<canvas_art "+q+"/>":"vector"==s&&(q="<canvas_art "+q+"  />"),p+=""+q}}for(n+=p,n+="</UserDesign>",f="//"+Z.domain+"/design/save?appKey="+Z.AppToken+"&userToken="+(i?i:""),o.xmlDesign=n,d=0;d<O.sides.length;d++)0<O.sides[d].elements.length&&(o["svg"+O.sides[d].side.name]=this.fixLinkedImagesInSVG(this.getSVG(O.sides[d],4500),O.sides[d]));this.checkDesignSave(o)?"undefined"!=typeof g&&g&&setTimeout(function(){g(n,ezd.lastSaveData.result)},10):(this.lastSaveData={postData:o,success:!1},this.zoom!=b&&this.doZoom(),$.ajax({type:"POST",url:f,data:o,complete:function(a){a=a.responseText,a=a.replace(/&amp;/gi,"TTTTT").replace(/&/gi,"&amp;").replace(/TTTTT/gi,"&amp;"),a=$($.parseXML(a));var b=a.find("Error");""!=b.text()?(a=b.text(),"undefined"!=typeof h&&h&&h(a)):(a={designID:a.find("DesignID").text(),image:a.find("image").text(),designURI:a.find("DesignURI").text(),UserToken:a.find("UserToken").text(),sessionToken:a.find("SessionToken").text(),UserToken:a.find("UserToken").text(),title:a.find("title").text(),description:a.find("description").text(),type:a.find("type").text(),url:a.find("url").text(),sitename:a.find("sitename").text(),brand:a.find("brand").text(),sku:a.find("sku").text(),color:a.find("color").text(),activityId:a.find("ActivityId").text()},"undefined"!=typeof g&&g&&g(n,a),window.eventManager&&window.eventManager.trigger("designSaved",a),"undefined"!=typeof ezd&&(ezd.designId=a.designId))}}))}},this.checkDesignSave=function(a){if(this.lastSaveData&&this.lastSaveData.success){for(var b in a){var c=a[b],d=this.lastSaveData.postData[b];if(c&&d&&c!=d)return!1}return!0}return!1},this.fixLinkedImagesInSVG=function(a,b){for(var c=$(a),d=0;d<b.elements.length;d++){var e=b.elements[d].object;if(e instanceof ui.bitmap.BitmapElement){var f=c.find("#DsElement"+e.id);if(!f||!f.length){console.log("Error: 不能找到图片 "+e.id+" 的 BitmapElement");continue}}(e instanceof ui.bitmap.EmbroideryArtElement||e instanceof ui.text.EmbroideryTextElement)&&(f=c.find("#DsElement"+e.id),f[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.dataUrl))}return"undefined"!=typeof b.side.distressObj&&(d=c.find("#distressImage"+b.side.sideId))&&d.length&&d[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",b.side.distressObj.name),c[0].xml||(new XMLSerializer).serializeToString(c[0]).replace('xmlns=""',"").replace('type="css/text"',"")},this.updateTextFont=function(a,b,c,d){return(a=this.getElementById(a))?(a=a.object,a.fontId=b.font_id,a.fontObject=b,service.loadFont(b,function(){a.fontFamily=b.fontFamily,a.fontId=b.font_id,a.fontStyleId=c,d&&d()},a.text),void this.addSnapshotEvent("changeProperty",[])):!1},this.updateTextWrapMode=function(a,b){var c=U.getElementById(a).object;c.sleep=!0,0!=b&&(c.arching=0),c.wrap=parseInt(b),c.wrapAmmount=0,c.forceUpdate()},this.updateTextWrapAmount=function(a,b){b=0>b?Math.max(-15,b):Math.min(15,b),U.getElementById(a).object.wrapAmmount=parseInt(b)},this.updateShadowColor=function(a,b){var c=U.getElementById(a);c&&c.object&&(c.shadow_color=b,c.object.setShadow(c.shadow_value,c.shadow_color,null),this.chanPropertyEvent()),U.updateInkColors()},this.updateInkColors=function(){},this.updateTextColor=function(a,b){U.getElementById(a).object.color=b,U.chanPropertyEvent(),U.updateInkColors()},this.updateTextStrokeColor=function(a,b){U.getElementById(a).object.strokeColor=b,U.chanPropertyEvent(),U.updateInkColors()},this.updateTextStrokeWidth=function(a,b){},this.updateTextArching=function(a,b,c){a=U.getElementById(a).object,"arcdown"==c&&(b=-Math.abs(b)),a.arching=b,U.chanPropertyEvent()},this.updateTextValue=function(a,b){},this.increaseTextSpacing=function(a){U.getElementById(a).object.letterSpacing+=.02,U.chanPropertyEvent()},this.decreaseTextSpacing=function(a){U.getElementById(a).object.letterSpacing-=.02,U.chanPropertyEvent()},this.setTextSpacing=function(a,b){U.getElementById(a).object.letterSpacing=b/50,U.chanPropertyEvent()},this.increaseTextHeight=function(a){U.getElementById(a).object.lineHeight+=1,U.chanPropertyEvent()},this.decreaseTextHeight=function(a){U.getElementById(a).object.lineHeight-=1,U.chanPropertyEvent()},this.setTextHeight=function(a,b){U.getElementById(a).object.lineHeight=b,U.chanPropertyEvent()},this.centerElement=function(a,b){var c=this.getElementById(a);if(!c)return!1;var d=this.activeSide.activeRegion.region;"h"==b&&(c.object.x=.5*(d[2]-c.object.width)+.5*c.object.width),"v"==b&&(c.object.y=.5*(d[3]-c.object.height)+.5*c.object.height),this.activeSide.boundingBox.selectElement(this.activeSide.boundingBox.getSelections())},this.changeElementFlip=function(a,b){var c=ezd.getElementById(a);return c?void this.updateElementFlip(a,b,!("v"==b?c.object.flipV:c.object.flipH)):!1},this.updateElementFlip=function(a,b,c){return(a=ezd.getElementById(a))?void("v"==b?a.object.flipV=c:a.object.flipH=c):!1},this.nudgeElement=function(a,b,c,d){var e="left"==b?-1*c:"right"==b?c:0;if(b="up"==b?-1*c:"down"==b?c:0,a)U.getElementById(a).object.x+=e,U.getElementById(a).object.y+=b;else if(d)if(1<d.length)for(c=0;c<d.length;c++)d[c].x+=e,d[c].y+=b;else d.x+=e,d.y+=b;d?Q.boundingBox.selectElement(d):Q.boundingBox.selectElement(U.getElementById(a).object),Q.boundingBox.checkBoundaries(),U.chanPropertyEvent()},this.nudgeDesign=function(a,b){for(var c="left"==a?-1*b:"right"==a?b:0,d="up"==a?-1*b:"down"==a?b:0,e=0;e<Q.elements.length;e++){var f=Q.elements[e];f.x+=c,f.y+=d}Q.boundingBox.mouseEnabled=!0,Q.boundingBox.selectAll(),Q.boundingBox.checkBoundaries(),Q.boundingBox.hideRegion(),Q.boundingBox.mouseEnabled=!1,Q.boundingBox.selectElement(Q.boundingBox.getSelections())},this.updateArtColor=function(a,b,c){for(var d=0;d<Q.elements.length;d++){var e=Q.elements[d];if(e.id&&e.id==a){e.id==a&&("undefined"!=typeof e.setColor?e.setColor(b,c):e.colors={index:b,color:c}),U.updateInkColors(),U.addSnapshotEvent("changeProperty",[]);break}}},this.changeLayer=function(a,b){for(var c=Q.elements,d=0;d<c.length;d++)if(c[d].id==a)return c=Q.boundingBox.getChildrenById(a),"up"==b?Q.boundingBox.setChildIndex(c,Q.boundingBox.getChildIndex(c)+1):Q.boundingBox.setChildIndex(c,Q.boundingBox.getChildIndex(c)-1)},this.getSideByName=function(a){return K(a)},this.copySelection=function(a,b){var d=b?b:Q.boundingBox.getSelections();if(d)if(d.length||(d=[d]),!1===a){if(ca.length){P.enable=!1;for(var d=searchInArray(X.sides,ca[0].side.sideId,"sideId"),e=0;e<ca.length;e++){var f=ca[e];if(f.side!=Q){f.element.id=V++;var g=Q.activeRegion.region[2]/d.activeRegion.region[2];f.element.x*=g,f.element.y*=g,f.element.width*=g,f.element.height*=g}f.side=Q,f.element.location=Q.name}d.elements.length==ca.length&&"undefined"==typeof Q.distressObj&&"undefined"!=typeof d.distressObj&&c(Q.name,d.distressObj.distress_id),G()}}else{for(e=a?!1:!0,T=eventManager.on("elementRendered",D),ca=[],f=da=0;f<d.length;f++){var g=d[f],h=clone(g.data),i=_.width/(2*Q.defaultRegion.region[2]);h.width=g.width*i,h.height=g.height*i,h.x=g.x*i-.5*h.width,h.y=10+g.y*i-.5*h.height,h.rotate=g.rotation,h.value=g.text,h.fliph=g.flipH,h.flipv=g.flipV,h.id=V++,g.constructor===ui.text.TextElement?(h.isNew=!0,h.fontFamily=g.fontFamily,h.fontId=g.fontId,h.fontStyleId=g.fontStyleId,h.shape=0>g.arching?"arcdown":"arcup",h.sweep=Math.abs(g.arching),h.strokeScale=g.strokeScale,h.alignment=g.alignment,h.line_height=g.lineHeight,h.kerning=50*g.letterSpacing,h.wrap_mode=g.wrap,h.wrap_amount=g.wrapAmmount):g.constructor===ui.svg.SvgElement?h.colors=g.colors:g.constructor===ui.bitmap.BitmapElement&&(h.image.url=g.url,h.colors=g.colors),ca.push({side:Q,element:h})}e&&G()}},this.keepOriginalZoom=function(){ba=1==ba?0:1,U.doZoom()},this.doZoom=function(){Y.container.find("image");if(Q.elements.length){if(1==ba){Q.boundingBox.visibleRegion=!1,"undefined"!=typeof changeZoomIcon&&changeZoomIcon("less");var a,b,c=Q.boundingBox.getDesignRectangle(!1,0,!0),d=Q.workArea,e=0;c.w>c.h?(a=500/c.w,Q.boundingBox.zoomScale=c.w/500,b=98/a):(a=460/c.h,b=e=61/a,Q.boundingBox.zoomScale=c.h/460);var f=.5*(500-c.w*a)/a,g=46/a;d.setViewBox(c.x-f-.5*b,c.y-g,c.w+b,c.h+e),Q.boundingBox.zoomScale=c.w>c.h?(c.w+b)/ia/(Y.width/ia):(c.h+e)/460/(Y.width/ia),Q.boundingBox.xOffset=c.x-f-.5*b,Q.boundingBox.yOffset=c.y-g,ba=a,$("#raphael").css("background-color","#"+X.information.html_color)}else ezdVars.ArtToolsMode||$("#raphael").css("background-color",""),Q.boundingBox.zoomScale=1,"undefined"!=typeof changeZoomIcon&&changeZoomIcon("more"),ba=1,J(Q,Q.activeRegion);Q.boundingBox.hideRegion(),eventManager.trigger("zoomChanged",{isZoomedIn:ba>1})}else ba=1,J(Q,Q.activeRegion),$("#raphael").css("background-color",""),eventManager.trigger("zoomChanged",{isZoomedIn:!1})},this.getElementPreview=function(a,b,c){if(a=U.getElementById(a),!a)return"<div></div>";var d,e="",e=$(document.createElement("svg"));if("vector"==a.type)d=a.object.getNode().g.cloneNode(!0),e.append(d);else if(d=a.object.getNode().clone(),"undefined"==typeof d.length){var f=d[0];f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",$(f).attr("href")),e.append(f)}else for(f=0;f<d.length;f++)e.append(d[f][0]);var g=a.object.width/a.object.height;a.object.height>a.object.width?(f=b/a.object.width*g,g=c/a.object.height):(g=a.object.height/a.object.width,f=b/a.object.width,g*=c/a.object.height);var h=Math.min(b/a.object.width,c/a.object.height),i=-a.object.x+a.object.width/2,j=-a.object.y+a.object.height/2;return b=.5*(b-a.object.width*h)/h,j+=.5*(c-a.object.height*h)/h,e='<g transform="scale('+f+","+g+") translate("+(i+b)+","+j+') ">'+e[0].innerHTML.replace("NS1:href","xlink:href")+"</g>",e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+e+"</svg>","undefined"!=typeof d.remove?d.remove():"undefined"!=typeof d.parentNode&&d.parentNode.removeChild(d),e},this.changeDistress=function(a){w(Q,a)},this.selectAll=function(){Q.boundingBox.selectAll()},this.moveDesignToRegion=function(a){Q.boundingBox.selectAll();var b=state.designer.activeSide.boundingBox.getSelections();if(b&&b.length){Q.boundingBox.copyElement(),this.deleteElements(b),this.selectRegion(a),this.activeSide.boundingBox.pasteElement();var c=eventManager.on("rendered",function(){ezd.scale=!0,c()})}}}function attrDirective(a,b){return a="isAttr"+a,function(){var c=/\s*([^=]+)(=\s*(\S+))?/;return{restrict:"A",link:function(d,e,f){function g(a){(!0===b||d.$index%2===b)&&(l&&!angular.equals(a,l)&&k(l,j),k(a,i)),l=angular.copy(a)}function h(a){return(a=c.exec(a))&&[a[1].replace(/\s+$/,""),a[3]]}function i(a){a&&"undefined"!==a[0]&&"null"!==a[0]&&e.attr(a[0],angular.isDefined(a[1])?a[1]:"")}function j(a){a&&e.removeAttr(a[0])}function k(a,b,c){angular.isString(a)&&(a=a.split(/\s+/)),angular.isArray(a)?angular.forEach(a,function(a){a=h(a),b(a)}):angular.isObject(a)&&angular.forEach(a,function(a,c){c=h(c),a&&(c[1]=a,b(c))})}var l;d.$watch(f[a],function(b){g(d.$eval(f[a]))},!0),f.$observe(a,function(){g(d.$eval(f[a]))})}}}}function Parser(){function a(){q==p&&(l.push(g),eventManager.trigger("designLoaded",g))}function b(b){g={elements:[],canvases:[],information:{},product:{}},q=p=0,m.toLoad=[],m.loaded=0,m.index=0,o.toLoad=[],o.loaded=0,o.index=0,n.toLoad=[],n.loaded=0,n.index=0,$(b).find("canvases").each(function(){var a={};$.each(this.attributes,function(b,c){var d=c.name,e=c.value;g.information[d]||(g.information[d]=e),a[d]=e}),g.canvases.push(a)}),$(b).find("designs").each(function(){$.each(this.attributes,function(a,b){g.information[b.name]=b.value})}),$(b).find("product_styles").each(function(){$.each(this.attributes,function(a,b){g.product[b.name]=b.value})}),$(b).find("canvas_text").each(function(){var a={type:"text"};$.each(this.attributes,function(b,c){a[c.name]=c.value});var b={};if(b.font_id=a.font_id,$(this).find("fonts").each(function(){$.each(this.attributes,function(a,c){b[c.name]=c.value}),$(this).find("font_styles").each(function(){$.each(this.attributes,function(a,c){b[c.name]=c.value})}),$(this).find("canvas_text_embroidery").each(function(){$.each(this.attributes,function(b,c){a[c.name]=c.value,a.type="embroideryText"})})}),state.fontReplacements){var c=findMatch(state.fontReplacements,function(a){return a.old_font_id==b.font_id});c&&(b.font=c.new_font_name,b.font_style=c.new_font_style_name,b.font_id=a.font_id=c.new_font_id,b.font_style_id=a.font_style_id=c.new_font_style_id,b.jspath=c.jspath,b.fontttfpath=b.jspath.replace(".ttf.js",".ttf"),b.altfontttfpath=b.jspath.replace(".ttf.js",".ttf"))}"embroideryText"!=a.type,b.font_family=b.fontFamily=c,b.gifpath=service.adjustUrl(b.gifpath),a.fontObject=b,a.fontObject.font_id=a.font_id,a.x*=.5,a.y*=.5,a.width*=.5,a.height*=.5,a.fill_color=getColorString(a.fill_color),a.stroke_color=getColorString(a.stroke_color),a.stroke_width=a.stroke_width,0!=parseFloat(a.stroke_width)?(a.stroke_width=parseFloat(a.stroke_width)/2,a.original_stroke=a.stroke_width):a.stroke_width=0,a.fontObject.font_id=a.font_id,g.elements.push(a),searchInArray(m.elements,a.fontObject.font_id,"font_id")||"embroideryText"==a.type||(p++,m.elements.push(a.fontObject),m.toLoad.push(a.fontObject))}),$(b).find("canvas_art").each(function(){var a={},b=[];$.each(this.attributes,function(c,d){var e=d.name;a[e]=d.value,"color"==e.substring(0,5)&&8>e.length&&(a[e]=getColorString(a[e],!0),b.push({name:e,value:a[e]}))}),b.sort(function(a,b){return parseInt(a.name.replace("color",""))-parseInt(b.name.replace("color",""))});for(var c=0;c<b.length;c++);$(this).find("art").each(function(){$.each(this.attributes,function(b,c){a[c.name]=c.value})}),a.x*=.5,a.y*=.5,a.width*=.5,a.height*=.5,a.type="vector"==a.art_type?"vector":"emb"==a.art_type?"embroideryArt":"image","vector"==a.type?(a.colors=b,a.stroke_color&&a.stroke_width&&(a.stroke_color=getColorString(a.stroke_color),a.stroke_width=a.stroke_width,0!=parseFloat(a.stroke_width)?(a.stroke_width=parseFloat(a.stroke_width)/2,a.original_stroke=a.stroke_width):a.stroke_width=0),p++,o.elements.push(a),o.toLoad.push(a)):"image"==a.type?(a.colors=b,p++,n.elements.push(a),n.toLoad.push(a)):"embroideryArt"==a.type&&(a.colors=b),g.elements.push(a)}),g.designId=g.information.design_id,m.toLoad.length&&e(),o.toLoad.length&&d(),n.toLoad.length&&c(),0===p&&a()}function c(){var b=0,c=function(){var d=n.toLoad[b],e=new Image,f=d.original_art_path?d.original_art_path:d.art_path;e.onload=function(e){d.image=this,b++,q++,a(),b<n.toLoad.length&&c()},e.src=fixImageUrl(f)};c()}function d(){var b=0,c=function(){var d=o.toLoad[b];$.ajax({type:"GET",url:fixImageUrl(d.original_art_path),dataType:"xml",success:function(e){d.svg=e,q++,a(),b++,b<o.toLoad.length&&c()},error:this.defaultError})};c()}function e(){var c=0,d=function(){var e=m.toLoad[c];null==m.categories[e.font_style_id]&&(m.categories[e.font_style_id]=[]);var f=m.categories[e.font_style_id];findMatch(f,function(a){return a.font_id==e.font_id})||f.push(b),e.font_id||(e.font_id=1);for(var h="",i=0;i<g.elements.length&&"text"==g.elements[i].type;i++)h+=g.elements[i].value;service.loadFont(e,function(){c++,q++,a(),c<m.toLoad.length&&d()},h),console.info("载入字体")};d()}function f(a){var b={regions:[],sides:[]},c={};$(a).find("products").each(function(){c={},$.each(this.attributes,function(a,b){c[b.name]=b.value})}),b.description=c;var d=$(a).find("product_styles");d.each(function(){b.information={},$.each(this.attributes,function(a,c){b.information[c.name]=c.value})});for(var e=0;e<d.length;e++){var f=d[e];f.attributes.product_style_id.value===state.selectedProductStyleID&&(b.information.html_color=f.attributes.html_color.value)}for($(a).find("print_mask").each(function(){this.attributes.length&&(b.mask={},$.each(this.attributes,function(a,c){b.mask[c.name]=c.value}),b.mask.art_path=fixImageUrl(b.mask.art_path))}),d.find("product_regions").each(function(){if(this.parentNode.getAttribute("product_style_id")==h){var a={};$.each(this.attributes,function(b,c){a[c.name]=c.value}),a.originalRegion=a.region.split(","),a.region=a.region.split(",");for(var c=0;c<a.region.length;c++)a.region[c]=k/500*a.region[c]*.5;c=this.getElementsByTagName("print_mask"),c=null!=c[0].getAttribute("art_path")?{type:"image",value:fixImageUrl(c[0].getAttribute("art_path"))}:{type:"shape",value:a.region},a.mask=c,isSideDefined(a.side,b.sides)||(c={zoom:1,resize:1},c.name=a.side,c.sideId=b.sides.length+1,c.defaultRegion={},b.sides.push(c)),b.regions.push(a)}}),a=[],e=0;e<b.regions.length;e++)"undefined"==typeof b.information["image_width_"+b.regions[e].side]&&a.push({region:b.regions[e].name,side:b.regions[e].side,image:b.regions[e].imgurl,index:e});eventManager.trigger("productLoaded",b)}var g,h,i=ezdVars.ApiDomain||"open.dev.jzw.la",j=ezdVars.AppToken||306,k=500,l=[],m={categories:{},elements:[]},n={elements:[]},o={elements:[]},p=0,q=0;eventManager.on("needProduct",function(a){h=a.productStyleId,a.data?setTimeout(function(){f(a.data)},50):a.productId?$.ajax({type:"GET",url:"//"+i+"/Product/Get/?appKey="+j+"&productId="+a.productId+"&productStyleId="+a.productStyleId,dataType:"xml",success:f}):setTimeout(function(){f(service.createProductXml())},50)}),eventManager.on("needSvg",function(a){$.ajax({type:"GET",url:fixImageUrl(a.original_art_path),dataType:"xml",success:function(b){a.svg=b,eventManager.trigger("elementLoaded",a)},error:this.defaultError})}),eventManager.on("needDesign",function(a){$.ajax({type:"GET",url:"//"+i+"/Design/Get/?appKey="+j+"&designId="+a+"&userToken="+ezdVars.UserToken,dataType:"xml",success:b})})}function startAngularApp(){var a=angular.module("ds",["ngRoute","ng.ueditor"]).directive("ngVisible",visibleDirective).directive("ngShowModal",showModalDirective).directive("isScrollPager",scrollPagerDirective).directive("isLoading",loadingDirective).directive("isVerticallyCentered",verticallyCenteredDirective).directive("isDisabled",disabledDirective).directive("showColorTooltip",colorsTooltipDirective).directive("isSubmit",formSubmitDirective).directive("isInlineModal",closeWhenClickOutside).directive("isInlineDropDown",closeWhenClickOutsideDropDown).directive("isInlineDropDownShow",closeWhenClickOutsideDropDownShow).directive("isInlineDropDownHide",closeWhenClickOutsideDropDownHide).directive("isAutoLoad",autoLoadFileInput).directive("isAutoFocus",autoFocusDirective).directive("isAutoSelect",autoSelect).directive("isShowDrawer",showDrawerDirective).directive("isHideDrawers",hideDrawersDirective).directive("isShowFonts",showFontsDirective).directive("isTimerChange",textboxTimerChangeDirective).directive("isHideFonts",hideFontsDirective).directive("isAttr",ngAttrDirective).directive("isPrintElement",printElementDirective).directive("isRequired",requiredDirective).directive("cartNavigation",cartNavigationDirective).directive("isColorPicker",ui.directives.colorPickerDirective).directive("isAddThis",ui.directives.addThis).directive("isSelectOnEnter",selectOnEnterTextboxDirective).directive("pca",pcaDirective).config(["$routeProvider","$sceDelegateProvider",function(a,b){dsLocation=ezdVars.DesignerLocation+"/ds",0===ezdVars.DesignerLocation.indexOf("http")&&ezdVars.DesignerLocation.substring(0,ezdVars.DesignerLocation.indexOf("/",7)),b.resourceUrlWhitelist(["self","**"]),a.when("/addText",{templateUrl:state.theme.url(dsLocation+"/html/designControls/addText.html"),controller:ui.controllers.AddTextController}).when("/editText/:id",{templateUrl:state.theme.url(dsLocation+"/html/designControls/editText.html"),controller:ui.controllers.EditTextController}).when("/editSvg/:id",{templateUrl:state.theme.url(dsLocation+"/html/designControls/editSvg.html"),controller:ui.controllers.EditSvgController}).when("/editImage/:id",{templateUrl:state.theme.url(dsLocation+"/html/designControls/editImage.html"),controller:ui.controllers.EditImageController}).when("/designs",{templateUrl:state.theme.url(dsLocation+"/html/designControls/layers.html"),controller:ui.controllers.PunchInController}).when("/savedArt",{templateUrl:state.theme.url(dsLocation+"/html/designControls/layers.html"),controller:ui.controllers.PunchInController}).when("/uploadArt",{templateUrl:state.theme.url(dsLocation+"/html/designControls/layers.html"),controller:ui.controllers.PunchInController}).when("/editImagePane",{templateUrl:state.theme.url(dsLocation+"/html/designControls/editImagePane.html"),controller:ui.controllers.EditImagePane}).when("/step1",{templateUrl:state.theme.url(dsLocation+"/html/designControls/empty.html"),controller:ui.controllers.Step1Controller}).when("/step2",{templateUrl:state.theme.url(dsLocation+"/html/designControls/empty.html"),controller:ui.controllers.Step2Controller}).when("/step3",{templateUrl:state.theme.url(dsLocation+"/html/designControls/empty.html"),controller:ui.controllers.Step3Controller}).otherwise({redirectTo:"/addText"})}]);ui.controllers.LayersController.$inject="$scope $routeParams $location $rootScope $compile $sce".split(" "),a.controller("LayersController",ui.controllers.LayersController),ui.controllers.EditSvgController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditSvgController",ui.controllers.EditSvgController),ui.controllers.EditTextController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditTextController",ui.controllers.EditTextController),ui.controllers.AddTextController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("AddTextController",ui.controllers.AddTextController),ui.controllers.EditTextEmbroideryController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditTextEmbroideryController",ui.controllers.EditTextEmbroideryController),ui.controllers.EditArtEmbroideryController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditArtEmbroideryController",ui.controllers.EditArtEmbroideryController),ui.controllers.EditImageController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditImageController",ui.controllers.EditImageController),ui.controllers.EditMultipleController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditMultipleController",ui.controllers.EditMultipleController),ui.controllers.DistressController.$inject=["$scope","$routeParams","$location"],a.controller("DistressController",ui.controllers.DistressController),ui.controllers.ProductRegionController.$inject=["$scope","$rootScope","$location"],a.controller("ProductRegionController",ui.controllers.ProductRegionController),ui.controllers.ProductColorsController.$inject=["$scope","$routeParams","$location"],a.controller("ProductColorsController",ui.controllers.ProductColorsController),ui.controllers.BackgroundColorController.$inject=["$scope","$routeParams","$location"],a.controller("BackgroundColorController",ui.controllers.BackgroundColorController),ui.controllers.DesignColorsController.$inject=["$scope","$rootScope","$compile"],a.controller("DesignColorsController",ui.controllers.DesignColorsController),ui.controllers.ActionController.$inject=["$scope","$rootScope","$routeParams","$location","$compile","$sce"],a.controller("ActionController",ui.controllers.ActionController),ui.controllers.DesignerController.$inject=["$scope","$rootScope","$location","$compile"],a.controller("DesignerController",ui.controllers.DesignerController),ui.controllers.AdminController.$inject=["$scope"],a.controller("AdminController",ui.controllers.AdminController),ui.controllers.VideoController.$inject=["$scope","$compile"],a.controller("VideoController",ui.controllers.VideoController),ui.controllers.PunchInController.$inject=["$scope","$rootScope","$location","$compile"],a.controller("PunchInController",ui.controllers.PunchInController),ui.controllers.DesignsAndClipArtController.$inject=["$scope","$location","$rootScope"],a.controller("DesignsAndClipArtController",ui.controllers.DesignsAndClipArtController),ui.controllers.DesignIdeasController.$inject=["$scope","$location","$rootScope"],a.controller("DesignIdeasController",ui.controllers.DesignIdeasController),ui.controllers.MyArtController.$inject=["$scope","$location","$rootScope"],a.controller("MyArtController",ui.controllers.MyArtController),ui.controllers.ProductCategoriesController.$inject=["$scope","$location","$compile","$sce"],a.controller("ProductCategoriesController",ui.controllers.ProductCategoriesController),ui.controllers.BrowseProductsController.$inject=["$scope","$rootScope","$compile","$sce"],a.controller("BrowseProductsController",ui.controllers.BrowseProductsController),ui.controllers.ColorPickerController.$inject=["$scope"],a.controller("ColorPickerController",ui.controllers.ColorPickerController),ui.controllers.AddNoteController.$inject=["$scope"],a.controller("AddNoteController",ui.controllers.AddNoteController),ui.controllers.LandingPageController.$inject=["$scope","$compile"],a.controller("LandingPageController",ui.controllers.LandingPageController),ui.controllers.ClipArtController.$inject=["$scope","$location","$rootScope"],a.controller("ClipArtController",ui.controllers.ClipArtController),ui.controllers.LogInOrCreateAccountController.$inject=["$scope","$rootScope","$location"],a.controller("LogInOrCreateAccountController",ui.controllers.LogInOrCreateAccountController),ui.controllers.SaveAndShareController.$inject=["$scope","$rootScope","$location","$compile"],a.controller("SaveAndShareController",ui.controllers.SaveAndShareController),ui.controllers.SaveAndNameDesignController.$inject=["$scope","$rootScope","$compile"],a.controller("SaveAndNameDesignController",ui.controllers.SaveAndNameDesignController),ui.controllers.SaveAndShareEmailController.$inject=["$scope","$rootScope"],a.controller("SaveAndShareEmailController",ui.controllers.SaveAndShareEmailController),ui.controllers.NamesAndNumbersController.$inject=["$scope","$compile","$rootScope"],a.controller("NamesAndNumbersController",ui.controllers.NamesAndNumbersController),ui.controllers.GetQuoteController.$inject=["$scope","$compile","$rootScope"],a.controller("GetQuoteController",ui.controllers.GetQuoteController),ui.controllers.MobileUploadController.$inject=["$scope","$rootScope"],a.controller("MobileUploadController",ui.controllers.MobileUploadController),ui.controllers.ShareWithSocialMediaController.$inject=["$scope","$rootScope","$location","$compile"],a.controller("ShareWithSocialMediaController",ui.controllers.ShareWithSocialMediaController),ui.controllers.SelectSizesController.$inject=["$scope","$compile","$rootScope"],a.controller("SelectSizesController",ui.controllers.SelectSizesController),ui.controllers.CartLoginController.$inject=["$scope","$compile","$rootScope"],a.controller("CartLoginController",ui.controllers.CartLoginController),ui.controllers.CartRegisterController.$inject=["$scope","$compile","$rootScope"],a.controller("CartRegisterController",ui.controllers.CartRegisterController),ui.controllers.SaveDesignController.$inject=["$scope","$compile","$rootScope"],a.controller("SaveDesignController",ui.controllers.SaveDesignController),ui.controllers.ViewCartController.$inject=["$scope","$compile","$rootScope"],a.controller("ViewCartController",ui.controllers.ViewCartController),ui.controllers.EnterPaymentController.$inject=["$scope","$compile"],a.controller("EnterPaymentController",ui.controllers.EnterPaymentController),ui.controllers.EnterAddressesController.$inject=["$scope","$compile"],a.controller("EnterAddressesController",ui.controllers.EnterAddressesController),ui.controllers.ShippingMethodController.$inject=["$scope","$compile"],a.controller("ShippingMethodController",ui.controllers.ShippingMethodController),ui.controllers.ReviewOrderController.$inject=["$scope","$compile"],a.controller("ReviewOrderController",ui.controllers.ReviewOrderController),ui.controllers.EmailDesignController.$inject=["$scope","$compile"],a.controller("EmailDesignController",ui.controllers.EmailDesignController),ui.controllers.PrintReceiptController.$inject=["$scope","$compile"],a.controller("PrintReceiptController",ui.controllers.PrintReceiptController),ui.controllers.ViewTestCaseXmlController.$inject=["$scope","$compile"],a.controller("ViewTestCaseXmlController",ui.controllers.ViewTestCaseXmlController),ui.controllers.UploaderLandingController.$inject=["$scope","$compile","$sce"],a.controller("UploaderLandingController",ui.controllers.UploaderLandingController),ui.controllers.upImageLoadingController.$inject=["$scope","$compile"],a.controller("upImageLoadingController",ui.controllers.upImageLoadingController),ui.controllers.ChooseNumberOfColorsController.$inject=["$scope","$compile"],a.controller("ChooseNumberOfColorsController",ui.controllers.ChooseNumberOfColorsController),ui.controllers.EmbroideryMapColorsController.$inject=["$scope","$compile"],a.controller("EmbroideryMapColorsController",ui.controllers.EmbroideryMapColorsController),ui.controllers.MobileUploadConfirmController.$inject=["$scope","$compile"],a.controller("MobileUploadConfirmController",ui.controllers.MobileUploadConfirmController),ui.controllers.SelectImageTypeController.$inject=["$scope","$compile"],a.controller("SelectImageTypeController",ui.controllers.SelectImageTypeController),ui.controllers.ColorOrBWController.$inject=["$scope","$compile"],a.controller("ColorOrBWController",ui.controllers.ColorOrBWController),ui.controllers.MobileUploadConfirmController.$inject=["$scope","$compile"],a.controller("MobileUploadConfirmController",ui.controllers.MobileUploadConfirmController),ui.controllers.EditImagePane.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("EditImagePane",ui.controllers.EditImagePane),ui.controllers.SaleGoalController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("SaleGoalController",ui.controllers.SaleGoalController),ui.controllers.Step1Controller.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("Step1Controller",ui.controllers.Step1Controller),ui.controllers.Step2Controller.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],
a.controller("Step2Controller",ui.controllers.Step2Controller),ui.controllers.Step3Controller.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("Step3Controller",ui.controllers.Step3Controller),ui.controllers.AddressController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("AddressController",ui.controllers.AddressController),ui.controllers.AddressListController.$inject=["$scope","$compile","$routeParams","$location","$rootScope"],a.controller("AddressListController",ui.controllers.AddressListController),angular.bootstrap(document.getElementById("angularAppElement"),["ds"])}function showModal(a,b,c,d){b=state.theme.url(ezdVars.DesignerLocation+modals[a]),"colorPicker"!=a&&$(".isd-modalContainer").hide(),function(){for(var a=$("div.isd-modalContainer"),b=0;b<a.length;b++){var c=$(a[b]);if("designIdeas"!=c[0].id&&"clipArt"!=c[0].id)for(var c=c.find("div[ng-controller]"),d=0;d<c.length;d++){var e=$(c[d]).scope();e&&e.beforeClose&&e.beforeClose(),e&&e.close&&e.close()}}}();var e=$("#"+a);if(e.length){if("designIdeas"==a||"clipArt"==a||"colorOrBW"==a)return void e.show();e.remove()}$.get(b,function(b){var e=angular.element("#angularAppElement").scope().$new();if(d)for(var f in d)e[f]=d[f];if(e.close=function(){e.beforeClose&&e.beforeClose(),"designIdeas"==a||"clipArt"==a?$("#"+a).modal("hide"):(("chooseNumberOfColors"==a||"colorOrBW"==a)&&(a="selectImageType"),$("#"+a).modal("hide"),$("#"+a).on("hidden.bs.modal",function(b){$("#"+a).remove()}),e.$destroy())},e.sendEvent=function(a,b){eventManager.trigger(a,b),e.close()},e.centerModal=function(b){b||(b=$("#"+a+" .isd-light-container"));var c=$("#angularAppElement").height(),d=b.height();b.css("top",Math.max(2,c-d)/2+"px")},b=$(b)[0],c(b)(e),"chooseNumberOfColors"==a||"colorOrBW"==a){var g=$("#selectImageType");g.find(".modal-content").empty()}else var g=$('<div class="modal fade" tabindex="-1" data-backdrop="false" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" id="'+a+'"><div class="modal-dialog modal-lg"><div class="modal-content"></div> </div></div>');e.$$destroyed||(g.find(".modal-content").append(b),g.appendTo("#dsContainer"),hideModalDrawer("#"+a),e.$apply()),d&&d.noCenter||setTimeout(function(){e.centerModal()},10)})}function hideModalDrawer(a){a||(a=".modal"),$(a+":visible").length?$(a).modal("hide"):$(a).modal("show")}function showModalDrawer(a,b,c,d,e,f,g){b=state.theme.url(ezdVars.DesignerLocation+modals[a]);$("#drawersContainer");if(!$("#"+a+":visible").length||d&&d.noToggleOnClick){hideModalDrawer("#"+a);var h=function(b){hideModalDrawer("#"+a)};if(e=$("#"+a),e.length)for(b=e.find("div[ng-controller]"),e=0;e<b.length;e++){var i=$(b[e]).scope();if(i&&i.onShow){if(d)for(var j in d)i[j]=d[j];"clipArt"==a&&$(".isd-clipart-category-list").removeClass("active"),i.onShow(d,g)}}else $.get(b,function(b){var e=angular.element("#angularAppElement").scope().$new();if(d)for(var i in d)e[i]=d[i];e.close=function(){e.beforeClose&&e.beforeClose(),hideModalDrawer("#"+a)},e.centerModal=function(a){},b=$(b)[0],c(b)(e);var j=$('<div class="modal fade" tabindex="-1" data-backdrop="false" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" id="'+a+'"><div class="modal-dialog modal-lg"><div class="modal-content"></div> </div></div>');e.$$destroyed||(j.find(".modal-content").append(b),j.appendTo("#dsContainer"),e.$apply()),h($("#"+a)),f&&f();var k=$("#"+a);if(k.length>0)for(var l=k.find("div[ng-controller]"),m=0;m<l.length;m++){var l=$(l[m]).scope();l.onShow(null,g)}})}else hideModalDrawer("#"+a)}function showColorModal(a,b,c,d,e){if(0!=$(".ds-colorPicker").length)$(".ds-colorPicker").remove();else{var f=d.currentColor,g=d.onSelect,h=d.allowTransparent,i=d.onlyNames,j=d.onlyNumbers,k=a.$new();k.designColors=[],k.otherColors=angular.copy(state.storeInkColors);for(var l=state.designer.sides,m=0;m<l.length;m++)for(var n=l[m],o=n.elements,p=0;p<o.length;p++){var q=o[p];q instanceof ui.text.TextElement&&(0!=q.stroke&&k.designColors.push(q.strokeColor),k.designColors.push(q.color))}if(k.designColors=k.designColors.unique(),k.currentColor=f,k.currentColorName=c.getColorName(f),k.allowTransparent=h,k.otherColorCurrent="-----",k.colorsInUseCurrent="-----",normalizeColorStrings(k.designColors),k.currentColor=normalizeColorStrings(k.currentColor),i||j){for(a=0;a<k.otherColors.length;a++)d=k.otherColors[a],i&&"0"==d.name_color&&(k.otherColors.splice(a,1),a--),j&&"0"==d.number_color&&(k.otherColors.splice(a,1),a--);for(a=0;a<k.designColors.length;a++){var r=getColorString(k.designColors[a]);d=findMatch(k.otherColors,function(a){return r==getColorString(a.html_color)}),d||(k.designColors.splice(a,1),a--)}}k.selectColor=function(a){return getDesignColors()>=10?(k.close(),alert("您添加的设计颜色数量超过了10种，为了保证印刷质量，请保证设计颜色数量不超过10种。\n或咨询客服：400-920-2085 协助您解决。"),!1):(g&&g(a),i||j||eventManager.trigger("designColorsChanged"),void k.close())},k.colorsInUseHover=function(a){k.colorsInUseCurrent=c.getColorName(a)},k.colorsInUseLeave=function(){k.colorsInUseCurrent="-----"},k.otherColorHover=function(a){k.otherColorCurrent=c.getColorName(a)},k.otherColorLeave=function(){k.otherColorCurrent="-----"},a=state.theme.url(ezdVars.DesignerLocation+"/ds/html/modals/colorPicker.html"),$(".ds-colorPicker").length&&$(".ds-colorPicker").remove(),$.get(a,function(a){k.close=function(){$(".ds-colorPicker").remove(),k.$destroy()},a=$(a)[0],b(a)(k),$(e.currentTarget).parent().addClass("open").find(".ds-colorPicker").remove(),$(e.currentTarget).parent().append(a),k.$apply()})}}function hideLoaderForNext(){hideLoader={}}function ajaxCallStarted(a,b,c){if(!(0<=excludedAjaxCalls.indexOf(a)))if(hideLoader&&!hideLoader.methodName)hideLoader.methodName=a;else{b=b||"载入中，请稍等...",pendingAjaxCalls.push(b);var d=$("#isd-LoaderContainer");a=$("#angularAppElement").height();var e=$("#angularAppElement").width();d.css("height",a+"px"),d.css("width",e+"px"),d.find(".loading-center-text").text(b),c||(c=10),c>0?setTimeout(function(){pendingAjaxCalls.length&&d.fadeIn()},c):d.show()}}function ajaxCallEnded(a){hideLoader&&hideLoader.methodName==a?hideLoader=null:(pendingAjaxCalls.pop(),setTimeout(function(){0==pendingAjaxCalls.length&&$("#isd-LoaderContainer").fadeOut()},100))}Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var a="",b=new XMLSerializer,c=0;c<this.childNodes.length;c++)a+=b.serializeToString(this.childNodes[c]);return a},set:function(a){alert("不允许设置SVG对象的innerHTML")},enumerable:!1,configurable:!0}),Math.formatFloat=function(a,b){var c=Math.pow(10,b);return parseInt(a*c,10)/c},Array.prototype.unique=function(){for(var a={},b=[],c=0;c<this.length;c++)a[this[c]]||(a[this[c]]=!0,b.push(this[c]));return b};var taskQueue=[];setUpTaskQueue(),String.prototype.hashCode=function(){var a,b,c=0;if(0==this.length)return c;for(a=0,l=this.length;a<l;a++)b=this.charCodeAt(a),c=(c<<5)-c+b,c|=0;return c},String.prototype.toBool=function(){return"0"==this||"false"==this.toLowerCase()||0==this.length?!1:!0},String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},String.prototype.startsWith=function(a){return 0==this.indexOf(a)},Array.prototype.clone=function(){return this.slice(0)},Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var tasks=[],startTime=Date(),numOverlays=0;PCA.prototype.getProvinces=function(){return this.provinces},PCA.prototype.getCities=function(a){var b=[];for(var c in this.hashData[a])b.push(c);return b},PCA.prototype.getAreas=function(a,b){return this.hashData[a][b]},window.pca=new PCA,Namespace("base"),base.EventManager=function(){this.element=$(window),this.trigger=function(a,b){this.element.trigger(a,[b]),this.enableLogging&&console.log("event:"+a)},this.on=function(a,b){var c=function(a,c){b(c)};return this.element.on(a,c),function(){eventManager.element.off(a,c)}}},window.eventManager=new base.EventManager,base.addStyleElement=function(a){var b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)},base.ColorUtils=function(){function a(a){var b={r:0,g:0,b:0,a:1};return a=getColorString(a,!0),"none"===a?b.a=0:a.match(/[0-9A-F]{6}/)&&(b.r=parseInt("0x"+a.substring(0,2)),b.g=parseInt("0x"+a.substring(2,4)),b.b=parseInt("0x"+a.substring(4,6))),b}this.rgbToXyz=function(a){var b=a[0]/255,c=a[1]/255;return a=a[2]/255,b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92,c=c>.04045?Math.pow((c+.055)/1.055,2.4):c/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,b*=100,c*=100,a*=100,[.4124*b+.3576*c+.1805*a,.2126*b+.7152*c+.0722*a,.0193*b+.1192*c+.9505*a]},this.xyzToLab=function(a){var b=a[0]/95.047,c=a[1]/100;return a=a[2]/108.883,b=b>.008856?Math.pow(b,1/3):7.787*b+16/116,c=c>.008856?Math.pow(c,1/3):7.787*c+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*c-16,500*(b-c),200*(c-a)]},this.labToXyz=function(a){var b=(a[0]+16)/116,c=a[1]/500+b;a=b-a[2]/200;var d=Math.pow(b,3),e=Math.pow(c,3),f=Math.pow(a,3);return[95.047*(e>.008856?e:(c-16/116)/7.787),100*(d>.008856?d:(b-16/116)/7.787),108.883*(f>.008856?f:(a-16/116)/7.787)]},this.xyzToRgb=function(a){var b=a[0]/100,c=a[1]/100,d=a[2]/100;a=3.2406*b+-1.5372*c+-.4986*d;var e=-.9689*b+1.8758*c+.0415*d,b=.0557*b+-.204*c+1.057*d;return a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:12.92*b,[Math.round(255*a),Math.round(255*e),Math.round(255*b)]},this.labToRgb=function(a){return a=this.labToXyz(a),this.xyzToRgb(a)},this.rgbToLab=function(a){return a=this.rgbToXyz(a),this.xyzToLab(a)},this.cie1994=function(a,b,c){var d=a[0],e=a[1],f=a[2];a=b[0];var g,h=b[1],i=b[2];c?(b=.014,g=.048,c=2):(b=.015,g=.045,c=1);var j=Math.sqrt(e*e+f*f),k=Math.sqrt(h*h+i*i);return b=1+b*j,g=1+g*j,e-=h,f-=i,h=j-k,d-=a,a=Math.abs(e*e+f*f-h*h),a=Math.sqrt(a),Math.sqrt(Math.pow(d/(1*c),2)+Math.pow(h/(1*g),2)+Math.pow(a/(1*b),2))},this.ciede2000=function(a,b){var c=Math.sqrt,d=Math.pow,e=Math.cos,f=Math.atan2,g=Math.sin,h=Math.abs,i=Math.exp,j=Math.PI,k=a[0],l=a[1],m=a[2],n=b[0],o=b[1],p=b[2],q=c(d(l,2)+d(m,2)),r=c(d(o,2)+d(p,2)),s=(q+r)/2,s=.5*(1-c(d(s,7)/(d(s,7)+d(25,7)))),l=(1+s)*l,t=(1+s)*o,o=c(d(l,2)+d(m,2)),s=c(d(t,2)+d(p,2)),u=function(a,b){if(0===a&&0===b)return 0;var c;return c=f(a,b)*(180/j),c>=0?c:c+360},v=u(m,l),t=u(p,t),p=n-k,m=s-o,l=function(a,b,c,d){if(0===a*b)return 0;if(180>=h(d-c))return d-c;if(d-c>180)return d-c-360;if(-180>d-c)return d-c+360;throw Error()}(q,r,v,t),l=2*c(o*s)*g(j/180*l/2),k=(k+n)/2,n=(o+s)/2,q=function(a,b,c,d){if(0===a*b)return c+d;if(180>=h(c-d))return(c+d)/2;if(180<h(c-d)&&360>c+d)return(c+d+360)/2;if(180<h(c-d)&&c+d>=360)return(c+d-360)/2;throw Error()}(q,r,v,t),e=1-.17*e(j/180*(q-30))+.24*e(j/180*q*2)+.32*e(j/180*(3*q+6))-.2*e(j/180*(4*q-63)),i=30*i(-d((q-275)/25,2)),q=c(d(n,7)/(d(n,7)+d(25,7))),r=1+.015*d(k-50,2)/c(20+d(k-50,2)),k=1+.045*n,e=1+.015*n*e,g=-2*q*g(j/180*i*2);return c(d(p/(1*r),2)+d(m/(1*k),2)+d(l/(1*e),2)+m/(1*k)*g*(l/(1*e)))},this.compareColors=function(b,c){var d=a(b),e=a(c),d=this.rgbToXyz([d.r,d.g,d.b]),e=this.rgbToXyz([e.r,e.g,e.b]),d=this.xyzToLab(d),e=this.xyzToLab(e);return this.cie1994(d,e,!1).toFixed(2)/100},this.compareCiedeColors=function(a,b){var c=this.rgbToXyz([a[0],a[1],a[2]]),d=this.rgbToXyz([b[0],b[1],b[2]]),c=this.xyzToLab(c),d=this.xyzToLab(d);return this.cie1994(c,d,!1)/100}},base.colorUtils=new base.ColorUtils,function(a){base.validators={text:function(a,b){var c=!0;return 1>a.trim().length&&(b.value="",c=!1),c},required:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0==b.trim().length&&(e.text("这是一个必填项").show(),c.value="",d=!1),d&&e.text("").hide(),d},name:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0<b.trim().length?b.match(/\d+/g)&&(e.text("名称不能包含数字").show(),d=!1):(e.text("这是一个必填项").show(),c.value="",d=!1),d&&e.text("").hide(),d},email:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0<b.length?b.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||(e.text("邮箱格式错误").show(),d=!1):(e.text("这是一个必填项").show(),d=!1),console.log("isValid = ",d),d&&e.text("").hide(),d},multipleEmail:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return b.split(",").forEach(function(a){0<a.length?(a=a.trim().replace(",",""),a.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||(e.text("邮箱格式错误").show(),d=!1)):(e.text("这是一个必填项").show(),d=!1)}),console.log("isValid = ",d),d&&e.text("").hide(),d},phone:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0<b.length?b.match(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i)?e.text("这是一个必填项").show():(e.text("电话号码格式错误").show(),d=!1):(e.text("这是一个必填项").show(),d=!1),d&&e.text("").hide(),d},taxID:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0<b.trim().length?b.match(/^([07][1-7]|1[0-6]|2[0-7]|[35][0-9]|[468][0-8]|9[0-589])-?\d{7}$/)||(e.text("传真格式错误").show(),d=!1):(e.text("这是一个必填项").show(),d=!1),d&&e.text("").hide(),d},creditCardNumber:function(b,c){var d=a(c).parent().find(".isd-invalid-msg");for(isValid=!1,value=b.replace(/\D+/g,""),len=value.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;len--;)sum+=prodArr[mul][parseInt(value.charAt(len),10)],mul^=1;return 0<b.length?0===sum%10&&0<sum?(d.text("这是一个必填项").show(),isValid=!0):d.text("证件格式错误").show():d.text("这是一个必填项").show(),isValid&&d.text("").hide(),isValid},zipCode:function(b,c){var d=a(c).attr("data-mode")||"US",e=a(c).parent().find(".isd-invalid-msg"),f=!1;return(f="1"==d?b.match(/^\d{5}$/)||b.match(/^\d{5}\-\d{4}$/)||b.match(/^\d{9}$/):"2"==d?b.match(/^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} *\d{1}[A-Z]{1}\d{1}$/):!0)?e.text("").hide():e.text("邮编格式错误").show(),f},password:function(b,c){var d=!0,e=a(c).parent().find(".isd-invalid-msg");return 0<b.length?6>b.length&&(e.text("密码至少需要6位").show(),d=!1):(e.text("这是一个必填项").show(),d=!1),d&&e.text("").hide(),d},confirmPassword:function(b,c){var d=a(c),e=!0,f=d.parent().find(".isd-invalid-msg"),g=d.val(),d=a("#"+d.attr("data-password-field")).val();return 0<b.length?g!==d?(f.text("两次输入的密码不一致").show(),e=!1):f.text("这是一个必填项").show():(f.text("这是一个必填项").show(),e=!1),e&&f.text("").hide(),e}}}(jQuery),function(b){var c={init:function(a){return this.each(function(){})},destroy:function(){return this.each(function(){var a=b(this);1==a.find(".ls_outer").length&&a.find(".ls_outer").remove(),1==a.next(".ls_main").length&&a.next(".ls_main").remove()})},method_1:function(a){var c={color_option_1:"#f9f9f9",color_option_2:"#000",main_width:70,main_height:12,inner_width:10,animation_speed:10,additional_style:"",after_element:!1};return this.each(function(){function d(){f.find(".ls_inner").css({"margin-left":n}),setTimeout(d,l),n++,n==i&&(n=-k)}function e(){f.next(".ls_main").find(".ls_inner").css({"margin-left":o}),setTimeout(e,l),o++,o==i&&(o=0)}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=c.main_height,k=c.inner_width,l=c.animation_speed,m=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; background-color:'+g+"; width:"+i+"px; height:"+j+"px; "+m+'"><span class="ls_inner" style="display:inline-block; width:'+k+"px; height:"+j+'px;"></span></div>'),setTimeout(e,l),f.next(".ls_main").find(".ls_inner").css({"background-color":h})):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; margin-left:auto; margin-right:auto; background-color:'+g+"; width:"+i+"px; height:"+j+"px; "+m+'"><span class="ls_inner" style="display:inline-block; width:'+k+"px; height:"+j+'px;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,l),f.find(".ls_inner").css({"background-color":h}));var n=0,o=0})},method_2:function(c){var d={color_option_1:"#aaa",color_option_2:"#000",main_width:15,main_height:15,animation_speed:200,number_of_box:3,margin_left_right:2,additional_style:"",circle_shape:!0,zoom_effect:!1,after_element:!1};return this.each(function(){function e(){o[0]?(g.find(".ls_inner").css({"background-color":h,height:k}),g.find(".ls_inner").eq(s).css({"background-color":i,height:k+o[1]})):(g.find(".ls_inner").css({"background-color":h}),g.find(".ls_inner").eq(s).css({"background-color":i})),setTimeout(e,l),s++,s==m&&(s=0)}function f(){o[0]?(g.next(".ls_main").find(".ls_inner").css({"background-color":h,height:k}),g.next(".ls_main").find(".ls_inner").eq(t).css({"background-color":i,height:k+o[1]})):(g.next(".ls_main").find(".ls_inner").css({"background-color":h}),g.next(".ls_main").find(".ls_inner").eq(t).css({"background-color":i})),setTimeout(f,l),t++,t==m&&(t=0)}c&&b.extend(d,c);var g=b(this),h=d.color_option_1,i=d.color_option_2,j=d.main_width,k=d.main_height,l=d.animation_speed,m=d.number_of_box,n=d.margin_left_right,o=d.zoom_effect,p=d.additional_style,q=d.after_element,r=0;if(d.circle_shape&&(r=80),q){for(g.after('<div class="ls_main" style="text-align:center; '+p+'"></div>'),a=0;a<m;a++)g.next(".ls_main").append('<span class="ls_inner" style="display:inline-block; border-radius:'+r+"px; -moz-border-radius:"+r+"px; -webkit-border-radius:"+r+"px; margin:0 "+n+"px; width:"+j+"px; height:"+k+'px;"></span>');setTimeout(f,l)}else{for(g.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+g.width()+"px; height:"+g.height()+'px;"><div class="ls_main" style="text-align:center;"></div></div>'),a=0;a<m;a++)g.find(".ls_main").append('<span class="ls_inner" style="display:inline-block; border-radius:'+r+"px; -moz-border-radius:"+r+"px; -webkit-border-radius:"+r+"px; margin:0 "+n+"px; width:"+j+"px; height:"+k+'px;"></span>');g.find(".ls_main").css({"margin-top":(g.find(".ls_outer").height()-g.find(".ls_main").outerHeight())/2}),setTimeout(e,l)}var s=0,t=0})},method_3:function(c){var d={color_option_1:"#aaa",color_option_2:"#000",animation_speed:100,animation_text:"载入中。。。",space_between_text:10,additional_style:"font-family:arial; font-size:12px;",zoom_effect:!1,after_element:!1};return this.each(function(){function e(){n[0]?(g.find(".ls_inner").css({color:h,"font-size":n[1]}),g.find(".ls_inner").eq(o).css({color:i,"font-size":n[2]})):(g.find(".ls_inner").css({color:h}),g.find(".ls_inner").eq(o).css({color:i})),setTimeout(e,j),o++,o==k.length&&(o=0)}function f(){n[0]?(g.next(".ls_main").find(".ls_inner").css({color:h,"font-size":n[1]}),g.next(".ls_main").find(".ls_inner").eq(p).css({color:i,"font-size":n[2]})):(g.next(".ls_main").find(".ls_inner").css({color:h}),g.next(".ls_main").find(".ls_inner").eq(p).css({color:i})),setTimeout(f,j),p++,p==k.length&&(p=0)}c&&b.extend(d,c);var g=b(this),h=d.color_option_1,i=d.color_option_2,j=d.animation_speed,k=d.animation_text,l=d.space_between_text,k=k.split(""),m=d.additional_style,n=d.zoom_effect;if(d.after_element){for(g.after('<div class="ls_main" style="overflow:hidden; text-align:center; '+m+'"></div>'),a=0;a<k.length;a++)g.next(".ls_main").append('<span class="ls_inner" style="display:inline-block; text-align:center; width:'+l+'px;">'+k[a]+"</span>");setTimeout(f,j)}else{for(g.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+g.width()+"px; height:"+g.height()+'px;"><div class="ls_main" style="overflow:hidden; margin-left:auto; margin-right:auto; text-align:center; '+m+'"></div></div>'),a=0;a<k.length;a++)g.find(".ls_main").append('<span class="ls_inner" style="display:inline-block; text-align:center; width:'+l+'px;">'+k[a]+"</span>");g.find(".ls_main").css({"margin-top":(g.find(".ls_outer").height()-g.find(".ls_main").outerHeight())/2}),setTimeout(e,j)}var o=0,p=0})},method_4:function(a){var c={color_option_1:"#fff",color_option_2:"#000",main_width:30,main_height:30,animation_speed:100,additional_style:"font-family:arial;",after_element:!1};return this.each(function(){function d(){f.find(".ls_main").html(m),setTimeout(d,k),m++}function e(){f.next(".ls_main").html(n),setTimeout(e,k),n++}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=c.main_height,k=c.animation_speed,l=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; text-align:center; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; width:'+i+"px; height:"+j+"px; line-height:"+j+"px; background-color:"+g+"; color:"+h+"; "+l+'">0</div>'),setTimeout(e,k)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; text-align:center; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; margin-left:auto; margin-right:auto; width:'+i+"px; height:"+j+"px; line-height:"+j+"px; background-color:"+g+"; color:"+h+"; "+l+'">0</div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,k));var m=1,n=1})},method_5:function(a){var c={color_option_1:"#eee",color_option_2:"#000",main_width:25,animation_speed:200,additional_style:"",after_element:!1};return this.each(function(){function d(){f.find(".ls_inner").css({"background-color":g}),f.find(".ls_inner").eq(m).css({"background-color":h}),setTimeout(d,k),m++,4==m&&(m=0)}function e(){f.next(".ls_main").find(".ls_inner").css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(n).css({"background-color":h}),setTimeout(e,k),n++,4==n&&(n=0)}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=i/2,k=c.animation_speed,l=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; vertical-align:center; width:'+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span></div>'),setTimeout(e,k)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; margin-left:auto; margin-right:auto; vertical-align:center; width:'+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,k));var m=0,n=0})},method_6:function(a){var c={color_option_1:"#f9f9f9",color_option_2:"#333",main_width:30,animation_speed:100,additional_style:"",reverse_animation:!1,circle_shape:!1,after_element:!1};return this.each(function(){function d(){l?(f.find(".ls_inner").css({"background-color":g}),f.find(".ls_inner."+o).css({"background-color":h})):(f.find(".ls_inner").css({"background-color":g}),f.find(".ls_inner."+p).css({"background-color":h})),setTimeout(d,j),o++,p--,6==o&&(o=1),0==p&&(p=6)}function e(){l?(f.next(".ls_main").find(".ls_inner").css({"background-color":g}),f.next(".ls_main").find(".ls_inner."+q).css({"background-color":h})):(f.next(".ls_main").find(".ls_inner").css({"background-color":g}),f.next(".ls_main").find(".ls_inner."+r).css({"background-color":h})),setTimeout(e,j),q++,r--,6==q&&(q=1),0==r&&(r=6)}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=c.animation_speed,k=c.additional_style,l=c.reverse_animation,m=c.after_element,n=0;c.circle_shape&&(n=80),m?(f.after('<div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner 1" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:100%; height:100%; margin-left:0%; margin-top:0%; float:left;"><span class="ls_inner 2" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 3" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 4" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 5" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 6" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:60%; height:60%; margin-left:20%; margin-top:20%; float:left;"></span></span></span></span></span></span></div>'),setTimeout(e,j)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; margin-left:auto; margin-right:auto; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner 1" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:100%; height:100%; margin-left:0%; margin-top:0%; float:left;"><span class="ls_inner 2" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 3" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 4" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 5" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:80%; height:80%; margin-left:10%; margin-top:10%; float:left;"><span class="ls_inner 6" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+'; width:60%; height:60%; margin-left:20%; margin-top:20%; float:left;"></span></span></span></span></span></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,j));var o=1,p=1,q=1,r=1})},method_7:function(a){var c={color_option_1:"#fff",color_option_2:"#333",main_width:"25",animation_speed:1,additional_style:"",reverse_animation:!1,gradient_setting:!1,circle_shape:!1,after_element:!1};return this.each(function(){function d(){m[0]&&(f.find(".ls_main").css({transform:"rotate("+q+"deg)","-moz-transform":"rotate("+q+"deg)","-o-transform":"rotate("+q+"deg)","-ms-transform":"rotate("+q+"deg)","-webkit-transform":"rotate("+q+"deg)"}),q+=m[3]),l?f.find(".ls_inner").css({height:""+p+"%",width:""+p+"%","margin-left":""+o/2+"%","margin-top":""+o/2+"%"}):f.find(".ls_inner").css({height:""+o+"%",width:""+o+"%","margin-left":""+p/2+"%","margin-top":""+p/2+"%"}),setTimeout(d,j),o--,p++,0==o&&(o=100),100==p&&(p=0)}function e(){m[0]&&(f.next(".ls_main").css({transform:"rotate("+t+"deg)","-moz-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-webkit-transform":"rotate("+t+"deg)"}),t+=m[3]),l?f.next(".ls_main").find(".ls_inner").css({height:""+s+"%",width:""+s+"%","margin-left":""+r/2+"%","margin-top":""+r/2+"%"}):f.next(".ls_main").find(".ls_inner").css({height:""+r+"%",width:""+r+"%","margin-left":""+s/2+"%","margin-top":""+s/2+"%"}),setTimeout(e,j),r--,s++,0==r&&(r=100),100==s&&(s=0)}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=c.animation_speed,k=c.additional_style,l=c.reverse_animation,m=c.gradient_setting,n=0;c.circle_shape&&(n=80),c.after_element?(m[0]?f.after('<div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+"; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from("+m[1]+"), to("+m[2]+")); background: -webkit-linear-gradient(top, "+m[1]+", "+m[2]+"); background: -moz-linear-gradient(left, "+m[1]+", "+m[2]+"); background: -ms-linear-gradient(top, "+m[1]+", "+m[2]+"); background: -o-linear-gradient(top, "+m[1]+", "+m[2]+'); width:100%; height:100%; margin-left:0; margin-top:0;"></span></div>'):f.after('<div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+"; margin-left:auto; margin-right:auto; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+h+'; width:100%; height:100%; margin-left:0; margin-top:0;"></span></div>'),setTimeout(e,j)):(m[0]?f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+"; margin-left:auto; margin-right:auto; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from("+m[1]+"), to("+m[2]+")); background: -webkit-linear-gradient(top, "+m[1]+", "+m[2]+"); background: -moz-linear-gradient(left, "+m[1]+", "+m[2]+"); background: -ms-linear-gradient(top, "+m[1]+", "+m[2]+"); background: -o-linear-gradient(top, "+m[1]+", "+m[2]+'); width:100%; height:100%; margin-left:0; margin-top:0;"></span></div></div>'):f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+g+"; margin-left:auto; margin-right:auto; width:"+i+"px; height:"+i+"px; "+k+'"><span class="ls_inner" style="display:block; border-radius:'+n+"px; -moz-border-radius:"+n+"px; -webkit-border-radius:"+n+"px; background-color:"+h+'; width:100%; height:100%; margin-left:0; margin-top:0;"></span></div></div>'),
f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,j));var o=100,p=0,q=0,r=100,s=0,t=0})},method_8:function(a){var c={color_option_1:"#333",color_option_2:"#fff",main_width:30,animation_speed:200,additional_style:"",circle_shape:!1,animation_effect:"",after_element:!1};return this.each(function(){function d(){"rotate"==m?f.find(".ls_main").css({transform:"rotate("+p+"deg)","-moz-transform":"rotate("+p+"deg)","-o-transform":"rotate("+p+"deg)","-ms-transform":"rotate("+p+"deg)","-webkit-transform":"rotate("+p+"deg)"}):0==p%2?"round"==m?(f.find(".ls_inner").eq(0).css({"background-color":h}),f.find(".ls_inner").eq(1).css({"background-color":h}),f.find(".ls_inner").eq(2).css({"background-color":h}),f.find(".ls_inner").eq(3).css({"background-color":g}),f.find(".ls_inner").eq(5).css({"background-color":h}),f.find(".ls_inner").eq(6).css({"background-color":g}),f.find(".ls_inner").eq(7).css({"background-color":g}),f.find(".ls_inner").eq(8).css({"background-color":g})):"cross"==m?(f.find(".ls_inner").eq(4).css({"background-color":h}),f.find(".ls_inner").eq(0).css({"background-color":g}),f.find(".ls_inner").eq(2).css({"background-color":h}),f.find(".ls_inner").eq(6).css({"background-color":h}),f.find(".ls_inner").eq(8).css({"background-color":g})):(f.find(".ls_inner:even").css({"background-color":g}),f.find(".ls_inner:odd").css({"background-color":h})):"round"==m?(f.find(".ls_inner").eq(0).css({"background-color":g}),f.find(".ls_inner").eq(1).css({"background-color":g}),f.find(".ls_inner").eq(2).css({"background-color":g}),f.find(".ls_inner").eq(3).css({"background-color":h}),f.find(".ls_inner").eq(5).css({"background-color":g}),f.find(".ls_inner").eq(6).css({"background-color":h}),f.find(".ls_inner").eq(7).css({"background-color":h}),f.find(".ls_inner").eq(8).css({"background-color":h})):"cross"==m?(f.find(".ls_inner").eq(4).css({"background-color":h}),f.find(".ls_inner").eq(0).css({"background-color":h}),f.find(".ls_inner").eq(2).css({"background-color":g}),f.find(".ls_inner").eq(6).css({"background-color":g}),f.find(".ls_inner").eq(8).css({"background-color":h})):(f.find(".ls_inner:odd").css({"background-color":g}),f.find(".ls_inner:even").css({"background-color":h})),setTimeout(d,k),p++}function e(){"rotate"==m?f.next(".ls_main").css({transform:"rotate("+q+"deg)","-moz-transform":"rotate("+q+"deg)","-o-transform":"rotate("+q+"deg)","-ms-transform":"rotate("+q+"deg)","-webkit-transform":"rotate("+q+"deg)"}):0==q%2?"round"==m?(f.next(".ls_main").find(".ls_inner").eq(0).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(1).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(2).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(3).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(5).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(6).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(7).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(8).css({"background-color":g})):"cross"==m?(f.next(".ls_main").find(".ls_inner").eq(4).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(0).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(2).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(6).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(8).css({"background-color":g})):(f.next(".ls_main").find(".ls_inner:even").css({"background-color":g}),f.next(".ls_main").find(".ls_inner:odd").css({"background-color":h})):"round"==m?(f.next(".ls_main").find(".ls_inner").eq(0).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(1).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(2).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(3).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(5).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(6).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(7).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(8).css({"background-color":h})):"cross"==m?(f.next(".ls_main").find(".ls_inner").eq(4).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(0).css({"background-color":h}),f.next(".ls_main").find(".ls_inner").eq(2).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(6).css({"background-color":g}),f.next(".ls_main").find(".ls_inner").eq(8).css({"background-color":h})):(f.next(".ls_main").find(".ls_inner:odd").css({"background-color":g}),f.next(".ls_main").find(".ls_inner:even").css({"background-color":h})),setTimeout(e,k),q++}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=i/3,k=c.animation_speed,l=c.additional_style,m=c.animation_effect,n=c.after_element,o=0;c.circle_shape&&(o=80),n?("rotate"==m?f.after('<div class="ls_main" style="overflow:hidden; border-radius:'+o+"px; -moz-border-radius:"+o+"px; -webkit-border-radius:"+o+"px; vertical-align:center; width:"+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span></div>'):f.after('<div class="ls_main" style="overflow:hidden; border-radius:'+o+"px; -moz-border-radius:"+o+"px; -webkit-border-radius:"+o+"px; vertical-align:center; width:"+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span></div>'),setTimeout(e,k)):("rotate"==m?f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:'+o+"px; -moz-border-radius:"+o+"px; -webkit-border-radius:"+o+"px; margin-left:auto; margin-right:auto; vertical-align:center; width:"+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span></div></div>'):f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:'+o+"px; -moz-border-radius:"+o+"px; -webkit-border-radius:"+o+"px; margin-left:auto; margin-right:auto; vertical-align:center; width:"+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; width:'+j+"px; height:"+j+'px;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,k));var p=0,q=0})},method_9:function(a){var c={color_option_1:"#333",color_option_2:"#ddd",main_width:25,animation_speed:5,additional_style:"",after_element:!1};return this.each(function(){function d(){f.find(".ls_main").css({transform:"rotate("+m+"deg)","-moz-transform":"rotate("+m+"deg)","-o-transform":"rotate("+m+"deg)","-ms-transform":"rotate("+m+"deg)","-webkit-transform":"rotate("+m+"deg)"}),setTimeout(d,k),m+=2}function e(){f.next(".ls_main").css({transform:"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)","-o-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)","-webkit-transform":"rotate("+n+"deg)"}),setTimeout(e,k),n+=2}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.main_width,j=i/3,k=c.animation_speed,l=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; vertical-align:center; width:'+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span></div>'),setTimeout(e,k)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; margin-left:auto; margin-right:auto; vertical-align:center; width:'+i+"px; height:"+i+"px; "+l+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+h+"; width:"+j+"px; height:"+j+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g+"; width:"+j+"px; height:"+j+'px;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,k));var m=0,n=0})},method_10:function(a){var c={color_option:["#eee","#333","#eee","#333"],main_width:25,animation_speed:1,additional_style:"",after_element:!1};return this.each(function(){function d(){f.find(".ls_main").css({transform:"rotate("+l+"deg)","-moz-transform":"rotate("+l+"deg)","-o-transform":"rotate("+l+"deg)","-ms-transform":"rotate("+l+"deg)","-webkit-transform":"rotate("+l+"deg)"}),setTimeout(d,j),l+=2}function e(){f.next(".ls_main").css({transform:"rotate("+m+"deg)","-moz-transform":"rotate("+m+"deg)","-o-transform":"rotate("+m+"deg)","-ms-transform":"rotate("+m+"deg)","-webkit-transform":"rotate("+m+"deg)"}),setTimeout(e,j),m-=2}a&&b.extend(c,a);var f=b(this),g=c.color_option,h=c.main_width,i=h/2,j=c.animation_speed,k=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; vertical-align:center; width:'+h+"px; height:"+h+"px; "+k+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g[0]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[1]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[2]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[3]+"; width:"+i+"px; height:"+i+'px;"></span></div>'),setTimeout(e,j)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; margin-left:auto; margin-right:auto; vertical-align:center; width:'+h+"px; height:"+h+"px; "+k+'"><span class="ls_inner" style="display:block; float:left; background-color:'+g[0]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[1]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[2]+"; width:"+i+"px; height:"+i+'px;"></span><span class="ls_inner" style="display:block; float:left; background-color:'+g[3]+"; width:"+i+"px; height:"+i+'px;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,j));var l=0,m=0})},method_11:function(a){var c={color_option_1:"#aaa",color_option_2:"#333",color_option_3:"#fff",main_width:30,animation_speed:1,additional_style:"",animation_effect:"option_1",after_element:!1};return this.each(function(){function d(){"option_3"==m?(f.find(".ls_main").css({transform:"rotate("+p+"deg)","-moz-transform":"rotate("+p+"deg)","-o-transform":"rotate("+p+"deg)","-ms-transform":"rotate("+p+"deg)","-webkit-transform":"rotate("+p+"deg)"}),f.find(".ls_inner").css({height:""+p+"%",width:""+p+"%"})):f.find(".ls_main").css({transform:"rotate("+o+"deg)","-moz-transform":"rotate("+o+"deg)","-o-transform":"rotate("+o+"deg)","-ms-transform":"rotate("+o+"deg)","-webkit-transform":"rotate("+o+"deg)"}),setTimeout(d,k),o+=5,p-=5,0==p&&(p=100)}function e(){"option_3"==m?(f.next(".ls_main").css({transform:"rotate("+r+"deg)","-moz-transform":"rotate("+r+"deg)","-o-transform":"rotate("+r+"deg)","-ms-transform":"rotate("+r+"deg)","-webkit-transform":"rotate("+r+"deg)"}),f.next(".ls_main").find(".ls_inner").css({height:""+r+"%",width:""+r+"%"})):f.next(".ls_main").css({transform:"rotate("+q+"deg)","-moz-transform":"rotate("+q+"deg)","-o-transform":"rotate("+q+"deg)","-ms-transform":"rotate("+q+"deg)","-webkit-transform":"rotate("+q+"deg)"}),setTimeout(e,k),q+=5,r-=5,0==r&&(r=100)}a&&b.extend(c,a);var f=b(this),g=c.color_option_1,h=c.color_option_2,i=c.color_option_3,j=c.main_width,k=c.animation_speed,l=c.additional_style,m=c.animation_effect,n=j/1.7;c.after_element?("option_1"==m?f.after('<div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; vertical-align:center; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_load_span" style="display:block; margin:auto; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background-color:'+i+"; width:"+n+"px; height:"+n+'px;"></span></div>'):"option_2"==m?f.after('<div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; vertical-align:center; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_load_span" style="display:block; margin:15% 0 0 15%; border-radius:80px; background-color:'+i+'; width:70%; height:70%;"></span></div>'):"option_3"==m&&f.after('<div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_inner" style="display:block; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background-color:'+i+'; width:100%; height:100%; margin-left:0; margin-top:0;"></span></div>'),setTimeout(e,k)):("option_1"==m?f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; vertical-align:center; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_load_span" style="display:block; margin:auto; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background-color:'+i+"; width:"+n+"px; height:"+n+'px;"></span></div></div>'):"option_2"==m?f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; vertical-align:center; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_load_span" style="display:block; margin:15% 0 0 15%; border-radius:80px; background-color:'+i+'; width:70%; height:70%;"></span></div></div>'):"option_3"==m&&f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background: -webkit-gradient(linear, 0% 0%, 0% 100%, from('+g+"), to("+h+")); background: -webkit-linear-gradient(top, "+g+", "+h+"); background: -moz-linear-gradient(left, "+g+", "+h+"); background: -ms-linear-gradient(top, "+g+", "+h+"); background: -o-linear-gradient(top, "+g+", "+h+"); margin-left:auto; margin-right:auto; width:"+j+"px; height:"+j+"px; "+l+'"><span class="ls_inner" style="display:block; border-radius:80px; -moz-border-radius:80px; -webkit-border-radius:80px; background-color:'+i+'; width:100%; height:100%; margin-left:0; margin-top:0;"></span></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,k));var o=0,p=100,q=0,r=100})},method_12:function(a){var c={background_image:"img/loading.png",main_width:32,animation_speed:1,additional_style:"",after_element:!1};return this.each(function(){function d(){f.find(".ls_main").css({transform:"rotate("+k+"deg)","-moz-transform":"rotate("+k+"deg)","-o-transform":"rotate("+k+"deg)","-ms-transform":"rotate("+k+"deg)","-webkit-transform":"rotate("+k+"deg)"}),setTimeout(d,i),k+=5}function e(){f.next(".ls_main").css({transform:"rotate("+l+"deg)","-moz-transform":"rotate("+l+"deg)","-o-transform":"rotate("+l+"deg)","-ms-transform":"rotate("+l+"deg)","-webkit-transform":"rotate("+l+"deg)"}),setTimeout(e,i),l+=5}a&&b.extend(c,a);var f=b(this),g=c.background_image,h=c.main_width,i=c.animation_speed,j=c.additional_style;c.after_element?(f.after('<div class="ls_main" style="overflow:hidden; width:'+h+"px; height:"+h+"px; background-image:url("+g+"); background-repeat:no-repeat; background-position:center center; "+j+'"></div>'),setTimeout(e,i)):(f.prepend('<div class="ls_outer" style="position:absolute; z-index:99999; width:'+f.width()+"px; height:"+f.height()+'px;"><div class="ls_main" style="overflow:hidden; margin-left:auto; margin-right:auto; width:'+h+"px; height:"+h+"px; background-image:url("+g+"); background-repeat:no-repeat; background-position:center center; "+j+'"></div></div>'),f.find(".ls_main").css({"margin-top":(f.find(".ls_outer").height()-f.find(".ls_main").outerHeight())/2}),setTimeout(d,i));var k=0,l=0})}};b.fn.LoadingScript=function(a){return c[a]?c[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void b.error("jQuery 载入Script中不存在方法 ："+a):c.init.apply(this,arguments)}}(jQuery),Math.isInsideSegment=function(a,b,c){return.01>Math.abs(Math.distance(a,b)+Math.distance(a,c)-Math.distance(b,c))?!0:!1},Math.distancePointSegment=function(a,b,c){return Math.abs(Math.distance(a,b)+Math.distance(a,c)-Math.distance(b,c))},Math.distPointToRect=function(a,b){var c=b.m,d=b.invM,e=a.y,f=a.x,c=(e-b.p1.y-d*f+c*b.p1.x)/(c-d),d=d*(c-f)+e,e=a.x,f=a.y;return console.log("对齐测量点",e,f,c,d,a,b),Math.distance({x:e,y:f},{x:c,y:d})},Math.nearestPointAtRect=function(a,b){var c=b.m,d=b.invM,e=a.y,f=a.x,c=(e-b.p1.y-d*f+c*b.p1.x)/(c-d);return{x:c,y:d*(c-f)+e}},Math.pointIsInPoly=function(a,b){for(var c=!1,d=b[0].x,e=b[0].x,f=b[0].y,g=b[0].y,h=1;h<b.length;h++)var i=b[h],d=Math.min(i.x,d),e=Math.max(i.x,e),f=Math.min(i.y,f),g=Math.max(i.y,g);if(a.x<d||a.x>e||a.y<f||a.y>g)return!1;for(d=0,e=b.length-1;d<b.length;e=d++)b[d].y>a.y!=b[e].y>a.y&&a.x<(b[e].x-b[d].x)*(a.y-b[d].y)/(b[e].y-b[d].y)+b[d].x&&(c=!c);return c},Math.getTforEllipseToPoint=function(a,b,c,d){var e=Math.pow(a,2),f=Math.pow(a,4),g=Math.pow(a,6);a=Math.pow(a,8),c=Math.pow(c,2);var h=Math.pow(d,2);d=Math.pow(b,2);var i=Math.pow(b,4),j=Math.pow(b,6),k=Math.pow(b,8);return b=Math.sqrt(-(Math.sqrt(-(16*d*h)-16*e*c+k-4*e*j+6*f*i-4*g*d+a)+i+2*e*d+f)/2+i+f)/2,f=Math.sqrt(Math.sqrt(-(16*d*h)-16*e*c+k-4*e*j+6*f*i-4*g*d+a)+i-2*e*d+f)/Math.pow(2,1.5),b+f+(d+e)/2},Math.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},Math.triangleArea=function(a,b,c){return c.x*b.y-b.x*c.y-(c.x*a.y-a.x*c.y)+(b.x*a.y-a.x*b.y)},Math.getRotatedPoint=function(a,b,c,d,e){return c=c/180*Math.PI,a-=d,b-=e,d+=a*Math.cos(c)+b*Math.sin(c),e-=-(a*Math.sin(c))+b*Math.cos(c),{x:d,y:e}},Math.doPolygonsIntersect=function(a,b){var c,d,e,f,g,h,i,j,k=[a,b];for(f=0;f<k.length;f++){var l=k[f];for(g=0;g<l.length;g++){c=l[g],d=l[(g+1)%l.length];var m=d.y-c.y,n=c.x-d.x;for(c=d=void 0,h=0;h<a.length;h++)e=m*a[h].x+n*a[h].y,(void 0==c||c>e)&&(c=e),(void 0==d||e>d)&&(d=e);for(i=j=void 0,h=0;h<b.length;h++)e=m*b[h].x+n*b[h].y,(void 0==i||i>e)&&(i=e),(void 0==j||e>j)&&(j=e);if(i>d||c>j)return!1}}return!0},Math.getElementPolygon=function(a,b,c,d,e){var f=[],g=[];for(g.push({x:a-c/2,y:b-d/2}),g.push({x:a+c/2,y:b-d/2}),g.push({x:a+c/2,y:b+d/2}),g.push({x:a-c/2,y:b+d/2}),c=0;c<g.length;c++)d=Math.getRotatedPoint(g[c].x,g[c].y,e,a,b),f.push(d);return f},Math.rectIntersection=function(a,b,c,d){var e=(b.y-a.y)/(b.x-a.x);return d=(d.y-c.y)/(d.x-c.x),px=(e*a.x-d*c.x+c.y-a.y)/(e-d),py=(b.y-a.y)/(b.x-a.x)*(px-a.x)+a.y,{x:px,y:py}},Math.getPosFromTranslatedPoly=function(a,b,c){var d=a[c].x-b.x;return b=a[c].y-b.y,a=Math.rectIntersection({x:a[0].x,y:a[0].y},{x:a[2].x,y:a[2].y},{x:a[1].x,y:a[1].y},{x:a[3].x,y:a[3].y}),c={},c.x=a.x-d,c.y=a.y-b,c},Math.snapAngle=function(a,b){var c,d=[0,45,90,135,180,225,270,315,360],e=!1;for(i=0;i<d.length;i++)e||(Math.sqrt(Math.pow(a-d[i],2))<b?(e=!0,c=d[i]):c=a);return c},Math.angleBetweenPoints=function(a,b,c,d){return 180*Math.atan2(b-d,a-c)/Math.PI},Math.angleTo360=function(a){for(;-360>a;)a+=360;for(a+=360;a>360;)a-=360;return a},Math.sortedRectangle=function(a,b,c,d){var e;return c>a?(c-=a,e=a):(e=c,c=a-c),d>b?(d-=b,a=b):(a=d,d=b-d),{x1:e,y1:a,x2:c,y2:d}},Math.sumRect=function(a,b){return{x:Math.min(a.x,b.x),y:Math.min(a.y,b.y),width:Math.max(a.x,b.x+b.width),height:Math.max(a.y,b.y+b.height)}},Math.getWrappedPath=function(a,b,c,d,e,f){for(var g=0;g<a.length;g++)for(var h=1;h<a[g].length-1;h+=2){var i=h+1,j=Math.floor(parseFloat(a[g][h]-c.x)/b.width*d),k=Math.ceil(parseFloat(a[g][i]-c.y)/b.height*d),j=Math.getWrappedPoint(j,k,e,f,b.height,b.width,d);a[g][h]=j.x+0,a[g][i]=j.y+0}return a},Math.getWrappedPoint=function(a,b,c,d,e,f,g){var h={x:0,y:0};switch(h.x=f/(g-1)*a,c){case 1:h.x=f/(g-1)*a,h.y=d>=0?e/g*b*(g-d/10*a)/g+a/g*(e/2)*(d/10):e/g*b*(g-(g-a)*(Math.abs(d)/10))/g+(g-a)/g*(e/2)*(Math.abs(d)/10);break;case 2:h.x=f/(g-1)*a,h.y=-(e/2)+e/g*b,d>=0?(h.y+=e/5*Math.pow((-1+g-2*a)/g,2)*d*(b/g),h.y-=b/g*(e/40)*d):(h.y-=e/5*Math.pow((-1+g-2*a)/g,2)*Math.abs(d)*((g-b)/g),h.y-=(g-b)/g*(e/40)*d),h.y+=e/2;break;case 3:h.x=f/(g-1)*a,h.y=e/(g-1)*b,h.y=d>=0?h.y+e/5*Math.pow((-1+g-2*a)/g,2)*d:h.y-e/5*Math.pow((-1+g-2*a)/g,2)*Math.abs(d);break;case 4:h.x=f/(g-1)*a,h.y=-(e/2)+e/g*b,h.y=d>=0?g/2>a?h.y*Math.sqrt(1-(g/2-4*a)/(g/2)*(d/10)):h.y*Math.sqrt(Math.max(0,1-(g/2-4*(g-1-a))/(g/2)*(d/10))):g/2>a?h.y*Math.pow(-1+(g/2-2*a)/(g/2)*(d/10),2):h.y*Math.pow(-1+(g/2-2*(g-1-a))/(g/2)*(d/10),2);break;case 5:h.y=e/g*b,d>=0?(h.x=-(f/2)+f/g*a,h.x*=(1+(g-2*b)/g*(d/10))/2):(h.x=-(f/2)+f/g*a,h.x*=(1+(2*b-g)/g*(Math.abs(d)/10))/2),h.x+=f/2;break;case 6:h.x=f/(g-1)*a,h.y=d>=0?e/g*b*((g-d/10*a)/g)+a/g*(d/10)*e:e/g*b*(g-(g-a)*(Math.abs(d)/10))/g+(g-a)/g*e*(Math.abs(d)/10);break;case 7:h.x=f/(g-1)*a,h.y=d>=0?e/g*b*(g-d/10*a)/g:e/g*b*(g-(g-a)*(Math.abs(d)/10))/g;break;case 8:h.x=f/(g-1)*a,h.y=e/(g-1)*b,h.y=d>=0?h.y+e/15*Math.pow((-1+g-2*a)/g,3)*d:h.y-e/15*Math.pow((-1+g-2*a)/g,3)*Math.abs(d)}return h},Math.getPathOffSet=function(a){for(var b=1e4,c=1e4,d={x:0,y:0},e=0;e<a.length;e++)for(var f=1;f<a[e].length-1;f+=2){var g=f+1,h=parseInt(parseFloat(a[e][f])),g=parseInt(parseFloat(a[e][g]));b>h&&(b=h),c>g&&(c=g)}return d.x=b,d.y=c,d},Math.getRadious=function(a,b,c){var d=a=a/2-b/2,e=a*(2*Math.abs(c)*Math.PI/360);return 2*(d+b/2)>e&&(a=2*(d+b/2)/(2*Math.abs(c)*Math.PI/360),e=2*c*Math.PI/360*a),e>2*(d+b/2)&&(a=2*(d+b/2)/(2*Math.abs(c)*Math.PI/360)),a},Math.getArc=function(a,b,c,d,e,f){var g=b+d*Math.cos(-e*Math.PI/180),h=c-d*Math.sin(-e*Math.PI/180);b+=d*Math.cos(-f*Math.PI/180),c-=d*Math.sin(-f*Math.PI/180);var i=0;return e>f?i=1:180>e&&180>f?i=0:e>180&&f>180?i=0:180>e&&f>180?i=0:e>180&&180>f&&(i=1),a.path([["M",g,h],["A",d,d,0,i,1,b,c]])},Math.arc=function(a,b,c,d){for(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),angle=c,coords=Math.toCoords(a,b,angle),path="M "+coords[0]+" "+coords[1];angle<=d;)coords=Math.toCoords(a,b,angle),path+=" L "+coords[0]+" "+coords[1],angle+=1;return path},Math.toCoords=function(a,b,c){var d=c/180*Math.PI;return c=a[0]+Math.cos(d)*b,a=a[1]+Math.sin(d)*b,[c,a]},Math.colorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),6>a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},Math.decimalToHex=function(a){return a=a.toString(16),1==a.length&&(a="0"+a),a},Math.hexToDecimal=function(a){return parseInt(a,16)},Math.returnOpposite=function(a){var b=Math.decimalToHex(255-Math.hexToDecimal(a.substr(0,2))),c=Math.decimalToHex(255-Math.hexToDecimal(a.substr(2,2)));return a=Math.decimalToHex(255-Math.hexToDecimal(a.substr(4,2))),b==a&&b==c&&(c=b="00",a="FF"),b+c+a},Math.checkSnapToRegion=function(a,b,c,d,e,f,g){c={x:a.x,y:a.y},d=[],e={x:b.x+b.width/2,y:b.y+b.height/2,dist:Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},d.push(e);var h=e=!1,j=[0,0];for(i=0;i<d.length;i++)(0==e||0==h)&&(Math.sqrt(Math.pow(a.x-d[i].x,2))<g*f||Math.sqrt(Math.pow(a.y-d[i].y,2))<g*f)&&(!e&&Math.sqrt(Math.pow(a.x-d[i].x,2))<g*f&&(e=!0,c.x=d[i].x,j[0]={x1:d[i].x,x2:d[i].x,y1:0,y2:b.height,dist:d[i].dist,element:d[i]}),!h&&Math.sqrt(Math.pow(a.y-d[i].y,2))<g*f&&(h=!0,c.y=d[i].y,j[1]={x1:0,x2:b.width,y1:d[i].y,y2:d[i].y,dist:d[i].dist,element:d[i]}));return c.lines=j,c},Math.checkSnapToMidPoint=function(a,b,c,d,e,f,g){for(c={x:a.x,y:a.y},d=[],e=0;e<b.elements.length;e++)if(!b.isSelected(b.elements[e])){var h={x:b.elements[e].x,y:b.elements[e].y,dist:Math.sqrt(Math.pow(a.x-b.elements[e].x,2)+Math.pow(a.y-b.elements[e].y,2)),element:b.elements[e]};d.push(h)}d.sort(Math.elementDistance);var i=h=!1,j=[0,0];for(e=0;e<d.length;e++)(0==h||0==i)&&(Math.sqrt(Math.pow(a.x-d[e].x,2))<g*f||Math.sqrt(Math.pow(a.y-d[e].y,2))<g*f)&&(!h&&Math.sqrt(Math.pow(a.x-d[e].x,2))<g*f&&(h=!0,c.x=d[e].x,j[0]={x1:d[e].x,x2:d[e].x,y1:a.y,
y2:d[e].y,dist:d[e].dist,element:d[e].element}),!i&&Math.sqrt(Math.pow(a.y-d[e].y,2))<b.snapMidPointTolerance*b.zoomScale&&(i=!0,c.y=d[e].y,j[1]={x1:a.x,x2:d[e].x,y1:d[e].y,y2:d[e].y,dist:d[e].dist,element:d[e].element}));return c.lines=j,c},Math.checkSnapToObject=function(a,b,c,d,e,f,g){for(var h={x:a.x,y:a.y},i=[],j=0;j<b.elements.length;j++)if(!b.isSelected(b.elements[j])){for(var k=Math.getElementPolygon(b.elements[j].x,b.elements[j].y,b.elements[j].width,b.elements[j].height,b.elements[j].rotation),l=0;l<k.length;l++){var m={x:k[l].x,y:k[l].y,dist:Math.sqrt(Math.pow(a.x-k[l].x,2)+Math.pow(a.y-k[l].y,2)),element:b.elements[j]};i.push(m)}Math.sqrt(Math.pow(a.x-b.elements[j].x,2)+Math.pow(a.y-b.elements[j].y,2))}for(a=Math.getElementPolygon(a.x,a.y,c,d,e),a.push(h),i.sort(Math.elementDistance),d=c=!1,e=[0,0],l=0;l<a.length;l++)for(j=0;j<i.length;j++)(0==c||0==d)&&(Math.sqrt(Math.pow(a[l].x-i[j].x,2))<g*f||Math.sqrt(Math.pow(a[l].y-i[j].y,2))<g*f)&&(!c&&Math.sqrt(Math.pow(a[l].x-i[j].x,2))<g*f&&(c=!0,h.x=Math.getPosFromTranslatedPoly(a,i[j],l).x,e[0]={x1:i[j].x,x2:i[j].x,y1:b.region.height,y2:0,dist:i[j].dist,element:i[j].element}),!d&&Math.sqrt(Math.pow(a[l].y-i[j].y,2))<b.snapMidPointTolerance*b.zoomScale&&(d=!0,h.y=Math.getPosFromTranslatedPoly(a,i[j],l).y,e[1]={x1:0,x2:b.region.width,y1:i[j].y,y2:i[j].y,dist:i[j].dist,element:i[j].element}));return h.lines=e,h},Math.elementDistance=function(a,b){return a.dist<b.dist?-1:a.dist>b.dist?1:0},Namespace("ui.text"),ui.text.TextMetrics=function(a,b,c,d,e){var f=[];this.init=function(){for(var g=0;g<b.length;g++){var h=a.print(0,0,b.slice(0,g+1),c,d,"middle",e),i=h.getBBox(!0);h.remove();var h=a.print(0,0,b.slice(g,g+1),c,d,"middle",e),j=h.getBBox(!0);h.remove(),i.x=i.x+i.width-j.width,i.width=j.width,i.y=j.y,i.height=j.height,f.push(i)}for(h=f[0].x,g=0;g<f.length;g++)f[g].x-=h},this.getMetrics=function(){return f},this.init()},ui.text.EmbroideryTextElement=function(a,b,c,d,e,f,g,h,i,j,k){},ui.text.TextElement=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(a){for(var b="",c=0;c<a.length;c++)127!=a.charCodeAt(c)&&(b+=a.charAt(c));return b}function v(a){if(D&&!z.sleep){z.prototype.baseSetPositionAndSize(z.x,z.y,z.width,z.height,z.rotation,z.flipH,z.flipV,D,F,E,a),a=z.width/F.width;var b=z.height/F.height,c=z.width/(F.width-2*L),d=z.height/(F.height-2*L);H?(H.sx=a,H.sy=b,A.length>=B.length?(H.w=z.width,H.h=z.height):(H.ox=a,H.oy=b)):H={sx:a,sy:b,w:z.width,h:z.height,x:z.x,y:e,yo:0},O=a,P=b,ba=c/d,E.attr({fill:"none",stroke:M,"stroke-width":w(),"stroke-linecap":"round","stroke-linejoin":"round"}),0==L&&(E.attr({fill:"none",stroke:"none","stroke-width":2*L}),D.attr({fill:K,"stroke-width":0,stroke:"none"})),z.prototype.reportInitiated()}}function w(){return 0==L?0:L/N*Math.max(Math.abs(O),Math.abs(P))*1.4}function x(){H=G=null,B=A,clearInterval(J)}function y(){clearInterval(J),D.remove(),E.remove(),z.init(),ezd.activeSide.boundingBox.getSelections()==z&&ezd.activeSide.boundingBox.selectElement(z),v()}var z=this,A=u(c),B=u(c),C=s.font_family?s.font_family:s.font;parseInt(s.font_id,10),parseInt(s.font_style_id,10);var D,E,F,G,H,I,J,K=j,L=k,M=l,N=1,O=1,P=1,Q=m,R=n,S=i/50,T=o,U="arcup",V=!1,W=g/t,X={},Y=0,Z=t,$=1,_=0,aa=1<c.split("\n").length?!0:!1,ba=1,ca=s,da=!1,ea=!1,U=0>T?"arcdown":"arcup";this.props="letterSpacing wrapAmmount arching wrap stroke fontFamily rotation fontSize color strokeColor flipH flipV x y width height".split(" "),this.historyProps="data id type text wrapAmmount arching wrap stroke fontFamily rotation fontSize color strokeColor flipH flipV x y width height z".split(" "),this.getNode=function(){return I},this.forceUpdate=function(a){z.sleep=!1,v(a)},this.remove=function(){E.remove(),D.remove()},this.setShadow=function(a,b,c){"undefined"!=typeof this.shadow&&this.shadow.remove(),this.shadow=this.element.glow({color:b,offsety:a,offsetx:a,fill:c})},this.removeShadow=function(){"undefined"!=typeof this.shadow&&this.shadow.remove()},this.init=function(){var a=!0,c=b.print(z.x,z.y,B||"Test",C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"square","text-anchor":"end"});g=c.getBBox(!1),c.remove(),(0==g.width||0==g.height)&&(a=!1),a||(C="Microsoft YaHei"),a=!1,""==A&&(a=!0,A=B),(aa=1<A.split("\n").length?!0:!1)||(Z=1),!aa&&$>1&&(c=b.print(0,0,"W",C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"round","stroke-linejoin":"round"}),c.getBBox(!0),c.remove(),z.height=W*Z*z.prototype.scaleY),z.sleep=!0,I=b.set(),c=b.print(z.x,z.y,A,C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"square","text-anchor":"end"}),c.scale(1,1),F=c.getBBox(!1),G||(G=F),g=Raphael.transformPath(c.attr("path"),"S1,1");var d;state;if(0!=R&&0!=Q&&0==T&&0==aa)d=Math.getPathOffSet(g),g=Math.getWrappedPath(g,F,d,1e5,Q,R);else if(0!=T&&0==aa){var e=T,f=F,g=1,h=!1;0>e&&(h=!0,g=-1),e=Math.abs(e),d="";var i=A,j=A;A.length<B.length&&0==V&&(f=G,j=B);var j=b.print(0,0,j,C,20,"middle",S),k=j.getBBox(!0),l=b.print(0,0,i,C,20,"middle",S),m=l.getBBox(!0),f=Math.getRadious(f.width,f.height,e),e=b.path(Math.arc([k.width/2,k.y2+f],f,-90-e/2,e-90-e/2)).attr({stroke:"#0000ff"}),n=e.getTotalLength();for(X[i+C+"SP"+S]?f=X[i+C+"SP"+S]:(f=new ui.text.TextMetrics(b,i,C,20,S).getMetrics(),X[i+C+"SP"+S]=f),j.remove(),l.remove(),j=Math.abs(k.width-m.width)/2,k=n/(k.width-k.x),l=0;l<i.length;l++)if(" "!=A[l]){var o=f[l].y,n=f[l].width,p=f[l].height,q=(j+f[l].x+n/2)/k,m=b.print(0,0,i[l],C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"round","stroke-linejoin":"round"}),p=b.rect(0,0,n,p),r=e.getPointAtLength(q).x,s=e.getPointAtLength(q).y*g;p.transform("T"+(r-n/2)+","+(o+s)),r=p.getBBox(!1),s=m.getBBox(!0),o=r.x-s.x,r=r.y-s.y,s=e.getPointAtLength(q),q=e.getPointAtLength(q+1),q=180*Math.atan2(q.y-s.y,q.x-s.x)/Math.PI,h&&(q=360-q),m.transform("r"+q+","+n/2+",0"),m.transform("t"+o+","+r+"..."),n=Raphael.transformPath(m.attr("path"),m.transform()),d+=n,m.remove(),p.remove()}e.remove(),H&&(h=b.path(d),e=h.getBBox(!0),i=e.width*H.sx,e=e.height*H.sy,H.yo=-(H.h/2)+e/2,f=z.height,z.prototype.setSize(i,e),A.length<B.length&&0==V||1==V||z.prototype.setSize(H.w,e/(i/H.w)),z.prototype.setPosition(z.x,z.y+(f-z.height)/2*g),h.remove()),g=d}else if(aa){for(ea=!0,g=A.split("\n"),d="",h=b.print(0,0,"W",C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"round","stroke-linejoin":"round"}),f=h.getBBox(!0),i=f.height,h.remove(),$=Z,Z=g.length,e=0;e<g.length;e++)h=b.print(0,e*(i+(_+2)/2),g[e],C,20,"middle",S).attr({fill:K,stroke:M,"stroke-width":L,"stroke-linecap":"round","stroke-linejoin":"round"}),f=h.getBBox(!0),j=0,0==Y?j=0:1==Y?j=(z.width-f.width)/2:2==Y&&(j=z.width-f.width),h.transform("t"+j+",0r0..."),f=Raphael.transformPath(h.attr("path"),h.transform()),d+=f,h.remove(),$!=Z&&(Z>$?V&&(z.y+=i/2):V&&(z.y-=i/2),$=Z);g=d,z.prototype.setSize(z.width,W*z.prototype.scaleY*Z)}c.remove(),E=b.path(g),E.attr({fill:"none",stroke:M,"stroke-width":w(),"stroke-linecap":"round","stroke-linejoin":"round"}),D=b.path(g),D.attr({fill:K,"stroke-width":0}),0==L&&(E.attr({fill:"none",stroke:"none","stroke-width":2*L}),D.attr({fill:K,"stroke-width":0,stroke:"none"})),0>T&&(U="arcdown"),I.push(E),I.push(D),F=D.getBBox(!0),0==T&&(F.width+=2*L,F.height+=2*L,F.x-=L,F.y-=L),z.forceUpdate(),eventManager.trigger("checkBoundaries"),a&&(A="")},this.basicPropertyUpdated=function(a){v(a)},z.prototype=new ui.element.BaseElement(z,d,e,p,f,g,h,q,r,!0,a,"text"),z.init(),this.strokeForSvg=function(){E.attr({fill:"none",stroke:M,"stroke-width":2*L,"stroke-linecap":"round","stroke-linejoin":"round"})},this.getFinalStrokeScaleSave=function(){return L},this.getStrokeScaleX=function(){return L/N*Math.max(O,O)*2},this.getStrokeScaleY=function(){return L/N*Math.max(P,P)*2},Object.defineProperty(this,"text",{set:function(a){A=a},get:function(){return A}});var fa=this;this.loadFont=function(a,b){console.log("实时更新文字");var c=fa.text;service.loadFont(b,function(){A=u(c),z.data.value=A,(aa=1<A.split("\n").length?!0:!1)&&(R=Q=T=0),"none"==K?(D.remove(),E.remove(),z.init(),ezd.activeSide.boundingBox.selectElement(z)):(y(),clearInterval(J),J=setInterval(function(){},0)),z.prototype.reportChange(),da=!0},c,null,a)},Object.defineProperty(this,"fontObject",{set:function(a){ca=clone(a)},get:function(){return ca}}),Object.defineProperty(this,"color",{set:function(a){var b=K;K=a,D.attr({fill:a,stroke:"none","stroke-width":0}),"None"===b?(D.remove(),E.remove(),z.init()):z.prototype.reportChange()},get:function(){return K}}),Object.defineProperty(this,"strokeColor",{set:function(a){M=a,E.attr({fill:"none",stroke:M,"stroke-width":w(),"stroke-linecap":"round","stroke-linejoin":"round"}),0==L&&E.attr({fill:"none",stroke:"none","stroke-width":2*L}),z.prototype.reportChange()},get:function(){return M}}),Object.defineProperty(this,"stroke",{set:function(a){L=a,a=z.width;var b=z.height;D.remove(),E.remove(),z.init(),aa&&(z.width=a,z.height=b),z.prototype.reportChange()},get:function(){return L}}),Object.defineProperty(this,"strokeScale",{set:function(a){N=a,E.attr({fill:"none",stroke:M,"stroke-width":w(),"stroke-linecap":"round","stroke-linejoin":"round"})},get:function(){return N}}),Object.defineProperty(this,"wrap",{set:function(a){T=0,Q=a,D.remove(),E.remove(),z.init(),z.prototype.reportChange()},get:function(){return Q}}),Object.defineProperty(this,"letterSpacing",{set:function(a){S=a,x(),y(),J=setInterval(function(){},0),z.prototype.reportChange()},get:function(){return S}}),Object.defineProperty(this,"wrapAmmount",{set:function(a){R=a,D.remove(),E.remove(),z.init(),z.prototype.reportChange()},get:function(){return R}}),Object.defineProperty(this,"arching",{set:function(a){T=a,clearInterval(J),y(),J=setInterval(function(){},0),z.prototype.reportChange()},get:function(){return T}}),Object.defineProperty(this,"fontFamily",{set:function(a){C=a,ca.font_family=a,x(),D.remove(),E.remove(),z.init(),z.prototype.reportChange()},get:function(){return C}}),Object.defineProperty(this,"fontId",{set:function(a){ca.font_id=a},get:function(){return ca.font_id}}),Object.defineProperty(this,"fontStyleId",{set:function(a){ca.font_style_id=a},get:function(){return ca.font_style_id}}),Object.defineProperty(this,"element",{get:function(){return D}}),Object.defineProperty(this,"shape",{get:function(){return U}}),Object.defineProperty(this,"isNew",{get:function(){return V},set:function(a){V=a}}),Object.defineProperty(this,"oText",{get:function(){return B}}),Object.defineProperty(this,"dText",{get:function(){return""}}),Object.defineProperty(this,"multiline",{get:function(){return aa},set:function(a){aa=a}}),Object.defineProperty(this,"alignment",{get:function(){return Y},set:function(a){Y=a,x(),a=z.width;var b=z.height;clearInterval(J),D.remove(),E.remove(),z.init(),z.prototype.setSize(a,b),z.prototype.reportChange()}}),Object.defineProperty(this,"lineHeight",{get:function(){return _},set:function(a){_=a,x(),y(),z.prototype.reportChange()}}),Object.defineProperty(this,"lines",{get:function(){return Z},set:function(a){Z=a}})},Namespace("ui.element"),ui.element.BaseElement=function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p,q,r=this,s=b,t=c,u=d,v=g,w=e,x=f,y=h,z=i,A=j,B=l,C=!1,D=!1;this.scaleY=this.scaleX=1,this.reportChange=function(){console.log("SVG－设计内容发生变化 ",A,D),D&&!A&&(D=!1,setTimeout(function(){console.debug("***更行了对象***"),state.isChangedDesign=!0,eventManager.trigger("elementEdited",a),eventManager.trigger("updatePricePreview"),D=!0},100))},this.reportInitiated=function(){C||(setTimeout(function(){console.debug("***初始化了对象***"),state.isInitialDesign=!0,eventManager.trigger("elementRendered",a),eventManager.trigger("updatePricePreview"),eventManager.trigger("updateStep2View"),D=!0},10),C=!0)},this.setSize=function(a,b){w=a,x=b},this.setPosition=function(a,b){s=a,t=b},this.baseSetPositionAndSize=function(a,b,c,d,e,f,g,h,i,j,k){"move"==k?(c=a-m,d=b-n,m=s,n=t,h.transform("t"+c+","+d+"..."),j&&j.transform("t"+c+","+d+"...")):(f&&(c=-Math.abs(c)),g&&(d=-Math.abs(d)),h.transform("R0"),j&&j.transform("R0"),f=c/i.width,g=d/i.height,c=a-i.x*f-c/2,d=b-i.y*g-d/2,m=s,n=t,h.transform("r"+e+","+a+","+b+"t"+c+","+d+"...s"+f+","+g+",0,0"),j&&j.transform("r"+e+","+a+","+b+"t"+c+","+d+"...s"+f+","+g+",0,0"))},this.updateDataUrl=function(){getImageData(a.url,!0,function(a){q=a.dataUrl})},Object.defineProperty(a,"dataUrl",{get:function(){return q},set:function(a){q=a}}),Object.defineProperty(a,"x",{set:function(b){s=b,a.basicPropertyUpdated("move"),r.reportChange()},get:function(){return s}}),Object.defineProperty(a,"y",{set:function(b){t=b,a.basicPropertyUpdated("move"),r.reportChange()},get:function(){return t}}),Object.defineProperty(a,"z",{set:function(a){u=a,r.reportChange()},get:function(){return u}}),Object.defineProperty(a,"width",{set:function(b){w=b,a.basicPropertyUpdated(),r.reportChange()},get:function(){return w}}),Object.defineProperty(a,"height",{set:function(b){x=b,a.basicPropertyUpdated(),r.reportChange()},get:function(){return x}}),Object.defineProperty(a,"rotation",{set:function(b){v=b,a.basicPropertyUpdated(),r.reportChange()},get:function(){return v}}),Object.defineProperty(a,"flipH",{set:function(b){y=b,a.basicPropertyUpdated(),r.reportChange()},get:function(){return y}}),Object.defineProperty(a,"flipV",{set:function(b){z=b,a.basicPropertyUpdated(),r.reportChange()},get:function(){return z}}),Object.defineProperty(a,"sleep",{set:function(a){A=a},get:function(){return A}}),Object.defineProperty(a,"data",{set:function(a){},get:function(){if(k.height=x,k.width=w,k.x=s,k.y=t,k.rotation=v,k.rotate=v,k.fliph=y,k.flipV=z,k.z=u,k.id=p,k.table_name=o,k.type=B,a.constructor===ui.text.TextElement&&(k.shape=0>a.arching?"arcdown":"arcup",k.sweep=String(Math.abs(parseInt(a.arching,10))),0!=Math.abs(parseInt(a.arching,10))&&(k.wrap_mode=a.wrap,k.wrap_amount=a.wrapAmmount),k.fontObject=a.fontObject,k.fill_color=a.color,k.stroke_color=a.strokeColor,k.stroke_width=a.stroke,k.letterSpacing=50*a.letterSpacing,k.kerning=50*a.letterSpacing,k.alignment=a.alignment,k.line_height=a.lineHeight,k.lines=a.lines,k.isNew=a.isNew),a.constructor===ui.svg.SvgElement&&(k.colors=clone(a.colors)),a.constructor===ui.bitmap.BitmapElement){a.colors&&(k.colors=clone(a.colors));var b=a.url;k.art_path=b,k.original_art_path=b,k.image={src:b,url:b}}return a.constructor===ui.text.EmbroideryTextElement&&(k.slant=a.slant,k.sequence=a.sequence,k.shape=a.shape,k.circle_radius=a.circle_radius,k.bottom_curve_type=a.bottom_curve_type,k.top_curve_type=a.top_curve_type,k.bottom_curve=a.bottom_curve,k.top_curve=a.top_curve,k.word_spacing=a.word_spacing,k.line_spacing=a.line_spacing,k.letter_spacing=a.letter_spacing,k.alignment=a.alignment,k.font=a.font,k.fontSize=a.fontSize,k.color1=a.color1,k.value=a.value,k.fontObject={font:a.font},k.art_id=k.canvas_text_id),a.constructor===ui.bitmap.EmbroideryArtElement&&(k.colors=clone(a.colors)),k}}),Object.defineProperty(a,"type",{get:function(){return B},set:function(a){B=a}}),Object.defineProperty(a,"id",{get:function(){return p},set:function(a){p=a}}),Object.defineProperty(a,"tableName",{get:function(){var a="";return"text"==B&&(a="canvas_text"),("vector"==B||"image"==B)&&(a="canvas_art"),a},set:function(a){o=a}}),Object.defineProperty(a,"canReportEdition",{get:function(){return D},set:function(a){D=a}})},Namespace("ui.svg"),ui.svg.SvgElement=function(a,b,c){function d(){if(q){for(var a="",b=q.textContent.split("}"),c=0;c<b.length;c++){var d=b[c].trim()+"}",d=d.replace("{}","{fill:#000000}"),e=d.match(/\.(fil|st)(\d+){(fill|stroke):([^;]+);*}/);if(e&&!(5>e.length)){for(var f=e[4],d=e[3],g=e[1],h=g+e[2],e=parseInt(e[2],10),i=h+"_"+k,j=o.getElementsByClassName(h),l=[],m=0;m<j.length;m++)l.push(j[m]);for(m=0;m<l.length;m++)l[m].setAttribute("class",l[m].getAttribute("class").replace(h,i));a+="."+i+"{"+d+":"+f+"}",h=x[e],h||(h=i,i=f.substring(f.lastIndexOf("(")+1,f.lastIndexOf(")")),i.length&&(i=i.split(","),f=rgbToHex(1*i[0],1*i[1],1*i[2])),h={style:h,color:f,is_stroke:"stroke"==d,is_fill:"fill"==d}),h.prefix=g,"stroke"===d?h.prefixStroke=g:h.prefixFill=g,h.is_stroke=h.is_stroke||"stroke"==d,h.is_fill=h.is_fill||"fill"==d,x[e]=h}}q.textContent=a,eventManager.trigger("designColorsChanged")}}function e(a){console.debug(a)}function f(){p.appendChild(q),p.appendChild(o);for(var a in w)"undefined"!=typeof j[a]&&(j[a]=w[a]);setTimeout(function(){console.debug("***element完成初始化***"),state.isInitialDesign=!0,eventManager.trigger("elementRendered",j)},10)}function g(){o.removeAttribute("transform"),o.parentNode.removeAttribute("transform"),y.removeAttribute("viewBox");var a=o.getBBox(),a={x:a.x,y:a.y,width:a.width,height:a.height,x:0,y:0},b=v,c=z/a.width,d=A/a.height;I&&(c*=-1),J&&(d*=-1),o.setAttribute("transform"," rotate("+E+" "+B+" "+C+") scale("+c+" "+d+") translate("+((a.x+B-.5*z)/c-(I?a.width:0)-b.x)+","+((a.y+C-.5*A)/d-(J?a.height:0)-b.y)+") "),y.setAttribute("viewBox",b.x+" "+b.y+" "+t+" "+u),j.prototype.reportChange(),a=o.getBBox(),a={x:a.x,y:a.y,width:a.width,height:a.height},c=o.ownerSVGElement,b=o.getTransformToElement(o.parentNode),c=[c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint()],c[0].x=a.x,c[0].y=a.y,c[1].x=a.x+a.width,c[1].y=a.y,c[2].x=a.x+a.width,c[2].y=a.y+a.height,c[3].x=a.x,c[3].y=a.y+a.height;for(var d=1/0,e=-(1/0),f=1/0,g=-(1/0),h=0;h<c.length;h++)if(b)var i=c[h].matrixTransform(b),d=Math.min(d,i.x),e=Math.max(e,i.x),f=Math.min(f,i.y),g=Math.max(g,i.y);try{a.x=d,a.y=f,a.width=e-d,a.height=g-f}catch(k){}s=a}function h(){for(var a=[],b=0;b<x.length;b++)x[b]&&a.push(x[b].color);return a}function i(){o=document.createElementNS("http://www.w3.org/2000/svg","g");var a=n.getElementsByTagName("svg")[0],b=a;try{b=p.ownerDocument.importNode(a,!0)}catch(c){}null==p&&(p=$("#designGroup1")[0]),p.appendChild(b),v=b.getBBox(),p.removeChild(b),y=document.createElementNS("http://www.w3.org/2000/svg","g"),y.setAttribute("width",t),y.setAttribute("height",u);for(var d=0;d<a.childNodes.length;d++)b=a.childNodes[d],b.tagName&&"style"!==b.tagName&&(b=o.ownerDocument.importNode(b,!0),y.appendChild(b));if(o.appendChild(y),!o.getElementsByClassName){var e=function(a,b){for(var c=[],d=0;d<a.childNodes.length;d++){var f=a.childNodes[d];if(f.tagName){var g=a.childNodes[d].getAttribute("class");g&&0<=g.indexOf(b)&&c.push(a.childNodes[d]),c=c.concat(e(f,b))}}return c};o.getElementsByClassName=function(a){return e(o,a)}}}var j=this,k=c.id;c.flipH=parseInt(c.fliph,10),c.flipV=parseInt(c.flipv,10),c.svg=a.implementation.createDocument(a.namespaceURI,null,null);var l=c.svg.importNode(a.documentElement,!0);c.svg.appendChild(l);var m=[{event:"click",fnc:e},{event:"mousedown",fnc:e},{event:"mouseup",fnc:e},{event:"mousemove",fnc:e}],n=a.cloneNode(!0);n||(n=$.parseXML((new XMLSerializer).serializeToString(a)));var o,p=b;b=a.getElementsByTagName("style"),0===b.length?(b=document.createElement("style"),b.setAttribute("type","text/css"),b.textContent=".fil0{fill:#000000;}",b=a.importNode(b,!0),a.documentElement.appendChild(b),b=a.getElementsByTagName("style"),l=function(a){a=n.getElementsByTagName(a);for(var b=0;b<a.length;b++){var c=a[b];c.getAttribute("class")||c.getAttribute("fill")||c.setAttribute("class","fil0")}},l("path"),l("polygon")):"g"===n.getElementsByTagName("style")[0].parentNode.tagName&&(l=n.getElementsByTagName("style")[0].parentNode.removeChild(n.getElementsByTagName("style")[0]),n.getElementsByTagName("svg")[0].appendChild(l));var q=b[0].cloneNode(!0);for(b=n.getElementsByTagName("g"),l=0;l<b.length;l++){var r=b[l];r.style.clipPath="",r.id=""}var s,t,u,v,w=c,x=[],y=null,z=t=parseInt(a.documentElement.getAttribute("width"),10)||500,A=u=parseInt(a.documentElement.getAttribute("height"),10)||500,B=parseInt(a.documentElement.getAttribute("x"),10)||0,C=parseInt(a.documentElement.getAttribute("y"),10)||0,D=c.z,E=0,F="front",G="location id x y width height rotation colors flipH flipV".split(" "),H="data id type x y width height rotation colors flipH flipV z".split(" "),I=!1,J=!1,K=!0,L=!1;Object.defineProperties(this,{id:{get:function(){return k}},colorsMapped:{get:function(){return h}},style:{get:function(){return q}},svg:{get:function(){return n}},historyProps:{get:function(){return H}},g:{get:function(){return o}},viewBoxGroup:{get:function(){return y}},originalBBox:{get:function(){return v}},bb:{get:function(){return s}},colors:{get:function(){return h()},set:function(a){if(a.length)for(var b=0;b<a.length;b++)j.setColor(b,getColorString(a[b])),console.debug("culo de mandril plus = ",a[b].value)}},width:{get:function(){return z},set:function(a){z=a,console.debug("WIDTH = ",a),g()}},height:{get:function(){return A},set:function(a){A=a,g()}},x:{get:function(){return B},set:function(a){B=a,g()}},y:{get:function(){return C},set:function(a){C=a,g()}},z:{get:function(){return D},set:function(a){D=a,g()}},rotation:{get:function(){return E},set:function(a){E=a,g()}},location:{get:function(){return F},set:function(a){F=a}},flipH:{get:function(){return I},set:function(a){a!=I&&(I=a,g())}},flipV:{get:function(){return J},set:function(a){a!=J&&(J=a,g())}},data:{get:function(){for(var a=clone(w),b=0;b<G.length;b++)a[G[b]]=j[G[b]];return a.object=j,a},set:function(a){}},canReportEdition:{get:function(){return K},set:function(a){K=a}},sleep:{get:function(){return L},set:function(a){L=a}}}),this.type="vector",this.setColor=function(a,b){if(x.length<=a||!x[a])return!1;x[a].color=b;for(var c="",d=0;d<x.length;d++)x[d]&&(x[d].is_fill&&(c+="."+x[d].prefixFill+d+"_"+k+"{fill:"+x[d].color+"}"),x[d].is_stroke&&(c+="."+x[d].prefixStroke+d+"_"+k+"{stroke:"+x[d].color+"}"));q.textContent=c,eventManager.trigger("designColorsChanged"),K&&eventManager.trigger("elementEdited",j)},this.remove=function(){for(var a=0;a<m.length;a++)o.removeEventListener(m[a].event,m[a].fnc);p.removeChild(o),p.removeChild(q),q=o=null},this.getNode=function(){return j.node||(j.node={g:o,toFront:function(){o.parentNode.appendChild(o)}}),j.node},this.forceUpdate=function(){},this.getStrokeScaleX=function(){},this.getStrokeScaleY=function(){},this.prototype={reportChange:function(){console.log("SVG内容发生了变化",L,K),K&&!L&&(K=!1,setTimeout(function(){state.isChangedDesign=!0,eventManager.trigger("elementEdited",j),console.debug("***Element 完成更新***"),K=!0},100))}},window.neverTrue&&(i(),d(),f()),i(),d(),f()},Namespace("ui.bitmap"),ui.bitmap.BitmapElement=function(b,c,d,e,f,g,h,i,j,k,l){function m(a){o&&!t.sleep&&(t.prototype.baseSetPositionAndSize(t.x,t.y,t.width,t.height,t.rotation,t.flipH,t.flipV,o,p,null,a),eventManager.trigger("rasterQualityChanged",this),t.prototype.reportInitiated())}function n(b){if("none"==b)return{r:255,g:255,b:255,a:0};var c={},c=parseInt(b.substring(0,2),16),d=parseInt(b.substring(2,4),16),e=parseInt(b.substring(4,6),16);return a=parseInt(b.substring(6,8),16),c={r:c,g:d,b:e,a:a}}var o,p,q,r,s,t=this,u=d,v=100;this.props="x y width height rotation flipH flipV url colors".split(" "),this.historyProps="data id type x y width height rotation flipH flipV z colors url".split(" "),this.getNode=function(){return o},this.forceUpdate=function(a){t.sleep=!1,m(a)},this.remove=function(){o.remove()},this.init=function(){t.sleep=!1,q=c.set(),o=c.image(u,t.x,t.y,t.width,t.height),o.node.setAttribute("id","DsElement"+b.id),o.attr("src"),q.push(o),p=o.getBBox(!0),t.forceUpdate();var a=new Image;a.src=o.attr("src"),s=new ui.resolution.ResolutionMeter(a.width,a.height)},t.prototype=new ui.element.BaseElement(t,e,f,j,g,h,i,k,l,!0,b,"image"),t.init(),this.basicPropertyUpdated=function(a){m(a)},this.replaceColor=function(a,b){var c=new Image;c.src=o.attr("src");var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var c=n(a).r,e=n(a).g,f=n(a).b,g=n(a).a,h=n(b).r,i=n(b).g,j=n(b).b,k=n(b).a,l=d.getContext("2d");l.globalCompositeOperation="source-out";var m=new Image;m.src=o.attr("src"),l.drawImage(m,0,0),m=l.getImageData(0,0,d.width,d.height),console.log(m);for(var p=0,q=m.data.length;q>p;p+=4){var r=m.data[p+3]==g;(m.data[p]==c&&m.data[p+1]==e&&m.data[p+2]==f&&r||r&&0===g)&&(m.data[p]=h,m.data[p+1]=i,m.data[p+2]=j,m.data[p+3]=k)}l.putImageData(m,0,0),u=d.toDataURL(),o.attr("src",u),t.data.art_id=0,t.data.artID=0},Object.defineProperty(this,"url",{set:function(a){u=a,t.remove(),t.init()},get:function(){return u=o.attr("src")}}),Object.defineProperty(this,"element",{get:function(){return o}}),Object.defineProperty(this,"quality",{get:function(){return s.getQuality(2*t.width,2*t.height)}}),Object.defineProperty(this,"colors",{set:function(a){if(console.debug("colors",a),0<a.length){r=[];for(var b=0;b<Math.min(a.length,v);b++)r[b]=a[b]}else{if(!r)return void(r=[]);if("undefined"!=typeof a.index){var b=r[a.index],b="none"==b?"none":b.split("#")[1]+"ff",c="none"==a.color?"none":a.color.split("#")[1]+"ff";for(t.replaceColor(b,c),r[a.index]=a.color,a=[],b=0;b<r.length;b++){for(var c=!0,d=0;d<a.length;d++)r[b]==a[d]&&(c=!1);c&&a.push(r[b])}r=clone(a)}}r&&t.prototype.reportChange()},get:function(){return r}}),Object.defineProperty(this,"maxColors",{set:function(a){v=a,r&&(r=r.slice(0,v))},get:function(){return v}})},ui.bitmap.EmbroideryArtElement=function(a,b,c,d,e,f,g,h,i,j,k){function l(a){m&&!q.sleep&&(q.prototype.baseSetPositionAndSize(q.x,q.y,q.width,q.height,q.rotation,q.flipH,q.flipV,m,n,null,a),q.prototype.reportInitiated())}var m,n,o,p,q=this,r=c;this.props="x y width height rotation flipH flipV url colors".split(" "),this.historyProps="data id type x y width height rotation flipH flipV z colors url".split(" "),this.getNode=function(){return m},this.forceUpdate=function(a){q.sleep=!1,l(a)},this.remove=function(){m.remove()},this.init=function(){q.sleep=!1,o=b.set(),m=b.image(r,q.x,q.y,q.width,q.height),m.node.setAttribute("id","DsElement"+a.id),m.attr("src"),o.push(m),n=m.getBBox(!0),q.forceUpdate(),q.prototype.updateDataUrl()},this.basicPropertyUpdated=function(a){l(a)},Object.defineProperty(this,"url",{set:function(a){r=a,q.remove(),q.init(),q.prototype.updateDataUrl()},get:function(){return r=m.attr("src")}}),Object.defineProperty(this,"element",{get:function(){return m}}),Object.defineProperty(this,"colors",{set:function(b){if(0<b.length){p=[];for(var c=0;c<b.length;c++)p[c]=b[c]}else{if(!p)return void(p=[]);"undefined"!=typeof b.index&&(c=p[b.index],"none"==c||c.split("#"),"none"==b.color||b.color.split("#"),p[b.index]=b.color,q.url=state.dsUtils.getEmbroideryUrl({art_id:a.art_id,colors:p},"embroideryArt"))}p&&q.prototype.reportChange()},get:function(){return p}}),q.prototype=new ui.element.BaseElement(q,d,e,i,f,g,h,j,k,!0,a,"embroideryArt"),q.init()},ui.bitmap.SimpleQuant=function(a){function b(a,b){var c,d,e,f,g,h;switch(Object.prototype.toString.call(a).slice(8,-1)){case"HTMLImageElement":c=document.createElement("canvas"),c.width=a.naturalWidth,c.height=a.naturalHeight,d=c.getContext("2d"),d.drawImage(a,0,0);case"HTMLCanvasElement":c=c||a,d=d||c.getContext("2d");case"CanvasRenderingContext2D":d=d||a,c=c||d.canvas,e=d.getImageData(0,0,c.width,c.height);case"ImageData":e=e||a,b=e.width,f="CanvasPixelArray"===Object.prototype.toString.call(e.data).slice(8,-1)?new Uint8Array(e.data):e.data;case"Array":f=f||new Uint8Array(a);case"Uint8Array":case"Uint8ClampedArray":f=f||a,g=new Uint32Array(f.buffer);case"Uint32Array":g=g||a,f=f||new Uint8Array(g.buffer),b=b||g.length,h=g.length/b}return{can:c,ctx:d,imgd:e,buf8:f,buf32:g,width:b,height:h}}var c=base.colorUtils.ciede2000;this.getPalette=function(d){c=base.colorUtils.ciede2000;var e=document.createElement("canvas");e.width=128,e.height=a.naturalHeight*e.width/a.naturalWidth,e.getContext("2d").drawImage(a,0,0,e.width,e.height);for(var e=b(e).buf32,f=e.length,g={colors:[]},h=0;f>h;h++){var i=e[h],i=[255&i,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24];if(0!==i[3]){if(0==i[0]&&0==i[1]);var i=base.colorUtils.rgbToLab(i),j=this.getNearest(g.colors,i),k=null;j.difference>d?(k={colors:[i]},this.getRepresentativeColor(k),g.colors.push(k)):(k=g.colors[j.index],k.colors.push(i),this.getRepresentativeColor(k))}}return g},this.getRepresentativeColor=function(a){var b=a.colors[a.colors.length-1];a.labInfo||(a.labInfo={},a.lab=b),a.labInfo[b]||(a.labInfo[b]=0),a.labInfo[b]++,a.labInfo[b]>a.labInfo[a.lab]&&(a.lab=b)},this.reducePaletteForced=function(a,b){b=b||50,a.colors.sort(function(a,b){return b.colors.length-a.colors.length});for(var c=0,d=a.colors.slice(0),e=0;e<d.length;e++)c+=d[e].colors.length;for(;d.length>b;){for(var f=[],e=0;e<d.length;e++){var g=d[e],h=g.colors.length/c;g=this.getNearest(d,g.lab,e),f[e]={index:e,closest:g,value:h*g.difference}}f.sort(function(a,b){return a.value-b.value}),e=f[0],this.mergePaletteColors(e.closest.value,d[e.index]),d.splice(e.index,1)}for(var i=[],j=0;j<a.colors.length;j++)d[j]&&d[j].colors.length/c>.012&&i.push(d[j]);return i},this.reducePaletteNatural=function(a,b,d){var e=0;a=a.colors.slice(0);for(var f=0;f<a.length;f++)e+=a[f].colors.length;f=e*b/100;do a.sort(function(a,b){return a.colors.length-b.colors.length}),a[0].colors.length<f&&(b=this.getNearest(a,a[0].lab,0),this.mergePaletteColors(b.value,a[0]),a.splice(0,1));while(a[0].colors.length<f);for(f=0;f<a.length;f++)for(b=f+1;b<a.length;b++)if(b!==f){var e=a[f],g=a[b];c(e.lab,g.lab)<d&&(this.mergePaletteColors(e,g),a.splice(b,1),b=f=0)}return a},this.mergePaletteColors=function(a,b){for(var c=0;c<b.colors.length;c++)a.colors.push(b.colors[c]),this.getRepresentativeColor(a)},this.reduceToPalette=function(c){var d=document.createElement("canvas");d.width=a.naturalWidth,d.height=a.naturalHeight;var e=d.width/10,f=d.height/10,g=d.getContext("2d");g.drawImage(a,0,0,e,f),g.imageSmoothingEnabled=g.mozImageSmoothingEnabled=g.webkitImageSmoothingEnabled=!1;for(var h=g.getImageData(0,0,e,f),i=b(d).buf32,j=new ArrayBuffer(h.data.length),k=new Uint8ClampedArray(j),j=new Uint32Array(j),l={},m=0;f>m;++m)for(var n=0;e>n;++n){var o=m*e+n,p=i[o];if(l[p])j[o]=l[p];else{var q=(4278190080&p)>>24,r=base.colorUtils.rgbToXyz([255&p,(65280&p)>>8,(16711680&p)>>16]),r=base.colorUtils.xyzToLab(r),r=this.getNearest(c,r).value.lab,r=base.colorUtils.labToXyz(r),r=base.colorUtils.xyzToRgb(r),q=q<<24|r[2]<<16|r[1]<<8|r[0];l[p]=q,j[o]=q}}return h.data.set(k),g.putImageData(h,0,0),d},this.getNearest=function(a,b,d){for(var e=1e5,f=-1,g=null,h=0;h<a.length;h++)if(h!==d){var i=c(a[h].lab,b);if(e>i&&(e=i,f=h,g=a[h]),0===i)break}return{difference:e,index:f,value:g}}},Namespace("container"),container.BoundingContainer=function(a,b,c){function d(){ezd.hm.enable=!1}function e(){eventManager.trigger("elementEdited",null),console.debug("***Multiple Elements was updated***"),ezd.hm.enable=!0}function f(a,b){if(ca){for(var c=Math.getElementPolygon(u.x,u.y,u.width,u.height,u.rotation),d=[],e=0;e<C.length;e++){var f=Math.getElementPolygon(C[e].x,C[e].y,C[e].width,C[e].height,C[e].rotation);if(Math.doPolygonsIntersect(f,c))if(f=C[e].getNode().items,a&&f)for(var g=0;g<f.length;g++)b.target===f[g].node&&d.push(C[e]);else d.push(C[e])}0<d.length?a?A.selectElement(d[d.length-1]):(A.selectElement(d),eventManager.trigger("elementsSelected",d)):(m.hide(),A.hideRegion(),n=null),u=null}}function g(){if(0!=C.length)for(var a=0;a<C.length;a++){for(var b=C[a].getNode(),c=0;c<b.length;c++)null==b[c].next&&(b[c].next=b[c+1]);try{C[a].getNode().toFront()}catch(d){}}}function h(a){A._popup=new PopupMenu,A._popup.setContainer(a),A._popup.add("删除 ",function(b){a.removeSelection()},"copy"),A._popup.add("复制 ",function(b){a.copyElement()},"copy"),A._popup.add("粘贴 ",function(b){a.pasteElement(),J=!1,v&&v.remove(),u&&f()},"paste"),A._popup.addSeparator(),A._popup.add("移到顶层",function(b){a.setChildIndex(a.getSelections(),a.getChildIndex(a.getSelections())+1)},"bringtofront"),A._popup.add("移到底层",function(b){a.setChildIndex(a.getSelections(),a.getChildIndex(a.getSelections())-1)},"sendtoback"),A._popup.addSeparator(),A._popup.add("上移一层",function(b){a.setChildIndex(a.getSelections(),a.elements.length-1)},"bringaboveobjects"),A._popup.add("下移一层",function(b){a.setChildIndex(a.getSelections(),0)},"sendunderobjects"),A._popup.addSeparator(),
A._popup.add("水平翻转",function(b){a.isMultiple()?a.flipHMultiple():(a.getSelections().flipH?a.getSelections().flipH=0:a.getSelections().flipH=1,a.reportEditionForLayers())},"fliphorizontal"),A._popup.add("垂直翻转",function(b){a.isMultiple()?a.flipVMultiple():(a.getSelections().flipV?a.getSelections().flipV=0:a.getSelections().flipV=1,a.reportEditionForLayers())},"flipvertical"),A._popup.addSeparator(),A._popup.add("对齐到中心",function(b){n&&(a.isMultiple()?a.snapToCenterMultiple():a.getSelections().x=x.x+x.width/2,A.selectElement(n))},"center"),A._popup.setSize(200,0),A._popup.bind(B)}function i(){if(y){for(var a=0;a<y.length;a++)y[a].remove();y.remove(),y.length=0,y=null}}function j(){if(!y){y=D.set();var a=D.text(x.x+x.width/2,x.height+10,"设计区域").attr({fill:"#ffffff","font-size":12,"font-weight":"bold"});if(!ea&&!fa)var b=A.getNormalSquare(x,ga,0,0,ha,"UI"),c=D.rect(x.x,x.height,x.width,20).attr({stroke:"#fe199d",fill:"#fe199d"});ea&&(b=A.getEllipse(x,0,0,ha,"UI"),c=A.getEllipse(x,0,0,ha,"UI")),fa&&(b=A.getRoundedSquare(x,ga,0,0,ha,"UI"),c=A.getRoundedSquare(x,ga,0,0,ha,"UI")),a.getBBox();var d="r"+ha,e=d+"-"+x.width/2+",-10";b.transform(d),c.transform(e),y.push(b),y.push(c),y.push(a),a.toFront(),a.toBack(),(80>x.width||ea||fa||0!=ha)&&(a.remove(),c.remove()),b.toBack(),c.toBack()}}function k(a){Y=a}function l(){return Y}function l(){return Y}function k(a){(Y=a)?A._popup.bind(B):A._popup.unbind(B)}var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this,B=c,C=b,D=a,E=0,F=0,G=1,H={x:0,y:0,width:1,height:1},I=[],J=!1,K=!1,L=null,M=!1,N=!0,O=!1,P=!0,Q=!0,R=4,S=3,T=3,U=!0,V=!0,W=!0,X=!1,Y=!0,Z=0,_=20,aa=Y=!0,ba=!0,ca=!0,da=!0,ea=ezdVars.DemoOval||!1,fa=!1,ga=50,ha=ezdVars.RegionAngle||0;this.clear=function(){m.reset()},this.updateScale=function(){m.updateUIScale()},this.getEllipse=function(a,b,c,d,e,f,g,h){var i=a.x+a.width/2,j=a.y+a.height/2,k=a.width/2;a=a.height/2;var l={},m={};if(k>=a?(m=Math.sqrt(Math.pow(k,2)-Math.pow(a,2)),l={x:i+m,y:j},m={x:i-m,y:j}):(m=Math.sqrt(Math.pow(a,2)-Math.pow(k,2)),l={x:i,y:j+m},m={x:i,y:j-m}),l=Math.getRotatedPoint(l.x,l.y,d,i,j),m=Math.getRotatedPoint(m.x,m.y,d,i,j),"INSIDE"==e){for(b=Math.getElementPolygon(b,c,f,g,h),c={value:!0,nodesOutside:[0,0,0,0]},e=0;e<b.length;e++)if(f=b[e],g=Math.sqrt(Math.pow(l.x-f.x,2)+Math.pow(l.y-f.y,2)),h=Math.sqrt(Math.pow(m.x-f.x,2)+Math.pow(m.y-f.y,2)),k>=a?g+h>2*k&&(c.value=!1,c.nodesOutside[e]={x:f.x,y:f.y,index:e}):g+h>2*a&&(c.value=!1,c.nodesOutside[e]={x:f.x,y:f.y,index:e}),!c.value){for(f=[],g=0;360>g;g+=3){var n=g/180*Math.PI;h=k*Math.cos(n),n=a*Math.sin(n),h=Math.getRotatedPoint(h+i,n+j,d,i,j),f.push(h)}for(h=[],g=0;g<f.length-1;g++){var n=(f[g].y-f[g+1].y)/(f[g].x-f[g+1].x),o=1/-n;h.push({p1:f[g],p2:f[g+1],m:n,invM:o})}n=(f[0].y-f[f.length-1].y)/(f[0].x-f[f.length-1].x),o=1/-n,h.push({p1:f[0],p2:f[f.length-1],m:n,invM:o}),c.lines=h}return c}return"UI"==e?(i=D.ellipse(i,j,k,a).attr({fill:"transparent",stroke:"#fe199d"}),i.transform("r"+d+"..."),i):void 0},this.getRoundedSquare=function(a,b,c,d,e,f){if("INSIDE"==f){var g=Math.getElementPolygon(a.x+a.width/2,a.y+a.height/2,a.width,a.height,e);f=g[3];for(var h=g[2],i=g[1],g=g[0],j=m.getDimensions(),j=Math.getElementPolygon(j.x,j.y,j.width,j.height,j.rotation),k=!0,k=0;k<j.length;k++){var l=j[k];0<Math.triangleArea(f,h,l)||0<Math.triangleArea(h,i,l)||0<Math.triangleArea(i,g,l)||0<Math.triangleArea(g,f,l)||Math.distance(f,l)<b||Math.distance(h,l)<b||Math.distance(i,l)<b||Math.distance(g,l)}return a=D.rect(a.x,a.y,a.width,a.height,b).attr({fill:"transparent",stroke:"#fe199d"}),a.transform("r"+e+"..."),k=a.isPointInside(c,d),a.remove(),k}return"UI"==f?(a=D.rect(a.x,a.y,a.width,a.height,b).attr({fill:"transparent",stroke:"#fe199d"}),a.transform("r"+e+"..."),a):void 0},this.rotateDesign=function(a){d(),A.selectAll(),A.getSelections().length||(a=A.getSelections().rotation+a),this.updateElement(H.x,H.y,a,H.width,H.height,"rotate"),m.hide(),A.hide(),e()},this.getNormalSquare=function(a,b,c,d,e,f,g,h,i){if("INSIDE"==f){var j=Math.getElementPolygon(a.x+a.width/2,a.y+a.height/2,a.width,a.height,e);for(e=j[3],b=j[2],f=j[1],j=j[0],d=Math.getElementPolygon(c,d,g,h,i),c={value:!0,nodesOutside:[0,0,0,0],nodesinside:[0,0,0,0]},g=0;g<d.length;g++)h=d[g],(0<Math.triangleArea(e,b,h)||0<Math.triangleArea(b,f,h)||0<Math.triangleArea(f,j,h)||0<Math.triangleArea(j,e,h))&&(c.value=!1,c.nodesOutside[g]={x:h.x,y:h.y,index:g});if(!c.value){for(d=Math.getElementPolygon(a.x+a.width/2,a.y+a.height/2,a.width,a.height,ha+1e-5),a=[],e=0;4>e;e+=1)a.push(d[e]);for(b=[],e=0;e<a.length-1;e++)f=(a[e].y-a[e+1].y)/(a[e].x-a[e+1].x),d=1/-f,b.push({p1:a[e],p2:a[e+1],m:f,invM:d});f=(a[0].y-a[a.length-1].y)/(a[0].x-a[a.length-1].x),b.push({p1:a[0],p2:a[a.length-1],m:f,invM:1/-f}),c.lines=b}return c}return"UI"==f?(a=D.rect(a.x,a.y,a.width,a.height).attr({fill:"transparent",stroke:"#fe199d"}),a.transform("r"+e+"..."),a):void 0},this.reportEditionForLayers=function(){var a=this.getSelections();!a||0==a.length||1<a.length||(delete a.previewHtml,eventManager.trigger("elementsSelected",a),eventManager.trigger("layersChanged"))},this.checkIsInside=function(a,b,c,d,e,f,g){var h;return ea&&(h=A.getEllipse(a,b,c,d,"INSIDE",e,f,g)),fa&&(h=A.getRoundedSquare(a,ga,b,c,d,"INSIDE",e,f,g)),ea||fa||(h=A.getNormalSquare(a,ga,b,c,d,"INSIDE",e,f,g)),h},this.selectElement=function(a){if(a&&0!=a.length){if(1<a.length){var b=D.set();I=[];for(var c=0;c<a.length;c++){var d=D.rect(a[c].x-a[c].width/2,a[c].y-a[c].height/2,a[c].width,a[c].height);d.rotate(a[c].rotation),b.push(d),I.push({x:a[c].x,y:a[c].y,rotation:a[c].rotation,width:a[c].width,height:a[c].height})}c=b.getBBox(!1),b.remove(),H={x:c.x+c.width/2,y:c.y+c.height/2,width:c.width,height:c.height},m.update(c.x+c.width/2,c.y+c.height/2,c.width,c.height,0)}else a.length&&(a=a[0]),m.update(a.x,a.y,a.width,a.height,a.rotation),eventManager.trigger("elementsSelected",a),eventManager.trigger("rasterQualityChanged",a);n=a,ba&&(clearInterval(z),z=setInterval(function(){clearInterval(z),ca&&m.show()},20),clearInterval(z),ca&&m.show()),eventManager.trigger("elementsSelected",a)}},this.fireClick=function(){},this.translateTo=function(a,b){H&&(A.selectAll(),this.updateElement(a,b,0,H.width,H.height,"move"),m.hide(),A.hide())},this.translateToRelative=function(a,b){A.selectAll(),this.updateElement(H.x+a,H.y+b,0,H.width,H.height,""),m.hide(),A.hide()},this.checkBoundaries=function(){m.dragManual()},this.checkElementSize=function(a,b){if(M||b){for(var c=A.checkIsInside(x,a.x,a.y,ha+1e-5,a.width,a.height,a.rotation);!c.value;)a.prototype&&(a.prototype.scaleX*=.99,a.prototype.scaleY*=.99),a.width*=.99,a.height*=.99,c=A.checkIsInside(x,a.x,a.y,ha+1e-5,a.width,a.height,a.rotation);n&&A.selectElement(A.getSelections())}},this.resizeToRelative=function(a){A.selectAll(),this.updateElement(H.x,H.y,0,H.width*a,H.height*a,""),m.hide(),A.hide()},this.resizeToFixedWH=function(a,b){d(),A.selectAll(),this.updateElement(H.x,H.y,0,a,b,"scale"),m.hide(),A.hide(),e()},this.resizeTo=function(a,b){if(1==C.length){var c=a/C[0].width;A.selectAll(),this.updateElement(C[0].x,C[0].y,C[0].rotation,a,C[0].height*c,"scale"),m.hide()}else A.selectAll(),c=H.height/b,c=H.width/c,c>a?(m.hide(),A.resizeToWidth(a)):(this.updateElement(H.x,H.y,0,c,b,"scale"),m.hide()),A.hide()},this.resizeToWidth=function(a){A.selectAll(),this.updateElement(H.x,H.y,0,a,H.height/(H.width/a),"scale"),m.hide(),A.hide()},this.resizeToHeight=function(a){A.selectAll(),this.updateElement(H.x,H.y,0,H.width/(H.height/a),a,"scale"),m.hide()},this.getDesignRectangle=function(a,b,c,d){var e=d?d:C;if(e.length){d=D.set();for(var f=0;f<e.length;f++){var g={x:e[f].x-e[f].width/2,y:e[f].y-e[f].height/2,width:e[f].width,height:e[f].height};e[f].constructor===ui.text.TextElement&&0!=e[f].arching&&(g.width+=2*e[f].stroke*e[f].strokeScale,g.height+=2*e[f].stroke*e[f].strokeScale,g.x-=e[f].stroke,g.y-=e[f].stroke),(e[f].constructor===ui.text.TextElement||e[f].constructor===ui.svg.SvgElement)&&(e[f].getStrokeScaleX(),e[f].getStrokeScaleY());var h=Math.getElementPolygon(C[f].x,C[f].y,C[f].width,C[f].height,C[f].rotation),i=Math.getElementPolygon(x.x+x.width/2,x.y+x.height/2,x.width,x.height,0);c&&!Math.doPolygonsIntersect(h,i)||null==g||(g=D.rect(g.x,g.y,g.width,g.height),g.rotate(C[f].rotation),d.push(g))}return e=d.getBBox(!1),c&&(e.x<x.x&&(e.width-=x.x-e.x,e.x=x.x,e.x1=x.x),e.y<x.y&&(e.height-=x.y-e.y,e.y=x.y),e.width>x.width&&(e.width-=e.x+e.width-(x.x+x.width)),e.height>x.height&&(e.height-=e.y+e.height-(x.y+x.height))),a&&(a=Math.max(e.width,e.height)+b,b=D.rect(e.x,e.y,a,a),b.translate((e.width-a)/2,(e.height-a)/2),e=b.getBBox(!1),b.remove()),d.remove(),{x:e.x,y:e.y,w:e.width,h:e.height}}},this.getSelections=function(){return n},this.isSelected=function(a){var b=!1;if(n&&(a==n&&(b=!0),0<n.length))for(var c=0;c<n.length;c++)n[c]==a&&(b=!0);return b},this.isMultiple=function(){return n&&0<n.length?!0:!1},this.selectAll=function(){m.hide(),n=null,A.selectElement(C)},this.canUpdate=function(){return!0},this.reportUndo=function(){n&&(n.length?(console.debug(ezd.hm.enable),e()):(console.debug(ezd.hm.enable),n.prototype.reportChange()),console.debug(ezd.hm.enable))},this.updateElement=function(a,b,c,d,e,f){if(n){if(0<n.length)for(e=0;e<n.length;e++){V&&(n[e].sleep=!0);var g=H.width/d;n[e].prototype.scaleX/=n[e].width/(I[e].width/g),n[e].prototype.scaleY/=n[e].height/(I[e].height/g),n[e].width=I[e].width/g,n[e].height=I[e].height/g,f=Math.angleTo360(I[e].rotation+c),n[e].rotation=f,f=-(H.x-I[e].x)/g;var h=-(H.y-I[e].y)/g,i=(360-c)/180*Math.PI,g=a+(f*Math.cos(i)+h*Math.sin(i));f=b+(-(f*Math.sin(i))+h*Math.cos(i)),n[e].x=g,n[e].y=f,V&&n[e].forceUpdate()}else V&&(n.sleep=!0),"rotate"==f&&(n.rotation=c),"move"==f&&(n.x=a,n.y=b),"scale"==f&&(n.prototype.scaleX/=n.width/d,n.prototype.scaleY/=n.height/e,n.width=d,n.height=e),V&&(n.sleep=!1,n.forceUpdate(f));eventManager.trigger("designLiveEdition")}},this.removeChildAt=function(a){-1!=a&&a<C.length&&a>=0&&(C[a].remove(),C.splice(a,1)),g()},this.removeChild=function(a){console.log("删除子节点");for(var b=0;b<C.length;b++)a.id==C[b].id&&(C[b].remove(),C.splice(b,1));g()},this.removeSelection=function(){ezd.deleteElements(n)},this.setChildIndex=function(a,b){for(var c=!1,d=-1,e=0;e<C.length;e++)a.getNode()==C[e].getNode()&&(d=e);return-1!=d&&b<C.length&&b>=0&&(c=C[d],C.splice(d,1),C.splice(b,0,c),c=!0,C[b].z=b),g(),eventManager.trigger("stackingOrderChanged"),c},this.getChildIndex=function(a){for(var b=-1,c=0;c<C.length;c++)a.getNode()==C[c].getNode()&&(b=c);return b},this.getChildrenById=function(a){for(var b=null,c=0;c<C.length;c++)a==C[c].id&&(b=C[c]);return b},this.swapChildIndex=function(a,b){for(var c=-1,d=-1,e=0;e<C.length;e++)a.getNode()==C[e].getNode()&&(c=e),b.getNode()==C[e].getNode()&&(d=e);-1!=c&&-1!=d&&(e=C[c],C[c]=C[d],C[d]=e,g())},this.removeSnapScreen=function(){w&&w.remove()},this.snapToCenterMultiple=function(){if(0<n.length){d(),A.selectElement(n);for(var a=H.x-(x.x+x.width/2),b=0;b<n.length;b++)n[b].x-=a;e()}},this.flipHMultiple=function(){if(0<n.length){d(),A.selectElement(n);for(var a=0;a<n.length;a++)n[a].flipH=n[a].flipH?0:1,n[a].x=n[a].x>H.x?H.x-(n[a].x-H.x):H.x+(H.x-n[a].x),I[a].x=n[a].x;e()}},this.flipVMultiple=function(){if(0<n.length){d(),A.selectElement(n);for(var a=0;a<n.length;a++)n[a].flipV=n[a].flipV?0:1,n[a].y=n[a].y>H.y?H.y-(n[a].y-H.y):H.y+(H.y-n[a].y),I[a].y=n[a].y;e()}},this.copyElement=function(){ezd._copiedElements=ezd.copySelection(!0),ezd._forCopySelection=n},this.pasteElement=function(){ezd.copySelection(!1,ezd._forCopySelection)},this.showRegion=function(){da&&(1==ezd.zoom?(aa=!0,A.region=A.region):(aa=!1,A.hideRegion()))},this.hideRegion=function(){y&&i()},this.getRegionCenter=function(){return x?{x:x.x+x.width/2,y:x.y+x.height/2}:{x:0,y:0}},this.hide=function(){m.hide(),n=null},this.showPopup=function(){A._popup.show({pageX:q,pageY:r})},this.init=function(){m||(m=new container.BoundingBox(D,A,c)),M=ezdVars.EnforceBoundaries,$("#"+B).mousemove(function(a,b,c){Z++,o=(-1+a.pageX-$("#"+B).offset().left)*G+E,p=(-1+a.pageY-$("#"+B).offset().top)*G+F,q=a.pageX,r=a.pageY,K=!0,v&&v.remove(),J&&(a=Math.sortedRectangle(s,t,o,p),v=D.rect(a.x1,a.y1,a.x2,a.y2).attr({"stroke-width":Math.min(1,1*G)}),u={x:a.x1+a.x2/2,y:a.y1+a.y2/2,width:a.x2,height:a.y2,rotation:0})}),$("#"+B).mousedown(function(a,b,c){if(ca){for(K=!1,L=a.target,A._popup.hide(),b=a.target.parentNode,console.log("0",b.localName);"g"==b.localName;)b=b.parentNode,console.log("1",b.localName);"svg"!=b.localName||"vml"==b.localName?(console.log("2",b.localName),m.hide(),n=null,s=o,t=p,J=!1,v&&v.remove(),J=!0):"BoundingBox"!=a.target.id&&"BoundingBoxRect"!=a.target.id&&"designGroup1"!=a.target.id&&(console.log("3",b.localName),A.removeSnapScreen(),J=!1,u={x:o,y:p,width:1,height:1,rotation:0},f(!0,a))}}),$("#"+B).mouseup(function(a,b,c){ca&&(m&&m.stopDragEvent(),3!=a.which&&(b=a.target.parentNode,"BoundingBoxRect"!=a.target.id||a.target!=L||K||(m.hide(),setTimeout(function(){$(document.elementFromPoint(a.clientX,a.clientY)).mousedown(),$(document.elementFromPoint(a.clientX,a.clientY)).mouseup()},20)),"g"==b.localName&&(b=b.parentNode),J=!1,u&&f()))}),w=new container.snap.SnapScreen(D,A),h(A),eventManager.on("checkInsideRegion",A.checkElementSize)},A.init(),this.getElementUnderMouse=function(){},Object.defineProperty(this,"showBB",{set:function(a){(ba=a)||m.hide()},get:function(){return ba}}),Object.defineProperty(this,"visibleRegion",{set:function(a){(aa=a)?y||(y&&i(),x&&j()):y&&i()},get:function(){return aa}}),Object.defineProperty(this,"elements",{set:function(a){for(C=a,a=0;a<C.length;a++);for(C.sort(function(a,b){return a.z-b.z}),a=0;a<C.length;a++);g(),m.hide(),n=null},get:function(){return C}}),Object.defineProperty(this,"region",{set:function(a){x=a,aa&&(y&&i(),x&&j())},get:function(){return x}}),Object.defineProperty(this,"mouseX",{set:function(a){o=a},get:function(){return o}}),Object.defineProperty(this,"mouseY",{set:function(a){p=a},get:function(){return p}}),Object.defineProperty(this,"enforceBoundaries",{set:function(a){M=a},get:function(){return M}}),Object.defineProperty(this,"snapToAngle",{set:function(a){N=a},get:function(){return N}}),Object.defineProperty(this,"snapAngleTolerance",{set:function(a){R=a},get:function(){return R}}),Object.defineProperty(this,"snapToMidPoint",{set:function(a){O=a},get:function(){return O}}),Object.defineProperty(this,"snapMidPointTolerance",{set:function(a){S=a},get:function(){return S}}),Object.defineProperty(this,"snapToObject",{set:function(a){P=a},get:function(){return P}}),Object.defineProperty(this,"snapObjectTolerance",{set:function(a){S=a},get:function(){return 3}}),Object.defineProperty(this,"snapScreen",{get:function(){return w}}),Object.defineProperty(this,"checkNonVisibleElements",{set:function(a){U=a},get:function(){return U}}),Object.defineProperty(this,"snapToRegion",{set:function(a){Q=a},get:function(){return Q}}),Object.defineProperty(this,"snapRegionTolerance",{set:function(a){T=a},get:function(){return T}}),Object.defineProperty(this,"performance",{set:function(a){V=a},get:function(){return V}}),Object.defineProperty(this,"showElementsWhileTransform",{set:function(a){W=a},get:function(){return W}}),Object.defineProperty(this,"skipFramesPerformance",{set:function(a){X=a},get:function(){return X}}),Object.defineProperty(this,"updateMaxDelay",{set:function(a){_=a},get:function(){return _}}),Object.defineProperty(this,"contextMenu",{set:k,get:l}),Object.defineProperty(this,"xOffset",{set:function(a){E=a},get:function(){return E}}),Object.defineProperty(this,"popup",{get:function(){}}),Object.defineProperty(this,"yOffset",{set:function(a){F=a},get:function(){return F}}),Object.defineProperty(this,"zoomScale",{set:function(a){for(G=a,a=0;a<C.length;a++)C[a].strokeScale=G;A.getSelections()&&A.selectElement(A.getSelections())},get:function(){return G}}),Object.defineProperty(this,"contextMenu",{get:l,set:k}),Object.defineProperty(this,"regionAngle",{get:function(){return ha},set:function(a){ha=a}}),Object.defineProperty(this,"oval",{get:function(){return ea},set:function(a){ea=a}}),Object.defineProperty(this,"mouseEnabled",{get:function(){return ca},set:function(a){ca=a,m.hide()}}),Object.defineProperty(this,"enableRegionBorder",{get:function(){return da},set:function(a){da=a,y&&0==a&&i()}})},container.BoundingBox=function(a,b,c){function d(a){clearInterval(W),W=setInterval(function(){},30)}function e(a){clearInterval(W)}function f(a){}function g(){G.removeSelection()}function h(){G.showPopup()}function i(a,b,c){a*=G.zoomScale,b*=G.zoomScale,a=H.x+z/2+a,b=H.y+A/2+b;var d={x:a,y:b};1!=c&&(c={x:a,y:b},G.snapToRegion&&(c=Math.checkSnapToRegion({x:a,y:b},G.region,z,A,B,G.zoomScale,G.snapRegionTolerance),0<c.lines.length&&G.snapScreen.drawRegionLines(c.lines,"#0000FF")),G.snapToMidPoint&&(c=Math.checkSnapToMidPoint({x:c.x,y:c.y},G,z,A,B,G.zoomScale,G.snapMidPointTolerance),0<c.lines.length&&G.snapScreen.drawLines(c.lines)),G.snapToObject&&(c=Math.checkSnapToObject({x:c.x,y:c.y},G,z,A,B,G.zoomScale,G.snapMidPointTolerance),0<c.lines.length&&G.snapScreen.drawLines(c.lines)),d=c),a==d.x&&b==d.y&&G.snapScreen.removeLines(),G.enforceBoundaries&&(d=j(d.x,d.y)),x=d.x,y=d.y,H.rotate(-B),H.attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"move"),H.rotate(B),v(),w("drag"),G.showRegion()}function j(a,b){for(var c={x:a,y:b},d=Math.getElementPolygon(c.x,c.y,z,A,B),e=[0,0,0,0],f=0;f<d.length;f++){var g=d[f].x,h=d[f].y,i=(d[0].x+d[2].x)/2,j=(d[0].y+d[2].y)/2;g>G.region.width&&G.region.width-(-i+g)<c.x&&(c.x=G.region.width-(-i+g),e[f]=1),0>g&&0-(-i+g)>c.x&&(c.x=0-(-i+g),e[f]=1),h>G.region.height&&G.region.height-(-j+h)<c.y&&(c.y=G.region.height-(-j+h),e[f]=1),0>h&&0-(-j+h)>c.y&&(c.y=0-(-j+h),e[f]=1)}return c.s=e,c}function k(a){G.showRegion(),G.getElementUnderMouse(),H.x=H[0].attr("x"),H.y=H[0].attr("y"),w("drag"),t(!1)}function l(){0!=G.showElementsWhileTransform&&1!=G.skipFramesPerformance||G.updateElement(x,y,B,z,A,"move"),G.reportUndo(),G.removeSnapScreen(),u(G.isMultiple()),v(),w("normal")}function m(a,b){G.showRegion();var c=-U+Math.round(Math.angleBetweenPoints(G.mouseX,G.mouseY,x,y)),c=Math.angleTo360(c);G.snapToAngle&&(c=Math.snapAngle(c,1*G.snapAngleTolerance)),B=c,H.transform("R0"),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"rotate"),H.transform("r"+B+","+x+","+y+"..."),G.enforceBoundaries&&(c=j(x,y),c.x!=x||c.y!=y)&&(x=c.x,y=c.y,H.rotate(-B),H.attr({x:x-z/2,y:y-A/2}),H[0].attr({x:x-z/2,y:y-A/2}),H[1].attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"move"),H.rotate(B),v(),w("normal"),1==c.s[0]&&1==c.s[2]||1==c.s[1]&&1==c.s[3])&&(z*=.9,A*=.9,H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"scale"),H.transform("r"+B+","+x+","+y+"t0,0...")),v()}function n(){var a=B/180*Math.PI,b=x+(0*Math.cos(a)+0*Math.sin(a)),a=y-(-(0*Math.sin(a))+0*Math.cos(a));U=Math.abs(360-B)+180*Math.atan2(G.mouseY-a,G.mouseX-b)/Math.PI,v()}function o(){G.hideRegion(),(0==G.showElementsWhileTransform||G.skipFramesPerformance)&&G.updateElement(x,y,B,z,A,"rotate"),G.reportUndo(),G.reportEditionForLayers()}function p(a,b){if(Z){G.showRegion(),a*=G.zoomScale,b*=G.zoomScale;var c=Math.getRotatedPoint(a,b,B,0,0),d=c.x,e=-c.y;if((this==K||this==L)&&(d=-c.x,e=c.y),this==P&&(e=-e),this==O&&(d=-d),Y&&(e=d*V),C+2*d<2*G.zoomScale||D+2*e<2*G.zoomScale)return;z=C+2*d,A=D+2*e,(this==N||this==P)&&(z=C,d=0),(this==O||this==Q)&&(A=D,e=0),H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:E-C/2-d,y:F-D/2-e}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(E,F,B,z,A,"scale"),H.transform("r"+B+","+x+","+y+"t0,0...")}if(G.enforceBoundaries){if(c=j(x,y),1==c.s[0]&&1==c.s[2]||1==c.s[1]&&1==c.s[3]){for(c=j(x,y);1==c.s[0]&&1==c.s[2]||1==c.s[1]&&1==c.s[3];)z*=.99,A*=.99,c=j(x,y);return E=x,F=y,_nDy=_nDx=0,H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"scale"),H.transform("r"+B+","+x+","+y+"t0,0..."),Z=!1,H.rotate(-B),H.attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"move"),void H.rotate(B)}Z=!0,(c.x!=x||c.y!=y)&&(x=c.x,y=c.y,E=x,F=y,_nDy=_nDx=0,H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:x-z/2,y:y-A/2}),H.transform("r"+B+","+x+","+y+"t0,0..."),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"move"))}v()}function q(){this==J||this==K||this==L||this==M?(Y=!0,V=A/z):Y=!1,this.x=this.attr("x"),this.y=this.attr("y"),C=z,D=A,E=x,F=y}function r(){G.hideRegion(),(0==G.showElementsWhileTransform||G.skipFramesPerformance)&&G.updateElement(E,F,B,z,A,"scale"),G.reportUndo(),G.reportEditionForLayers()}function s(a){return state&&state.theme?state.theme.url(a):a}function t(a){0!=a&&H&&H.hide(),I&&I.hide(),J&&(J.hide(),K.hide(),L.hide(),M.hide()),N&&(N.hide(),O.hide(),P.hide(),Q.hide()),R&&R.hide(),T&&T.hide()}function u(a){I&&(I.show(),I.toFront()),J&&(J.show(),K.show(),L.show(),M.show(),J.toFront(),K.toFront(),L.toFront(),M.toFront()),N&&0==a&&(N.show(),O.show(),P.show(),Q.show(),N.toFront(),O.toFront(),P.toFront(),Q.toFront()),R&&(R.show(),R.toFront()),T&&(T.show(),T.toFront())}function v(a){a=_*G.zoomScale;var b=aa*G.zoomScale,c=b/3,d=ba*G.zoomScale,e=ca*G.zoomScale;for(a=[{btn:T,x:z/2+a/2,y:-(A/2)-1.5*a},{btn:R,x:-(z/2)-1.5*a,y:-(A/2)-1.5*a},{btn:J,x:z/2-b/2+c,y:A/2-b/2+c},{btn:K,x:-(z/2)-b/2-c,y:A/2-b/2+c},{btn:L,x:-(z/2)-b/2-c,y:-(A/2)-b/2-c},{btn:M,x:z/2-b/2+c,y:-(A/2)-b/2-c},{btn:N,x:0-d/2,y:A/2},{btn:O,x:-(z/2)-d,y:0-d/2},{btn:P,x:0-d/2,y:-(A/2)-d},{btn:Q,x:z/2,y:0-d/2},{btn:I,x:-(e/2),y:-(A/2)-1.8*e},{btn:S,x:-(z/2)-a,y:A/2}],b=0;b<a.length;b++){var c=a[b].btn,d=x+a[b].x,e=y+a[b].y,f=G.zoomScale;c&&(c.transform("R0"),c.transform("r"+B+","+x+","+y+"t"+d+","+e+"...s"+f+","+f+",0,0"))}}function w(a){if(H){H[0].attr({fill:"#000000","fill-opacity":0}),H[1].attr({fill:"#000000","fill-opacity":0});var b=H[0].node,c=H[1].node;b.setAttribute("class","whiteLineClass"),c.setAttribute("class","dashedLineClass"),void 0===document.documentElement.style.vectorEffect?(b=2*G.zoomScale,c=5*G.zoomScale):(b.setAttribute("vector-effect","non-scaling-stroke"),c.setAttribute("vector-effect","non-scaling-stroke"),b=2,c=5),$(".whiteLineClass").attr("stroke","#ffffff"),$(".whiteLineClass").attr("stroke-width",b),$(".dashedLineClass").attr("stroke","#000000"),$(".dashedLineClass").attr("stroke-width",b/2),b=c+","+c,$(".dashedLineClass").attr("stroke-dasharray",b),"drag"===a&&($(".whiteLineClass").attr("stroke","none"),$(".dashedLineClass").attr("stroke","#4267c7"))}}var x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=this,Y=!0,Z=!0,_=24,aa=15,ba=9,ca=26,da=a.set();this.init=function(){G=b,eventManager.on("checkBoundaries",X.forceBoundaries)},this.update=function(a,b,c,d,e){x=a,y=b,z=c,A=d,B=e},this.updateUIScale=function(){w("normal")},this.hide=function(){console.log("调用 this.hide()"),H?(t(!0),G.snapScreen&&(console.log(1),b.snapScreen.remove())):t(!1)},this.getDimensions=function(){return{x:x,y:y,width:z,height:A,rotation:B}},this.reset=function(){H&&(console.log("删除正方形"),H.undrag(),H.remove(),H=null),I&&(I.undrag(),I.remove(),I=null),J&&(J.undrag(),K.undrag(),L.undrag(),M.undrag(),J.remove(),K.remove(),L.remove(),M.remove(),M=L=K=J=null),N&&(N.undrag(),O.undrag(),P.undrag(),Q.undrag(),N.remove(),O.remove(),P.remove(),Q.remove(),Q=P=O=N=null),J&&(J.remove(),K.remove(),L.remove(),M.remove(),M=L=K=J=null),N&&(N.remove(),O.remove(),P.remove(),Q.remove(),Q=P=O=N=null),R&&(R.unclick(g),R.remove(),R=null),T&&(T.unclick(h),T.remove(),T=null)},this.show=function(){if(Y=!0,!H){da=a.set();var b=a.rectBb(x-z/2,y-A/2,z,A),c=a.rectBb(x-z/2,y-A/2,z,A);da.push(b),da.push(c),da[0].node.id="BoundingBoxRect",da[1].node.id="BoundingBoxRect",H=da,b=G.isMultiple(),J=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_11px.png"),0,0,aa,aa),K=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_11px.png"),0,0,aa,aa),L=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_11px.png"),0,0,aa,aa),M=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_11px.png"),0,0,aa,aa),J.node.id="BoundingBox",K.node.id="BoundingBox",L.node.id="BoundingBox",M.node.id="BoundingBox",N=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_8.5px.png"),0,0,ba,ba),O=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_8.5px.png"),0,0,ba,ba),P=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_8.5px.png"),0,0,ba,ba),Q=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/grasp_8.5px.png"),0,0,ba,ba),N.node.id="BoundingBox",O.node.id="BoundingBox",P.node.id="BoundingBox",Q.node.id="BoundingBox",b||(N.hide(),O.hide(),P.hide(),Q.hide()),J&&(J.drag(p,q,r),K.drag(p,q,r),L.drag(p,q,r),M.drag(p,q,r)),N&&(N.drag(p,q,r),O.drag(p,q,r),P.drag(p,q,r),Q.drag(p,q,r)),R=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/delete.png"),0,0,_,_),R.node.id="BoundingBox",R.click(g),T=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/tools.png"),0,0,_,_),T.node.id="BoundingBox",T.click(h),I=a.imageBb(s(ezdVars.DesignerLocation+"/ds/images/rotate-tall.png"),0,0,ca,1.5*ca),I.node.id="BoundingBox",I.drag(m,n,o),H.drag(i,k,l),H.mousedown(d),H.mouseup(e),H.mousemove(f)}H.show(),H.x=H[0].attr("x"),H.y=H[0].attr("y"),H.rotate(B),u(G.isMultiple()),v(),w("normal"),H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:x-z/2,y:y-A/2}),H.transform("r"+B+","+x+","+y+"t0,0..."),H.toFront()},this.stopDragEvent=function(){},this.dragManual=function(){H&&(G.getElementUnderMouse(),H.x=H[0].attr("x"),H.y=H[0].attr("y")),i(0,0,!0)},this.forceBoundaries=function(){if(G.enforceBoundaries&&H){G.getElementUnderMouse(),H.x=H[0].attr("x"),H.y=H[0].attr("y"),w("normal"),Y=!0,V=A/z,C=z,D=A,E=x,F=y;for(var a=H.getBBox();a.width-a.x>G.region.width||a.height-a.y>G.region.height;)a=H.getBBox(),z*=.98,A*=.98,H.transform("R0"),H.attr({width:z,height:A}),H.attr({x:x-z/2,y:y-A/2}),1==G.showElementsWhileTransform&&G.canUpdate()&&G.updateElement(x,y,B,z,A,"scale"),H.transform("r"+B+","+x+","+y+"t0,0...");X.dragManual(),H.attr({width:z,height:A})}},X.init()},Namespace("container.snap"),container.snap.SnapScreen=function(a,b){var c,d,e=a.set();_groupR=a.set(),this.drawLines=function(c,d){if(e)for(var f=0;f<e.items.length;f++)e.items[f].remove();var g;for(g=d?"#ffff00":"#4245cc",f=0;f<c.length;f++)if(0!=c[f]){var h=a.pathBb("M"+c[f].x1+" "+c[f].y1+" L"+c[f].x2+" "+c[f].y2).attr({stroke:g,"stroke-width":Math.max(1*b.zoomScale,1),"stroke-dasharray":""});e.push(h),h=a.rectBb(c[f].element.x-c[f].element.width/2,c[f].element.y-c[f].element.height/2,c[f].element.width,c[f].element.height).attr({stroke:"#4245cc","stroke-dasharray":"","stroke-width":Math.max(1,1*b.zoomScale)}).rotate(c[f].element.rotation),e.push(h)}},this.removeLines=function(){if(e)for(var a=0;a<e.items.length;a++)e.items[a].remove();if(_groupR)for(a=0;a<_groupR.items.length;a++)_groupR.items[a].remove()},this.drawRegionLines=function(b,c){if(_groupR)for(var d=0;d<_groupR.items.length;d++)_groupR.items[d].remove();if(c)var e="#4245cc";for(e="#fe199d",d=0;d<b.length;d++)if(0!=b[d]){var f=a.path("M"+b[d].x1+" "+b[d].y1+" L"+b[d].x2+" "+b[d].y2).attr({stroke:e,"stroke-width":2,"stroke-dasharray":""});_groupR.push(f)}},this.drawNonVisibleElements=function(a){console.debug("OUTSIDE CHECK LATER")},this.remove=function(){e&&e.remove(),_groupR&&_groupR.remove()},this.init=function(){},this.init(),Object.defineProperty(this,"x",{set:function(a){c=a,setPositionAndSize()},get:function(){return c}}),Object.defineProperty(this,"y",{set:function(a){d=a,setPositionAndSize()},get:function(){return d}})};var listener,PopupMenu=function(){this.init()};PopupMenu.SEPARATOR="PopupMenu.SEPARATOR",PopupMenu.current=null,PopupMenu.addEventListener=function(a,b,c,d){"string"==typeof a&&(a=document.getElementById(a)),a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},PopupMenu.removeEventListener=function(a,b,c,d){"string"==typeof a&&(a=document.getElementById(a)),a.removeEventListener?a.removeEventListener(b,c,d):a.attachEvent&&a.detachEvent("on"+b,c)},PopupMenu.prototype={init:function(){this.items=[],this.height=this.width=0},setContainer:function(a){this.container=a},setSize:function(b,d){if(this.width=b,this.height=d,this.element)with(this.element.style);},unbind:function(a){var b=this;a?"string"==typeof a&&(a=document.getElementById(a)):a=document,this.target=a,this.target.oncontextmenu=function(a){return b.hide.call(b,a),!1},PopupMenu.removeEventListener(a,"click",listener,!0),PopupMenu.addEventListener(a,"contextmenu",function(){return!0},!0)},bind:function(a){var b=this;a?"string"==typeof a&&(a=document.getElementById(a)):a=document,this.target=a,this.target.oncontextmenu=function(a){return b.show.call(b,a),!1},listener=function(){b.hide.call(b)},PopupMenu.addEventListener(a,"click",listener,!0)},add:function(a,b,c){this.items.push({text:a,"class":c,callback:b})},addSeparator:function(){this.items.push(PopupMenu.SEPARATOR)},setPos:function(a){if(this.element){a||(a=window.event);var b,c;window.opera?(b=a.clientX,c=a.clientY):document.all?(b=document.body.scrollLeft+event.clientX,c=document.body.scrollTop+event.clientY):(document.layers||document.getElementById)&&(b=a.pageX,c=a.pageY),this.element.style.top=c+-25+"px",this.element.style.left=b+25+"px",console.log(b,c)}},show:function(a){PopupMenu.current&&PopupMenu.current!=this||(PopupMenu.current=this,this.element?(this.setPos(a),this.element.style.display=""):(this.element=this.createMenu(this.items),this.setPos(a),document.body.appendChild(this.element),this.element.style.zIndex="10004"))},hide:function(){PopupMenu.current=null,this.element&&(this.element.style.display="none")},createMenu:function(b){var d=document.createElement("div");with(d.id="isd-rightClickMenu",d.style)this.width&&(width=this.width+"px"),this.height&&(height=this.height+"px");for(var c=0;c<b.length;c++){var g;g=b[c]==PopupMenu.SEPARATOR?this.createSeparator():this.createItem(b[c]),d.appendChild(g)}return d},createItem:function(a){var b=this,c=document.createElement("div");c.setAttribute("class","rightClickMenuOption"),PopupMenu.addEventListener(c,"click",function(a){return function(){b.hide(),a(b.target)}}(a.callback),!0);var d=document.createElement("div");return d.setAttribute("class",a["class"]),c.appendChild(d),d.appendChild(document.createTextNode(a.text)),c},createSeparator:function(){var a=document.createElement("div");return a.setAttribute("class","popupSeparator"),a}},Namespace("ui.resolution"),ui.resolution.ResolutionMeter=function(a,b){function c(c,d){if("w"==d)var e=parseFloat(ezd.activeSide.activeRegion.render_width_inches),g=parseFloat(ezd.activeSide.activeRegion.region[2]),h=a,i=c;else e=parseFloat(ezd.activeSide.activeRegion.render_width_inches),g=parseFloat(ezd.activeSide.activeRegion.region[3]),h=b,i=c;return i/(i/(g/(e*f))/(e*f)*e*100/100)/(100*i/h)*100}var d=a,e=b,f=300;this.getQuality=function(a,b){var d=Math.max(Math.min(c(a,"w"),f),75),e=Math.max(Math.min(c(b,"h"),f),75);return(Math.min(d,e)-75)/(f-75)},this.init=function(){},this.init(),Object.defineProperty(this,"originalWidth",{set:function(a){d=a},get:function(){return d}}),Object.defineProperty(this,"originalHeight",{set:function(a){e=a},get:function(){return e}})},Namespace("com.aq.bitmap"),com.aq.bitmap.AQBitmapPalettes=function(b,c,d){function e(a,b,c){var d=0;r&&(d=1.8),c=c.getContext("2d");var e=c.canvas.width,h=c.canvas.height,i=c.getImageData(0,0,e,h),j=i.data,k=4*(b*e+a);floodFillScanline(a,b,e,h,g,f,[0,0,0,0],[j[k],j[k+1],j[k+2],j[k+3]],j,d),c.putImageData(i,0,0)}function f(a,b,c,d,e,f){a=4*(b*c+a),f[a+0]=e[0],f[a+1]=e[1],f[a+2]=e[2],f[a+3]=e[3]}function g(a,b,c,d,e,f,g,h){return a=4*(b*c+a),g=[g[a],g[a+1],g[a+2],g[a+3]],0===g[3]?!1:(base.colorUtils.rgbToLab(g),base.colorUtils.rgbToLab(f),f=base.colorUtils.cie1994(g,f,!1)/100<=h/100?!0:!1)}function h(a,b){return{x:Math.round(b.offsetX*a.width/a.clientWidth),
y:Math.round(b.offsetY*a.height/a.clientHeight)}}function i(a){if("HTMLCanvasElement"===n.toString().slice(8,-1)){var b=!1,c=new Image;c.onload=function(){a&&!b&&(a(),b=!0)},c.src=n.toDataURL(),c.naturalWidth&&a&&!b&&(setTimeout(a),b=!0),n=c}}function j(a){for(var b=[],c=0;c<a.length;c++){var d=base.colorUtils.labToRgb(a[c].lab);b.push(d)}return b}function k(a){return 2==a.length?a:"0"+a}function l(a){for(var b=[],c=0;c<a.length;c++){var d=k(a[c][0].toString(16)),d=d+k(a[c][1].toString(16)),d=d+k(a[c][2].toString(16)),d=a[c][3]?d+k(a[c][3].toString(16)):d+"ff";b.push(d)}return b}function m(b){var c={},c=parseInt(b.substring(0,2),16),d=parseInt(b.substring(2,4),16),e=parseInt(b.substring(4,6),16);return a=parseInt(b.substring(6,8),16),c={r:c,g:d,b:e,a:a}}var n=b,o={},p=[],q=!0,r=!0;this.init=function(){i(c)},this.getPicture=function(a){var b=document.createElement("canvas");b.width=n.naturalWidth,b.height=n.naturalHeight;var c=b.getContext("2d"),f=this.getQuantizedImage(a,!0);return c.drawImage(f.img,0,0),d&&(o[a]?b=o[a]:(this.removeBackground(b,!0),o[a]=b)),b.addEventListener("click",function(a){a=h(b,a),e(a.x,a.y,this)},!1),b},this.replaceColor=function(a,b,c,d){console.log(a,b,c);var e=m(b).r,f=m(b).g,g=m(b).b,h=m(b).a,i=m(c).r,j=m(c).g,k=m(c).b,l=m(c).a;ctx=a.getContext("2d"),ctx.globalCompositeOperation="source-out";var n=d?d.getContext("2d"):ctx,o=ctx.getImageData(0,0,a.width,a.height),q=d?n.getImageData(0,0,d.width,d.height):o;for(console.log(o),d=0,n=q.data.length;n>d;d+=4)q.data[d]==e&&q.data[d+1]==f&&q.data[d+2]==g&&q.data[d+3]==h&&(o.data[d]=i,o.data[d+1]=j,o.data[d+2]=k,o.data[d+3]=l);for(ctx.putImageData(o,0,0),d=0,n=p.length;n>d;d++)if(p[d].img==a)for(e=0,f=p[d].colors.length;f>e;e++)p[d].colors[e]==b&&(p[d].colors[e]=c)},this.removeBackground=function(a,b){var c=a.getContext("2d"),d=c.canvas.width,e=c.canvas.height,h=c.getImageData(0,0,d,e);if(b){for(var i=h.data,j=0;d>j;j++)f(j,0,d,e,[255,255,255,255],i),f(j,e-1,d,e,[255,255,255,255],i);for(j=0;e>j;j++)f(0,j,d,e,[255,255,255,255],i),f(d-1,j,d,e,[255,255,255,255],i);floodFillScanline(0,0,d,e,g,f,[0,0,0,0],[255,255,255],i,15)}else for(var k,l,m,d={},e=h.data,i=e.length,n=base.colorUtils.rgbToLab([255,255,255]),j=0;i>j;j+=4)l=e[j],k=e[j+1],m=e[j+2],l=[l,k,m],d[l]?k=d[l]:(k=base.colorUtils.rgbToLab(l),k=base.colorUtils.cie1994(k,n,!1)/100,0===k&&(k=.001),d[l]=k),.1>=k&&(e[j+3]=0);c.putImageData(h,0,0)},this.getQuantizedImage=function(a){a=parseInt(a);var b=findMatch(p,function(b){return b.colors.length==a});if(b)return b;var b=new ui.bitmap.SimpleQuant(n),c=b.getPalette(9),c=b.reducePaletteForced(c,a),b=b.reduceToPalette(c),c=j(c);return b.id="canvas_bmp"+a,b={img:b,colors:l(c),oColors:l(c)},p.push(b),b},this.init(),Object.defineProperty(this,"bitmaps",{set:function(a){p=a},get:function(){return p}}),Object.defineProperty(this,"canClick",{set:function(a){q=a},get:function(){return q}}),Object.defineProperty(this,"fullColor",{set:function(a){r=a},get:function(){return r}}),Object.defineProperty(this,"bW",{get:function(){if(document.getElementById("canvasRasterColors")){var a=document.getElementById("canvasRasterColors");a.parentNode.removeChild(a)}var b=document.createElement("canvas");b.id="canvasRasterColors",b.width=n.naturalWidth,b.height=n.naturalHeight,ctx=b.getContext("2d"),ctx.drawImage(n,0,0);for(var a=ctx.getImageData(0,0,b.width,b.height),c=a.data,f=0,g=c.length;g>f;f+=4){var i=.3*c[f]+.59*c[f+1]+.11*c[f+2];c[f]=i,c[f+1]=i,c[f+2]=i}return ctx.putImageData(a,0,0),b.addEventListener("click",function(a){a=h(b,a),e(a.x,a.y,this)},!1),d&&(o.blackAndWhite?b=o.blackAndWhite:(this.removeBackground(b,!0),o.blackAndWhite=b)),b}}),Object.defineProperty(this,"original",{get:function(){if(document.getElementById("canvasRasterColors")){var a=document.getElementById("canvasRasterColors");a.parentNode.removeChild(a)}var b=document.createElement("canvas");return b.width=n.naturalWidth,b.height=n.naturalHeight,ctx=b.getContext("2d"),ctx.imageSmoothingEnabled=ctx.mozImageSmoothingEnabled=ctx.webkitImageSmoothingEnabled=!1,ctx.drawImage(n,0,0),b.addEventListener("click",function(a){a=h(b,a),e(a.x,a.y,this)},!1),d&&(o.fullColor?b=o.fullColor:(this.removeBackground(b,!0),o.fullColor=b)),b}})},function(a){var b,c,d=/[\.\/]/,e=function(){},f=function(a,b){return a-b},g={n:{}},h=function(a,d){a=String(a);var e,g=c,i=Array.prototype.slice.call(arguments,2),j=h.listeners(a),k=0,l=[],m={},n=[],o=b;b=a;for(var p=c=0,q=j.length;q>p;p++)"zIndex"in j[p]&&(l.push(j[p].zIndex),0>j[p].zIndex&&(m[j[p].zIndex]=j[p]));for(l.sort(f);0>l[k];)if(e=m[l[k++]],n.push(e.apply(d,i)),c)return c=g,n;for(p=0;q>p;p++)if(e=j[p],"zIndex"in e)if(e.zIndex==l[k]){if(n.push(e.apply(d,i)),c)break;do if(k++,(e=m[l[k]])&&n.push(e.apply(d,i)),c)break;while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,i)),c)break;return c=g,b=o,n.length?n:null};h._events=g,h.listeners=function(a){a=a.split(d);var b,c,e,f,h,i,j,k=g,l=[k],m=[];for(e=0,f=a.length;f>e;e++){for(j=[],h=0,i=l.length;i>h;h++)for(k=l[h].n,b=[k[a[e]],k["*"]],c=2;c--;)(k=b[c])&&(j.push(k),m=m.concat(k.f||[]));l=j}return m},h.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(d),f=g,h=0,i=c.length;i>h;h++)f=f.n,f=f.hasOwnProperty(c[h])&&f[c[h]]||(f[c[h]]={n:{}});for(f.f=f.f||[],h=0,i=f.f.length;i>h;h++)if(f.f[h]==b)return e;return f.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},h.f=function(a){var b=[].slice.call(arguments,1);return function(){h.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},h.stop=function(){c=1},h.nt=function(a){return a?RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},h.nts=function(){return b.split(d)},h.off=h.unbind=function(a,b){if(a){var c,e,f,i,j,k,l=a.split(d),m=[g];for(i=0,j=l.length;j>i;i++)for(k=0;k<m.length;k+=f.length-2){if(f=[k,1],c=m[k].n,"*"!=l[i])c[l[i]]&&f.push(c[l[i]]);else for(e in c)c.hasOwnProperty(e)&&f.push(c[e]);m.splice.apply(m,f)}for(i=0,j=m.length;j>i;i++)for(c=m[i];c.n;){if(b){if(c.f){for(k=0,l=c.f.length;l>k;k++)if(c.f[k]==b){c.f.splice(k,1);break}!c.f.length&&delete c.f}for(e in c.n)if(c.n.hasOwnProperty(e)&&c.n[e].f){for(f=c.n[e].f,k=0,l=f.length;l>k;k++)if(f[k]==b){f.splice(k,1);break}!f.length&&delete c.n[e].f}}else for(e in delete c.f,c.n)c.n.hasOwnProperty(e)&&c.n[e].f&&delete c.n[e].f;c=c.n}}else h._events=g={n:{}}},h.once=function(a,b){var c=function(){return h.unbind(a,c),b.apply(this,arguments)};return h.on(a,c)},h.version="0.4.2",h.toString=function(){return"您正在使用易衫设计工具 "},"undefined"!=typeof module&&module.exports?module.exports=h:"undefined"!=typeof define?define("eve",[],function(){return h}):a.eve=h}(this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return q?a():b.on("raphael.DOMload",a);if(c.is(a,Q))return c._engine.create[A](c,a.splice(0,3+c.is(a[0],P))).add(a);var d=Array.prototype.slice.call(arguments,0);if(c.is(d[d.length-1],"function")){var e=d.pop();return q?e.call(c._engine.create[A](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[A](c,d))})}return c._engine.create[A](c,arguments)}function d(a){if(Object(a)!==a)return a;var b,c=new a.constructor;for(b in a)a[v](b)&&(c[b]=d(a[b]));return c}function e(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("␀"),g=d.cache=d.cache||{},h=d.count=d.count||[];if(g[v](f)){a:for(var e=h,h=f,i=0,j=e.length;j>i;i++)if(e[i]===h){e.push(e.splice(i,1)[0]);break a}return c?c(g[f]):g[f]}return 1e3<=h.length&&delete g[h.shift()],h.push(f),g[f]=a[A](b,e),c?c(g[f]):g[f]}return d}function f(){return this.hex}function g(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function h(a,b,c,d,e,f,g,h,i){null==i&&(i=1),i=(i>1?1:0>i?0:i)/2;for(var j=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],k=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],l=0,m=0;12>m;m++)var n=i*j[m]+i,o=n*(n*(-3*a+9*c-9*e+3*g)+6*a-12*c+6*e)-3*a+3*c,n=n*(n*(-3*b+9*d-9*f+3*h)+6*b-12*d+6*f)-3*b+3*d,l=l+k[m]*J.sqrt(o*o+n*n);return i*l}function i(a,b,c,d,e,f,g,i,j){if(!(0>j||h(a,b,c,d,e,f,g,i)<j)){var k,l=.5,m=1-l;for(k=h(a,b,c,d,e,f,g,i,m);.01<M(k-j);)l/=2,m+=(j>k?1:-1)*l,k=h(a,b,c,d,e,f,g,i,m);return m}}function j(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,i,j,k,l,m,n,o,p=d?0:[],q=0,r=a.length;r>q;q++)if(n=a[q],"M"==n[0])e=j=n[1],f=k=n[2];else{"C"==n[0]?(n=[e,f].concat(n.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,j,k,j,k],e=j,f=k);for(var s=0,t=b.length;t>s;s++)if(o=b[s],"M"==o[0])g=l=o[1],i=m=o[2];else{"C"==o[0]?(o=[g,i].concat(o.slice(1)),g=o[6],i=o[7]):(o=[g,i,g,i,l,m,l,m],g=l,i=m);var u,v=n,w=o;u=d;var x=c.bezierBBox(v),y=c.bezierBBox(w);if(c.isBBoxIntersect(x,y)){for(var x=h.apply(0,v),y=h.apply(0,w),x=~~(x/5),y=~~(y/5),z=[],A=[],B={},C=u?0:[],D=0;x+1>D;D++){var E=c.findDotsAtSegment.apply(c,v.concat(D/x));z.push({x:E.x,y:E.y,t:D/x})}for(D=0;y+1>D;D++)E=c.findDotsAtSegment.apply(c,w.concat(D/y)),A.push({x:E.x,y:E.y,t:D/y});for(D=0;x>D;D++)for(v=0;y>v;v++){var F,G=z[D],H=z[D+1],w=A[v],E=A[v+1],I=.001>M(H.x-G.x)?"y":"x",J=.001>M(E.x-w.x)?"y":"x";F=G.x;var N=G.y,O=H.x,P=H.y,Q=w.x,R=w.y,S=E.x,T=E.y;if(K(F,O)<L(Q,S)||L(F,O)>K(Q,S)||K(N,P)<L(R,T)||L(N,P)>K(R,T))F=void 0;else{var U=(F*P-N*O)*(Q-S)-(F-O)*(Q*T-R*S),V=(F*P-N*O)*(R-T)-(N-P)*(Q*T-R*S),W=(F-O)*(R-T)-(N-P)*(Q-S);if(W){var U=U/W,V=V/W,W=+U.toFixed(2),X=+V.toFixed(2);F=W<+L(F,O).toFixed(2)||W>+K(F,O).toFixed(2)||W<+L(Q,S).toFixed(2)||W>+K(Q,S).toFixed(2)||X<+L(N,P).toFixed(2)||X>+K(N,P).toFixed(2)||X<+L(R,T).toFixed(2)||X>+K(R,T).toFixed(2)?void 0:{x:U,y:V}}else F=void 0}F&&B[F.x.toFixed(4)]!=F.y.toFixed(4)&&(B[F.x.toFixed(4)]=F.y.toFixed(4),G=G.t+M((F[I]-G[I])/(H[I]-G[I]))*(H.t-G.t),w=w.t+M((F[J]-w[J])/(E[J]-w[J]))*(E.t-w.t),G>=0&&1>=G&&w>=0&&1>=w&&(u?C++:C.push({x:F.x,y:F.y,t1:G,t2:w})))}u=C}else u=u?0:[];if(d)p+=u;else{for(x=0,y=u.length;y>x;x++)u[x].segment1=q,u[x].segment2=s,u[x].bez1=n,u[x].bez2=o;p=p.concat(u)}}}return p}function k(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.c=this.b=0,this.d=1,this.f=this.e=0)}function l(){return this.x+D+this.y+D+this.width+" × "+this.height}function m(a,b,c,d,e,f){function g(a,b){var c,d,e,f;for(e=a,d=0;8>d;d++){if(f=((j*e+i)*e+h)*e-a,M(f)<b)return e;if(c=(3*j*e+2*i)*e+h,1e-6>M(c))break;e-=f/c}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c&&(f=((j*e+i)*e+h)*e,!(M(f-a)<b));)a>f?c=e:d=e,e=(d-c)/2+c;return e}var h=3*b,i=3*(d-b)-h,j=1-h-i,k=3*c,l=3*(e-c)-k,m=1-k-l;return function(a,b){var c=g(a,b);return((m*c+l)*c+k)*c}(a,1/(200*f))}function n(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[v](e)&&(d[W(e)]=a[e],c.push(W(e)));c.sort(ga)}this.anim=d,this.top=c[c.length-1],this.percents=c}function o(a,d,e,f,g,h){e=W(e);var i,j,l,n,o,p,q=a.ms,r={},t={},u={};if(f)for(p=0,x=bb.length;x>p;p++){var w=bb[p];if(w.el.id==d.id&&w.anim==a){w.percent!=e?(bb.splice(p,1),l=1):j=w,d.attr(w.totalOrigin);break}}else f=+t;p=0;for(var x=a.percents.length;x>p;p++){if(a.percents[p]==e||a.percents[p]>f*a.top){e=a.percents[p],o=a.percents[p-1]||0,q=q/a.top*(e-o),n=a.percents[p+1],i=a.anim[e];break}f&&d.attr(a.anim[a.percents[p]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(var y in i)if(i[v](y)&&($[v](y)||d.paper.customAttributes[v](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=Z[y]),t[y]=i[y],$[y]){case P:u[y]=(t[y]-r[y])/q;break;case"colour":r[y]=c.getRGB(r[y]),p=c.getRGB(t[y]),u[y]={r:(p.r-r[y].r)/q,g:(p.g-r[y].g)/q,b:(p.b-r[y].b)/q};break;case"path":for(p=Ea(r[y],t[y]),w=p[1],r[y]=p[0],u[y]=[],p=0,x=r[y].length;x>p;p++){u[y][p]=[0];for(var z=1,A=r[y][p].length;A>z;z++)u[y][p][z]=(w[p][z]-r[y][p][z])/q}break;case"transform":if(p=d._,x=Ja(p[y],t[y]))for(r[y]=x.from,t[y]=x.to,u[y]=[],u[y].real=!0,p=0,x=r[y].length;x>p;p++)for(u[y][p]=[r[y][p][0]],z=1,A=r[y][p].length;A>z;z++)u[y][p][z]=(t[y][p][z]-r[y][p][z])/q;else x=d.matrix||new k,p={_:{transform:p.transform},getBBox:function(){return d.getBBox(1)}},r[y]=[x.a,x.b,x.c,x.d,x.e,x.f],Ha(p,t[y]),t[y]=p._.transform,u[y]=[(p.matrix.a-x.a)/q,(p.matrix.b-x.b)/q,(p.matrix.c-x.c)/q,(p.matrix.d-x.d)/q,(p.matrix.e-x.e)/q,(p.matrix.f-x.f)/q];break;case"csv":if(x=E(i[y])[F](s),w=E(r[y])[F](s),"clip-rect"==y)for(r[y]=w,u[y]=[],p=w.length;p--;)u[y][p]=(x[p]-r[y][p])/q;t[y]=x;break;default:for(x=[][B](i[y]),w=[][B](r[y]),u[y]=[],p=d.paper.customAttributes[y].length;p--;)u[y][p]=((x[p]||0)-(w[p]||0))/q}if(p=i.easing,y=c.easing_formulas[p],!y)if((y=E(p).match(U))&&5==y.length){var C=y;y=function(a){return m(a,+C[1],+C[2],+C[3],+C[4],q)}}else y=ia;if(p=i.start||a.start||+new Date,w={anim:a,percent:e,timestamp:p,start:p+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:q,easing:y,from:r,diff:u,to:t,el:d,callback:i.callback,prev:o,next:n,repeat:h||a.times,origin:d.attr(),totalOrigin:g},bb.push(w),f&&!j&&!l&&(w.stop=!0,w.start=new Date-q*f,1==bb.length))return db();l&&(w.start=new Date-w.ms*f),1==bb.length&&cb(db)}b("raphael.anim.start."+d.id,d,a)}}function p(a){for(var b=0;b<bb.length;b++)bb[b].el.paper==a&&bb.splice(b--,1)}c.version="2.1.0",c.eve=b;var q,r,s=/[, ]+/,t={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},u=/\{(\d+)\}/g,v="hasOwnProperty",w={doc:document,win:a},x=Object.prototype[v].call(w.win,"Raphael"),y=w.win.Raphael,z=function(){this.ca=this.customAttributes={}},A="apply",B="concat",C="ontouchstart"in w.win||w.win.DocumentTouch&&w.doc instanceof DocumentTouch,D=" ",E=String,F="split",G="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[F](D),H={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},I=E.prototype.toLowerCase,J=Math,K=J.max,L=J.min,M=J.abs,N=J.pow,O=J.PI,P="number",Q="array",R=Object.prototype.toString;c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var S=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,T={NaN:1,Infinity:1,"-Infinity":1},U=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,V=J.round,W=parseFloat,X=parseInt,Y=E.prototype.toUpperCase,Z=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Microsoft JhengHei"',"font-family":'"Microsoft JhengHei"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},$=c._availableAnimAttrs={blur:P,"clip-rect":"csv",cx:P,cy:P,fill:"colour","fill-opacity":P,"font-size":P,height:P,opacity:P,path:"path",r:P,rx:P,ry:P,stroke:"colour","stroke-opacity":P,"stroke-width":P,transform:"transform",width:P,x:P,y:P},_=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,aa={hs:1,rg:1},ba=/,?([achlmqrstvxz]),?/gi,ca=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,da=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ea=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi;c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/;var fa={},ga=function(a,b){return W(a)-W(b)},ha=function(){},ia=function(a){return a},ja=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},ka=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},la=c._getPath={path:function(a){return a.attr("path")},circle:function(a){return a=a.attrs,ka(a.cx,a.cy,a.r)},ellipse:function(a){return a=a.attrs,ka(a.cx,a.cy,a.rx,a.ry)},rect:function(a){return a=a.attrs,ja(a.x,a.y,a.width,a.height,a.r)},image:function(a){return a=a.attrs,ja(a.x,a.y,a.width,a.height)},text:function(a){return a=a._getBBox(),ja(a.x,a.y,a.width,a.height)},set:function(a){return a=a._getBBox(),ja(a.x,a.y,a.width,a.height)}},ma=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Ea(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=w,c.type=w.win.SVGAngle||w.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var na,oa=w.doc.createElement("div");if(oa.innerHTML='<v:shape adj="1"/>',na=oa.firstChild,na.style.behavior="url(#default#VML)",!na||"object"!=typeof na.adj)return c.type="";oa=null}c.svg=!(c.vml="VML"==c.type),c._Paper=z,c.fn=r=z.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return b=I.call(b),"finite"==b?!T[v](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||R.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){return null==f?(a-=d,b-=e,a||b?(180*J.atan2(-b,-a)/O+540)%360:0):c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*O/180},c.deg=function(a){return 180*a/O%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,Q)){for(var e=a.length;e--;)if(M(a[e]-b)<=d)return a[e]}else{if(a=+a,e=b%a,d>e)return b-e;if(e>a-d)return b-e+a}return b},c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*J.random()|0;return("x"==a?b:3&b|8).toString(16)}),c.setWindow=function(a){b("raphael.setWindow",c,w.win,a),w.win=a,w.doc=w.win.document,c._engine.initWin&&c._engine.initWin(w.win)};var pa=function(a){if(c.vml){var b,d=/^\s+|\s+$/g;try{var f=new ActiveXObject("htmlfile");f.write("<body>"),f.close(),b=f.body}catch(g){b=createPopup().document.body}var h=b.createTextRange();pa=e(function(a){try{b.style.color=E(a).replace(d,"");var c=h.queryCommandValue("ForeColor");return"#"+("000000"+((255&c)<<16|65280&c|(16711680&c)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=w.doc.createElement("i");i.title="Raphaël Colour Picker",i.style.display="none",w.doc.body.appendChild(i),pa=e(function(a){return i.style.color=a,w.doc.defaultView.getComputedStyle(i,"").getPropertyValue("color")})}return pa(a)},qa=function(){return"hsb("+[this.h,this.s,this.b]+")"},ra=function(){return"hsl("+[this.h,this.s,this.l]+")"},sa=function(){return this.hex},ta=function(a,b,d){return null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,"string")&&(d=c.getRGB(a),a=d.r,b=d.g,d=d.b),(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},ua=function(a,b,d,e){return a*=255,b*=255,d*=255,a={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:sa},c.is(e,"finite")&&(a.opacity=e),a};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=sa,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);var e,f,g;return a=360*a%360/60,g=c*b,b=g*(1-M(a%2-1)),c=e=f=c-g,a=~~a,c+=[g,b,0,0,b,g][a],e+=[b,g,g,b,0,0][a],f+=[0,0,b,g,g,b][a],ua(c,e,f,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100);var e,f,g;return a=360*a%360/60,g=2*b*(.5>c?c:1-c),b=g*(1-M(a%2-1)),c=e=f=c-g/2,a=~~a,c+=[g,b,0,0,b,g][a],e+=[b,g,g,b,0,0][a],f+=[0,0,b,g,g,b][a],ua(c,e,f,d)},c.rgb2hsb=function(a,b,c){c=ta(a,b,c),a=c[0],b=c[1],c=c[2];var d,e;return d=K(a,b,c),e=d-L(a,b,c),a=((0==e?0:d==a?(b-c)/e:d==b?(c-a)/e+2:(a-b)/e+4)+360)%6*60/360,{h:a,s:0==e?0:e/d,b:d,toString:qa}},c.rgb2hsl=function(a,b,c){c=ta(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f;return d=K(a,b,c),e=L(a,b,c),f=d-e,a=((0==f?0:d==a?(b-c)/f:d==b?(c-a)/f+2:(a-b)/f+4)+360)%6*60/360,d=(d+e)/2,{h:a,s:0==f?0:.5>d?f/(2*d):f/(2-2*d),l:d,toString:ra}},c._path2string=function(){return"undefined"==typeof this.path2stringCached&&(this.path2stringCached=this.join(",").replace(ba,"$1")),this.path2stringCached},c._preload=function(a,b){var c=w.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,w.doc.body.removeChild(this)},c.onerror=function(){w.doc.body.removeChild(this)},w.doc.body.appendChild(c),c.src=a},c.getRGB=e(function(a){if(!a||(a=E(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:f};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:f};!aa[v](a.toLowerCase().substring(0,2))&&"#"!=a.charAt()&&(a=pa(a));var b,d,e,g,h;return(a=a.match(S))?(a[2]&&(e=X(a[2].substring(5),16),d=X(a[2].substring(3,5),16),b=X(a[2].substring(1,3),16)),a[3]&&(e=X((h=a[3].charAt(3))+h,16),d=X((h=a[3].charAt(2))+h,16),b=X((h=a[3].charAt(1))+h,16)),a[4]&&(h=a[4][F](_),b=W(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),d=W(h[1]),"%"==h[1].slice(-1)&&(d*=2.55),e=W(h[2]),"%"==h[2].slice(-1)&&(e*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(g=W(h[3])),h[3]&&"%"==h[3].slice(-1)&&(g/=100)),a[5]?(h=a[5][F](_),b=W(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),d=W(h[1]),"%"==h[1].slice(-1)&&(d*=2.55),e=W(h[2]),"%"==h[2].slice(-1)&&(e*=2.55),"deg"!=h[0].slice(-3)&&"°"!=h[0].slice(-1)||(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(g=W(h[3])),h[3]&&"%"==h[3].slice(-1)&&(g/=100),c.hsb2rgb(b,d,e,g)):a[6]?(h=a[6][F](_),b=W(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),d=W(h[1]),"%"==h[1].slice(-1)&&(d*=2.55),e=W(h[2]),"%"==h[2].slice(-1)&&(e*=2.55),"deg"!=h[0].slice(-3)&&"°"!=h[0].slice(-1)||(b/=360),"hsla"==a[1].toLowerCase().slice(0,4)&&(g=W(h[3])),h[3]&&"%"==h[3].slice(-1)&&(g/=100),c.hsl2rgb(b,d,e,g)):(a={r:b,g:d,b:e,toString:f},a.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(g,"finite")&&(a.opacity=g),a)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:f}},c),c.hsb=e(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=e(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=e(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){a=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75};var b=this.hsb2rgb(a.h,a.s,a.b);return a.h+=.075,1<a.h&&(a.h=0,a.s-=.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b})),b.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=va(a);if(b.arr)return xa(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,Q)&&c.is(a[0],Q)&&(e=xa(a)),e.length||E(a).replace(ca,function(a,b,c){var f=[];if(a=b.toLowerCase(),c.replace(ea,function(a,b){b&&f.push(+b)}),"m"==a&&2<f.length&&(e.push([b][B](f.splice(0,2))),a="l",b="m"==b?"l":"L"),"r"==a)e.push([b][B](f));else for(;f.length>=d[a]&&(e.push([b][B](f.splice(0,d[a]))),d[a]););}),e.toString=c._path2string,b.arr=xa(e),e},c.parseTransformString=e(function(a){if(!a)return null;var b=[];return c.is(a,Q)&&c.is(a[0],Q)&&(b=xa(a)),b.length||E(a).replace(da,function(a,c,d){var e=[];I.call(c),d.replace(ea,function(a,b){b&&e.push(+b)}),b.push([c][B](e))}),b.toString=c._path2string,b});var va=function(a){var b=va.ps=va.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[v](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=N(j,3),l=N(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,k=k*b+3*l*i*d+3*j*i*i*f+n*h,l=a+2*i*(c-a)+m*(e-2*c+a),n=b+2*i*(d-b)+m*(f-2*d+b),p=c+2*i*(e-c)+m*(g-2*e+c),m=d+2*i*(f-d)+m*(h-2*f+d);return a=j*a+i*c,b=j*b+i*d,e=j*e+i*g,f=j*f+i*h,h=90-180*J.atan2(l-p,n-m)/O,(l>p||m>n)&&(h+=180),{x:o,y:k,m:{x:l,y:n},n:{x:p,y:m},start:{x:a,y:b},end:{x:e,y:f},alpha:h}},c.bezierBBox=function(a,b,d,e,f,g,h,i){return c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]),a=Da.apply(null,a),{x:a.min.x,y:a.min.y,x2:a.max.x,y2:a.max.y,width:a.max.x-a.min.x,height:a.max.y-a.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return j(a,b)},c.pathIntersectionNumber=function(a,b){return j(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&1==j(a,[["M",b,d],["H",e.x2+10]],1)%2},c._removedFactory=function(a){return function(){b("raphael.log",null,"Raphael: 您正使用方法： “"+a+"” 来删除对象",a)}};var wa=c.pathBBox=function(a){var b=va(a);if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Ea(a);for(var c,e=0,f=0,g=[],h=[],i=0,j=a.length;j>i;i++)c=a[i],"M"==c[0]?(e=c[1],f=c[2],g.push(e),h.push(f)):(e=Da(e,f,c[1],c[2],c[3],c[4],c[5],c[6]),g=g[B](e.min.x,e.max.x),h=h[B](e.min.y,e.max.y),e=c[5],f=c[6]);return a=L[A](0,g),c=L[A](0,h),g=K[A](0,g),h=K[A](0,h),i=g-a,j=h-c,h={x:a,y:c,x2:g,y2:h,width:i,height:j,cx:a+i/2,cy:c+j/2},b.bbox=d(h),h},xa=function(a){return a=d(a),a.toString=c._path2string,a},ya=c._pathToRelative=function(a){var b=va(a);if(b.rel)return xa(b.rel);c.is(a,Q)&&c.is(a&&a[0],Q)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=a.length;j>i;i++){var k=d[i]=[],l=a[i];if(l[0]!=I.call(l[0]))switch(k[0]=I.call(l[0]),k[0]){case"a":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]-e).toFixed(3),k[7]=+(l[7]-f).toFixed(3);break;case"v":k[1]=+(l[1]-f).toFixed(3);break;case"m":g=l[1],h=l[2];default:for(var m=1,n=l.length;n>m;m++)k[m]=+(l[m]-(m%2?e:f)).toFixed(3)}else for(d[i]=[],"m"==l[0]&&(g=l[1]+e,h=l[2]+f),k=0,m=l.length;m>k;k++)d[i][k]=l[k];switch(l=d[i].length,d[i][0]){case"z":e=g,f=h;break;case"h":e+=+d[i][l-1];break;case"v":f+=+d[i][l-1];break;default:e+=+d[i][l-2],f+=+d[i][l-1]}}return d.toString=c._path2string,b.rel=xa(d),d},za=c._pathToAbsolute=function(a){var b=va(a);if(b.abs)return xa(b.abs);if(c.is(a,Q)&&c.is(a&&a[0],Q)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,h=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],h=e,i=f,j++,d[0]=["M",e,f]);for(var k,l=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),m=j,n=a.length;n>m;m++){if(d.push(j=[]),k=a[m],k[0]!=Y.call(k[0]))switch(j[0]=Y.call(k[0]),j[0]){case"A":j[1]=k[1],j[2]=k[2],j[3]=k[3],j[4]=k[4],j[5]=k[5],j[6]=+(k[6]+e),j[7]=+(k[7]+f);break;case"V":j[1]=+k[1]+f;break;case"H":j[1]=+k[1]+e;break;case"R":for(var o=[e,f][B](k.slice(1)),p=2,q=o.length;q>p;p++)o[p]=+o[p]+e,o[++p]=+o[p]+f;d.pop(),d=d[B](g(o,l));break;case"M":h=+k[1]+e,i=+k[2]+f;default:for(p=1,q=k.length;q>p;p++)j[p]=+k[p]+(p%2?e:f)}else if("R"==k[0])o=[e,f][B](k.slice(1)),d.pop(),d=d[B](g(o,l)),j=["R"][B](k.slice(-2));else for(o=0,p=k.length;p>o;o++)j[o]=k[o];switch(j[0]){case"Z":e=h,f=i;break;case"H":e=j[1];break;case"V":f=j[1];break;case"M":h=j[j.length-2],i=j[j.length-1];default:e=j[j.length-2],f=j[j.length-1]}}return d.toString=c._path2string,b.abs=xa(d),d},Aa=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Ba=function(a,b,c,d,f,g,h,i,j,k){var l,m=120*O/180,n=O/180*(+f||0),o=[],p=e(function(a,b,c){var d=a*J.cos(c)-b*J.sin(c);return a=a*J.sin(c)+b*J.cos(c),{x:d,y:a}});if(k)s=k[0],l=k[1],g=k[2],q=k[3];else{l=p(a,b,-n),a=l.x,b=l.y,l=p(i,j,-n),i=l.x,j=l.y,J.cos(O/180*f),J.sin(O/180*f),l=(a-i)/2,s=(b-j)/2,q=l*l/(c*c)+s*s/(d*d),q>1&&(q=J.sqrt(q),c*=q,d*=q);var q=c*c,r=d*d,q=(g==h?-1:1)*J.sqrt(M((q*r-q*s*s-r*l*l)/(q*s*s+r*l*l)));g=q*c*s/d+(a+i)/2;var q=q*-d*l/c+(b+j)/2,s=J.asin(((b-q)/d).toFixed(9));l=J.asin(((j-q)/d).toFixed(9)),s=g>a?O-s:s,l=g>i?O-l:l,0>s&&(s=2*O+s),0>l&&(l=2*O+l),h&&s>l&&(s-=2*O),!h&&l>s&&(l-=2*O)}if(M(l-s)>m){var o=l,r=i,t=j;l=s+m*(h&&l>s?1:-1),i=g+c*J.cos(l),j=q+d*J.sin(l),o=Ba(i,j,c,d,f,0,h,r,t,[l,o,g,q])}if(g=l-s,f=J.cos(s),m=J.sin(s),h=J.cos(l),l=J.sin(l),g=J.tan(g/4),c=4/3*c*g,g*=4/3*d,d=[a,b],a=[a+c*m,b-g*f],b=[i+c*l,j-g*h],i=[i,j],a[0]=2*d[0]-a[0],a[1]=2*d[1]-a[1],k)return[a,b,i][B](o);for(o=[a,b,i][B](o).join()[F](","),k=[],i=0,j=o.length;j>i;i++)k[i]=i%2?p(o[i-1],o[i],n).y:p(o[i],o[i+1],n).x;return k},Ca=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:N(j,3)*a+3*N(j,2)*i*c+3*j*i*i*e+N(i,3)*g,y:N(j,3)*b+3*N(j,2)*i*d+3*j*i*i*f+N(i,3)*h}},Da=e(function(a,b,c,d,e,f,g,h){var i=e-2*c+a-(g-2*e+c),j=2*(c-a)-2*(e-c),k=a-c,l=(-j+J.sqrt(j*j-4*i*k))/2/i,i=(-j-J.sqrt(j*j-4*i*k))/2/i,m=[b,h],n=[a,g];return"1e12"<M(l)&&(l=.5),"1e12"<M(i)&&(i=.5),l>0&&1>l&&(l=Ca(a,b,c,d,e,f,g,h,l),n.push(l.x),m.push(l.y)),i>0&&1>i&&(l=Ca(a,b,c,d,e,f,g,h,i),n.push(l.x),m.push(l.y)),i=f-2*d+b-(h-2*f+d),j=2*(d-b)-2*(f-d),k=b-d,l=(-j+J.sqrt(j*j-4*i*k))/2/i,i=(-j-J.sqrt(j*j-4*i*k))/2/i,"1e12"<M(l)&&(l=.5),"1e12"<M(i)&&(i=.5),l>0&&1>l&&(l=Ca(a,b,c,d,e,f,g,h,l),n.push(l.x),m.push(l.y)),i>0&&1>i&&(l=Ca(a,b,c,d,e,f,g,h,i),n.push(l.x),m.push(l.y)),{min:{x:L[A](0,n),y:L[A](0,m)},max:{x:K[A](0,n),y:K[A](0,m)}}}),Ea=c._path2curve=e(function(a,b){var c=!b&&va(a);if(!b&&c.curve)return xa(c.curve);for(var d=za(a),e=b&&za(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(a[0]in{T:1,Q:1}||(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][B](Ba[A](0,[b.x,b.y][B](a.slice(1))));break;case"S":c=b.x+(b.x-(b.bx||b.x)),d=b.y+(b.y-(b.by||b.y)),a=["C",c,d][B](a.slice(1));break;case"T":b.qx=b.x+(b.x-(b.qx||b.x)),b.qy=b.y+(b.y-(b.qy||b.y)),
a=["C"][B](Aa(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][B](Aa(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][B]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case"H":a=["C"][B]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case"V":a=["C"][B]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case"Z":a=["C"][B]([b.x,b.y,b.X,b.Y,b.X,b.Y])}return a}),i=function(a,b){if(7<a[b].length){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][B](c.splice(0,6)));a.splice(b,1),l=K(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=K(d.length,e&&e.length||0))},k=0,l=K(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=W(m[o-4])||f.x,f.by=W(m[o-3])||f.y,g.bx=e&&(W(n[p-4])||g.x),g.by=e&&(W(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=xa(d)),e?[d,e]:d},null,xa);c._parseDots=e(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(a=W(b[d-1].offset||0),g=0,f=d+1;e>f;f++)if(b[f].offset){g=b[f].offset;break}for(g||(g=100,f=e),g=W(g),g=(g-a)/(f-d+1);f>d;d++)a+=g,b[d].offset=a+"%"}return b});var Fa=c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)};c._tofront=function(a,b){b.top!==a&&(Fa(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Fa(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Fa(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Fa(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b};var Ga=c.toMatrix=function(a,b){var c=wa(a),d={_:{transform:""},getBBox:function(){return c}};return Ha(d,b),d.matrix};c.transformPath=function(a,b){return ma(a,Ga(a,b))};var Ha=c._extractTransform=function(a,b){if(null==b)return a._.transform;b=E(b).replace(/\.{3}|\u2026/g,a._.transform||"");var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,g=new k;if(j.transform=d||[],d)for(var f=0,l=d.length;l>f;f++){var m,n=d[f],o=n.length,p=E(n[0]).toLowerCase(),q=n[0]!=p,r=q?g.invert():0;"t"==p&&3==o?q?(o=r.x(0,0),p=r.y(0,0),q=r.x(n[1],n[2]),r=r.y(n[1],n[2]),g.translate(q-o,r-p)):g.translate(n[1],n[2]):"r"==p?2==o?(m=m||a.getBBox(1),g.rotate(n[1],m.x+m.width/2,m.y+m.height/2),e+=n[1]):4==o&&(q?(q=r.x(n[2],n[3]),r=r.y(n[2],n[3]),g.rotate(n[1],q,r)):g.rotate(n[1],n[2],n[3]),e+=n[1]):"s"==p?2==o||3==o?(m=m||a.getBBox(1),g.scale(n[1],n[o-1],m.x+m.width/2,m.y+m.height/2),h*=n[1],i*=n[o-1]):5==o&&(q?(q=r.x(n[3],n[4]),r=r.y(n[3],n[4]),g.scale(n[1],n[2],q,r)):g.scale(n[1],n[2],n[3],n[4]),h*=n[1],i*=n[2]):"m"==p&&7==o&&g.add(n[1],n[2],n[3],n[4],n[5],n[6]),j.dirtyT=1,a.matrix=g}a.matrix=g,j.sx=h,j.sy=i,j.deg=e,j.dx=f=g.e,j.dy=g=g.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1},Ia=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Ja=c._equaliseTransform=function(a,b){b=E(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var d,e,f,g,h=K(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ia(b[k]),g=b[k]||Ia(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=K(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return f=null!=e||c.is(a,"object")?a:w.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=ya,c._engine={},c.path2curve=Ea,c.matrix=function(a,b,c,d,e,f){return new k(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=J.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];for(b=[[a,c,e],[b,d,f],[0,0,1]],a&&a instanceof k&&(b=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),a=0;3>a;a++)for(c=0;3>c;c++){for(d=e=0;3>d;d++)e+=h[a][d]*b[d][c];g[a][c]=e}this.a=g[0][0],this.b=g[1][0],this.c=g[0][1],this.d=g[1][1],this.e=g[0][2],this.f=g[1][2]},a.invert=function(){var a=this.a*this.d-this.b*this.c;return new k(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)},a.clone=function(){return new k(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+J.cos(a).toFixed(9);a=+J.sin(a).toFixed(9),this.add(e,a,-a,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[E.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=J.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=J.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],e=e[1][1];return 0>e?(a.rotate=c.deg(J.acos(e)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(J.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){return a=a||this[F](),a.isSimple?(a.scalex=+a.scalex.toFixed(4),a.scaley=+a.scaley.toFixed(4),a.rotate=+a.rotate.toFixed(4),(a.dx||a.dy?"t"+[a.dx,a.dy]:"")+(1!=a.scalex||1!=a.scaley?"s"+[a.scalex,a.scaley,0,0]:"")+(a.rotate?"r"+[a.rotate,0,0]:"")):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(k.prototype);var Ka=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Ka&&4>Ka[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Ka&&8>Ka[1]?r.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:r.safari=ha;for(var La=function(){this.returnValue=!1},Ma=function(){return this.originalEvent.preventDefault()},Na=function(){this.cancelBubble=!0},Oa=function(){return this.originalEvent.stopPropagation()},Pa=function(a){return{x:a.clientX+(w.doc.documentElement.scrollLeft||w.doc.body.scrollLeft),y:a.clientY+(w.doc.documentElement.scrollTop||w.doc.body.scrollTop)}},Qa=function(){return w.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Pa(a);return c.call(d,a,b.x,b.y)};return a.addEventListener(b,e,!1),C&&H[b]&&a.addEventListener(H[b],function(b){for(var e=Pa(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g],b.originalEvent=f,b.preventDefault=Ma,b.stopPropagation=Oa;break}return c.call(d,b,e.x,e.y)},!1),function(){return a.removeEventListener(b,e,!1),C&&H[b]&&a.removeEventListener(H[b],e,!1),!0}}:w.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||w.win.event;var b=a.clientX+(w.doc.documentElement.scrollLeft||w.doc.body.scrollLeft),e=a.clientY+(w.doc.documentElement.scrollTop||w.doc.body.scrollTop);return a.preventDefault=a.preventDefault||La,a.stopPropagation=a.stopPropagation||Na,c.call(d,a,b,e)};return a.attachEvent("on"+b,e),function(){return a.detachEvent("on"+b,e),!0}}:void 0}(),Ra=[],Sa=function(a){for(var c,d=a.clientX,e=a.clientY,f=w.doc.documentElement.scrollTop||w.doc.body.scrollTop,g=w.doc.documentElement.scrollLeft||w.doc.body.scrollLeft,h=Ra.length;h--;){if(c=Ra[h],C&&a.touches){for(var i,j=a.touches.length;j--;)if(i=a.touches[j],i.identifier==c.el._drag.id){d=i.clientX,e=i.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var j=c.el.node,k=j.nextSibling,l=j.parentNode,m=j.style.display;w.win.opera&&l.removeChild(j),j.style.display="none",i=c.el.paper.getElementByPoint(d,e),j.style.display=m,w.win.opera&&(k?l.insertBefore(j,k):l.appendChild(j)),i&&b("raphael.drag.over."+c.el.id,c.el,i),d+=g,e+=f,b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Ta=function(a){c.unmousemove(Sa).unmouseup(Ta);for(var d,e=Ra.length;e--;)d=Ra[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Ra=[]},Ua=c.el={},Va=G.length;Va--;)!function(a){c[a]=Ua[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Qa(this.shape||this.node||w.doc,a,b,d||this)})),this},c["un"+a]=Ua["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(G[Va]);Ua.data=function(a,d){var e=fa[this.id]=fa[this.id]||{};if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[v](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},Ua.removeData=function(a){return null==a?fa[this.id]={}:fa[this.id]&&delete fa[this.id][a],this},Ua.getData=function(){return d(fa[this.id]||{})},Ua.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},Ua.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var Wa=[];Ua.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var j=w.doc.documentElement.scrollTop||w.doc.body.scrollTop,k=w.doc.documentElement.scrollLeft||w.doc.body.scrollLeft;this._drag.x=i.clientX+k,this._drag.y=i.clientY+j,this._drag.id=i.identifier,!Ra.length&&c.mousemove(Sa).mouseup(Ta),Ra.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+k,i.clientY+j,i)}return this._drag={},Wa.push({el:this,start:i}),this.mousedown(i),this},Ua.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},Ua.undrag=function(){for(var a=Wa.length;a--;)Wa[a].el==this&&(this.unmousedown(Wa[a].start),Wa.splice(a,1),b.unbind("raphael.drag.*."+this.id));!Wa.length&&c.unmousemove(Sa).unmouseup(Ta)},r.circle=function(a,b,d){return a=c._engine.circle(this,a||0,b||0,d||0),this.__set__&&this.__set__.push(a),a},r.rect=function(a,b,d,e,f){return a=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0),this.__set__&&this.__set__.push(a),a},r.rectBb=function(a,b,d,e,f){return a=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0),this.__set__&&this.__set__.push(a),a},r.ellipse=function(a,b,d,e){return a=c._engine.ellipse(this,a||0,b||0,d||0,e||0),this.__set__&&this.__set__.push(a),a},r.path=function(a){a&&!c.is(a,"string")&&!c.is(a[0],Q)&&(a+="");var b=c._engine.path(c.format[A](c,arguments),this);return this.__set__&&this.__set__.push(b),b},r.pathBb=function(a){a&&!c.is(a,"string")&&!c.is(a[0],Q)&&(a+="");var b=c._engine.path(c.format[A](c,arguments),this,!0);return this.__set__&&this.__set__.push(b),b},r.image=function(a,b,d,e,f){return a=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0),this.__set__&&this.__set__.push(a),a},r.imageBb=function(a,b,d,e,f){return a=c._engine.imageBb(this,a||"about:blank",b||0,d||0,e||0,f||0),this.__set__&&this.__set__.push(a),a},r.text=function(a,b,d){return a=c._engine.text(this,a||0,b||0,E(d)),this.__set__&&this.__set__.push(a),a},r.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new fb(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},r.setStart=function(a){this.__set__=a||this.set()},r.setFinish=function(a){return a=this.__set__,delete this.__set__,a},r.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},r.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},r.top=r.bottom=null,r.raphael=c,r.getElementByPoint=function(a,b){var c,d,e=this.canvas,f=w.doc.elementFromPoint(a,b);if(w.win.opera&&"svg"==f.tagName){d=e.getBoundingClientRect(),c=e.ownerDocument;var g=c.body,h=c.documentElement;c=d.top+(w.win.pageYOffset||h.scrollTop||g.scrollTop)-(h.clientTop||g.clientTop||0),d=d.left+(w.win.pageXOffset||h.scrollLeft||g.scrollLeft)-(h.clientLeft||g.clientLeft||0),g=e.createSVGRect(),g.x=a-d,g.y=b-c,g.width=g.height=1,c=e.getIntersectionList(g,null),c.length&&(f=c[c.length-1])}if(!f)return null;for(;f.parentNode&&f!=e.parentNode&&!f.raphael;)f=f.parentNode;return f==this.canvas.parentNode&&(f=e),f=f&&f.raphael?this.getById(f.raphaelid):null},r.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},r.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},r.forEach=function(a,b){for(var c=this.bottom;c&&!1!==a.call(b,c);)c=c.next;return this},r.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},Ua.isPointInside=function(a,b){var d=this.realPath=this.realPath||la[this.type](this);return c.isPointInsidePath(d,a,b)},Ua.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=la[this.type](this),b.bboxwt=wa(this.realPath),b.bboxwt.toString=l,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=la[this.type](this)),b.bbox=wa(ma(this.realPath,this.matrix)),b.bbox.toString=l,b.dirty=b.dirtyT=0),b.bbox)},Ua.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},Ua.glow=function(a){if("text"==this.type)return null;a=a||{};var b=(a.width||10)+(+this.attr("stroke-width")||1),c=a.fill||!1,d=a.opacity||.5,e=a.offsetx||0,f=a.offsety||0;a=a.color||"#000";for(var g=b/2,h=this.paper,i=h.set(),j=this.realPath||la[this.type](this),j=this.matrix?ma(j,this.matrix):j,k=1;g+1>k;k++)i.push(h.path(j).attr({stroke:a,fill:c?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/g*k).toFixed(3),opacity:+(d/g).toFixed(3)}));return i.insertBefore(this).translate(e,f)};var Xa=function(a,b,d,e,f,g,j,k,l){return null==l?h(a,b,d,e,f,g,j,k):c.findDotsAtSegment(a,b,d,e,f,g,j,k,i(a,b,d,e,f,g,j,k,l))},Ya=function(a,b){return function(d,e,f){d=Ea(d);for(var g,h,i,j,k="",l={},m=0,n=0,o=d.length;o>n;n++){if(i=d[n],"M"==i[0])g=+i[1],h=+i[2];else{if(j=Xa(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),m+j>e){if(b&&!l.start){if(g=Xa(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-m),k+=["C"+g.start.x,g.start.y,g.m.x,g.m.y,g.x,g.y],f)return k;l.start=k,k=["M"+g.x,g.y+"C"+g.n.x,g.n.y,g.end.x,g.end.y,i[5],i[6]].join(),m+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return g=Xa(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-m),{x:g.x,y:g.y,alpha:g.alpha}}m+=j,g=+i[5],h=+i[6]}k+=i.shift()+i}return l.end=k,g=a?m:b?l:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),g.alpha&&(g={x:g.x,y:g.y,alpha:g.alpha}),g}},Za=Ya(1),$a=Ya(),_a=Ya(0,1);c.getTotalLength=Za,c.getPointAtLength=$a,c.getSubpath=function(a,b,c){return 1e-6>this.getTotalLength(a)-c?_a(a,b).end:(a=_a(a,c,1),b?_a(a,b).end:a)},Ua.getTotalLength=function(){return"path"==this.type?this.node.getTotalLength?this.node.getTotalLength():Za(this.attrs.path):void 0},Ua.getPointAtLength=function(a){return"path"==this.type?$a(this.attrs.path,a):void 0},Ua.getSubpath=function(a,b){return"path"==this.type?c.getSubpath(this.attrs.path,a,b):void 0};var ab=c.easing_formulas={linear:function(a){return a},"<":function(a){return N(a,1.7)},">":function(a){return N(a,.48)},"<>":function(a){var b=.48-a/1.04,c=J.sqrt(.1734+b*b);return a=c-b,a=N(M(a),1/3)*(0>a?-1:1),b=-c-b,b=N(M(b),1/3)*(0>b?-1:1),a=a+b+.5,3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){return a-=1,a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==!!a?a:N(2,-10*a)*J.sin(2*(a-.075)*O/.3)+1},bounce:function(a){return 1/2.75>a?a*=7.5625*a:2/2.75>a?(a-=1.5/2.75,a=7.5625*a*a+.75):2.5/2.75>a?(a-=2.25/2.75,a=7.5625*a*a+.9375):(a-=2.625/2.75,a=7.5625*a*a+.984375),a}};ab.easeIn=ab["ease-in"]=ab["<"],ab.easeOut=ab["ease-out"]=ab[">"],ab.easeInOut=ab["ease-in-out"]=ab["<>"],ab["back-in"]=ab.backIn,ab["back-out"]=ab.backOut;var bb=[],cb=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},db=function(){for(var a=+new Date,d=0;d<bb.length;d++){var e=bb[d];if(!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=e.el,p={},q={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,e.status=e.initstatus,delete e.initstatus,e.stop&&bb.splice(d--,1)):e.status=(e.prev+h/i*(e.percent-e.prev))/e.anim.top,!(0>h))if(i>h){var r,s=j(h/i);for(r in k)if(k[v](r)){switch($[r]){case P:f=+k[r]+s*i*l[r];break;case"colour":f="rgb("+[eb(V(k[r].r+s*i*l[r].r)),eb(V(k[r].g+s*i*l[r].g)),eb(V(k[r].b+s*i*l[r].b))].join()+")";break;case"path":for(f=[],h=0,j=k[r].length;j>h;h++){for(f[h]=[k[r][h][0]],m=1,q=k[r][h].length;q>m;m++)f[h][m]=+k[r][h][m]+s*i*l[r][h][m];f[h]=f[h].join(D)}f=f.join(D);break;case"transform":if(l[r].real)for(f=[],h=0,j=k[r].length;j>h;h++)for(f[h]=[k[r][h][0]],m=1,q=k[r][h].length;q>m;m++)f[h][m]=k[r][h][m]+s*i*l[r][h][m];else f=function(a){return+k[r][a]+s*i*l[r][a]},f=[["m",f(0),f(1),f(2),f(3),f(4),f(5)]];break;case"csv":if("clip-rect"==r)for(f=[],h=4;h--;)f[h]=+k[r][h]+s*i*l[r][h];break;default:for(j=[][B](k[r]),f=[],h=n.paper.customAttributes[r].length;h--;)f[h]=+j[h]+s*i*l[r][h]}p[r]=f}n.attr(p),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),bb.splice(d--,1),1<e.repeat&&!e.next){for(g in m)m[v](g)&&(q[g]=e.totalOrigin[g]);e.el.attr(q),o(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&o(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),bb.length&&cb(db)},eb=function(a){return a>255?255:0>a?0:a};Ua.animateWith=function(a,b,d,e,f,g){if(this.removed)return g&&g.call(this),this;for(d=d instanceof n?d:c.animation(d,e,f,g),o(d,this,d.percents[0],null,this.attr()),d=0,e=bb.length;e>d;d++)if(bb[d].anim==b&&bb[d].el==a){bb[e-1].start=bb[d].start;break}return this},Ua.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},n.prototype.delay=function(a){var b=new n(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},n.prototype.repeat=function(a){var b=new n(this.anim,this.ms);return b.del=this.del,b.times=J.floor(K(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof n)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[v](g)&&W(g)!=g&&W(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new n({100:h},b)):new n(a,b)},Ua.animate=function(a,b,d,e){return this.removed?(e&&e.call(this),this):(a=a instanceof n?a:c.animation(a,b,d,e),o(a,this,a.percents[0],null,this.attr()),this)},Ua.setTime=function(a,b){return a&&null!=b&&this.status(a,L(b,a.ms)/a.ms),this},Ua.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return o(a,this,-1,L(b,1)),this;for(c=bb.length;c>f;f++)if(d=bb[f],d.el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e},Ua.pause=function(a){for(var c=0;c<bb.length;c++)bb[c].el.id!=this.id||a&&bb[c].anim!=a||!1===b("raphael.anim.pause."+this.id,this,bb[c].anim)||(bb[c].paused=!0);return this},Ua.resume=function(a){for(var c=0;c<bb.length;c++)if(bb[c].el.id==this.id&&(!a||bb[c].anim==a)){var d=bb[c];!1!==b("raphael.anim.resume."+this.id,this,d.anim)&&(delete d.paused,this.status(d.anim,d.status))}return this},Ua.stop=function(a){for(var c=0;c<bb.length;c++)bb[c].el.id!=this.id||a&&bb[c].anim!=a||!1!==b("raphael.anim.stop."+this.id,this,bb[c].anim)&&bb.splice(c--,1);return this},b.on("raphael.remove",p),b.on("raphael.clear",p),Ua.toString=function(){return"Raphaël’s object"};var fb=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=Ua.constructor&&a[b].constructor!=fb||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},gb=fb.prototype;gb.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)!(a=arguments[c])||a.constructor!=Ua.constructor&&a.constructor!=fb||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},gb.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},gb.forEach=function(a,b){for(var c=0,d=this.items.length;d>c&&!1!==a.call(b,this.items[c],c);c++);return this};for(var hb in Ua)Ua[v](hb)&&(gb[hb]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][A](c,b)})}}(hb));return gb.attr=function(a,b){if(a&&c.is(a,Q)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(d=0,e=this.items.length;e>d;d++)this.items[d].attr(a,b);return this},gb.clear=function(){for(;this.length;)this.pop()},gb.splice=function(a,b,c){a=0>a?K(this.length+a,0):a,b=K(0,L(this.length-a,b));var d,e=[],f=[],g=[];for(d=2;d<arguments.length;d++)g.push(arguments[d]);for(d=0;b>d;d++)f.push(this[a+d]);for(;d<this.length-a;d++)e.push(this[a+d]);var h=g.length;for(d=0;d<h+e.length;d++)this.items[a+d]=this[a+d]=h>d?g[d]:e[d-h];for(d=this.items.length=this.length-=b-h;this[d];)delete this[d++];return new fb(f)},gb.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},gb.animate=function(a,b,d,e){!c.is(d,"function")&&d||(e=d||null);var f,g=this.items.length,h=g,i=this;if(!g)return this;for(e&&(f=function(){!--g&&e.call(i)}),d=c.is(d,"string")?d:f,b=c.animation(a,b,d,f),a=this.items[--h].animate(b);h--;)this.items[h]&&!this.items[h].removed&&this.items[h].animateWith(a,b,b);return this},gb.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},gb.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=L[A](0,a),b=L[A](0,b),c=K[A](0,c),d=K[A](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},gb.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},gb.toString=function(){return"Raphaël‘s set"},gb.glow=function(a){var b=this.paper.set();return this.forEach(function(c,d){var e=c.glow(a);null!=e&&e.forEach(function(a,c){b.push(a)})}),b},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b,c={w:a.w,face:{},glyphs:{}},d=a.face["font-family"];for(b in a.face)a.face[v](b)&&(c.face[b]=a.face[b]);if(this.fonts[d]=[c],!a.svg){c.face["units-per-em"]=X(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[v](e)&&(d=a.glyphs[e],c.glyphs[e]={w:d.w,k:{},d:d.d&&"M"+d.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},d.k))for(var f in d.k)d[v](f)&&(c.glyphs[e].k[f]=d.k[f])}return a},r.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i");for(var g in c.fonts)if(c.fonts[v](g)&&a.test(g)){f=c.fonts[g];break}}var h;if(f){for(g=0,a=f.length;a>g&&(h=f[g],h.face["font-weight"]!=b||h.face["font-style"]!=d&&h.face["font-style"]||h.face["font-stretch"]!=e);g++);f.splice(0,f.length-1),h=f[0]}return h}},r.print=function(a,b,d,e,f,g,h,i){g=g||"middle",h=K(L(h||0,1),-1),i=K(L(i||1,3),1),d=E(d)[F]("");var j=0,k=0,l="";if(c.is(e,"string")&&(e=this.getFont(e)),e){f=(f||16)/e.face["units-per-em"];var m=e.face.bbox[F](s),n=+m[0],o=m[3]-m[1],p=0;g=+m[1]+("baseline"==g?o+ +e.face.descent:o/2);for(var m=0,q=d.length;q>m;m++){if("\n"==d[m])k=t=j=0,p+=o*i;else var r=k&&e.glyphs[d[m-1]]||{},t=e.glyphs[d[m]],j=j+(k?(r.w||e.w)+(r.k&&r.k[d[m]]||0)+e.w*h:0),k=1;t&&t.d&&(l+=c.transformPath(t.d,["t",j*f,p*f,"s",f,f,n,g,"t",(a-n)/f,(b-g)/f]))}}return this.path(l).attr({fill:"#000",stroke:"none"})},r.printBb=function(a,b,d,e,f,g,h,i){g=g||"middle",h=K(L(h||0,1),-1),i=K(L(i||1,3),1),d=E(d)[F]("");var j=0,k=0,l="";if(c.is(e,"string")&&(e=this.getFont(e)),e){f=(f||16)/e.face["units-per-em"];var m=e.face.bbox[F](s),n=+m[0],o=m[3]-m[1],p=0;g=+m[1]+("baseline"==g?o+ +e.face.descent:o/2);for(var m=0,q=d.length;q>m;m++){if("\n"==d[m])k=t=j=0,p+=o*i;else var r=k&&e.glyphs[d[m-1]]||{},t=e.glyphs[d[m]],j=j+(k?(r.w||e.w)+(r.k&&r.k[d[m]]||0)+e.w*h:0),k=1;t&&t.d&&(l+=c.transformPath(t.d,["t",j*f,p*f,"s",f,f,n,g,"t",(a-n)/f,(b-g)/f]))}}return this.pathBb(l).attr({fill:"#000",stroke:"none"})},r.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},t[v](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,Q)?[0][B](b):arguments;return a&&c.is(a,"string")&&d.length-1&&(a=a.replace(u,function(a,b){return null==d[++b]?"":d[b]})),a||""},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return x?w.win.Raphael=y:delete Raphael,c},c.st=gb,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){q=!0}),function(){if(c.svg){var a=String,b=parseFloat,d=parseInt,e=Math,f=e.max,g=e.abs,h=e.pow,i=/[, ]+/,j=c.eve,k={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},l={};c.toString=function(){return"您的浏览器支持 SVG.\n可以运行 Raphael "+this.version};var m=function(b,d){if(d){"string"==typeof b&&(b=m(b));for(var e in d)d.hasOwnProperty(e)&&("xlink:"==e.substring(0,6)?b.setAttributeNS("http://www.w3.org/1999/xlink",e.substring(6),a(d[e])):"xmlns"==e?b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"):"xmlns:xlink"==e?b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"):b.setAttribute(e,a(d[e])))}else b=c._g.doc.createElementNS("http://www.w3.org/2000/svg",b),b.style&&(b.style.webkitTapHighlightColor="rgba(0,0,0,0)");return b},n=function(d,i){var j="linear",k=d.id+i,l=.5,n=.5,o=d.node,p=d.paper,q=o.style,r=c._g.doc.getElementById(k);if(!r){if(i=a(i).replace(c._radial_gradient,function(a,c,d){return j="radial",c&&d&&(l=b(c),n=b(d),a=2*(n>.5)-1,.25<h(l-.5,2)+h(n-.5,2)&&(n=e.sqrt(.25-h(l-.5,2))*a+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*a)),""}),i=i.split(/\s*\-\s*/),"linear"==j){if(r=i.shift(),r=-b(r),isNaN(r))return null;var s=[0,0,e.cos(c.rad(r)),e.sin(c.rad(r))],r=1/(f(g(s[2]),g(s[3]))||1);s[2]*=r,s[3]*=r,0>s[2]&&(s[0]=-s[2],s[2]=0),0>s[3]&&(s[1]=-s[3],s[3]=0)}var t=c._parseDots(i);if(!t)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),d.gradient&&k!=d.gradient.id&&(p.defs.removeChild(d.gradient),delete d.gradient),!d.gradient)for(r=m(j+"Gradient",{id:k}),d.gradient=r,m(r,"radial"==j?{fx:l,fy:n}:{x1:s[0],y1:s[1],x2:s[2],y2:s[3],gradientTransform:d.matrix.invert()}),p.defs.appendChild(r),p=0,s=t.length;s>p;p++)r.appendChild(m("stop",{offset:t[p].offset?t[p].offset:p?"100%":"0%","stop-color":t[p].color||"#fff"}))}return m(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),q.fill="",q.opacity=1,q.fillOpacity=1},o=function(a){var b=a.getBBox(1);m(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},p=function(b,d,e){if("path"==b.type){for(var f,g,h=a(d).toLowerCase().split("-"),i=b.paper,j=e?"end":"start",n=b.node,o=b.attrs,p=o["stroke-width"],q=h.length,r="classic",s=3,t=3,u=5;q--;)switch(h[q]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":r=h[q];break;case"wide":t=5;break;case"narrow":t=2;break;case"long":s=5;break;case"short":s=2}if("open"==r?(s+=2,t+=2,u+=2,f=1,g=e?4:1,h={fill:"none",stroke:o.stroke}):(g=f=s/2,h={fill:o.stroke,stroke:"none"}),b._.arrows?e?(b._.arrows.endPath&&l[b._.arrows.endPath]--,b._.arrows.endMarker&&l[b._.arrows.endMarker]--):(b._.arrows.startPath&&l[b._.arrows.startPath]--,b._.arrows.startMarker&&l[b._.arrows.startMarker]--):b._.arrows={},"none"!=r){var q="raphael-marker-"+r,v="raphael-marker-"+j+r+s+t;c._g.doc.getElementById(q)?l[q]++:(i.defs.appendChild(m(m("path"),{"stroke-linecap":"round",d:k[r],id:q})),l[q]=1);var w=c._g.doc.getElementById(v);w?(l[v]++,s=w.getElementsByTagName("use")[0]):(w=m(m("marker"),{id:v,markerHeight:t,markerWidth:s,orient:"auto",refX:g,refY:t/2}),s=m(m("use"),{"xlink:href":"#"+q,transform:(e?"rotate(180 "+s/2+" "+t/2+") ":"")+"scale("+s/u+","+t/u+")","stroke-width":(1/((s/u+t/u)/2)).toFixed(4)}),w.appendChild(s),i.defs.appendChild(w),l[v]=1),m(s,h),i=f*("diamond"!=r&&"oval"!=r),e?(e=b._.arrows.startdx*p||0,p=c.getTotalLength(o.path)-i*p):(e=i*p,p=c.getTotalLength(o.path)-(b._.arrows.enddx*p||0)),h={},h["marker-"+j]="url(#"+v+")",(p||e)&&(h.d=c.getSubpath(o.path,e,p)),m(n,h),b._.arrows[j+"Path"]=q,b._.arrows[j+"Marker"]=v,b._.arrows[j+"dx"]=i,b._.arrows[j+"Type"]=r,b._.arrows[j+"String"]=d}else e?(e=b._.arrows.startdx*p||0,p=c.getTotalLength(o.path)-e):(e=0,p=c.getTotalLength(o.path)-(b._.arrows.enddx*p||0)),b._.arrows[j+"Path"]&&m(n,{d:c.getSubpath(o.path,e,p)}),delete b._.arrows[j+"Path"],delete b._.arrows[j+"Marker"],delete b._.arrows[j+"dx"],delete b._.arrows[j+"Type"],delete b._.arrows[j+"String"];for(h in l)l.hasOwnProperty(h)&&!l[h]&&(b=c._g.doc.getElementById(h))&&b.parentNode.removeChild(b)}},q={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},r=function(b,c,d){if(c=q[a(c).toLowerCase()]){var e=b.attrs["stroke-width"]||"1";d={round:e,square:e,butt:0}[b.attrs["stroke-linecap"]||d["stroke-linecap"]]||0;for(var f=[],g=c.length;g--;)f[g]=c[g]*e+(g%2?1:-1)*d;m(b.node,{"stroke-dasharray":f.join(",")})}},s=function(b,e){var h=b.node,j=b.attrs,k=h.style.visibility;h.style.visibility="hidden";for(var l in e)if(e.hasOwnProperty(l)&&c._availableAttrs.hasOwnProperty(l)){
var q=e[l];switch(j[l]=q,l){case"blur":b.blur(q);break;case"href":case"title":case"target":var s=h.parentNode;if("a"!=s.tagName.toLowerCase()){var u=m("a");s.insertBefore(u,h),u.appendChild(h),s=u}"target"==l?s.setAttributeNS("http://www.w3.org/1999/xlink","show","blank"==q?"new":q):s.setAttributeNS("http://www.w3.org/1999/xlink",l,q);break;case"cursor":h.style.cursor=q;break;case"transform":b.transform(q);break;case"arrow-start":p(b,q);break;case"arrow-end":p(b,q,1);break;case"clip-rect":if(s=a(q).split(i),4==s.length){b.clip&&b.clip.parentNode.parentNode.removeChild(b.clip.parentNode);var u=m("clipPath"),v=m("rect");u.id=c.createUUID(),m(v,{x:s[0],y:s[1],width:s[2],height:s[3]}),u.appendChild(v),b.paper.defs.appendChild(u),m(h,{"clip-path":"url(#"+u.id+")"}),b.clip=v}!q&&(q=h.getAttribute("clip-path"))&&((q=c._g.doc.getElementById(q.replace(/(^url\(#|\)$)/g,"")))&&q.parentNode.removeChild(q),m(h,{"clip-path":""}),delete b.clip);break;case"path":"path"==b.type&&(m(h,{d:q?j.path=c._pathToAbsolute(q):"M0,0"}),b._.dirty=1,b._.arrows&&("startString"in b._.arrows&&p(b,b._.arrows.startString),"endString"in b._.arrows&&p(b,b._.arrows.endString,1)));break;case"width":if(h.setAttribute(l,q),b._.dirty=1,!j.fx)break;l="x",q=j.x;case"x":j.fx&&(q=-j.x-(j.width||0));case"rx":if("rx"==l&&"rect"==b.type)break;case"cx":h.setAttribute(l,q),b.pattern&&o(b),b._.dirty=1;break;case"height":if(h.setAttribute(l,q),b._.dirty=1,!j.fy)break;l="y",q=j.y;case"y":j.fy&&(q=-j.y-(j.height||0));case"ry":if("ry"==l&&"rect"==b.type)break;case"cy":h.setAttribute(l,q),b.pattern&&o(b),b._.dirty=1;break;case"r":"rect"==b.type?m(h,{rx:q,ry:q}):h.setAttribute(l,q),b._.dirty=1;break;case"src":"image"==b.type&&h.setAttributeNS("http://www.w3.org/1999/xlink","href",q);break;case"stroke-width":(1!=b._.sx||1!=b._.sy)&&(q/=f(g(b._.sx),g(b._.sy))||1),b.paper._vbSize&&(q*=b.paper._vbSize),h.setAttribute(l,q),j["stroke-dasharray"]&&r(b,j["stroke-dasharray"],e),b._.arrows&&("startString"in b._.arrows&&p(b,b._.arrows.startString),"endString"in b._.arrows&&p(b,b._.arrows.endString,1));break;case"stroke-dasharray":r(b,q,e);break;case"fill":var w=a(q).match(c._ISURL);if(w){var u=m("pattern"),x=m("image");u.id=c.createUUID(),m(u,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),m(x,{x:0,y:0,"xlink:href":w[1]}),u.appendChild(x),function(a){c._preload(w[1],function(){var c=this.offsetWidth,d=this.offsetHeight;m(a,{width:c,height:d}),m(x,{width:c,height:d}),b.paper.safari()})}(u),b.paper.defs.appendChild(u),m(h,{fill:"url(#"+u.id+")"}),b.pattern=u,b.pattern&&o(b);break}if(s=c.getRGB(q),s.error){if(("circle"==b.type||"ellipse"==b.type||"r"!=a(q).charAt())&&n(b,q)){("opacity"in j||"fill-opacity"in j)&&(s=c._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,"")))&&(s=s.getElementsByTagName("stop"),m(s[s.length-1],{"stop-opacity":("opacity"in j?j.opacity:1)*("fill-opacity"in j?j["fill-opacity"]:1)})),j.gradient=q,j.fill="none";break}}else delete e.gradient,delete j.gradient,!c.is(j.opacity,"undefined")&&c.is(e.opacity,"undefined")&&m(h,{opacity:j.opacity}),!c.is(j["fill-opacity"],"undefined")&&c.is(e["fill-opacity"],"undefined")&&m(h,{"fill-opacity":j["fill-opacity"]});s.hasOwnProperty("opacity")&&m(h,{"fill-opacity":1<s.opacity?s.opacity/100:s.opacity});case"stroke":s=c.getRGB(q),h.setAttribute(l,s.hex),"stroke"==l&&s.hasOwnProperty("opacity")&&m(h,{"stroke-opacity":1<s.opacity?s.opacity/100:s.opacity}),"stroke"==l&&b._.arrows&&("startString"in b._.arrows&&p(b,b._.arrows.startString),"endString"in b._.arrows&&p(b,b._.arrows.endString,1));break;case"gradient":"circle"!=b.type&&"ellipse"!=b.type&&"r"==a(q).charAt()||n(b,q);break;case"opacity":j.gradient&&!j.hasOwnProperty("stroke-opacity")&&m(h,{"stroke-opacity":q>1?q/100:q});case"fill-opacity":if(j.gradient){(s=c._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,"")))&&(s=s.getElementsByTagName("stop"),m(s[s.length-1],{"stop-opacity":q}));break}default:"font-size"==l&&(q=d(q,10)+"px"),s=l.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()}),h.style[s]=q,b._.dirty=1,h.setAttribute(l,q)}}t(b,e),h.style.visibility=k},t=function(b,e){if("text"==b.type&&(e.hasOwnProperty("text")||e.hasOwnProperty("font")||e.hasOwnProperty("font-size")||e.hasOwnProperty("x")||e.hasOwnProperty("y"))){var f=b.attrs,g=b.node,h=g.firstChild?d(c._g.doc.defaultView.getComputedStyle(g.firstChild,"").getPropertyValue("font-size"),10):10;if(e.hasOwnProperty("text")){for(f.text=e.text;g.firstChild;)g.removeChild(g.firstChild);for(var i,j=a(e.text).split("\n"),k=[],l=0,n=j.length;n>l;l++)i=m("tspan"),l&&m(i,{dy:1.2*h,x:f.x}),i.appendChild(c._g.doc.createTextNode(j[l])),g.appendChild(i),k[l]=i}else for(k=g.getElementsByTagName("tspan"),l=0,n=k.length;n>l;l++)l?m(k[l],{dy:1.2*h,x:f.x}):m(k[0],{dy:0});m(g,{x:f.x,y:f.y}),b._.dirty=1,g=b._getBBox(),(f=f.y-(g.y+g.height/2))&&c.is(f,"finite")&&m(k[0],{dy:f})}},u=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!b.bottom&&(b.bottom=this),(this.prev=b.top)&&(b.top.next=this),b.top=this,this.next=null},v=c.el;u.prototype=v,v.constructor=u,c._engine.path=function(a,b,c){var d=m("path"),e=b.canvas.getElementsByTagName("g");return 2<=e.length&&"undefined"==typeof c?b.canvas&&e[0].appendChild(d):b.canvas&&b.canvas.appendChild(d),b=new u(d,b),b.type="path",s(b,{fill:"none",stroke:"#000",path:a}),b},v.rotate=function(c,d,e){return this.removed?this:(c=a(c).split(i),c.length-1&&(d=b(c[1]),e=b(c[2])),c=b(c[0]),null==e&&(d=e),(null==d||null==e)&&(e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2),this.transform(this._.transform.concat([["r",c,d,e]])),this)},v.scale=function(c,d,e,f){if(this.removed)return this;if(c=a(c).split(i),c.length-1&&(d=b(c[1]),e=b(c[2]),f=b(c[3])),c=b(c[0]),null==d&&(d=c),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",c,d,e,f]])),this},v.translate=function(c,d){return this.removed?this:(c=a(c).split(i),c.length-1&&(d=b(c[1])),c=b(c[0])||0,this.transform(this._.transform.concat([["t",c,+d||0]])),this)},v.transform=function(a){var b=this._;return null==a?b.transform:(c._extractTransform(this,a),this.clip&&m(this.clip,{transform:this.matrix.invert()}),this.pattern&&o(this),this.node&&m(this.node,{transform:this.matrix}),(1!=b.sx||1!=b.sy)&&(a=this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":a})),this)},v.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},v.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},v.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),j.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},v._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},v.attr=function(a,b){if(this.removed)return this;if(null==a){var d,e={};for(d in this.attrs)this.attrs.hasOwnProperty(d)&&(e[d]=this.attrs[d]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==b&&c.is(a,"string")){if("fill"==a&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==a)return this._.transform;d=a.split(i);for(var e={},f=0,g=d.length;g>f;f++)a=d[f],a in this.attrs?e[a]=this.attrs[a]:c.is(this.paper.customAttributes[a],"function")?e[a]=this.paper.customAttributes[a].def:e[a]=c._availableAttrs[a];return g-1?e:e[d[0]]}if(null==b&&c.is(a,"array")){for(e={},f=0,g=a.length;g>f;f++)e[a[f]]=this.attr(a[f]);return e}null!=b?(e={},e[a]=b):null!=a&&c.is(a,"object")&&(e=a);for(f in e)j("raphael.attr."+f+"."+this.id,this,e[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.is(this.paper.customAttributes[f],"function"))for(g in d=this.paper.customAttributes[f].apply(this,[].concat(e[f])),this.attrs[f]=e[f],d)d.hasOwnProperty(g)&&(e[g]=d[g]);return s(this,e),this},v.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},v.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this},v.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},v.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},v.blur=function(a){if(0!==+a){var b=m("filter"),d=m("feGaussianBlur");this.attrs.blur=a,b.id=c.createUUID(),m(d,{stdDeviation:+a||1.5}),b.appendChild(d),this.paper.defs.appendChild(b),this._blur=b,m(this.node,{filter:"url(#"+b.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")},c._engine.circle=function(a,b,c,d){var e=m("circle");return a.canvas&&a.canvas.appendChild(e),a=new u(e,a),a.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},a.type="circle",m(e,a.attrs),a},c._engine.rectBb=function(a,b,c,d,e,f){var g=m("rect"),h=a.canvas.getElementsByTagName("g");return 2==h.length&&a.canvas&&h[1].appendChild(g),a=new u(g,a),a.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},a.type="rect",m(g,a.attrs),a},c._engine.rect=function(a,b,c,d,e,f){var g=m("rect");return a.canvas&&a.canvas.appendChild(g),a=new u(g,a),a.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},a.type="rect",m(g,a.attrs),a},c._engine.ellipse=function(a,b,c,d,e){var f=m("ellipse");return a.canvas&&a.canvas.appendChild(f),a=new u(f,a),a.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},a.type="ellipse",m(f,a.attrs),a},c._engine.imageBb=function(a,b,c,d,e,f){var g=m("image");return m(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS("http://www.w3.org/1999/xlink","href",b),a.canvas.getElementById("bbGroup").appendChild(g),a=new u(g,a),a.attrs={x:c,y:d,width:e,height:f,src:b},a.type="image",a},c._engine.image=function(a,b,c,d,e,f){var g=m("image");m(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS("http://www.w3.org/1999/xlink","href",b);var h=a.canvas.getElementsByTagName("g");return 2<=h.length?a.canvas&&h[0].appendChild(g):a.canvas&&a.canvas.appendChild(g),a=new u(g,a),a.attrs={x:c,y:d,width:e,height:f,src:b},a.type="image",a},c._engine.text=function(a,b,d,e){var f=m("text");return a.canvas&&a.canvas.appendChild(f),a=new u(f,a),a.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},a.type="text",s(a,a.attrs),a},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,a=a.height;if(!b)throw Error("没有找到画布对象.");var g,h=m("svg"),d=d||0,e=e||0,f=f||512,a=a||342;return m(h,{height:a,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),1==b?(h.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(h),g=1):(h.style.cssText="overflow:hidden;position:relative",b.firstChild?b.insertBefore(h,b.firstChild):b.appendChild(h)),b=new c._Paper,b.width=f,b.height=a,b.canvas=h,b.clear(),b._left=b._top=0,g&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){j("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var g,h=f(c/this.width,d/this.height),i=this.top,k=e?"meet":"xMinYMin";for(null==a?(this._vbSize&&(h=1),delete this._vbSize,g="0 0 "+this.width+" "+this.height):(this._vbSize=h,g=a+" "+b+" "+c+" "+d),m(this.canvas,{viewBox:g,preserveAspectRatio:k});h&&i;)k="stroke-width"in i.attrs?i.attrs["stroke-width"]:1,i.attr({"stroke-width":k}),i._.dirty=1,i._.dirtyT=1,i=i.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}b=-a.e%1,a=-a.f%1,(b||a)&&(b&&(this._left=(this._left+b)%1,c.left=this._left+"px"),a&&(this._top=(this._top+a)%1,c.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=m("desc")).appendChild(c._g.doc.createTextNode("by EasyTee Design Tool "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=m("defs"));var b=document.createElementNS("http://www.w3.org/2000/svg","g");a.appendChild(b),b=document.createElementNS("http://www.w3.org/2000/svg","g"),b.setAttribute("id","bbGroup"),a.appendChild(b)},c.prototype.remove=function(){j("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var w,x=c.st;for(w in v)v.hasOwnProperty(w)&&!x.hasOwnProperty(w)&&(x[w]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(w))}}(),function(){if(c.vml){var a=String,b=parseFloat,d=Math,e=d.round,f=d.max,g=d.min,h=d.abs,i=/[, ]+/,j=c.eve,k={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},l=/([clmz]),?([^clmz]*)/gi,m=/ progid:\S+Blur\([^\)]+\)/g,n=/-?[^,\s-]+/g,o={path:1,rect:1,image:1},p={circle:1,ellipse:1},q=function(b){var d=/[ahqstv]/gi,f=c._pathToAbsolute;if(a(b).match(d)&&(f=c._path2curve),d=/[clmz]/g,f==c._pathToAbsolute&&!a(b).match(d))return b=a(b).replace(l,function(a,b,c){var d=[],f="m"==b.toLowerCase(),g=k[b];return c.replace(n,function(a){f&&2==d.length&&(g+=d+k["m"==b?"l":"L"],d=[]),d.push(e(21600*a))}),g+d});var g,d=f(b);b=[];for(var h=0,i=d.length;i>h;h++){f=d[h],g=d[h][0].toLowerCase(),"z"==g&&(g="x");for(var j=1,m=f.length;m>j;j++)g+=e(21600*f[j])+(j!=m-1?",":"");b.push(g)}return b.join(" ")},r=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},s=function(a,b,c,d,e,f){var g=a._,i=a.matrix,j=g.fillpos;a=a.node;var k=a.style,l=1,m="",n=21600/b,o=21600/c;k.visibility="hidden",b&&c&&(a.coordsize=h(n)+" "+h(o),k.rotation=f*(0>b*c?-1:1),f&&(e=r(f,d,e),d=e.dx,e=e.dy),0>b&&(m+="x"),0>c&&(m+=" y")&&(l=-1),k.flip=m,a.coordorigin=d*-n+" "+e*-o,(j||g.fillsize)&&(d=(d=a.getElementsByTagName("fill"))&&d[0],a.removeChild(d),j&&(e=r(f,i.x(j[0],j[1]),i.y(j[0],j[1])),d.position=e.dx*l+" "+e.dy*l),g.fillsize&&(d.size=g.fillsize[0]*h(b)+" "+g.fillsize[1]*h(c)),a.appendChild(d)),k.visibility="visible")};c.toString=function(){return"您的浏览器不支持 SVG. 但支持 VML.\n可以运行 Raphael "+this.version};var t=function(b,c,d){c=a(c).toLowerCase().split("-"),d=d?"end":"start";for(var e=c.length,f="classic",g="medium",h="medium";e--;)switch(c[e]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":f=c[e];break;case"wide":case"narrow":h=c[e];break;case"long":case"short":g=c[e]}b=b.node.getElementsByTagName("stroke")[0],b[d+"arrow"]=f,b[d+"arrowlength"]=g,b[d+"arrowwidth"]=h},u=function(d,h){d.attrs=d.attrs||{};var j,k=d.node,l=d.attrs,m=k.style,n=o[d.type]&&(h.x!=l.x||h.y!=l.y||h.width!=l.width||h.height!=l.height||h.cx!=l.cx||h.cy!=l.cy||h.rx!=l.rx||h.ry!=l.ry||h.r!=l.r),r=p[d.type]&&(l.cx!=h.cx||l.cy!=h.cy||l.r!=h.r||l.rx!=h.rx||l.ry!=h.ry);for(j in h)h.hasOwnProperty(j)&&(l[j]=h[j]);if(n&&(l.path=c._getPath[d.type](d),d._.dirty=1),h.href&&(k.href=h.href),h.title&&(k.title=h.title),h.target&&(k.target=h.target),h.cursor&&(m.cursor=h.cursor),"blur"in h&&d.blur(h.blur),(h.path&&"path"==d.type||n)&&(k.path=q(~a(l.path).toLowerCase().indexOf("r")?c._pathToAbsolute(l.path):l.path),"image"==d.type&&(d._.fillpos=[l.x,l.y],d._.fillsize=[l.width,l.height],s(d,1,1,0,0,0))),"transform"in h&&d.transform(h.transform),r&&(m=+l.cx,n=+l.cy,r=+l.rx||+l.r||0,j=+l.ry||+l.r||0,k.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e(21600*(m-r)),e(21600*(n-j)),e(21600*(m+r)),e(21600*(n+j)),e(21600*m))),"clip-rect"in h&&(m=a(h["clip-rect"]).split(i),4==m.length&&(m[2]=+m[2]+ +m[0],m[3]=+m[3]+ +m[1],n=k.clipRect||c._g.doc.createElement("div"),r=n.style,r.clip=c.format("rect({1}px {2}px {3}px {0}px)",m),k.clipRect||(r.position="absolute",r.top=0,r.left=0,r.width=d.paper.width+"px",r.height=d.paper.height+"px",k.parentNode.insertBefore(n,k),n.appendChild(k),k.clipRect=n)),h["clip-rect"]||k.clipRect&&(k.clipRect.style.clip="auto")),d.textpath&&(m=d.textpath.style,h.font&&(m.font=h.font),h["font-family"]&&(m.fontFamily='"'+h["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),h["font-size"]&&(m.fontSize=h["font-size"]),h["font-weight"]&&(m.fontWeight=h["font-weight"]),h["font-style"]&&(m.fontStyle=h["font-style"])),"arrow-start"in h&&t(d,h["arrow-start"]),"arrow-end"in h&&t(d,h["arrow-end"],1),(null!=h.opacity||null!=h["stroke-width"]||null!=h.fill||null!=h.src||null!=h.stroke||null!=h["stroke-width"]||null!=h["stroke-opacity"]||null!=h["fill-opacity"]||null!=h["stroke-dasharray"]||null!=h["stroke-miterlimit"]||null!=h["stroke-linejoin"]||null!=h["stroke-linecap"])&&(m=(m=k.getElementsByTagName("fill"))&&m[0],!m&&(m=y("fill")),"image"==d.type&&h.src&&(m.src=h.src),h.fill&&(m.on=!0),(null==m.on||"none"==h.fill||null===h.fill)&&(m.on=!1),m.on&&h.fill&&((n=a(h.fill).match(c._ISURL))?(m.parentNode==k&&k.removeChild(m),m.rotate=!0,m.src=n[1],m.type="tile",r=d.getBBox(1),m.position=r.x+" "+r.y,d._.fillpos=[r.x,r.y],c._preload(n[1],function(){d._.fillsize=[this.offsetWidth,this.offsetHeight]})):(m.color=c.getRGB(h.fill).hex,m.src="",m.type="solid",c.getRGB(h.fill).error&&(d.type in{circle:1,ellipse:1}||"r"!=a(h.fill).charAt())&&v(d,h.fill,m)&&(l.fill="none",l.gradient=h.fill,m.rotate=!1))),("fill-opacity"in h||"opacity"in h)&&(r=((+l["fill-opacity"]+1||2)-1)*((+l.opacity+1||2)-1)*((+c.getRGB(h.fill).o+1||2)-1),r=g(f(r,0),1),m.opacity=r,m.src&&(m.color="none")),k.appendChild(m),m=k.getElementsByTagName("stroke")&&k.getElementsByTagName("stroke")[0],n=!1,!m&&(n=m=y("stroke")),(h.stroke&&"none"!=h.stroke||h["stroke-width"]||null!=h["stroke-opacity"]||h["stroke-dasharray"]||h["stroke-miterlimit"]||h["stroke-linejoin"]||h["stroke-linecap"])&&(m.on=!0),"none"!=h.stroke&&null!==h.stroke&&null!=m.on&&0!=h.stroke&&0!=h["stroke-width"]||(m.on=!1),r=c.getRGB(h.stroke),m.on&&h.stroke&&(m.color=r.hex),r=((+l["stroke-opacity"]+1||2)-1)*((+l.opacity+1||2)-1)*((+r.o+1||2)-1),j=.75*(b(h["stroke-width"])||1),r=g(f(r,0),1),null==h["stroke-width"]&&(j=l["stroke-width"]),h["stroke-width"]&&(m.weight=j),j&&1>j&&(r*=j)&&(m.weight=1),m.opacity=r,h["stroke-linejoin"]&&(m.joinstyle=h["stroke-linejoin"]||"miter"),m.miterlimit=h["stroke-miterlimit"]||8,h["stroke-linecap"]&&(m.endcap="butt"==h["stroke-linecap"]?"flat":"square"==h["stroke-linecap"]?"square":"round"),h["stroke-dasharray"]&&(r={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},m.dashstyle=r.hasOwnProperty(h["stroke-dasharray"])?r[h["stroke-dasharray"]]:""),n&&k.appendChild(m)),"text"==d.type){d.paper.canvas.style.display="",k=d.paper.span,n=l.font&&l.font.match(/\d+(?:\.\d*)?(?=px)/),m=k.style,l.font&&(m.font=l.font),l["font-family"]&&(m.fontFamily=l["font-family"]),l["font-weight"]&&(m.fontWeight=l["font-weight"]),l["font-style"]&&(m.fontStyle=l["font-style"]),n=b(l["font-size"]||n&&n[0])||10,m.fontSize=100*n+"px",d.textpath.string&&(k.innerHTML=a(d.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>")),k=k.getBoundingClientRect(),d.W=l.w=(k.right-k.left)/100,d.H=l.h=(k.bottom-k.top)/100,d.X=l.x,d.Y=l.y+d.H/2,("x"in h||"y"in h)&&(d.path.v=c.format("m{0},{1}l{2},{1}",e(21600*l.x),e(21600*l.y),e(21600*l.x)+1)),k="x y text font font-family font-weight font-style font-size".split(" "),m=0;for(n=k.length;n>m;m++)if(k[m]in h){d._.dirty=1;break}switch(l["text-anchor"]){case"start":d.textpath.style["v-text-align"]="left",d.bbx=d.W/2;break;case"end":d.textpath.style["v-text-align"]="right",d.bbx=-d.W/2;break;default:d.textpath.style["v-text-align"]="center",d.bbx=0}d.textpath.style["v-text-kern"]=!0}},v=function(e,f,g){e.attrs=e.attrs||{};var h=Math.pow,i="linear",j=".5 .5";if(e.attrs.gradient=f,f=a(f).replace(c._radial_gradient,function(a,c,e){return i="radial",c&&e&&(c=b(c),e=b(e),.25<h(c-.5,2)+h(e-.5,2)&&(e=d.sqrt(.25-h(c-.5,2))*(2*(e>.5)-1)+.5),j=c+" "+e),""}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift(),k=-b(k);if(isNaN(k))return null}if(f=c._parseDots(f),!f)return null;if(e=e.shape||e.node,f.length){e.removeChild(g),g.on=!0,g.method="none",g.color=f[0].color,g.color2=f[f.length-1].color;for(var l=[],m=0,n=f.length;n>m;m++)f[m].offset&&l.push(f[m].offset+" "+f[m].color);g.colors=l.length?l.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),e.appendChild(g)}return 1},w=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.Y=this.X=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),(this.prev=b.top)&&(b.top.next=this),b.top=this,this.next=null},x=c.el;w.prototype=x,x.constructor=w,x.transform=function(b){if(null==b)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:"";e&&(d=b=a(b).replace(/\.{3}|\u2026/g,this._.transform||"")),c._extractTransform(this,f+b);var e=this.matrix.clone(),g=this.skew;b=this.node;var f=~a(this.attrs.fill).indexOf("-"),h=!a(this.attrs.fill).indexOf("url(");return e.translate(-.5,-.5),h||f||"image"==this.type?(g.matrix="1 0 0 1",g.offset="0 0",g=e.split(),f&&g.noRotation||!g.isSimple?(b.style.filter=e.toFilter(),f=this.getBBox(),g=this.getBBox(1),e=f.x-g.x,f=f.y-g.y,b.coordorigin=-21600*e+" "+-21600*f,s(this,1,1,e,f,0)):(b.style.filter="",s(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate))):(b.style.filter="",g.matrix=a(e),g.offset=e.offset()),d&&(this._.transform=d),this},x.rotate=function(c,d,e){return this.removed?this:null!=c?(c=a(c).split(i),c.length-1&&(d=b(c[1]),e=b(c[2])),c=b(c[0]),null==e&&(d=e),(null==d||null==e)&&(e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2),this._.dirtyT=1,this.transform(this._.transform.concat([["r",c,d,e]])),this):void 0},x.translate=function(c,d){return this.removed?this:(c=a(c).split(i),c.length-1&&(d=b(c[1])),c=b(c[0])||0,d=+d||0,this._.bbox&&(this._.bbox.x+=c,this._.bbox.y+=d),this.transform(this._.transform.concat([["t",c,d]])),this)},x.scale=function(c,d,e,f){if(this.removed)return this;if(c=a(c).split(i),c.length-1&&(d=b(c[1]),e=b(c[2]),f=b(c[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),c=b(c[0]),null==d&&(d=c),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",c,d,e,f]])),this._.dirtyT=1,this},x.hide=function(){return!this.removed&&(this.node.style.display="none"),this},x.show=function(){return!this.removed&&(this.node.style.display=""),this},x._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},x.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},x.attr=function(a,b){if(this.removed)return this;if(null==a){var d,e={};for(d in this.attrs)this.attrs.hasOwnProperty(d)&&(e[d]=this.attrs[d]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==b&&c.is(a,"string")){if("fill"==a&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;d=a.split(i);for(var e={},f=0,g=d.length;g>f;f++)a=d[f],a in this.attrs?e[a]=this.attrs[a]:c.is(this.paper.customAttributes[a],"function")?e[a]=this.paper.customAttributes[a].def:e[a]=c._availableAttrs[a];return g-1?e:e[d[0]]}if(this.attrs&&null==b&&c.is(a,"array")){for(e={},f=0,g=a.length;g>f;f++)e[a[f]]=this.attr(a[f]);return e}null!=b&&(e={},e[a]=b),null==b&&c.is(a,"object")&&(e=a);for(f in e)j("raphael.attr."+f+"."+this.id,this,e[f]);if(e){for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&e.hasOwnProperty(f)&&c.is(this.paper.customAttributes[f],"function"))for(g in d=this.paper.customAttributes[f].apply(this,[].concat(e[f])),this.attrs[f]=e[f],d)d.hasOwnProperty(g)&&(e[g]=d[g]);e.text&&"text"==this.type&&(this.textpath.string=e.text),u(this,e)}return this},x.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},x.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},x.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},x.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},x.blur=function(a){var b=this.node.runtimeStyle,d=b.filter,d=d.replace(m,"");0!==+a?(this.attrs.blur=a,b.filter=d+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",e(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur)},c._engine.path=function(a,b){var c=y("shape");c.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px",c.coordsize="21600 21600",c.coordorigin=b.coordorigin;var d=new w(c,b),e={fill:"none",stroke:"#000"};return a&&(e.path=a),d.type="path",d.path=[],d.Path="",u(d,e),b.canvas.appendChild(c),e=y("skew"),e.on=!0,c.appendChild(e),d.skew=e,d.transform(""),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g);a=a.path(h);var i=a.attrs;return a.X=i.x=b,a.Y=i.y=d,a.W=i.width=e,a.H=i.height=f,i.r=g,i.path=h,a.type="rect",a},c._engine.ellipse=function(a,b,c,d,e){return a=a.path(),a.X=b-d,a.Y=c-e,a.W=2*d,a.H=2*e,a.type="ellipse",u(a,{cx:b,cy:c,rx:d,ry:e}),a},c._engine.circle=function(a,b,c,d){return a=a.path(),a.X=b-d,a.Y=c-d,a.W=a.H=2*d,a.type="circle",u(a,{cx:b,cy:c,r:d}),a},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g);a=a.path(h).attr({stroke:"none"});var i=a.attrs,j=a.node,k=j.getElementsByTagName("fill")[0];return i.src=b,a.X=i.x=d,a.Y=i.y=e,a.W=i.width=f,a.H=i.height=g,i.path=h,a.type="image",k.parentNode==j&&j.removeChild(k),k.rotate=!0,k.src=b,k.type="tile",a._.fillpos=[d,e],a._.fillsize=[f,g],j.appendChild(k),s(a,1,1,0,0,0),a},c._engine.text=function(b,d,f,g){var h=y("shape"),i=y("path"),j=y("textpath");d=d||0,f=f||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",e(21600*d),e(21600*f),e(21600*d)+1),i.textpathok=!0,j.string=a(g),j.on=!0,h.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px",h.coordsize="21600 21600",h.coordorigin="0 0";var k=new w(h,b),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};return k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=a(g),k.attrs.x=d,k.attrs.y=f,k.attrs.w=1,k.attrs.h=1,u(k,l),h.appendChild(j),h.appendChild(i),b.canvas.appendChild(h),b=y("skew"),b.on=!0,h.appendChild(b),k.skew=b,k.transform(""),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,g){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,g]);var h,i,j=this.width,k=this.height,l=1/f(d/j,e/k);return g&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!g],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};var y;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),y=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){y=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,a=a.y;if(!b)throw Error("VML container not found.");var g=new c._Paper,h=g.canvas=c._g.doc.createElement("div"),i=h.style,f=f||0,a=a||0,e=e||512,d=d||342;return g.width=e,g.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),g.coordsize="21600000 21600000",g.coordorigin="0 0",g.span=c._g.doc.createElement("span"),g.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",h.appendChild(g.span),i.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(h),i.left=f+"px",i.top=a+"px",i.position="absolute"):b.firstChild?b.insertBefore(h,b.firstChild):b.appendChild(h),g.renderfix=function(){},g},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML="",this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var z,A=c.st;for(z in x)x.hasOwnProperty(z)&&!A.hasOwnProperty(z)&&(A[z]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(z))}}(),x?w.win.Raphael=c:Raphael=c,c}),function(a){function b(a){if("number"==typeof a)return a.toString();var b,c={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"};for(b in c)a=a.replace(RegExp(b,"g"),"&"+c[b]+";");return a}function c(a,b){var c,d=[];for(c in a)if(a.hasOwnProperty(c)){var e=b.call(this,a[c],c);null!==e&&d.push(e)}return d}function d(a,b,c){for(var d in a)a.hasOwnProperty(d)&&(c=b.call(this,c,a[d],d));return c}function e(a,d,e,f){return("undefined"==typeof f||null===f)&&(f=""),"object"==typeof d&&(d=c(d,function(a,c){return"transform"!==c?c+'="'+b(a)+'"':void 0}).join(" ")),"<"+a+(e?' transform="matrix('+e.toString().replace(/^matrix\(|\)$/g,"")+')" ':" ")+d+">"+f+"</"+a+">";
}function f(a,b,c){return null===a&&(a=10),console.log("KSKKS"),4.5*a/13*(b-.2-c/2)*3.5}var g={text:function(a){style={font:{family:a.attrs.font.replace(/^.*?"(\w+)".*$/,"$1"),size:"undefined"==typeof a.attrs["font-size"]?null:a.attrs["font-size"]}};var g=[];return c(a.attrs.text.split("\n"),function(c,h,i){i=i||0,g.push(e("text",d(a.attrs,function(a,c,d){return"text"!==d&&"w"!==d&&"h"!==d&&("font-size"===d&&(c+="px"),a[d]=b(c.toString())),a},{style:"text-anchor: middle; "+("font: normal normal normal 10px/normal "+style.font.family+(null===style.font.size?"":"; font-size: "+style.font.size+"px"))+";"}),a.matrix,e("tspan",{dy:f(style.font.size,i+1,a.attrs.text.split("\n").length)},null,c)))}),g},path:function(a){return e("path",d(a.attrs,function(b,c,d){return"path"===d&&(d="d"),"undefined"==typeof c||null==c?b:(b[d]=c.toString(),"stroke-width"==d&&(console.log("STw",c,b,a),b[d]=c.toString()),b)},{}),a.matrix)}};a.fn.toSVG=function(){var c=a.svg,d=a.vml,e='<svg style="overflow: hidden; position: relative;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'" version="1.1">';a.svg=!0,a.vml=!1;for(var f=this.bottom;null!=f;f=f.next)if("none"!==f.node.style.display){var h="";if("function"==typeof g[f.type])e+=g[f.type](f);else{switch(f.type){case"image":h+=' preserveAspectRatio="none"'}for(i in f.attrs){var j=i;switch(i){case"src":j="xlink:href";break;case"transform":j=""}j&&(h+=" "+j+'="'+b(f.attrs[i].toString())+'"')}e+="<"+f.type+' transform="matrix('+f.matrix.toString().replace(/^matrix\(|\)$/g,"")+')"'+h+"></"+f.type+">"}}return a.svg=c,a.vml=d,e+"</svg>"}}(window.Raphael),Raphael.fn.freeTransform=function(a,b,c){function d(a){("set"===a.type?a.items:[a]).map(function(a){"set"===a.type?d(a):n.items.push({el:a,attrs:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},transformString:a.matrix.toTransformString()})})}function e(){var a=n.attrs.rotate*Math.PI/180,b=(n.attrs.rotate+90)*Math.PI/180,c=n.attrs.size.x/2*n.attrs.scale.x,d=n.attrs.size.y/2*n.attrs.scale.y,e=[];return[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}].map(function(f){e.push({x:n.attrs.center.x+n.attrs.translate.x+f.x*c*Math.cos(a)+f.y*d*Math.cos(b),y:n.attrs.center.y+n.attrs.translate.y+f.x*c*Math.sin(a)+f.y*d*Math.sin(b)})}),e}function f(a){if(a&&n.opts.snap.drag){var b=a.x,c=a.y,d={x:0,y:0},e=0,f=0;[0,1].map(function(){d.x=b-Math.round(b/n.opts.snap.drag)*n.opts.snap.drag,d.y=c-Math.round(c/n.opts.snap.drag)*n.opts.snap.drag,Math.abs(d.x)<=n.opts.snapDist.drag&&(e=d.x),Math.abs(d.y)<=n.opts.snapDist.drag&&(f=d.y),b+=a.width-e,c+=a.height-f}),n.attrs.translate.x-=e,n.attrs.translate.y-=f}if(n.opts.boundary){var g=n.opts.boundary;n.attrs.center.x+n.attrs.translate.x<g.x&&(n.attrs.translate.x+=g.x-(n.attrs.center.x+n.attrs.translate.x)),n.attrs.center.y+n.attrs.translate.y<g.y&&(n.attrs.translate.y+=g.y-(n.attrs.center.y+n.attrs.translate.y)),n.attrs.center.x+n.attrs.translate.x>g.x+g.width&&(n.attrs.translate.x+=g.x+g.width-(n.attrs.center.x+n.attrs.translate.x)),n.attrs.center.y+n.attrs.translate.y>g.y+g.height&&(n.attrs.translate.y+=g.y+g.height-(n.attrs.center.y+n.attrs.translate.y))}d=Math.abs(n.attrs.rotate%n.opts.snap.rotate),d=Math.min(d,n.opts.snap.rotate-d),d<n.opts.snapDist.rotate&&(n.attrs.rotate=Math.round(n.attrs.rotate/n.opts.snap.rotate)*n.opts.snap.rotate),d={x:Math.abs(n.attrs.scale.x*n.attrs.size.x%n.opts.snap.scale),y:Math.abs(n.attrs.scale.y*n.attrs.size.x%n.opts.snap.scale)},d={x:Math.min(d.x,n.opts.snap.scale-d.x),y:Math.min(d.y,n.opts.snap.scale-d.y)},d.x<n.opts.snapDist.scale&&(n.attrs.scale.x=Math.round(n.attrs.scale.x*n.attrs.size.x/n.opts.snap.scale)*n.opts.snap.scale/n.attrs.size.x),d.y<n.opts.snapDist.scale&&(n.attrs.scale.y=Math.round(n.attrs.scale.y*n.attrs.size.y/n.opts.snap.scale)*n.opts.snap.scale/n.attrs.size.y),n.opts.range.rotate&&(g=(360+n.attrs.rotate)%360,g>180&&(g-=360),g<n.opts.range.rotate[0]&&(n.attrs.rotate+=n.opts.range.rotate[0]-g),g>n.opts.range.rotate[1]&&(n.attrs.rotate+=n.opts.range.rotate[1]-g)),n.opts.range.scale&&(n.attrs.scale.x*n.attrs.size.x<n.opts.range.scale[0]&&(n.attrs.scale.x=n.opts.range.scale[0]/n.attrs.size.x),n.attrs.scale.y*n.attrs.size.y<n.opts.range.scale[0]&&(n.attrs.scale.y=n.opts.range.scale[0]/n.attrs.size.y),n.attrs.scale.x*n.attrs.size.x>n.opts.range.scale[1]&&(n.attrs.scale.x=n.opts.range.scale[1]/n.attrs.size.x),n.attrs.scale.y*n.attrs.size.y>n.opts.range.scale[1]&&(n.attrs.scale.y=n.opts.range.scale[1]/n.attrs.size.y))}function g(){return{x:n.attrs.scale.x*n.attrs.size.x>=n.opts.range.scale[0]&&n.attrs.scale.x*n.attrs.size.x<=n.opts.range.scale[1],y:n.attrs.scale.y*n.attrs.size.y>=n.opts.range.scale[0]&&n.attrs.scale.y*n.attrs.size.y<=n.opts.range.scale[1]}}function h(a){"x"===a?n.attrs.scale.y=n.attrs.scale.x/n.attrs.ratio:n.attrs.scale.x=n.attrs.scale.y*n.attrs.ratio}function i(a){var b,c={};for(b in a)c[b]="object"==typeof a[b]?i(a[b]):a[b];return c}function j(a){if(n.callback){var b=[];a.map(function(a,c){a&&b.push(a)}),clearTimeout(o),setTimeout(function(){n.callback&&n.callback(n,b)},1)}}if(a.freeTransform)return a.freeTransform;Array.prototype.hasOwnProperty("map")||(Array.prototype.map=function(a,b){var c,d=[];for(c in this)this.hasOwnProperty(c)&&(d[c]=a.call(b,this[c],c,this));return d}),Array.prototype.hasOwnProperty("indexOf")||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1});var k=this,l=a.getBBox(!0),m=parent.zoom,n=a.freeTransform={attrs:{x:l.x,y:l.y,size:{x:l.width,y:l.height},center:{x:l.x+l.width/2,y:l.y+l.height/2},rotate:0,scale:{x:1,y:1},translate:{x:0,y:0},ratio:1},axes:null,bbox:null,callback:null,items:[],handles:{center:null,x:null,y:null,del:null,lock:null},offset:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},opts:{animate:!1,attrs:{fill:"#fff",stroke:"#000"},boundary:{x:k._left||0,y:k._top||0,width:k.width,height:k.height},distance:1.3,drag:!0,draw:!1,keepRatio:!1,range:{rotate:[-180,180],scale:[-99999,99999]},rotate:!0,scale:!0,snap:{rotate:0,scale:0,drag:0},snapDist:{rotate:0,scale:0,drag:7},size:5},subject:a};n.updateHandles=function(){if(n.handles.bbox||0<=n.opts.rotate.indexOf("self"))var a=e();e();var b={x:(n.attrs.rotate+45)*Math.PI/180,y:(n.attrs.rotate+225)*Math.PI/180},c={x:n.attrs.size.x/2*n.attrs.scale.x,y:n.attrs.size.y/2*n.attrs.scale.y};if(n.axes.map(function(a){if(n.handles[a]){var d=n.attrs.center.x+n.attrs.translate.x+c[a]*n.opts.distance*Math.cos(b[a]),e=n.attrs.center.y+n.attrs.translate.y+c[a]*n.opts.distance*Math.sin(b[a]);n.opts.boundary&&(d=Math.max(Math.min(d,n.opts.boundary.x+n.opts.boundary.width),n.opts.boundary.x),e=Math.max(Math.min(e,n.opts.boundary.y+n.opts.boundary.height),n.opts.boundary.y)),n.handles[a].disc.attr({cx:d,cy:e}),n.handles[a].disc.toFront()}}),n.bbox){n.bbox.toFront().attr({path:[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",a[2].x,a[2].y],["L",a[3].x,a[3].y],["L",a[0].x,a[0].y]]});var d=[[-1,-1],[1,-1],[1,1],[-1,1],[0,-1],[1,0],[0,1],[-1,0]];n.handles.bbox&&n.handles.bbox.map(function(b,c){var e,f,g;b.isCorner?(e=a[c].x,f=a[c].y):(f=c%4,g=(f+1)%a.length,e=(a[f].x+a[g].x)/2,f=(a[f].y+a[g].y)/2),b.element.toFront().attr({x:e-(b.isCorner?n.opts.size.bboxCorners:n.opts.size.bboxSides),y:f-(b.isCorner?n.opts.size.bboxCorners:n.opts.size.bboxSides)}).transform("R"+n.attrs.rotate),b.x=d[c][0],b.y=d[c][1]})}var f=13;if(m=parent.zoom,1!=parent.zoom&&(m=.5,f=6),n.handles.x.disc.transform("S"+m+","+m),n.handles.y.disc.transform("S"+m+","+m),n.handles.del.disc.transform("S"+m+","+m),n.handles.center.disc.transform("S"+m+","+m),n.handles.lock.disc.transform("S"+m+","+m),n.circle&&n.circle.attr({cx:n.attrs.center.x+n.attrs.translate.x,cy:n.attrs.center.y+n.attrs.translate.y,r:Math.max(c.x,c.y)*n.opts.distance}),n.handles.center){n.handles.center.disc.toFront();var g=-f-n.attrs.size.x*n.attrs.scale.x*.5,h=f+n.attrs.size.y*n.attrs.scale.y*.5,i=(360-n.attrs.rotate)/180*Math.PI,j=Math.cos(i),k=Math.sin(i),i=n.attrs.translate.x+(g*j+h*k),g=n.attrs.translate.y+(-(g*k)+h*j);n.handles.center.disc.transform("...T"+i+","+g),n.handles.center.disc.transform("...R"+n.attrs.rotate)}return n.handles.del&&(n.handles.del.disc.toFront(),g=f+n.attrs.size.x*n.attrs.scale.x*.5,h=-f-n.attrs.size.y*n.attrs.scale.y*.5,i=(360-n.attrs.rotate)/180*Math.PI,j=Math.cos(i),k=Math.sin(i),i=n.attrs.translate.x+(g*j+h*k),g=n.attrs.translate.y+(-(g*k)+h*j),n.handles.del.disc.transform("...T"+i+","+g),n.handles.del.disc.transform("...R"+n.attrs.rotate)),n.handles.lock&&(n.handles.lock.disc.toFront(),g=-f-n.attrs.size.x*n.attrs.scale.x*.5,h=f+n.attrs.size.y*n.attrs.scale.y*.5,i=(360-n.attrs.rotate)/180*Math.PI,j=Math.cos(i),k=Math.sin(i),i=n.attrs.translate.x+(g*j+h*k),g=n.attrs.translate.y+(-(g*k)+h*j),n.handles.lock.disc.transform("...T"+i+","+g),n.handles.lock.disc.transform("...R"+n.attrs.rotate)),0<=n.opts.rotate.indexOf("self")&&(c=Math.max(Math.sqrt(Math.pow(a[1].x-a[0].x,2)+Math.pow(a[1].y-a[0].y,2)),Math.sqrt(Math.pow(a[2].x-a[1].x,2)+Math.pow(a[2].y-a[1].y,2)))/2),n.handles.x.disc.toFront(),g=f+n.attrs.size.x*n.attrs.scale.x*.5,h=f+n.attrs.size.y*n.attrs.scale.y*.5,i=(360-n.attrs.rotate)/180*Math.PI,j=Math.cos(i),k=Math.sin(i),i=n.attrs.translate.x+(g*j+h*k),g=n.attrs.translate.y+(-(g*k)+h*j),n.handles.x.disc.transform("...T"+i+","+g),n.handles.x.disc.transform("...R"+n.attrs.rotate),n.handles.y.disc.toFront(),g=-f-n.attrs.size.x*n.attrs.scale.x*.5,h=-f-n.attrs.size.y*n.attrs.scale.y*.5,i=(360-n.attrs.rotate)/180*Math.PI,j=Math.cos(i),k=Math.sin(i),i=n.attrs.translate.x+(g*j+h*k),g=n.attrs.translate.y+(-(g*k)+h*j),n.handles.y.disc.transform("...T"+i+","+g),n.handles.y.disc.transform("...R"+n.attrs.rotate),n},n.showHandles=function(){var b=["x","y","center","del","lock"];if(n.hideHandles(),n.axes.map(function(a){n.handles[a]={},e(),"x"==a?n.handles.x.disc=k.image("http://open.dev.jzw.la/designer/html5/ezd/images/bbResize.png",n.attrs.center.x-15,n.attrs.center.y-15,30,30).attr(n.opts.attrs):n.handles.y.disc=k.image("http://open.dev.jzw.la/designer/html5/ezd/images/bbRotate.png",n.attrs.center.x-15,n.attrs.center.y-15,30,30).attr(n.opts.attrs)}),0<=n.opts.draw.indexOf("bbox")){n.bbox=k.path("").attr({stroke:n.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),n.handles.bbox=[];var c,d;for(c=0<=n.opts.scale.indexOf("bboxCorners")?0:4;c<(-1===n.opts.scale.indexOf("bboxSides")?4:8);c++)d={},d.axis=c%2?"x":"y",d.isCorner=4>c,d.element=k.rect(n.attrs.center.x,n.attrs.center.y,2*n.opts.size[d.isCorner?"bboxCorners":"bboxSides"],2*n.opts.size[d.isCorner?"bboxCorners":"bboxSides"]).attr(n.opts.attrs),n.handles.bbox[c]=d}for(-1!==n.opts.draw.indexOf("circle")&&(n.circle=k.circle(0,0,0).attr({stroke:n.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.3})),-1!==n.opts.drag.indexOf("center")&&(n.handles.center={},n.handles.center.disc=k.image("http://open.dev.jzw.la/designer/html5/ezd/images/tp.png",n.attrs.center.x-15,n.attrs.center.y-15,30,30).attr(n.opts.attrs)),-1!==n.opts.lock.indexOf("lock")&&(n.handles.lock={},n.handles.lock.disc=k.image("http://open.dev.jzw.la/designer/html5/ezd/images/bbLock.png",n.attrs.center.x-15,n.attrs.center.y-15,30,30).attr(n.opts.attrs),n.handles.lock.disc.node.onclick=function(){console.debug(n.handles.lock),-1!==n.opts.keepRatio.indexOf("axisX")?(n.opts.keepRatio=[],n.handles.lock.disc.node.src="http://open.dev.jzw.la/designer/html5/ezd/images/bbUnLock.png"):(n.opts.keepRatio=["axisX","axisY"],n.handles.lock.disc.node.src="http://open.dev.jzw.la/designer/html5/ezd/images/bbLock.png")}),-1!==n.opts.del.indexOf("del")&&(n.handles.del={},n.handles.del.disc=k.image("http://open.dev.jzw.la/designer/html5/ezd/images/bbClose.png",n.attrs.center.x-15,n.attrs.center.y-15,30,30).attr(n.opts.attrs),n.handles.del.disc.node.onclick=deleteUserImage),c=0;c<b.length;c++);n.axes.map(function(a){if(n.handles[a]){var b=-1!==n.opts.rotate.indexOf("axis"+a.toUpperCase()),c=-1!==n.opts.scale.indexOf("axis"+a.toUpperCase());n.handles[a].disc.drag(function(d,e){n.o.viewBoxRatio&&(d*=n.o.viewBoxRatio.x,e*=n.o.viewBoxRatio.y);var g=d+n.handles[a].disc.ox,i=e+n.handles[a].disc.oy;console.debug(n.handles[a].disc.ox);var k={x:0>n.o.scale.x,y:0>n.o.scale.y};if(b){var l=Math.atan2(i-n.o.center.y-n.o.translate.y,g-n.o.center.x-n.o.translate.x);n.attrs.rotate=180*l/Math.PI-("y"===a?225:45),k[a]&&(n.attrs.rotate-=180)}n.opts.boundary&&(g=Math.max(Math.min(g,n.opts.boundary.x+n.opts.boundary.width),n.opts.boundary.x),i=Math.max(Math.min(i,n.opts.boundary.y+n.opts.boundary.height),n.opts.boundary.y)),g=Math.sqrt(Math.pow(g-n.o.center.x-n.o.translate.x,2)+Math.pow(i-n.o.center.y-n.o.translate.y,2)),c&&(n.attrs.scale[a]=g/(n.o.size[a]/2*n.opts.distance),k[a]&&(n.attrs.scale[a]*=-1)),f(),-1!==n.opts.keepRatio.indexOf("axis"+a.toUpperCase())?h(a):n.attrs.ratio=n.attrs.scale.x/n.attrs.scale.y,n.attrs.scale.x&&n.attrs.scale.y&&n.apply(),j([b?"rotate":null,c?"scale":null])},function(){n.o=i(n.attrs),k._viewBox&&(n.o.viewBoxRatio={x:k._viewBox[2]/k.width,y:k._viewBox[3]/k.height}),n.handles[a].disc.ox=this.attrs.cx,n.handles[a].disc.oy=this.attrs.cy,j([b?"rotate start":null,c?"scale start":null])},function(){j([b?"rotate end":null,c?"scale end":null])})}}),0<=n.opts.draw.indexOf("bbox")&&(-1!==n.opts.scale.indexOf("bboxCorners")||-1!==n.opts.scale.indexOf("bboxSides"))&&n.handles.bbox.map(function(a){a.element.drag(function(b,c){n.o.viewBoxRatio&&(b*=n.o.viewBoxRatio.x,c*=n.o.viewBoxRatio.y);var d,e,k,l,m,o=i(n.attrs);if(d=n.o.rotate.sin,e=n.o.rotate.cos,l=b*d+c*e,k=(b*e-c*d)*Math.abs(a.x),l*=Math.abs(a.y),n.attrs.translate={x:n.o.translate.x+(k*e+l*d)/2,y:n.o.translate.y+(k*-d+l*e)/2},l=n.o.handlePos.cx+b-n.attrs.center.x-n.attrs.translate.x,m=n.o.handlePos.cy+c-n.attrs.center.y-n.attrs.translate.y,k=l*e-m*d,l=l*d+m*e,a.isCorner&&-1!==n.opts.keepRatio.indexOf("bboxCorners")){m=n.attrs.size.x*n.attrs.scale.x/(n.attrs.size.y*n.attrs.scale.y);var p=1/m*a.x*k,q=l*a.y*m;q>p*m?k=q*a.x:l=p*a.y}n.attrs.scale={x:2*k*a.x/n.o.size.x||n.attrs.scale.x,y:2*l*a.y/n.o.size.y||n.attrs.scale.y},g().x&&g().y||(n.attrs=o),f(),(a.isCorner&&-1!==n.opts.keepRatio.indexOf("bboxCorners")||!a.isCorner&&-1!==n.opts.keepRatio.indexOf("bboxSides"))&&(h(a.axis),k=(n.attrs.scale.x-n.o.scale.x)*n.o.size.x*a.x,o=(n.attrs.scale.y-n.o.scale.y)*n.o.size.y*a.y,n.attrs.translate.x=n.o.translate.x+(k*e+o*d)/2,n.attrs.translate.y=n.o.translate.y+(-k*d+o*e)/2),n.attrs.ratio=n.attrs.scale.x/n.attrs.scale.y,j(["scale"]),n.apply()},function(){var b=(360-n.attrs.rotate)%360/180*Math.PI,c=a.element.attr(["x","y"]);n.o=i(n.attrs),n.o.handlePos={cx:c.x+n.opts.size[a.isCorner?"bboxCorners":"bboxSides"],cy:c.y+n.opts.size[a.isCorner?"bboxCorners":"bboxSides"]},n.o.rotate={sin:Math.sin(b),cos:Math.cos(b)},k._viewBox&&(n.o.viewBoxRatio={x:k._viewBox[2]/k.width,y:k._viewBox[3]/k.height}),j(["scale start"])},function(){j(["scale end"])})}),b=[],0<=n.opts.drag.indexOf("self")&&-1===n.opts.scale.indexOf("self")&&-1===n.opts.rotate.indexOf("self")&&b.push(a),0<=n.opts.drag.indexOf("center")&&b.push(n.handles.center.disc),b.map(function(b){b.drag(function(a,b){n.o.viewBoxRatio&&(a*=n.o.viewBoxRatio.x,b*=n.o.viewBoxRatio.y),n.attrs.translate.x=n.o.translate.x+a,n.attrs.translate.y=n.o.translate.y+b;var c=i(n.o.bbox);c.x+=a,c.y+=b,f(c),j(["drag"]),n.apply()},function(){n.o=i(n.attrs),n.opts.snap.drag&&(n.o.bbox=a.getBBox()),k._viewBox&&(n.o.viewBoxRatio={x:k._viewBox[2]/k.width,y:k._viewBox[3]/k.height}),n.axes.map(function(a){n.handles[a]&&(n.handles[a].disc.ox=n.handles[a].disc.attrs.cx,n.handles[a].disc.oy=n.handles[a].disc.attrs.cy)}),j(["drag start"])},function(){j(["drag end"])})});var l=0<=n.opts.rotate.indexOf("self"),m=0<=n.opts.scale.indexOf("self");return(l||m)&&a.drag(function(a,b,c,d){l&&(console.debug(c),a=Math.atan2(d-n.o.center.y-n.o.translate.y,c-n.o.center.x-n.o.translate.x),n.attrs.rotate=n.o.rotate+180*a/Math.PI-n.o.deg),a=0>n.o.scale.x,b=0>n.o.scale.y,m&&(c=Math.sqrt(Math.pow(c-n.o.center.x-n.o.translate.x,2)+Math.pow(d-n.o.center.y-n.o.translate.y,2)),n.attrs.scale.x=n.attrs.scale.y=(a?-1:1)*n.o.scale.x+(c-n.o.radius)/(n.o.size.x/2),a&&(n.attrs.scale.x*=-1),b&&(n.attrs.scale.y*=-1)),f(),n.apply(),j([l?"rotate":null,m?"scale":null])},function(a,b){n.o=i(n.attrs),n.o.deg=180*Math.atan2(b-n.o.center.y-n.o.translate.y,a-n.o.center.x-n.o.translate.x)/Math.PI,n.o.radius=Math.sqrt(Math.pow(a-n.o.center.x-n.o.translate.x,2)+Math.pow(b-n.o.center.y-n.o.translate.y,2)),k._viewBox&&(n.o.viewBoxRatio={x:k._viewBox[2]/k.width,y:k._viewBox[3]/k.height}),j([l?"rotate start":null,m?"scale start":null])},function(){j([l?"rotate end":null,m?"scale end":null])}),n.updateHandles(),n},n.hideHandles=function(a){return a=a||{},"undefined"==typeof a.undrag&&(a.undrag=!0),a.undrag&&n.items.map(function(a){a.el.undrag()}),n.handles.center&&(n.handles.center.disc.remove(),n.handles.center=null),["x","y"].map(function(a){n.handles[a]&&(n.handles[a].disc.remove(),n.handles[a]=null)}),n.bbox&&(n.bbox.remove(),n.bbox=null,n.handles.bbox&&(n.handles.bbox.map(function(a){a.element.remove()}),n.handles.bbox=null)),n.circle&&(n.circle.remove(),n.circle=null),n.handles.del&&(n.handles.del.disc.remove(),n.handles.del=null),n.handles.lock&&(n.handles.lock.disc.remove(),n.handles.lock=null),n},n.setOpts=function(a,b){n.callback="function"==typeof b?b:!1;var c,d;for(c in a)if(a[c]&&a[c].constructor===Object)for(d in a[c])a[c].hasOwnProperty(d)&&(n.opts[c][d]=a[c][d]);else n.opts[c]=a[c];return!0===n.opts.animate&&(n.opts.animate={delay:700,easing:"linear"}),!0===n.opts.drag&&(n.opts.drag=["center","self"]),!0===n.opts.keepRatio&&(n.opts.keepRatio=["bboxCorners","bboxSides"]),!0===n.opts.rotate&&(n.opts.rotate=["axisY"]),!0===n.opts.scale&&(n.opts.scale=["axisX","bboxCorners","bboxSides"]),n.opts.del=["del"],n.opts.lock=["lock"],["drag","draw","keepRatio","rotate","scale"].map(function(a){!1===n.opts[a]&&(n.opts[a]=[])}),n.axes=[],(0<=n.opts.rotate.indexOf("axisX")||0<=n.opts.scale.indexOf("axisX"))&&n.axes.push("x"),(0<=n.opts.rotate.indexOf("axisY")||0<=n.opts.scale.indexOf("axisY"))&&n.axes.push("y"),["drag","rotate","scale"].map(function(a){n.opts.snapDist[a]||(n.opts.snapDist[a]=n.opts.snap[a])}),n.opts.range={rotate:[parseFloat(n.opts.range.rotate[0]),parseFloat(n.opts.range.rotate[1])],scale:[parseFloat(n.opts.range.scale[0]),parseFloat(n.opts.range.scale[1])]},n.opts.snap={drag:parseFloat(n.opts.snap.drag),rotate:parseFloat(n.opts.snap.rotate),scale:parseFloat(n.opts.snap.scale)},n.opts.snapDist={drag:parseFloat(n.opts.snapDist.drag),rotate:parseFloat(n.opts.snapDist.rotate),scale:parseFloat(n.opts.snapDist.scale)},"string"==typeof n.opts.size&&(n.opts.size=parseFloat(n.opts.size)),isNaN(n.opts.size)||(n.opts.size={axes:n.opts.size,bboxCorners:n.opts.size,bboxSides:n.opts.size,center:n.opts.size}),n.showHandles(),j(["init"]),n},n.setOpts(b,c),n.apply=function(){return n.items.map(function(a,b){var c=n.attrs.center.x+n.offset.translate.x,d=n.attrs.center.y+n.offset.translate.y,e=n.attrs.rotate-n.offset.rotate,f=n.attrs.scale.x/n.offset.scale.x,g=n.attrs.scale.y/n.offset.scale.y,h=n.attrs.translate.x-n.offset.translate.x,i=n.attrs.translate.y-n.offset.translate.y;n.opts.animate?(j(["animate start"]),a.el.animate({transform:["R",e,c,d,"S",f,g,c,d,"T",h,i]+n.items[b].transformString},n.opts.animate.delay,n.opts.animate.easing,function(){j(["animate end"]),n.updateHandles()})):(a.el.transform(["R",e,c,d,"S",f,g,c,d,"T",h,i]+n.items[b].transformString),j(["apply"]),n.updateHandles())}),n},n.unplug=function(){var b=n.attrs;return n.hideHandles(),delete a.freeTransform,b},d(a),n.items.map(function(a,b){a.el._&&a.el._.transform&&"object"==typeof a.el._.transform&&a.el._.transform.map(function(a){if(a[0])switch(a[0].toUpperCase()){case"T":n.items[b].attrs.translate.x+=a[1],n.items[b].attrs.translate.y+=a[2];break;case"S":n.items[b].attrs.scale.x*=a[1],n.items[b].attrs.scale.y*=a[2];break;case"R":n.items[b].attrs.rotate+=a[1]}})}),"set"!==a.type&&(n.attrs.rotate=n.items[0].attrs.rotate,n.attrs.scale=n.items[0].attrs.scale,n.attrs.translate=n.items[0].attrs.translate,n.items[0].attrs={rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},n.items[0].transformString=""),n.attrs.ratio=n.attrs.scale.x/n.attrs.scale.y;var o=!1;return n.updateHandles(),n},function(a){a.el.cloneToPaper=function(a){return!this.removed&&a[this.type]().attr(this.attr())},a.st.cloneToPaper=function(a){return console.log("ID",a.canvas.id),a.setStart(),this.forEach(function(b){b.cloneToPaper(a)}),a.setFinish()}}(window.Raphael),EmptyUI.prototype.setEZD=function(a){},EmptyUI.prototype.addText=function(a){},EmptyUI.prototype.addSvg=function(a){},EmptyUI.prototype.addImage=function(a){},EmptyUI.prototype.updateLayers=function(){},EmptyUI.prototype.updateProduct=function(){},EmptyUI.prototype.updateLayers=function(){};var pcaDirective=function(){var a={};return a.restrict="E",a.replace=!0,a.compile=function(a,b){var c=function(a,b,c){a.province="北京市",a.city="市辖区",a.area="东城区",a.provinces=pca.getProvinces(),a.cities=pca.getCities(a.province),a.areas=pca.getAreas(a.province,a.city),a.changeProvince=function(){a.cities=pca.getCities(a.province),a.city=a.cities[0],a.changeCity()},a.changeCity=function(){a.areas=pca.getAreas(a.province,a.city),a.area=a.areas[0]}};return c},a},showModalDirective=["$compile",function(a){return function(b,c,d){c.click(function(){showModal(d.ngShowModal,b,a)})}}],visibleDirective=function(){return function(a,b,c){a.$watch(c.ngVisible,function(a){b.css("visibility",a?"visible":"hidden")})}},showDrawerDirective=["$compile",function(a){return{link:function(b,c,d){var e=d.isDrawerWidth,f=d.isShowDrawer,g=function(){};c.click(function(){showModalDrawer(f,b,a,e,g,null,d)})}}}],selectOnEnterTextboxDirective=function(){return{link:function(a,b,c){b.focus(function(){function a(){return b.off("mouseup",a),!1}b.select(),window.setTimeout(function(){b.select()},1),b.mouseup(a)})}}},hideDrawersDirective=function(){return{link:function(a,b,c){b.click(function(){0<$("#drawersContainer").width()&&($("#drawersContainer:animated").length||hideModalDrawer("animate"))})}}},showFontsDirective=function(){return{link:function(a,b,c){a.showFonts||b.click(function(){a.showFonts=1,a.showClose=1,a.$apply()})}}},hideFontsDirective=function(){return{link:function(a,b,c){b.click(function(){a.showFonts=0,a.showClose=0,a.$apply()})}}},autoFocusDirective=function(){return function(a,b,c){setTimeout(function(){b.focus()},50)}},autoSelect=function(){return function(a,b,c){b.focus(function(){setTimeout(function(){b[0].select()},10)})}},closeWhenClickOutside=["$parse",function(a){return function(b,c,d){var e=d.isInlineModal;$(document).mousedown(function(d){var f=d.target;(f===document||"HTML"===f.tagName)&&(f=d.currentTarget.activeElement),!c.is(f)&&0===c.has(f).length&&c.is(":visible")&&(b.$eval(e)?(a(e).assign(b,!1),b.$$phase||b.$apply()):c.hide())})}}],closeWhenClickOutsideDropDown=function(){return function(a,b,c){$(document).mouseup(function(c){var d=c.target;(d===document||"HTML"===d.tagName)&&(d=c.currentTarget.activeElement),!b.is(d)&&0===b.has(d).length&&b.is(":visible")&&(a.showingInlineModal?(a.showingInlineModal=!1,a.$$phase||a.$apply()):(b.slideUp(300),$("#"+b.attr("id")+"-close-btn").hide(),$("#"+b.attr("id")+"-select-arrow").show()))})}},closeWhenClickOutsideDropDownShow=function(){return function(a,b,c){b.click(function(a){"block"!=$("#"+b.data("dropdownid")).css("display")&&(a=b.data("dropdownid"),$("#"+a).slideDown(300),$("#"+a+"-select-arrow").hide(),$("#"+a+"-close-btn").show())})}},closeWhenClickOutsideDropDownHide=function(){return function(a,b,c){b.click(function(a){"block"==$("#"+b.data("dropdownid")).css("display")&&(a=b.data("dropdownid"),$("#"+a).slideUp(300),$("#"+a+"-select-arrow").show(),$("#"+a+"-close-btn").hide())})}},autoLoadFileInput=function(){return function(a,b,c){var d=function(){var c=b[0];if(c.files&&c.files[0]){var e=new FileReader;e.onload=function(e){a.fileDataReady&&a.fileDataReady(e.target.result,c.files[0]);var f=$("<input type='file' name='"+b[0].name+"' id='"+b[0].id+"' />");$.each(b[0].attributes,function(a,b){var c=b.name,d=b.value;"type"!=c&&f.attr(c,d)}),b.replaceWith(f),f.change(d),b=f},e.readAsDataURL(c.files[0])}};b.change(d)}},textboxTimerChangeDirective=["$parse",function(a){return{link:function(b,c,d){var e=null;c.on("input paste",function(c){e&&clearTimeout(e),e=setTimeout(function(){var e=a(d.isTimerChange);e&&e(b,{$event:c})},parseInt(d.interval))})}}}],formSubmitDirective=["$parse",function(a){return{restrict:"A",require:"form",link:function(b,c,d,e){setTimeout(function(){c.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown")},0);var f=d.validClass||"isd-valid",g=d.invalidClass||"isd-invalid",h=function(a){var b=!0;return a.find("[data-input-type]").each(function(){if($(this).is(":visible")){var a;if(a=b){a=this.value;var c=$(this).data("input-type"),c=base.validators[c];a="function"==typeof c?c(a,this):c.test(a),c=$(this).closest(".isd-form-group"),c.length||(c=$(this).parent()),a?(c.addClass(f),c.removeClass(g)):(c.addClass(g),c.removeClass(f))}b=a}}),b};c.on("submit",function(e){return h(c)?(a(d.isSubmit)(b,{$event:e}),void(b.$$phase||b.$apply())):(e.preventDefault(),!1)})}}}],colorsTooltipDirective=function(){return function(a,b,c){b.bind("mouseover",function(){var c=b.attr("data-color"),c=a.getColorName(c),d=$("#dsContainer"),e=-d.offset().top+b.offset().top-b.height()-20,f=-d.offset().left+b.offset().left-b.width()/2+32;d.append('<div class="isd-tooltip-color"><span class="isd-color-name">'+c+'</span><span class="isd-color-tool-tip-arrow-down"></span></div>'),$(".isd-tooltip-color").css("top",e).css("left",f-$(".isd-tooltip-color").outerWidth(!1)/2).css("z-index",1009)}),b.on("mouseleave",function(){$(".isd-tooltip-color").remove()}),b.bind("click",function(){$(".isd-tooltip-color").remove()})}},tooltipDirective=function(){return function(a,b,c){a=$("#tooltipsContainer"),a.length||($(document.body).append("<div id='tooltipsContainer'></div>"),a=$("#tooltipsContainer")),a.append('<div id="tooltip'+c.isTooltip+'" class="isd-buttonTooltip"></div>'),b.on("mouseenter",function(){if(state.tooltips){var a=c.isTooltip;if(state.tooltips[a]){var d=$("#tooltip"+c.isTooltip),e=b.offset(),f=b[0].clientWidth,g=b[0].clientHeight,h=$(document.body).height(),i=$(document.body).width();d.css("visibility","hidden"),d.show();var j=d[0].clientHeight,k=d[0].clientWidth;d.css("visibility","visible"),d.hide(),f=e.left+f+0,g=e.top+g+0,e.left>.6*i&&(f=e.left-k-0),e.top>.6*h&&(g=e.top-j-0),d.css("left",f),d.css("top",g),$("#tooltip"+a).fadeIn("fast")}}}),b.on("mouseleave",function(){$("#tooltip"+c.isTooltip).fadeOut("fast")})}},disabledDirective=function(){function a(a){a.preventDefault()}return{link:function(b,c,d){b.$watch(d.isDisabled,function(b){c.removeClass("isd-disabled"),b&&c.addClass("isd-disabled");var d=c.prop("tagName").toUpperCase();"A"==d?b?c.on("click",a):c.off("click",a):("INPUT"==d||"SELECT"==d||"TEXTAREA"==d||"BUTTON"==d)&&(b?c.prop("disabled",!0):c.prop("disabled",!1))})}}},requiredDirective=function(){return{link:function(a,b,c){a.$watch(c.isRequired,function(a){b.removeClass("isd-required"),a&&b.addClass("isd-required");var c=b.prop("tagName").toUpperCase();("INPUT"==c||"SELECT"==c||"TEXTAREA"==c||"BUTTON"==c)&&(a?b.prop("required",!0):b.prop("required",!1))})}}},printElementDirective=function(){return{link:function(a,b,c){a.$watch(function(){return c.isPrintElement},function(a){a&&"false"!=a&&(document.getElementById("isdPrintElement")||$(document.body).prepend("<div id='isdPrintElement'></div>"),a=$("#isdPrintElement"),a.html(b.html()),window.print())})}}},scrollPagerDirective=["$timeout",function(a){return{restrict:"A",transclude:!0,template:'<div class="isd-scrollPagerContainer"><div ng-transclude></div><div class="isd-direction-arrow"><a class="isd-direction-up"><i>&nbsp;</i></a><a class="isd-direction-down"><i>&nbsp;</i></a></div>',scope:{pageSize:"@",itemHeight:"@"},link:function(b,c,d){c.css("overflow","hidden"),c.css("height","100%");var e=function(){var a=c.find("a.isd-direction-up"),d=c.find("a.isd-direction-down");b.scrollPosition>=c[0].scrollHeight-c[0].offsetHeight?d.hide():d.show(),0>=b.scrollPosition?a.hide():a.show()};b.scrollPosition=0,a(e,10),d=c.find("a.isd-direction-up"),c.find("a.isd-direction-down").click(function(){b.scrollPosition+=.75*c[0].offsetHeight,c[0].scrollTop=b.scrollPosition,e()}),d.click(function(){b.scrollPosition=Math.max(0,b.scrollPosition-.75*c[0].offsetHeight),c[0].scrollTop=b.scrollPosition,e()}),c.click(function(){a(e,10)}),b.$watch(function(){return c[0].scrollHeight+":"+c[0].offsetHeight},function(){e(c)})}}}],verticallyCenteredDirective=function(){return{restrict:"A",transclude:!0,template:'<div ng-transclude class="isd-verticallyCentered"></div>',scope:{},link:function(a,b,c){b.parent(),c=b.find("img");var d=function(a){if(!a.centered&&a.is(":visible")){var b=a.parent(),c=a.find("img");areImagesLoaded(c)?(c.show(),(c=a[0].offsetHeight)&&(b.height()>c?(b=(b.height()-a[0].offsetHeight)/2,a.css("margin-top",b+"px")):a.css("margin-top","0px"),a.centered=!0)):c.load(function(){d(a)})}};areImagesLoaded(c)?d(b):(c.load(function(){d(b)}),c.hide()),a.$watch(function(){return b.is(":visible")},function(){d(b)})}}},loadingDirective=function(){return function(a,b,c){a.$watch(c.isLoading,function(a){$(b).LoadingScript("method_12",{background_image:ezdVars.DesignerLocation+"/common/images/loading20.png",main_width:32,animation_speed:10,additional_style:"",after_element:!1})})}},cartNavigationDirective=function(){var a=[];return a.push({description:"Select Sizes, Colors and Quantities",modalName:"selectSizes",index:0,isDisabled:function(){return!1}}),a.push({description:"Login",modalName:"cartLogin",index:1,isDisabled:function(){return state.activeUserToken&&state.currentUserToken}}),a.push({description:"Save Design",modalName:"saveDesign",index:2,isDisabled:function(){return state.designSaveResult||!state.selectedDesign||state.selectedDesign.isEmpty()}}),a.push({description:"View Cart",modalName:"viewCart",index:3,isDisabled:function(){return!1}}),a.push({description:"Payment Options",modalName:"enterPayment",index:4,isDisabled:function(){return!ezdVars.EnableCartCheckout||ezdVars.PaymentDisabled}}),a.push({description:"Billing Address",modalName:"enterAddresses",index:5,isDisabled:function(){return!ezdVars.EnableCartCheckout}}),a.push({description:"Shipping Method",modalName:"shippingMethod",index:6,isDisabled:function(){return!ezdVars.EnableCartCheckout||!ezdVars.EnableCartShipping}}),a.push({description:"Review Order",modalName:"reviewOrder",index:7,isDisabled:function(){return!ezdVars.EnableCartCheckout}}),{restrict:"E",transclude:!0,templateUrl:state.theme.url(ezdVars.DesignerLocation+"/ds/html/cart/cartNavigation.html"),scope:{},link:function(b,c,d){if(c=parseInt(d.stepNumber),0==c)for(d=0;d<a.length;d++){var e=a[d];"undefined"==typeof e.isDisabledValue&&(e.isDisabledValue=e.isDisabled())}b.previousSteps=[];var f=0;for(d=0;c>=d;d++)e=a[d],e.isDisabledValue||(e.number=f,f++,b.previousSteps.push(e));for(b.nextSteps=[],d=c+1;8>d;d++)e=a[d],e.isDisabledValue||(e.number=f,f++,b.nextSteps.push(e))}}},ngAttrDirective=attrDirective("",!0);Namespace("ui.directives"),ui.directives.pagerDirective=["$parse",function(a){var b=function(a){this.allData=null,this.pageSize=a,this.currentPageNum=0,this.__defineGetter__("currentPage",function(){return this.allData?this.allData.slice(this.currentPageNum*this.pageSize,this.currentPageNum*this.pageSize+this.pageSize):[]}),this.__defineGetter__("pageNumbers",function(){if(!this.allData)return[];var a=[],b=Math.ceil(this.allData.length/this.pageSize);if(1>=b)return[];for(var c=0;b>c;c++)a.push(c);return a})};return{link:function(c,d,e){c[e.isPager+"Pager"]=new b(parseInt(e.pageSize)),c[e.isPager+"Pager"].allData=a(e.isPager)(c),c.$watch(e.isPager,function(){c[e.isPager+"Pager"].allData=a(e.isPager)(c)})}}}],ui.directives.colorPickerDirective=["$parse",function(a){
return{link:function(b,c,d){c.spectrum({flat:!0,showInput:!0,allowEmpty:!1,preferredFormat:"hex",showButtons:!1,color:"#FFFFFF",move:function(c){ezdVars.ArtToolsMode&&(a(d.ngModel).assign(b,c.toHexString()),(c=a(d.ngChange))&&c(b))}})}}}],ui.directives.errorSrcDirective=function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.isErrorSrc&&c.$set("src",c.isErrorSrc)})}}},ui.directives.imgLoadingOverlay=function(){return{link:function(a,b,c){var d=$(c.isImgPreload);0<!b.parent().has(d).length&&(d=d.clone(),b.parent().append(d)),d.show(),b.load(function(){d.hide()}),b.error(function(){d.hide()})}}},ui.directives.addThis=function(){return{link:function(a,b,c){setTimeout(function(){if(0!=location.href.indexOf("file:")){var a=c.designId;window.addthis_share={url:"http://"+ezdVars.ApiDomain+"/"+ezdVars.AppURI+"/Design/"+encodeURI(c.designName)+"_"+a},document.getElementById("addThisWidget")?addthis.toolbox("#"+b[0].id):service.loadScript("https://s7.addthis.com/js/250/addthis_widget.js#pubid="+ezdVars.AddThisPublisherId,"addThisWidget",function(){addthis.toolbox("#"+b[0].id)})}},50)}}},Namespace("ui.common"),ui.common.Design=function(a){Object.defineProperty(this,"design_id",{get:function(){return a.design.information||(a.design.information={}),a.design.information.design_id},set:function(b){a.design.information||(a.design.information={}),a.design.information.design_id=b}}),Object.defineProperty(this,"canvas",{get:function(){return a.activeSide}}),Object.defineProperty(this,"canvases",{get:function(){return a.product.sides}}),Object.defineProperty(this,"canvas_text",{get:function(){for(var b=[],c=0;c<a.activeSide.elements.length;c++){var d=a.activeSide.elements[c];d instanceof ui.text.TextElement&&b.push(d)}return b}}),Object.defineProperty(this,"canvas_art",{get:function(){for(var b=[],c=0;c<a.activeSide.elements.length;c++){var d=a.activeSide.elements[c];d instanceof ui.text.TextElement||b.push(d)}return b}}),this.isEmpty=function(b){if(!a.product.sides||!a.product.sides.length)return!0;if(b)return!a.activeSide.elements||!a.activeSide.elements.length;for(b=0;b<a.product.sides.length;b++){var c=a.product.sides[b];if(c.elements&&c.elements.length)return!1}return!0}},Namespace("ui"),ui.ThemeEditor=function(a){var b=this;this.rules=a,this.makeUI=function(){for(var c=$("<form id='isd-themeEditor'><button type='button' id='isd-saveThemeButton'>Save</button><button type='button' id='isd-resetThemeButton'>Reset</button></form>").prependTo(document.body),d={},e=0;e<a.length;e++){var f=a[e];d[f.group]||(d[f.group]=[]),d[f.group].push(f),"color"==f.type?f.html="<li><span>"+f.label+':</span> <input type="color" name="'+f.id+'" id="'+f.id+'" class="themeControl" value= "'+f["default"]+'"/></li>':"text"==f.type&&(f.html="<li><span>"+f.label+':</span> <input type="text" name="'+f.id+'" id="'+f.id+'" class="themeControl" value= "'+f["default"]+'"/></li>')}for(var g in d)c.append('<a class="groupLabel" href="#group'+g.replace(/ /gi,"")+'">'+g+"</a>");for(g in d){for(var h='<ul id="group'+g.replace(/ /gi,"")+'" class="groupControls" style="display:none">',e=0;e<d[g].length;e++)f=d[g][e],h+=f.html;h+="</ul>",c.append(h)}$("a.groupLabel").click(function(a){var b=$($(a.currentTarget).attr("href"));$(".groupLabel").removeClass("active"),b.is(":visible")?b.slideUp():($(".groupControls").hide(),b.slideDown(),$(a.currentTarget).addClass("active"))}),$("#isd-saveThemeButton").click(function(){b.saveChanges()}),$("#isd-resetThemeButton").click(function(){for(var c=0;c<a.length;c++)$("#"+a[c].id).val(a[c]["default"]);b.applyChangesToDocument()}),$(".themeControl").change(this.applyChangesToDocument),this.getChanges(function(a){a&&$(a).find("Setting").each(function(){var a=$("#"+$(this).attr("rule_id"));a&&a.val($(this).attr("value"))})})},this.applyChangesToDocument=function(){$("#isd-themeCustomization").remove();for(var b="<style id='isd-themeCustomization'>",c=0;c<a.length;c++){var d=a[c];if("color"==d.type)b+=d.css[0].replace(/%%value%%/gi,$("#"+d.id).val());else if("cssChoice"!=d.type&&"text"==d.type){var e=$(d.selector).text();(ezdVars.EditTheme||e==d["default"])&&$(d.selector).text($("#"+d.id).val())}}$("head").append(b+"</style>")},this.saveChanges=function(){var b={};$("#isd-themeEditor input").each(function(){b[this.id]=$(this).val()});for(var c in b){var d=findMatch(a,function(a){return a.id==c});b[c]==d["default"]&&delete b[c]}$.ajax({type:"POST",url:"http://"+ezdVars.ApiDomain+"/"+ezdVars.AppURI+"/Config/UploadDesignerTheme/",data:b,dataType:"text/plain"})},this.getChanges=function(a){$.ajax({type:"GET",url:"http://"+ezdVars.ApiDomain+"/images/publishers/"+ezdVars.PublisherID+"/stores/"+ezdVars.AppURI+"/dsTheme.xml",dataType:"xml",success:function(b){a&&a(b)},error:function(){a&&a(null)}})},this.updateAtBeginning=function(c){if(c){this.currentSettings={},$("#isd-themeCustomization").remove();var d="<style id='isd-themeCustomization'>";$(c).find("Setting").each(function(){var c=$(this).attr("rule_id"),e=findMatch(a,function(a){return a.id==c});e&&(b.currentSettings[c]={rule:e,value:$(this).attr("value")},"color"==e.type&&(d+=e.css[0].replace(/%%value%%/gi,$(this).attr("value"))))}),this.updateLabels(),$("head").append(d+"</style>")}},this.updateLabels=function(){for(var a in this.currentSettings){var b=this.currentSettings[a],c=b.rule;"text"==c.type&&$(c.selector).text().toLowerCase()==c["default"].toLowerCase()&&$(c.selector).text(b.value)}}},ui.FontManager=function(a){var b=this,c=state.fontCategories.slice(0);a?deleteMatches(c,function(a){return"0"==a.IsEmbroidery}):deleteMatches(c,function(a){return"1"==a.IsEmbroidery}),this.getCategories=function(){return c},this.addMissingDesignFonts=function(){var a=c[0],b=!1;0!=a.font_style_id&&(a={font_style_id:0,FontCount:0},a.IsEmbroidery=ezdVars.EmbroideryMode,a.font_style=a.style="In Use",a.fonts=[]);for(var d=0;d<state.selectedDesign.canvas_text.length;d++){var e=state.selectedDesign.canvas_text[d],f=findMatch(c,function(a){return a.font_style_id==e.fontStyleId}),g=0<=state.excludedFontIDs.indexOf(e.fontId)||!f;f&&f.fonts&&(findMatch(f.fonts,function(a){return a.font_id==e.fontId})||(g=!0)),f=findMatch(a.fonts,function(a){return a.font_id==e.fontId}),g&&(e.fontObject.fontStyle=a,e.fontObject.old_font_style_id=e.fontObject.font_style_id,e.fontObject.font_style_id=0,f||(b=b||0==a.FontCount,a.FontCount++,a.fonts.push(e.fontObject)))}b&&c.unshift(a)},this.getFontsByCategory=function(a,d){var e=findMatch(c,function(b){return b.font_style_id==a});e||(e=findMatch(c,function(a){return 0==a.font_style_id})),e.fonts&&e.fonts.length?d(e.fonts):service.getFontsByCategory(a,function(a){e.fonts=a;for(var c=0;c<a.length;c++)a[c].fontStyle=e,a[c].font_style_id=e.font_style_id;b.addMissingDesignFonts(),d(a)})},this.getFontDefaults=function(a){var b="popups",d="3D 03";ezdVars.HasGoogleFonts&&(b="Modern",d="Modern 20");var e=searchInArray(c,b,"style");e||(e=c[c.length-1]),this.getFontsByCategory(e.font_style_id,function(b){var c=searchInArray(b,d,"name");c||(c=b[0]),c.font_style_id=e.font_style_id,a({category:e,font:c})})},this.addMissingDesignFonts()},ui.DSUtils=function(){console.log("DSUtils init");var a=this;this.syncDesignCanvasesWithProductRegions=function(){},this.loadDesignInformation=function(b,c,d){state.selectedDesignID=state.selectedDesignID||0;var e=function(){state.initData&&(a.syncDesignCanvasesWithProductRegions(),state.designer?(a.synchronizeElementIDs(),b&&b()):state.selectedProductStyle&&state.selectedProductStyle.product_regions&&state.selectedProductStyle.product_regions.length?a.addDesigner(function(){a.synchronizeElementIDs(),b&&b()}):(state.designer={},b&&b()))},f=function(){ezdVars.EmbroideryMode=ezdVars.EmbroideryMode||"embroidery_demo"==ezdVars.AppURI,service.getInitialLoad(ezdVars.ProductID,ezdVars.ProductStyleID,ezdVars.EmbroideryMode,function(a){state.selectedProduct=a.product,state.selectedProductStyle=findMatch(a.product.product_styles,function(a){return a.product_style_id==ezdVars.ProductStyleID}),null!=state.selectedProduct&&null!=state.selectedProductStyle&&null!=state.selectedProductStyle.product_regions&&0!=state.selectedProductStyle.product_regions.length||alert("This product is not configured for use with the design studio.  Please select a different product."),state.selectedProductStyle.selectedRegion=state.selectedProductStyle.defaultRegion,state.storeInkColors=normalizeColorStrings(a.inkColors),state.fontCategories=a.fontCategories,state.excludedFontIDs=a.excludedFontIDs;for(var b=0;b<state.excludedFontIDs.length;b++)state.excludedFontIDs[b]=parseInt(state.excludedFontIDs[b],10);state.threadCharts=a.threadCharts,state.productXml=a.productResultXml,eventManager.trigger("selectedProductLoaded",a.product),state.initData=a,e(),console.debug("end...")},function(a){"Store is suspended"==a&&$("#ink_overlayWrap").show()})};ezdVars.UseDesignProduct&&service.getDesign(state.selectedDesignID,function(a){state.initData||(a.productStyle&&a.productStyle.product_id&&(ezdVars.ProductID=window.ezdProductID=state.selectedProductID=a.productStyle.product_id,ezdVars.ProductStyleID=window.ezdProductStyleID=state.selectedProductStyleID=a.productStyle.product_style_id),f()),e()}),ezdVars.UseDesignProduct||state.initData||f(),e()},this.getColorsForElement=function(a,b,c){var d=[];if(a instanceof ui.text.TextElement)if(a.isEmbroidery)a=getColorString(a.color1),d.push(a);else{b=getColorString(a.color);var e=getColorString(a.strokeColor);d.push(b),a.strokeColor&&1e-5<a.stroke&&d.push(e)}else if(e=a instanceof ui.svg.SvgElement?"vector":"raster",(a=a.colors||a.data.colors)&&(!b||"vector"==e||"emb"==e))for(b=0;b<a.length;b++)e=getColorString(a[b]),d.push(e);return c&&deleteMatches(d,function(a){return"none"==a}),d},this.getColorsInUse=function(a,b,c){var d=state.selectedDesign.canvas;if(a&&(d=findMatch(state.selectedDesign.canvases,function(b){return b.name.toLowerCase()==a.toLowerCase()}),!d))return[];for(var e=[],f=0;f<d.elements.length;f++)e=e.concat(this.getColorsForElement(d.elements[f],b,c));for(b=[],f=0;f<e.length;f++)c=e[f],searchInArray(b,c)||b.push(c);return b},this.getPricingColorData=function(){var b=function(a){var b=state.selectedDesign.canvas;if(a&&(b=findMatch(state.selectedDesign.canvases,function(b){return b.name.toLowerCase()==a.toLowerCase()}),!b))return!0;if(b.is_distressed&&"0"!=b.is_distressed)return!1;for(var c=0;c<b.elements.length;c++){var d=b.elements[c];if(d instanceof ui.bitmap.BitmapElement&&(d=d.data,!(d.colors&&d.colors.length||d.art_colors&&d.art_colors.length)))return!1}for(c=0;c<state.designer.design.sides.length;c++)if(b=state.designer.design.sides[c],b.is_distressed&&1==b.is_distressed)return!1;return!0},c={};return c.usrColors={front:a.getColorsInUse("front",!1,!0),back:a.getColorsInUse("back",!1,!0),left:a.getColorsInUse("third",!1,!0),right:a.getColorsInUse("fourth",!1,!0)},c.usrColors.all=c.usrColors.front.length+c.usrColors.back.length+c.usrColors.left.length+c.usrColors.right.length,c.numFrontColors=c.usrColors.front.length,c.isFrontVector=b("front"),c.numSleeveLeftColors=c.usrColors.left.length,c.isSleeveLeftVector=b("sleeveleft"),c.numSleeveRightColors=c.usrColors.right.length,c.isSleeveRightVector=b("sleeveright"),c.numBackColors=c.usrColors.back.length,c.isBackVector=b("back"),c.isFrontVector||(c.numFrontColors=100),c.isSleeveLeftVector||(c.numSleeveLeftColors=100),c.isSleeveRightVector||(c.numSleeveRightColors=100),c.isBackVector||(c.numBackColors=100),b=[],state.designer.getSideByName("front")&&b.push("Front: "+(c.isFrontVector?c.numFrontColors:"N/A - Digital Print")),state.designer.getSideByName("back")&&b.push("Back: "+(c.isBackVector?c.numBackColors:"N/A - Digital Print")),state.designer.getSideByName("sleeveleft")&&b.push("Sleeve Left: "+(c.isSleeveLeftVector?c.numSleeveLeftColors:"N/A - Digital Print")),state.designer.getSideByName("sleeveright")&&b.push("Sleeve Right: "+(c.isSleeveRightVector?c.numSleeveRightColors:"N/A - Digital Print")),c.sideColorString=b.join(", "),c.isAllVector=!1,c.isFrontVector&&c.isSleeveLeftVector&&c.isSleeveRightVector&&c.isBackVector&&(c.isAllVector=!0),c},this.addDesigner=function(b){"undefined"!=typeof Parser&&(window.parser=new Parser);var c={type:"ezd",width:500,height:500,container:$("#designerContainer"),ui:new EmptyUI,ajaxCallStarted:service.ajaxCallStarted,ajaxCallEnded:service.ajaxCallEnded,productXml:state.initData.productResultXml,designXml:state.initData.designXml},d=eventManager.on("rendered",function(){state.selectedDesign=new ui.common.Design(state.designer),a.synchronizeElementIDs(),b&&b(),d&&d()});c.hideVisibleRegion=!ezdVars.ProductID&&!ezdVars.DefaultProductID,window.ezd=state.designer=new BaseEZD(c)},this.addRenderedHandlerOneTime=function(a){var b=eventManager.on("rendered",function(){a&&a(),b&&b()})},this.selectNewDesign=function(b,c,d){eventManager.trigger("designChanging",null);var e=eventManager.on("rendered",function(){a.synchronizeElementIDs(),eventManager.trigger("designChanged",null),eventManager.trigger("layersChanged",null),e&&e()});state.designer.getDesign(b)},this.goToDefaultRoute=function(a){},this.addClipArt=function(a,b){var c=function(){var c=eventManager.on("rendered",function(){c&&c(),eventManager.trigger("designColorsChanged"),b&&b(d)});a.art_name_full&&(a.art_name=a.art_name_full),a.art_jit&&"raster"==a.art_type&&(a.art_path=a.art_jit),"emb"==a.art_type&&state.selectedProductStyle.selectedRegion&&(a.percentOfRegion=a.width/254/state.selectedProductStyle.selectedRegion.render_width_inches);var d=state.designer.addClipArt(a);eventManager.trigger("designColorsChanged")};a.width&&a.height?c():getImageData(a.thumburl_large,!1,function(b){a.width=b.width,a.height=b.height,c()})},this.haveSameSides=function(a){for(var b=0,c=0;c<state.designer.product.sides.length;c++)searchInArray(a.defaultStyle.product_regions,state.designer.product.sides[c].name,"side")&&b++;return b===state.designer.product.sides.length?!0:!1},this.saveStateToLocalStorage=function(){this.clearLocalStorage(),state.selectedDesign&&0<state.selectedDesign.design_id&&(localStorage.design_id=state.selectedDesign.design_id),state.selectedProduct&&0<state.selectedProduct.product_id&&(localStorage.product_id=state.selectedProduct.product_id),state.selectedProductStyle&&0<state.selectedProductStyle.product_style_id&&(localStorage.product_style_id=state.selectedProductStyle.product_style_id),state.selectedProductStyle&&state.selectedProductStyle.selectedRegion&&state.selectedProductStyle.selectedRegion.regionIndex&&(localStorage.region_index=state.selectedProductStyle.selectedRegion.regionIndex),state.activeUserToken&&(localStorage.user_id=state.activeUserToken),state.currentUserToken&&(localStorage.session_id=state.currentUserToken),state.currentSessionToken&&(localStorage.session_token=state.currentSessionToken),state.userSelectedProduct&&(localStorage.userSelectedProduct=state.userSelectedProduct),state.userSelectedDesign&&(localStorage.userSelectedDesign=state.userSelectedDesign),localStorage.store_id=ezdVars.AppToken},this.loadStateFromLocalStorage=function(){var a={};return localStorage.store_id!=ezdVars.AppToken?(this.clearLocalStorage(),{}):(localStorage.design_id&&(a.design_id=localStorage.design_id),a.design_id=localStorage.design_id,a.product_id=localStorage.product_id,a.product_style_id=localStorage.product_style_id,a.region_index=localStorage.region_index,a.user_id=localStorage.user_id,a.session_id=localStorage.session_id,a.session_token=localStorage.session_token,!state.activeUserToken&&localStorage.user_id&&(state.activeUserToken=localStorage.user_id),!state.currentUserToken&&localStorage.session_id&&(state.currentUserToken=localStorage.session_id),!state.currentSessionToken&&localStorage.session_token&&(state.currentSessionToken=localStorage.session_token),state.userSelectedProduct=localStorage.userSelectedProduct,state.userSelectedDesign=localStorage.userSelectedDesign,a)},this.clearLocalStorage=function(){localStorage.removeItem("store_id"),localStorage.removeItem("design_id"),localStorage.removeItem("product_id"),localStorage.removeItem("product_style_id"),localStorage.removeItem("region_index"),localStorage.removeItem("user_id"),localStorage.removeItem("session_id"),localStorage.removeItem("session_token"),localStorage.removeItem("userSelectedProduct"),localStorage.removeItem("userSelectedDesign")},this.canPrintDesign=function(){for(var a=0;a<state.designer.sides.length;a++)if(state.dsUtils.getColorsInUse(state.designer.sides[a].name).length>ezdVars.MaxScreenPrintColors)return!1;return!0},this.synchronizeElementIDs=function(){},this.getEmbroideryUrl=function(a,b,c){var d="";if("embroideryText"===b){d="http://"+ezdVars.ApiDomain+"/"+ezdVars.AppURI+"/JITImage/EmbroideryTextFull/?textValue="+escape(a.value)+"&fontName="+escape(a.fontObject.font||a.fontObject.name),a.font_size=240;for(var e in c)if(a[e])var f=escape(a[e]),d=d+("&"+c[e]+"="+f);console.log("color1 color2 color3 color4"),a.color1&&(d+="&rgb0="+parseInt(getColorString(a.color1,!0),16)),a.color2&&(d+="&rgb1="+parseInt(getColorString(a.color2,!0),16)),a.color3&&(d+="&rgb2="+parseInt(getColorString(a.color3,!0),16)),a.color4&&(d+="&rgb3="+parseInt(getColorString(a.color4,!0),16))}if("embroideryArt"===b&&(d="http://"+ezdVars.ApiDomain+"/"+ezdVars.AppURI+"/JITImage/EmbroideryClipArt/?ArtID="+a.art_id,a.colors&&a.colors.length))for(b=0;b<a.colors.length;b++)d+="&colors="+getColorString(a.colors[b],!0);return d}},Namespace("ui.controllers"),ui.controllers.ColorPickerController=function(a){},ui.controllers.AddNoteController=function(a){a.note=state.designer.design.information.notes,a.saveNote=function(){a.showingInlineModal=0,state.designer.design.information.notes=a.note}},ui.controllers.LandingPageController=function(a,b){a.showDesignsModal=function(){showModalDrawer("designIdeas",a,b),a.close()},a.showMyArtModal=function(){showModalDrawer("myArt",a,b),a.close()},eventManager.on("punchIn",function(b){a.close()})},ui.controllers.LogInOrCreateAccountController=function(a,b,c){a.login={},a.create={},a.showForgotPasswordForm=!1,a.login.email=ezdVars.UserEmail,a.logInExisting=function(){ezdVars.UserEmail||(ezdVars.UserEmail=a.login.email),service.logIn(a.login.email,a.login.password,state.currentUserToken,function(b){a.$emit("loggedIn",b),a.loggedIn&&a.loggedIn(b)},function(b){a.login.error=b,a.$apply()})},a.createAccount=function(){service.createAccount(a.create.firstName,a.create.lastName,a.create.email,a.create.password,a.create.passwordConfirm,state.currentUserToken,function(b){ezdVars.UserName=a.create.firstName+" "+a.create.lastName,ezdVars.UserEmail=a.create.email,a.$emit("loggedIn",b),a.loggedIn&&a.loggedIn(b)},function(b){a.create.error=b,a.$apply()})},a.submitForgotPassword=function(){a.forgotPasswordSuccess=!1,a.forgotPasswordError=!1,service.resetPassword(a.login.email,function(){a.forgotPasswordSuccess=!0,a.$apply()},function(b){a.forgotPasswordError=!0,a.$apply()})}},ui.controllers.VideoController=function(a){},ui.controllers.UploaderLandingController=function(a,b,c){a.showUploadImageScreen=!1,eventManager.on("punchIn",function(b){b&&"uploadArt"==b.screenName&&(a.showUploadImageScreen=!0,a.$$phase||a.$apply())}),state.imageUploadData={},a.fileTypes="",ezdVars.DisableUploadRasterArt||(a.fileTypes+=".png,.bmp,.jpg,.jpeg,.tif,.gif,"),ezdVars.DisableUploadVectorArt||(a.fileTypes+=""),ezdVars.Embroidery&&!ezdVars.DisableUploadEmbroideryArt&&(a.fileTypes+=".be,.pes,.pec,.phc,.art,.exp,.exp+,.emd,.hus,.shv,.sew,.jef,.jef+,.jan,.pcs,.pcm,.pcsmac,.vip,.vp3,.xxx,.csd,.dst,.tap,.gnc,.cnd,.emb,"),a.fileTypes=a.fileTypes.substring(0,a.fileTypes.length-1),a.allowedFileTypes=a.fileTypes.split(","),a.uploadImageTermsData={terms:c.trustAsHtml(state.initData.uploadImageTerms),accepted:!state.initData.uploadImageTerms,showing:!1},a.showUploadImageTerms=function(){a.uploadImageTermsData.showing=!0},a.acceptedUploadImageTermsChanged=function(){a.uploadImageTermsData.accepted&&(a.uploadImageTermsData.showing=!1)},a.fileDataReady=function(c,d){if(state.imageUploadData.isVector=!1,15e6<d.size)alert("您上传的图片太大了！\n目前设计工具支持上传不超过15M的图片。\n或咨询客服：400-920-2085 协助您解决。");else{var e=d.name.substring(d.name.lastIndexOf(".")).toLowerCase();if(15e6<c.length||0<=",.pdf,.eps,.svg,.be,.pes,.pec,.phc,.art,.exp,.exp+,.emd,.hus,.shv,.sew,.jef,.jef+,.jan,.pcs,.pcm,.pcsmac,.vip,.vp3,.xxx,.csd,.dst,.tap,.gnc,.cnd,.emb,.tif,.tiff,".indexOf(","+e+",")){if(0<d.name.toLowerCase().indexOf(".tif")){if(ezdVars.DisableUploadRasterArt)return void alert("很抱歉，我们目前不支持TIF格式的图片文件。")}else if(ezdVars.DisableUploadVectorArt)return void alert("不支持该文件类型。");service.saveUserArt(state.currentUserToken,state.activeUserToken,new FormData(document.getElementById("uploadForm")),function(c){service.getArtByID(c.ArtID,function(c){state.imageUploadData.imageUrl=service.adjustUrl(c.art_path),state.imageUploadData.name=c.art_name,state.imageUploadData.isVector="vector"==c.art_type,state.imageUploadData.isEmbroidery="emb"==c.art_type,state.imageUploadData.artData=c,state.imageUploadData.art_width=parseInt(c.width,10),state.imageUploadData.art_height=parseInt(c.height,10),state.imageUploadData.isVector?showModal("upImageLoading",a,b):state.imageUploadData.isEmbroidery?showModal("upImageLoading",a,b):(state.imageUploadData.imageUrl=c.art_path,state.imageUploadData.name=c.name,showModal("upImageLoading",a,b)),a.$apply()})})}else if(ezdVars.DisableUploadRasterArt)alert("不支持的文件类型。");else{delete state.imageUploadData.artData;var f=new Image;f.onload=function(){var e=parseInt($(f).context.width,10),g=parseInt($(f).context.height,10);return 1048576>e*g?void alert("您上传的作品至少需要达到100万像素(当前像素："+e*g+")。\n如有问题请咨询客服：400-920-2085 协助您解决。"):e*g>36e6?void alert("您上传的图片太大了！\n过大的尺寸会导致整个设计体验急剧变差。\n请适当缩小图片的宽高（3600万像数以内）或咨询客服：400-920-2085 协助您解决。"):(state.imageUploadData.art_width=e,state.imageUploadData.art_height=g,state.imageUploadData.imageUrl=c,state.imageUploadData.name=d.name,void showModal("upImageLoading",a,b))},f.src=c,f.name=d.name}}},a.mobileUpload=function(c){var d=c?showModalDrawer:d;d("mobileUploadFromDevice",a,b);var e=eventManager.on("imageUploaded",function(c){state.imageUploadData.imageUrl=service.adjustUrl(c.url),state.imageUploadData.artData=c,state.imageUploadData.art_width=parseInt(c.width,10),state.imageUploadData.art_height=parseInt(c.height,10),d("mobileUploadConfirm",a,b),e()})},a.disableUploadRasterArt=ezdVars.DisableUploadRasterArt},ui.controllers.MobileUploadConfirmController=function(a,b){var c=function(){a.originalSource=state.imageUploadData.artData.url,a.nextStep=function(){state.uploadedImage=state.imageUploadData.artData,state.designer.loadLocalImage(a.originalSource,null,state.imageUploadData.artData),eventManager.trigger("layersChanged"),a.close()}};c(),a.onShow=c},ui.controllers.EmbroideryMapColorsController=function(a,b){a.storeColors=state.storeInkColors;var c=function(a){var b="http://"+ezdVars.ApiDomain+"/"+ezdVars.AppURI+"/JITImage/EmbroideryClipArt/?ArtID="+a.art_id;if(a.art_colors&&a.art_colors.length)for(var c=0;c<a.art_colors.length;c++)b+="&colors="+getColorString(a.art_colors[c],!0);return b};a.addImageToDesigner=function(){state.dsUtils.addClipArt(state.imageUploadData.artData,function(){}),a.close()},a.embroiderySource=c(state.imageUploadData.artData),a.showColorOptions=function(b,c,d){a.showingInlineModal=!0,a.color=b,a.parentIndex=c,b=$(event.target).position(),a.colorOptionsX=b.left,a.colorOptionsY=b.top+30,$("#uploaderColorOptions").show()},a.mapColor=function(b,d,e){d||(d={html_color:"#000000"}),"none"==d&&(d={html_color:"none"}),state.imageUploadData.artData.art_colors[e].color=d.html_color,b.matchedColor=d.html_color,a.showingInlineModal=!1,a.embroiderySource=c(state.imageUploadData.artData)},function(){for(var b=[],c=state.imageUploadData.artData.art_colors,d=0;d<c.length;d++){var e=getColorString(c[d],!0),f=a.currentColors?findMatch(a.currentColors,function(a){return a.originalColor==e}):null;f&&(f=f.matchedColor),b[d]={originalColor:getColorString(e),matchedColor:f?getColorString(f):null}}a.currentColors=b,a.$$phase||a.$apply()}()},ui.controllers.upImageLoadingController=function(a,b){var c=parseInt(ezdVars.MaxScreenPrintColors,10);a.colorSettings={},a.colorSettings.numColors=state.imageUploadData.numColors=c,a.showMatchColors=state.imageUploadData.isVector,a.vectorOnly=ezdVars.VectorOnly,a.loadingImage=!0,a.maxcolors=!1;var d={};ezdVars.VectorOnly&&(state.imageUploadData.numColors=c),a.numColorChoicesLeft=Array(c),c>4&&(a.numColorChoicesLeft=Array(c),a.numColorChoicesRight=Array(c)),a.storeColors=state.storeInkColors,state.imageUploadData.reduceOrder="dependentSlow",state.imageUploadData.minHueCols="256",a.speedSettings=state.imageUploadData,a.disableUploadRasterArt=ezdVars.DisableUploadRasterArt||ezdVars.VectorOnly,state.imageUploadData.imageType="multiColor",a.changeNumColors=function(){state.uploader.canClick=!0;var b=a.colorSettings.numColors;"blackAndWhite"==b?(g(state.uploader.bW),state.uploader.fullColor=!0,a.loadingImage=!1):"fullColor"==b?(g(state.uploader.original),state.uploader.fullColor=!0,a.loadingImage=!1):(a.loadingImage=!0,setTimeout(function(){g(state.uploader.getPicture(b)),state.uploader.fullColor=!1,a.loadingImage=!1,a.$$phase||a.$apply()},25)),state.imageUploadData.numColors=b,setTimeout(f,75)},a.removeBackground=function(b){a.loadingImage=!0,setTimeout(e,75,b)};var e=function(b){a.backgroundRemoved=!0,a.preservedFigure=b;var c="noBackground"+b.toString();if(d[c])state.uploader=d[c];else{var e=new Image;e.src=$("#sourceImage")[0].src,!1===b&&(e=d.standard.original,state.uploader.removeBackground(e,b)),d[c]=state.uploader=new com.aq.bitmap.AQBitmapPalettes(e,function(){a.changeNumColors()},b)}a.changeNumColors(),a.$$phase||a.$apply()};a.restoreBackground=function(){state.uploader=d.standard,a.changeNumColors(),a.backgroundRemoved=!1};var f=function(){var b=[];if(state.imageUploadData.isVector)for(var c=state.imageUploadData.svgElement.colors,d=0;d<c.length;d++){var e=getColorString(c[d],!0),f=a.currentColors?findMatch(a.currentColors,function(a){return a.originalColor==e}):null;f&&(f=f.matchedColor),b[d]={originalColor:getColorString(e),matchedColor:f?getColorString(f):null}}else{var g=new Image;for(g.src=state.imageUploadData.imageUrl,state.uploader=new com.aq.bitmap.AQBitmapPalettes(g),c="blackAndWhite"==state.imageUploadData.numColors||"fullColor"==state.imageUploadData.numColors?state.uploader.getQuantizedImage().colors:state.uploader.getQuantizedImage(state.imageUploadData.numColors).colors,d=0;d<c.length;d++)e=c[d].substring(0,6),(f=a.currentColors?findMatch(a.currentColors,function(a){return a.originalColor==e}):null)&&(f=f.matchedColor),b[d]={originalColor:getColorString(e),matchedColor:f?getColorString(f):null}}a.currentColors=b};setTimeout(function(){if(a.isRaster=!state.imageUploadData.isVector,state.imageUploadData.isVector)getImageData(state.imageUploadData.artData.thumb_jit,!1,function(b){var c=ScaleImage(b.width,b.height,300,300,!0);state.imageUploadData.isVector&&$("#targetImageContainer").css("cursor","default"),b={object:{}},$.ajax({type:"GET",url:state.imageUploadData.imageUrl,dataType:"xml",success:function(d){$("#targetImageContainer").append("<svg id='targetImageContainerSVG' style='height:100%;'></svg>"),$("#targetImageContainer").css("height","100%"),$("#targetImageContainer").css("width","100%");var e=document.getElementById("targetImageContainerSVG");$("#targetImageContainerSVG").show(),b.width=c.width,b.height=c.height,b.x=150,b.y=150,b.id=1e5,state.imageUploadData.svgElement=new ui.svg.SvgElement(d,e,b),c=ScaleImage(state.imageUploadData.svgElement.originalBBox.width,state.imageUploadData.svgElement.originalBBox.height,300,300,!0),state.imageUploadData.svgElement.width=c.width,state.imageUploadData.svgElement.height=c.height,f(),a.updateNumColors(),a.$$phase||a.$apply()}})});else{var b=$("#sourceImage")[0];a.loadingImage=!0,$(b).load(function(){a.$apply(),setTimeout(function(){state.uploader=new com.aq.bitmap.AQBitmapPalettes(b),d.standard=state.uploader,ezdVars.VectorOnly?(g(state.uploader.getPicture(ezdVars.MaxScreenPrintColors)),state.uploader.fullColor=!1,a.colorSettings.numColors=ezdVars.MaxScreenPrintColors):(g(state.uploader.original),state.uploader.fullColor=!0),state.uploader.canClick=!1,a.loadingImage=!1,a.updateNumColors(),a.$apply()},100)}),a.originalSource=state.imageUploadData.imageUrl,a.$apply()}},10);var g=function(a){var b=$("#targetImageContainer");b.empty(),b.append(a),$(a).css("margin-top",(330-a.clientHeight)/2+"px")};a.showColorMatchingScreen=function(){"fullColor"!=a.colorSettings.numColors&&"blackAndWhite"!=a.colorSettings.numColors||a.addImageToDesigner(),a.showMatchColors=!0,f(),a.updateNumColors()},a.deleteColor=function(b,c){a.mapColor(b,"none",c),a.updateNumColors()},a.showColorOptions=function(b,c,d){a.showingInlineModal=!0,a.color=b,a.parentIndex=c,b=$(event.target).position(),a.colorOptionsX=b.left,a.colorOptionsY=b.top+30,$("#uploaderColorOptions").show()},a.mapColor=function(b,c,d){if(c||(c={html_color:"#000000"}),"none"==c&&(c={html_color:"none"}),state.imageUploadData.isVector){for(var e=[],f=0;f<state.imageUploadData.svgElement.colors.length;f++)e.push(state.imageUploadData.svgElement.colors[f]);e[d]=c.html_color,state.imageUploadData.svgElement.colors=e,state.imageUploadData.artData.art_colors[d].color=c.html_color}else d=b.originalColor,8>d.length&&(d+="ff"),e=getColorString(c.html_color),8>e.length&&(e+="ff"),state.uploader.replaceColor($("#targetImageContainer").children()[0],d.substring(1),e.substring(1),state.uploader.getPicture(a.colorSettings.numColors));b.matchedColor=c.html_color,a.updateNumColors(),a.showingInlineModal=!1},a.updateNumColors=function(){a.maxColors=c;for(var b=a.currentColors||[],d=0,e=[],f=0;f<b.length;f++){var g=b[f].matchedColor||b[f].originalColor;findMatch(e,function(a){return(a.matchedColor||a.originalColor)==g})||"#00000000"==g.toLowerCase()||(e.push(b[f]),"none"!=g&&d++)}a.numImageColors=d},a.addImageToDesigner=function(){if(f(),state.imageUploadData.isVector){var b=state.imageUploadData.artData;b.width=state.imageUploadData.svgElement.width,b.height=state.imageUploadData.svgElement.height;for(var c=eventManager.on("rendered",function(){state.designer.getElementById(h.id),a.$$phase||a.$apply(),c&&c()}),d=[],e=0;e<a.currentColors.length;e++){var g=a.currentColors[e],g=getColorString(f.matchedColor||f.originalColor);d.push(getColorString(g,!0))}b.art_colors=d,b.forceColors=!0;var h=state.designer.addClipArt(b),h={table_name:"canvas_art",location:"Front",canvas_art_id:0,canvas_art_rendered:b.thumb_jit,colors:d,art:b,id:h.id,z:1e6}}else{if(d=[],a.currentColors)for(e=0;e<a.currentColors.length;e++)d[e]={value:getColorString(a.currentColors[e].matchedColor||a.currentColors[e].originalColor)};d={width:state.imageUploadData.art_width,height:state.imageUploadData.art_height,artID:0,artName:state.imageUploadData.name,colors:d,art_width:state.imageUploadData.art_width,art_height:state.imageUploadData.art_height},h=state.designer.loadLocalImage(state.imageUploadData.imageUrl,null,d)}eventManager.trigger("layersChanged",h),a.close()},window.setTimeout(function(){a.addImageToDesigner()},300)},ui.controllers.ChooseNumberOfColorsController=function(a,b){var c=parseInt(ezdVars.MaxScreenPrintColors,10);a.colorSettings={},a.colorSettings.numColors=state.imageUploadData.numColors=c,a.showMatchColors=state.imageUploadData.isVector,a.vectorOnly=ezdVars.VectorOnly;var d={};ezdVars.VectorOnly&&(state.imageUploadData.numColors=c),a.numColorChoicesLeft=Array(c),c>4&&(a.numColorChoicesLeft=Array(c),a.numColorChoicesRight=Array(c)),a.storeColors=state.storeInkColors,a.changeNumColors=function(){state.uploader.canClick=!0;var b=a.colorSettings.numColors;"blackAndWhite"==b?(g(state.uploader.bW),state.uploader.fullColor=!0,a.loadingImage=!1):"fullColor"==b?(g(state.uploader.original),state.uploader.fullColor=!0,a.loadingImage=!1):(a.loadingImage=!0,setTimeout(function(){g(state.uploader.getPicture(b)),state.uploader.fullColor=!1,a.loadingImage=!1,
a.$$phase||a.$apply()},25)),state.imageUploadData.numColors=b,setTimeout(f,75)},a.removeBackground=function(b){a.loadingImage=!0,setTimeout(e,75,b)};var e=function(b){a.backgroundRemoved=!0,a.preservedFigure=b;var c="noBackground"+b.toString();if(d[c])state.uploader=d[c];else{var e=new Image;e.src=$("#sourceImage")[0].src,!1===b&&(e=d.standard.original,state.uploader.removeBackground(e,b)),d[c]=state.uploader=new com.aq.bitmap.AQBitmapPalettes(e,function(){a.changeNumColors()},b)}a.changeNumColors(),a.$$phase||a.$apply()};a.restoreBackground=function(){state.uploader=d.standard,a.changeNumColors(),a.backgroundRemoved=!1};var f=function(){var b=[];if(state.imageUploadData.isVector)for(var c=state.imageUploadData.svgElement.colors,d=0;d<c.length;d++){var e=getColorString(c[d],!0),f=a.currentColors?findMatch(a.currentColors,function(a){return a.originalColor==e}):null;f&&(f=f.matchedColor),b[d]={originalColor:getColorString(e),matchedColor:f?getColorString(f):null}}else for(c="blackAndWhite"==state.imageUploadData.numColors||"fullColor"==state.imageUploadData.numColors?state.uploader.getQuantizedImage().colors:state.uploader.getQuantizedImage(state.imageUploadData.numColors).colors,d=0;d<c.length;d++)e=c[d].substring(0,6),(f=a.currentColors?findMatch(a.currentColors,function(a){return a.originalColor==e}):null)&&(f=f.matchedColor),b[d]={originalColor:getColorString(e),matchedColor:f?getColorString(f):null};a.currentColors=b,a.$$phase||a.$apply()};setTimeout(function(){if(a.isRaster=!state.imageUploadData.isVector,state.imageUploadData.isVector)getImageData(state.imageUploadData.artData.thumb_jit,!1,function(b){var c=ScaleImage(b.width,b.height,300,300,!0);state.imageUploadData.isVector&&$("#targetImageContainer").css("cursor","default"),b={object:{}},$.ajax({type:"GET",url:state.imageUploadData.imageUrl,dataType:"xml",success:function(d){$("#targetImageContainer").append("<svg id='targetImageContainerSVG' style='height:100%;'></svg>"),$("#targetImageContainer").css("height","100%"),$("#targetImageContainer").css("width","100%");var e=document.getElementById("targetImageContainerSVG");$("#targetImageContainerSVG").show(),b.width=c.width,b.height=c.height,b.x=150,b.y=150,b.id=1e5,state.imageUploadData.svgElement=new ui.svg.SvgElement(d,e,b),c=ScaleImage(state.imageUploadData.svgElement.originalBBox.width,state.imageUploadData.svgElement.originalBBox.height,300,300,!0),state.imageUploadData.svgElement.width=c.width,state.imageUploadData.svgElement.height=c.height,f(),a.updateNumColors(),a.$$phase||a.$apply()}})});else{var b=$("#sourceImage")[0];a.loadingImage=!0,$(b).load(function(){a.$apply(),setTimeout(function(){state.uploader=new com.aq.bitmap.AQBitmapPalettes(b),d.standard=state.uploader,ezdVars.VectorOnly?(g(state.uploader.getPicture(ezdVars.MaxScreenPrintColors)),state.uploader.fullColor=!1,a.colorSettings.numColors=ezdVars.MaxScreenPrintColors):(g(state.uploader.original),state.uploader.fullColor=!0),state.uploader.canClick=!1,a.loadingImage=!1,a.updateNumColors(),a.$apply()},100)}),a.originalSource=state.imageUploadData.imageUrl,a.$apply()}},10);var g=function(a){var b=$("#targetImageContainer");b.empty(),b.append(a),$(a).css("margin-top",(330-a.clientHeight)/2+"px")};a.showColorMatchingScreen=function(){"fullColor"!=a.colorSettings.numColors&&"blackAndWhite"!=a.colorSettings.numColors||a.addImageToDesigner(),a.showMatchColors=!0,f(),a.updateNumColors()},a.deleteColor=function(b,c){a.mapColor(b,"none",c),a.updateNumColors()},a.showColorOptions=function(b,c,d){a.showingInlineModal=!0,a.color=b,a.parentIndex=c,b=$(event.target).position(),a.colorOptionsX=b.left,a.colorOptionsY=b.top+30,$("#uploaderColorOptions").show()},a.mapColor=function(b,c,d){if(c||(c={html_color:"#000000"}),"none"==c&&(c={html_color:"none"}),state.imageUploadData.isVector){for(var e=[],f=0;f<state.imageUploadData.svgElement.colors.length;f++)e.push(state.imageUploadData.svgElement.colors[f]);e[d]=c.html_color,state.imageUploadData.svgElement.colors=e,state.imageUploadData.artData.art_colors[d].color=c.html_color}else d=b.originalColor,8>d.length&&(d+="ff"),e=getColorString(c.html_color),8>e.length&&(e+="ff"),state.uploader.replaceColor($("#targetImageContainer").children()[0],d.substring(1),e.substring(1),state.uploader.getPicture(a.colorSettings.numColors));b.matchedColor=c.html_color,a.updateNumColors(),a.showingInlineModal=!1},a.updateNumColors=function(){a.maxColors=c;for(var b=a.currentColors||[],d=0,e=[],f=0;f<b.length;f++){var g=b[f].matchedColor||b[f].originalColor;findMatch(e,function(a){return(a.matchedColor||a.originalColor)==g})||"#00000000"==g.toLowerCase()||(e.push(b[f]),"none"!=g&&d++)}a.numImageColors=d},a.addImageToDesigner=function(){if(state.imageUploadData.isVector){var b=state.imageUploadData.artData;b.width=state.imageUploadData.svgElement.width,b.height=state.imageUploadData.svgElement.height;for(var c=eventManager.on("rendered",function(){state.designer.getElementById(g.id),a.$$phase||a.$apply(),c&&c()}),d=[],e=0;e<a.currentColors.length;e++){var f=a.currentColors[e],f=getColorString(f.matchedColor||f.originalColor);d.push(getColorString(f,!0))}b.art_colors=d,b.forceColors=!0;var g=state.designer.addClipArt(b),g={table_name:"canvas_art",location:"Front",canvas_art_id:0,canvas_art_rendered:b.thumb_jit,colors:d,art:b,id:g.id,z:1e6}}else{if(b=$("#targetImageContainer").children()[0],d=[],a.currentColors)for(e=0;e<a.currentColors.length;e++)d[e]={value:getColorString(a.currentColors[e].matchedColor||a.currentColors[e].originalColor)};d={width:b.width,height:b.height,artID:0,artName:state.imageUploadData.name,colors:d,art_width:state.imageUploadData.art_width,art_height:state.imageUploadData.art_height},g=state.designer.loadLocalImage(b.toDataURL(),null,d)}eventManager.trigger("layersChanged",g),a.close()}},ui.controllers.SelectImageTypeController=function(a,b){state.imageUploadData.reduceOrder="dependentSlow",state.imageUploadData.minHueCols="256",a.speedSettings=state.imageUploadData,a.disableUploadRasterArt=ezdVars.DisableUploadRasterArt||ezdVars.VectorOnly,a.selectLogo=function(){state.imageUploadData.imageType="multiColor",showModal("chooseNumberOfColors",a,b)},a.selectPhoto=function(){state.imageUploadData.imageType="fullColor",showModal("colorOrBW",a,b)}},ui.controllers.ColorOrBWController=function(a,b){a.originalSource=state.imageUploadData.imageUrl,a.loadingImage=!0,setTimeout(function(){var b=new Image;b.onload=function(){a.originalSourceBW=desaturatePicture(b),a.loadingImage=!1,a.$apply()},b.src=state.imageUploadData.imageUrl},25),a.addImageToDesigner=function(b){var c=$("#isd-originalImage").width(),d=$("#isd-originalImage").height();b=state.designer.loadLocalImage(b?a.originalSourceBW:state.imageUploadData.imageUrl,null,{width:c,height:d,artID:state.imageUploadData.artData?state.imageUploadData.artData.art_id:0,artName:null,art_width:state.imageUploadData.art_width,art_height:state.imageUploadData.art_height}),eventManager.trigger("layersChanged",b),a.close()}},ui.controllers.MobileUploadController=function(a,b){function c(b,c,d,e,f){var g={width:c,height:d,artID:e,artName:f,url:b};state.imageUploadData?eventManager.trigger("imageUploaded",g):(state.uploadedImage=g,state.designer.loadLocalImage(b,null,{width:c,height:d,artID:e,artName:f}),state.dsUtils.addRenderedHandlerOneTime(function(){eventManager.trigger("layersChanged")}),a.close?a.close():a.toSidePanelDefault&&a.toSidePanelDefault())}a.userKey="";var d;window.deleteUserImage=function(){},a.onShow=function(){a.foundEmail=!1},a.startCheckUploads=function(){a.foundEmail=!1,a.checkingUploads=!0,f(),d=setInterval(f,5e3)};var e=function(b){a.userKey=service.getMobileUploadUserKey(b),a.$$phase||a.$apply()};!function(){state.currentUserToken?e(state.currentUserToken):service.getOrCreateSession(function(a){e(a.UserToken)})}();var f=function(){service.checkMobileUploads(state.currentUserToken,function(b){a.foundEmail||(a.foundEmail=!0,c(service.adjustUrl(b.art_url),b.width,b.height,b.art_id,b.art_name)),clearInterval(d),a.checkingUploads=!1,a.checkingUploads=!1,a.foundEmail=!0,a.showMobileUpload=a.$parent.showMobileUpload=!1,a.$$phase||a.$apply()},function(a){console.log(a.result)},function(a){console.log("发生未知错误.")})};a.stopCheckingUploads=function(){clearInterval(d),a.checkingUploads=!1,a.toSidePanelDefault&&a.toSidePanelDefault()}},ui.controllers.EditArtEmbroideryController=function(a,b,c,d,e){var f=searchInArray(state.selectedDesign.canvas_art,c.id,"id");if(f){eventManager.trigger("elementSelected",f.id),a.canvasArt=f;var g=function(){if(f&&f.colors){a.colors=[];for(var b=0;b<f.colors.length;b++){var c=getColorString(f.colors[b]);a.colors.push(c)}}};g(),a.showChangeColorModal=function(c,d){var h={currentColor:getColorString(f.colors[c]),onSelect:function(a){f.colors[c]="string"==typeof f.colors[c]?a:getColorString(a,!0),f.colors={index:c,color:a},g()},allowTransparent:!0};showColorModal(a,b,e,h,d)},a.replaceClipArt=function(){var c=state.designer.getElementById(f.id);showModalDrawer("clipArt",a,b,{embroideryOnly:!0,clipArtToReplace:f,clipArtAdded:function(b){a.canvasArt=b,a.$$phase||a.$apply(),b=state.designer.getElementById(b.id);var e=ScaleImageFloat(b.object.width,b.object.height,c.object.width,c.object.height,!0);b.object.width=e.width,b.object.height=e.height,b.object.x=c.object.x,b.object.y=c.object.y,state.designer.deleteElements(c.object),d.path("/editArtEmbroidery/"+b.id)}})},a.changeAlignment=function(a){state.designer.changeElementAlignment(f.id,a)},a.nudge=function(a){ezd.nudgeElement(f.id,a,1)},eventManager.on("designColorsChanged",g),eventManager.on("elementDeleted",function(b){searchInArray(state.selectedDesign.canvas_art,c.id,"id")||(d.path("/layers"),a.$$phase||a.$apply())})}else d.path("/layers")},ui.controllers.EditTextEmbroideryController=function(a,b,c,d,e){a.shapes=[{label:"Normal",value:"Normal",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:0,bottom_curve:0}},{label:"Circle",value:"Circle",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:0,bottom_curve:0}},{label:"Vertical",value:"Vertical",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:0,bottom_curve:0}},{label:"Square Left",value:"Square Left",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:0,bottom_curve:0}},{label:"Square Right",value:"Square Right",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:0,bottom_curve:0}},{label:"Oval",value:"Oval",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:12,bottom_curve:12}},{label:"Bridge Top",value:"Bridge Top",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:15,bottom_curve:10}},{label:"Bridge Bottom",value:"Bridge Bottom",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:10,bottom_curve:15}},{label:"Bridge Up",value:"Bridge Up",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:14,bottom_curve:6}},{label:"Bridge Down",value:"Bridge Down",presets:{bottom_curve_type:"Curve",top_curve_type:"Curve",top_curve:6,bottom_curve:14}},{label:"Diamond",value:"Diamond",presets:{bottom_curve_type:"Peak",top_curve_type:"Peak",top_curve:15,bottom_curve:15}},{label:"Pennant Up",value:"Pennant Up",presets:{bottom_curve_type:"Peak",top_curve_type:"Peak",top_curve:15,bottom_curve:10}},{label:"Pennant Down",value:"Pennant Down",presets:{bottom_curve_type:"Peak",top_curve_type:"Peak",top_curve:10,bottom_curve:15}},{label:"Ascending",value:"Ascending",presets:{bottom_curve_type:"Grow",top_curve_type:"Shrink",top_curve:14,bottom_curve:14}},{label:"Descending",value:"Descending",presets:{bottom_curve_type:"Shrink",top_curve_type:"Grow",top_curve:14,bottom_curve:14}}];var f={slant:50,sequence:"A-B-C",shape:"Normal",circle_radius:100,bottom_curve_type:"Curve",top_curve_type:"Curve",bottom_curve:10,top_curve:10,word_spacing:100,line_spacing:100,letter_spacing:100,alignment:0,font:{font:"University",is_embroidery:1},font_id:"1759",fontSize:240,color1:"A8A8A8",value:"Text",isEmbroidery:!0};if(f.fontObject=f.font,c.id)if(c=searchInArray(state.selectedDesign.canvas_text,c.id,"id")){var g=a.text=c;eventManager.trigger("elementSelected",g.id),g.sleep=!0;for(var h in f)g[h]||(g[h]="object"==typeof f[h]?angular.copy(f[h]):f[h]);g.slant=parseInt(g.slant,10),g.bottom_curve=parseInt(g.bottom_curve,10),g.top_curve=parseInt(g.top_curve,10),g.word_spacing=parseInt(g.word_spacing,10),g.line_spacing=parseInt(g.line_spacing,10),g.letter_spacing=parseInt(g.letter_spacing,10),g.alignment=parseInt(g.alignment,10),g.fontSize=parseInt(g.fontSize,10),g.circle_radius=parseInt(g.circle_radius,10),g.sleep=!1;var i=findMatch(state.fontCategories,function(a){return"1"==a.IsEmbroidery});service.getFontsByCategory(i.font_style_id,function(b){a.fonts=b,i.fonts=b;for(var c=0;c<b.length;c++){var d=b[c];d.font==a.text.font.font&&(a.text.font=d,a.text.font_id=d.font_id)}a.$$phase||a.$apply()}),a.showfontList=0,a.fontCategories=state.fontCategories.slice(0),deleteMatches(a.fontCategories,function(a){return"0"==a.IsEmbroidery}),a.updateTextValue=function(){},a.updateFontName=function(){var b=searchInArray(a.fonts,g.font_id,"font_id");b&&(g.font=b.name)},a.showFillColorModal=function(c){showColorModal(a,b,e,{currentColor:g.color1,onSelect:function(a){"none"!=a&&(g.color1=getColorString(a,!0))},allowTransparent:!0},c)};var j=g.shape;a.updateTextShape=function(){if("Vertical"==g.shape||"Vertical"==j){var b=state.designer.getElementById(g.id).object,c=b.height;b.height=b.width,b.width=c}j=g.shape,b=findMatch(a.shapes,function(a){return a.label==g.shape}),g.sleep=!0;for(var d in b.presets)g[d]=b.presets[d];g.sleep=!1},a.increaseLetterSpacing=function(){g.letter_spacing=Math.min(200,parseInt(g.letter_spacing,10)+20)},a.decreaseLetterSpacing=function(){g.letter_spacing=Math.max(0,parseInt(g.letter_spacing,10)-20)},a.increaseWordSpacing=function(){g.word_spacing=Math.min(200,parseInt(g.word_spacing,10)+10)},a.decreaseWordSpacing=function(){g.word_spacing=Math.max(0,parseInt(g.word_spacing,10)-10)},a.updateTopCurveType=function(){},a.increaseTopCurve=function(){g.top_curve=Math.min(15,parseInt(g.top_curve,10)+1)},a.decreaseTopCurve=function(){g.top_curve=Math.max(5,parseInt(g.top_curve,10)-1)},a.updateBottomCurveType=function(){},a.increaseBottomCurve=function(){g.bottom_curve=Math.min(15,parseInt(g.bottom_curve,10)+1)},a.decreaseBottomCurve=function(){g.bottom_curve=Math.max(5,parseInt(g.bottom_curve,10)-1)},a.increaseTextRadius=function(){g.circle_radius=Math.min(300,g.circle_radius+5)},a.decreaseTextRadius=function(){g.circle_radius=Math.max(10,g.circle_radius-5)},a.increaseTextSlant=function(){g.slant=Math.min(100,parseInt(g.slant,10)+5)},a.decreaseTextSlant=function(){g.slant=Math.max(0,parseInt(g.slant,10)-5)},a.updateSequence=function(){},a.nudge=function(a){ezd.nudgeElement(g.id,a,1)},a.changeAlignment=function(a){g.alignment=a}}else d.path("/layers");else a.action="Add",a.text=angular.copy(f),f=state.selectedDesign.isEmpty(!0)&&ezdVars.AutoZoom,c=state.designer.addEmbroideryText(a.text),state.selectedDesign.canvas_text.push(c),eventManager.trigger("layersChanged"),eventManager.trigger("designColorsChanged"),d.path("/editTextEmbroidery/"+c.id),f&&setTimeout(function(){state.designer.zoomIn()},2e3)},ui.controllers.SelectSizesController=function(a,b,c){a.nextStep=function(){a.validateWithInventory(function(){a.inventoryErrors&&a.inventoryErrors.length||(a.close(),showModal("cartLogin",a,b))})},a.validateWithInventory=function(b){for(var c=!0,d=0;d<state.quoteInformation.sizeStyles.length;d++){var e=state.quoteInformation.sizeStyles[d];e.style.inventory?"LOADING"==e.style.inventory&&(c=!1):(c=!1,e.style.inventory="LOADING",function(){var c=e;service.checkStyleInventory(e.style.product_style_id,function(d){c.style.inventory=d,a.validateWithInventory(b)},function(){a.inventoryErrors=[],b()})}())}if(c){for(a.inventoryErrors=[],d=0;d<state.quoteInformation.sizeStyles.length;d++)for(e=state.quoteInformation.sizeStyles[d],c=0;c<e.sizes.length;c++){var f=e.sizes[c];if(!(0>=f.quantity)){var g=findMatch(e.style.inventory.sizes,function(a){return a.id==f.size_id});g&&g.available_quantity<f.quantity&&(0==g.available_quantity?a.inventoryErrors.push(e.style.color+" "+f.name+" is out of stock."):a.inventoryErrors.push("Only "+g.available_quantity+" of "+e.style.color+" "+f.name+(1==g.available_quantity?" is":" are")+" available for purchase at this time."))}}a.$$phase||a.$apply(),b&&b()}},state.namesNumbers&&0<state.namesNumbers.countTotals().numItems&&(delete state.quoteInformation,a.readOnly=!0)},ui.controllers.CartLoginController=function(a,b,c){a.login=state.cartLoginInfo={},a.showForgotPasswordForm=!1;var d=function(){a.close(),showModal("saveDesign",a,b)};state.activeUserToken&&state.currentUserToken?d():(a.login.mode="guest",a.logInExisting=function(){service.logIn(a.login.email,a.login.password,state.currentUserToken,function(a){d()},function(b){a.login.error=b,a.$apply()})},a.logInNew=function(){"guest"==a.login.mode?state.currentUserToken?d():service.getOrCreateSession(function(a){state.currentUserToken=a.UserToken,state.activeUserToken=a.UserToken,state.currentSessionToken=a.sessionToken,d()}):"register"==a.login.mode&&(a.close(),showModal("cartRegister",a,b))},a.submitForgotPassword=function(){a.forgotPasswordSuccess=!1,a.forgotPasswordError=!1,service.resetPassword(a.login.email,function(){a.forgotPasswordSuccess=!0,a.$apply()},function(b){a.forgotPasswordError=!0,a.$apply()})})},ui.controllers.CartRegisterController=function(a,b,c){a.register={},a.createAccount=function(){service.createAccount(a.register.firstName,a.register.lastName,a.register.email,a.register.password,a.register.passwordConfirm,state.currentUserToken,function(c){state.currentUserToken=c.UserToken,state.activeUserToken=c.UserToken,state.currentSessionToken=c.sessionToken,a.close(),showModal("saveDesign",a,b)},function(b){a.register.error=b,a.$apply()})}},ui.controllers.SaveDesignController=function(a,b,c){a.saveInfo={designName:state.designer.design.information.name};var d=function(){a.close(),showModal("viewCart",a,b)};state.designSaveResult||!state.selectedDesign||state.selectedDesign.isEmpty()?d():a.saveDesign=function(){ajaxCallStarted("SaveDesignTemplate","保存设计..."),state.designer.saveDesign({designId:state.selectedDesign.design_id,productStyleId:state.selectedProductStyle.product_style_id,UserToken:state.currentUserToken,UserToken:state.activeUserToken,name:a.saveInfo.designName,notes:state.designer.design.information.notes,success:function(a,b){state.selectedDesignID=state.selectedDesign.design_id=b.designID,ajaxCallEnded("SaveDesignTemplate"),state.designSaveResult=b,b.UserToken&&(state.currentUserToken=parseInt(b.UserToken.trim(),10)),b.UserToken&&(state.activeUserToken=parseInt(b.UserToken,10)),b.sessionToken&&(state.currentSessionToken=b.sessionToken.trim()),d()},error:function(a){ajaxCallEnded("SaveDesignTemplate"),alert("保存设计时发生错误：: "+a)}})}},ui.controllers.EnterPaymentController=function(a,b){state.order||(state.order={}),state.order.payment||(state.order.payment={paymentType:null,cardNumber:null,expirationMonth:null,expirationYear:null,ccvCode:null,poNumber:null}),a.nextStep=function(){a.close(),showModal("enterAddresses",a,b)},ezdVars.PaymentDisabled&&(state.order.payment.paymentType="Arrange Payment Later",a.nextStep()),state.cart.paymentMethods?(1==paymentMethods.length&&"Arrange Payment Later"==paymentMethods[0]&&(state.order.payment.paymentType="Arrange Payment Later",a.nextStep()),a.paymentMethods=state.cart.paymentMethods):service.getCartPaymentMethods(state.currentUserToken,function(b){a.paymentMethods=b,a.$apply(),1==b.length&&"Arrange Payment Later"==b[0]&&(state.order.payment.paymentType="Arrange Payment Later",a.nextStep())}),a.payment=state.order.payment,a.todayYear=(new Date).getFullYear()},ui.controllers.ShippingMethodController=function(a,b){ezdVars.EnableCartShipping||(a.close(),showModal("reviewOrder",a,b)),service.getCartShippingMethods(state.currentUserToken,function(b){for(var c=0;c<b.length;c++){state.order.shippingMethods=b;var d=b[c];d.text="Delivery usually within "+d.min_days+" business days."}a.methods=b,a.$apply()}),a.hidePricing=!ezdVars.EnableCartPricing,a.order=state.order,a.nextStep=function(){state.order.shippingMethod=searchInArray(state.order.shippingMethods,state.order.shippingMethodID,"shipping_method_id"),service.saveCartShippingMethod(state.currentUserToken,state.order.shippingMethodID,function(){a.close(),showModal("reviewOrder",a,b)})}},ui.controllers.ReviewOrderController=function(a,b){function c(a){for(var b=[],c=0;c<a.selectedSizes.length;c++)for(var d=a.selectedSizes[c],e=0;e<d.cart_retail_item_size_namenumbers.length;e++){var f=d.cart_retail_item_size_namenumbers[e];b.push({name:f.name,number:f.number,size:findMatch(a.sizeData,function(a){return a.id==d.product_style_size_id}),cart_retail_item_id:a.cart_retail_item_id,cart_retail_item_size_namenumber_id:f.cart_retail_item_size_namenumber_id})}return b}a.hidePricing=!ezdVars.EnableCartPricing,a.placeOrderText=ezdVars.PaymentDisabled?"Submit Now":"Place Order Now",service.getCart(state.currentUserToken,!0,function(b){a.cart=state.cart=b,a.centerModal(),a.$apply()}),a.pageOffset=0,a.pageSize=2,a.previousPage=function(){a.pageOffset=Math.max(0,a.pageOffset-a.pageSize)};var d=function(a){for(var b=0,c=function(){b--,0==b&&a&&a()},d=0;d<state.cart.cart_retail_items.length;d++){var e=state.cart.cart_retail_items[d];e.updateNote&&(b++,e.updateNote=!1,service.saveCartItemNotes(state.currentUserToken,e.cart_retail_item_id,e.note,c))}0==b&&a&&a()};a.beforeClose=function(){d()},a.nextStep=function(){d(function(){var c={},d=state.order.payment;state.order.payment_type=c.payment_method=d.paymentType,"Credit Card"==d.paymentType?(c.cc_num=d.cardNumber,1==d.expirationMonth.toString().length&&(d.expirationMonth="0"+d.expirationMonth.toString()),c.cc_exp=d.expirationMonth+"-"+d.expirationYear,c.cc_cvv=d.ccvCode):"Purchase Order"==d.paymentType&&(c.po_number=d.poNumber),c.amount_due=state.cart.total_due,service.saveCartOrder(state.currentUserToken,c,function(c){state.cart.orderID=c,a.close(),showModal("emailDesign",a,b)})})},a.showNamesNumbers=function(d){$.get(state.theme.url(dsLocation+"/html/modals/namesAndNumbersCommon.html"),function(e){var f=angular.element("#angularAppElement").scope().$new();f.sizeData=d.sizeData,f.namesNumbers=c(d),f.close=function(){$(".isd-nncContainer").remove(),f.$destroy(),a.showingNamesNumbers=!1,a.$$phase||a.$apply(),a.centerModal()},e=$(e)[0],b(e)(f),$("<div class='isd-nncContainer'>").appendTo(".isd-cart-namesNumbers").append(e),a.showingNamesNumbers=!0,f.noAddingAllowed=!0,f.inCart=!0,f.readOnly=!0,f.$apply(),setTimeout(function(){a.centerModal()},10)})},a.editCart=function(c){a.close(),showModal("viewCart",a,b,{editCartRetailItemID:c.cart_retail_item_id})}},ui.controllers.ViewTestCaseXmlController=function(a,b){var c={};c.cart=state.cart,c.billing_address=state.billingAddress,c.shipping_address=state.shipToAddress,c.name="Test Case",c.store_id=ezdVars.AppToken,c.publisher_id=ezdVars.PublisherID,c.domain=ezdVars.ApiDomain,c.store_uri=ezdVars.AppURI,c.coupon_code=state.cart.coupon_code,c.shipping_method_id=state.order.shippingMethodID,c.guest_email=state.cartLoginInfo.guestEmail,c.payment_type=state.order.payment.paymentType,c.po_number=state.order.payment.poNumber,a.testCase=c,a.refreshXml=function(){setTimeout(function(){var b=$("#testCaseXml").html(),b=b.replace(/\x3c!--[\s\S]*?--\x3e/g,""),b=b.replace(/ng-\w+?=".*?"/g,""),b=b.replace(/class=".*?"/g,""),b=b.replace("  "," ");a.testCase.xml=b,a.$apply()},50)},a.refreshXml()},ui.controllers.PrintReceiptController=function(a,b){a.sendToPrinter=function(){a.startPrint=!0},a.cart=state.cart,a.order=state.order,a.shipping=state.shipToAddress,a.billing=state.billingAddress,a.contact={},state.shipToAddress&&(a.contact.name=state.shipToAddress.first_name+" "+state.shipToAddress.last_name,a.shipping.name=state.shipToAddress.first_name+" "+state.shipToAddress.last_name),state.billingAddress&&(a.billing.name=state.billingAddress.first_name+" "+state.billingAddress.last_name),a.contact.email=state.cartLoginInfo.guestEmail||ezdVars.UserEmail,a.shippingMethod=state.order.shippingMethod,a.paymentMethod=state.order.payment_type,a.orderNumber=state.cart.orderID,service.getStoreAddress(function(b){a.store=b,b.web_address="http://"+ezdVars.ApiDomain,a.$apply()}),a.beforeClose=function(){delete state.cart,delete state.quoteInformation,delete state.namesNumbers},"Purchase Order"==state.order.payment.paymentType&&(a.paymentMethod="Purchase Order: "+state.order.payment.poNumber),a.shippingMethod=state.order.shippingMethod},ui.controllers.ViewCartController=function(a,b,c){function d(a){for(var b=[],c=0;c<a.selectedSizes.length;c++)for(var d=a.selectedSizes[c],e=0;e<d.cart_retail_item_size_namenumbers.length;e++){var f=d.cart_retail_item_size_namenumbers[e];b.push({name:f.name,number:f.number,size:findMatch(a.sizeData,function(a){return a.id==d.product_style_size_id}),cart_retail_item_id:a.cart_retail_item_id,cart_retail_item_size_namenumber_id:f.cart_retail_item_size_namenumber_id})}return b}a.enableCartCheckout=ezdVars.EnableCartCheckout,a.hidePricing=!ezdVars.EnableCartPricing;var e=ezdVars.CartURL;0>e.indexOf("{{")&&(e+="/{{SessionToken}}"),e=e.replace("{{SessionToken}}",state.currentSessionToken),e=e.replace("{{UserToken}}",state.currentUserToken),e=e.replace("{{UserToken}}",state.activeUserToken),a.cartURL=e,a.sessionToken=state.currentSessionToken;var f=function(b,c){a.cart||(a.cart={}),a.cart.sub_total="Calculating...",a.cart.tax_amount="Calculating...",a.cart.discount="Calculating...",a.cart.grand_total="Calculating...",service.getCart(state.currentUserToken,!1,function(c){if(a.centerModal(),a.cart=state.cart=c,g(),a.editCartRetailItemID){var d=findMatch(state.cart.cart_retail_items,function(b){return b.cart_retail_item_id==a.editCartRetailItemID});d&&(d.editMode=!0)}for(d=0;d<c.cart_retail_items.length;d++)c.cart_retail_items[d].selectedPreview=c.cart_retail_items[d].sidePreviews[0];a.$apply(),b&&b()},c)};a.selectedPreviewChanged=function(a){},a.beforeClose=function(){k()};var g=function(){var a=state.cart,b=state.quoteInformation;if(a&&a.cart_retail_items)for(var c=0;c<a.cart_retail_items.length;c++){var d=a.cart_retail_items[c];if(!(d.design_id&&d.design_id!=state.selectedDesign.design_id||!d.design_id&&state.selectedDesign.design_id)){var e=findMatch(b.sizeStyles,function(a){return a.style.product_style_id==d.product_style_id});if(e){e.cart_retail_item_id=d.cart_retail_item_id,e.cart_retail_item=d,state.designer.design.information.notes&&!d.note&&(d.note=state.designer.design.information.notes);for(var f=0;f<d.selectedSizes.length;f++){var g=d.selectedSizes[f],h=findMatch(e.sizes,function(a){return a.size_id==g.product_style_size_id});if(h||(h={name:product_style_size_name,size_id:g.product_style_size_id,quantity:g.quantity},sizeStyle.sizes.push(h)),h.cart_retail_item_size_id=g.cart_retail_item_size_id,h.cart_retail_item_size=g,h.namesNumbers&&g.cart_retail_item_size_namenumbers)for(var i=0;i<g.cart_retail_item_size_namenumbers.length;i++){var j=g.cart_retail_item_size_namenumbers[i],k=findMatch(h.namesNumbers,function(a){return a.name==j.name&&a.number==j.number});k||(k={name:j.name,number:j.number,size:h.name},h.namesNumbers.push(k)),k.cart_retail_item_size_namenumber_id=j.cart_retail_item_size_namenumber_id,k.cart_retail_item_id=d.cart_retail_item_id}}}}}};a.pageOffset=0,a.pageSize=2,a.previousPage=function(){a.pageOffset=Math.max(0,a.pageOffset-a.pageSize)};var h=0,i=0,j=function(c){i++,i==h&&(ajaxCallEnded("AddItemsToCart"),ezdVars.EnableCartCheckout?f(function(){!state.activeUserToken&&state.cartLoginInfo&&state.cartLoginInfo.guestEmail&&service.saveCartEmail(state.currentUserToken,state.cartLoginInfo.guestEmail)},function(c){"Empty Cart!"==c&&(a.close(),showModal("selectSizes",a,b))}):(window.onbeforeunload=function(){return null},top.location.href=e))};a.editCart=function(a){a.editMode=!0},c.$on("updateNamesAndNumbersQuote",function(){f(function(){l()},function(){l()})}),a.sizeChanged=function(a,b){b.updateSize=!0;var c=b.cart_retail_item_size_id;c&&(c=state.quoteInformation.getCartItemByID(c))&&(c.quantity=0),state.quoteInformation.getProductStyleSizeByID(b.product_style_size_id).quantity+=b.quantity},a.quantityChanged=function(a,b){parseInt(b.quantity,10)?0>b.quantity&&(b.quantity*=-1):b.quantity=0,b.updateQuantity=!0;var c=b.cart_retail_item_size_id;c&&(c=state.quoteInformation.getCartItemByID(c))&&(c.quantity=b.quantity)},a.updateCart=function(b){delete a.editCartRetailItemID;for(var c=i=h=0;c<b.selectedSizes.length;c++){var d=b.selectedSizes[c];d.updateSize?(h++,service.updateCartItemQuantity(state.currentSessionToken,b.cart_retail_item_id,d.original_product_style_size_id,0,j),h++,service.addItemToCart(state.currentSessionToken,b.product_id,b.product_style_id,d.product_style_size_id,b.design_id||"0",d.quantity,j),d.updateSize=!1):d.updateQuantity&&(h++,service.updateCartItemQuantity(state.currentSessionToken,b.cart_retail_item_id,d.product_style_size_id,d.quantity,j),d.updateQuantity=!1)}0==h&&(b.editMode=!1)};var k=function(a){for(var b=0,c=function(){b--,0==b&&a&&a()},d=0;d<state.cart.cart_retail_items.length;d++){var e=state.cart.cart_retail_items[d];e.original_note!=e.note&&(b++,e.original_note=e.note,service.saveCartItemNotes(state.currentUserToken,e.cart_retail_item_id,e.note,c))}0==b&&a&&a()};a.nextStep=function(){k(function(){a.close(),showModal("enterPayment",a,b)})},a.deleteCartItem=function(c){service.removeCartItem(state.currentSessionToken,c.cart_retail_item_id,function(){var d=a.cart.cart_retail_items.indexOf(c);a.cart.cart_retail_items.splice(d,1),d=findMatchIndex(state.quoteInformation.sizeStyles,function(a){return a.cart_retail_item_id==c.cart_retail_item_id}),d>=0&&state.quoteInformation.sizeStyles.splice(d,1),hideLoaderForNext(),f(null,function(c){"Empty Cart!"==c&&(a.close(),showModal("selectSizes",a,b))}),a.$apply()})},a.applyCouponCode=function(){service.saveCartCouponCode(state.currentUserToken,state.cart.couponCode,function(){f()},function(a){alert(a)})};var l=function(){ajaxCallStarted("AddItemsToCart","添加到购物车...");for(var c=i=h=0;c<state.quoteInformation.sizeStyles.length;c++)for(var d=state.quoteInformation.sizeStyles[c],e=0;e<d.sizes.length;e++){var g=d.sizes[e];if(g.cart_retail_item_size_id){var k=g.cart_retail_item_size.cart_retail_item_size_namenumbers&&g.cart_retail_item_size.cart_retail_item_size_namenumbers.length;g.quantity==g.cart_retail_item_size.quantity||k||(h++,service.updateCartItemQuantity(state.currentSessionToken,d.cart_retail_item_id,g.size_id,g.quantity,j))}else if(0<g.quantity)if(g.namesNumbers)for(k=0;k<g.namesNumbers.length;k++){var l=g.namesNumbers[k];if(!l.cart_retail_item_size_namenumber_id){var m={name:l.name,size:state.namesNumbers.names.textSize.size,font_id:state.namesNumbers.names.font.fontID,color:getColorString(state.namesNumbers.names.color,!0)},l={number:l.number,size:state.namesNumbers.numbers.textSize.size,font_id:state.namesNumbers.numbers.font.fontID,color:getColorString(state.namesNumbers.numbers.color,!0)};h++,service.addItemToCartWithName(state.currentSessionToken,state.selectedProduct.product_id,d.style.product_style_id,g.size_id,state.selectedDesign.design_id,1,m,l,j)}}else h++,service.addItemToCart(state.currentSessionToken,state.selectedProduct.product_id,d.style.product_style_id,g.size_id,state.selectedDesign.design_id,g.quantity,j)}0==h&&(ajaxCallEnded("AddItemsToCart"),f(function(){!state.activeUserToken&&state.cartLoginInfo&&state.cartLoginInfo.guestEmail&&service.saveCartEmail(state.currentUserToken,state.cartLoginInfo.guestEmail)},function(c){"Empty Cart!"==c&&(a.close(),showModal("selectSizes",a,b))}))};a.showNamesNumbers=function(c){$.get(state.theme.url(dsLocation+"/html/modals/namesAndNumbersCommon.html"),function(e){var f=angular.element("#angularAppElement").scope().$new();f.sizeData=c.sizeData,
f.namesNumbers=d(c),f.cartItem=c,f.close=function(){$(".isd-nncContainer").remove(),f.$destroy(),a.showingNamesNumbers=!1,a.$$phase||a.$apply()},e=$(e)[0],b(e)(f),$("<div class='isd-nncContainer'>").appendTo(".isd-cart-namesNumbers").append(e),a.showingNamesNumbers=!0,f.noAddingAllowed=!0,f.inCart=!0,f.$apply(),setTimeout(function(){a.centerModal()},10)})},f(function(){l()},function(){l()})},ui.controllers.EnterAddressesController=function(a,b){state.order&&state.order.payment?(a.editableAddressType="SHIPPING",a.nonEditableAddressType="BILLING",a.allowOnlyOneAddress=!1,ezdVars.EnableCartShipping||(a.nonEditableAddressType="SHIPPING",a.editableAddressType="BILLING",a.allowOnlyOneAddress=!0),a.billingAddressRequired=ezdVars.BillingAddressRequired||"Credit Card"==state.order.payment.paymentType||!ezdVars.EnableCartShipping,a.allowOnlyOneAddress&&(a.billingAddressDisabled=!0,a.addressesSame=!0),state.shipToAddress||(state.shipToAddress={country_id:"1",business:"False",pobox:"False"}),a.shipToAddress=state.shipToAddress,state.billingAddress||(state.billingAddress={country_id:"1",business:"True",pobox:"True"}),a.billingAddress=state.billingAddress,a.shippingCountries=[{country_id:1,code:"US",name:"United States",require_state:!0},{country_id:0,code:"",name:"--Loading Country list--",require_state:!0}],a.billingCountries=angular.copy(a.shippingCountries),a.shippingStates=a.allShippingStates=[{country_id:1,code:null,name:"--Loading State List--",state_id:0}],a.billingStates=a.allBillingStates=angular.copy(a.billingStates),"SHIPPING"==a.editableAddressType&&(service.getCartShippingCountryList(state.currentUserToken,function(b){a.shippingCountries=b,a.shipToCountryChanged(),a.$$phase||a.$apply()}),service.getCartShippingStateList(state.currentUserToken,function(b){a.allShippingStates=b,a.shipToCountryChanged(),a.$$phase||a.$apply()})),service.getCartBillingCountryList(state.currentUserToken,function(b){a.billingCountries=b,a.billingCountryChanged(),"BILLING"==a.editableAddressType&&(a.shippingCountries=b),a.$$phase||a.$apply()}),service.getCartBillingStateList(state.currentUserToken,function(b){a.allBillingStates=b,a.billingCountryChanged(),"BILLING"==a.editableAddressType&&(a.allShippingStates=b,a.shipToCountryChanged()),a.$$phase||a.$apply()}),state.activeUserToken&&"SHIPPING"==a.editableAddressType?service.getCartShippingAddresses(state.currentUserToken,function(b){a.accountAddresses=b;for(var c=0;c<b.length;c++){var d=b[c];d.description=d.first_name+" "+d.last_name+"     "+d.street1}a.$$phase||a.$apply()}):a.$$phase||a.$apply(),a.billingAddressChanged=function(){var b=a.billingAddress.first_name||a.billingAddress.first_name||a.billingAddress.last_name||a.billingAddress.street1||a.billingAddress.city||a.billingAddress.postcode||a.billingAddress.phone;a.billingAddressRequired=ezdVars.BillingAddressRequired||"Credit Card"==state.order.payment.paymentType||!ezdVars.EnableCartShipping||b},a.savedAddressChanged=function(){var b=a.shipToAddress.address_id;if(b)for(var c=0;c<a.accountAddresses.length;c++){var d=a.accountAddresses[c];d.address_id==b&&(a.shipToAddress=state.shipToAddress=angular.copy(d),a.shipToCountryChanged(),a.billingCountryChanged(),a.billingAddressDisabled&&(a.billingAddress=state.billingAddress=angular.copy(d)))}},a.savedBillingAddressChanged=function(){var b=a.billingAddress.address_id;if(b)for(var c=0;c<a.accountAddresses.length;c++){var d=a.accountAddresses[c];d.address_id==b&&(a.billingAddress=state.billingAddress=angular.copy(d),a.shipToCountryChanged(),a.billingCountryChanged(),a.billingAddressDisabled&&(a.billingAddress=state.billingAddress=angular.copy(d)))}},a.changeAddressesSame=function(){a.billingAddressDisabled=a.addressesSame,a.billingAddress=a.billingAddressDisabled?state.billingAddress=a.shipToAddress:state.billingAddress=angular.copy(a.shipToAddress),a.billingCountryChanged(),a.billingAddressChanged()},a.shipToCountryChanged=function(){var b=[];if(a.shipToAddress.country_id){a.shippingStates=b,a.shipToAddress.country=findMatch(a.shippingCountries,function(b){return b.country_id==a.shipToAddress.country_id});var c="SHIPPING"==a.editableAddressType?a.allShippingStates:a.allBillingStates;if(c){for(var d=0;d<c.length;d++){var e=c[d];e.country_id==a.shipToAddress.country_id&&b.push(e)}b.length||(a.shipToAddress.state_id=null)}}},a.billingCountryChanged=function(){var b=[];if(a.billingAddress.country_id&&(a.billingStates=b,a.billingAddress.country=findMatch(a.billingCountries,function(b){return b.country_id==a.billingAddress.country_id}),a.allBillingStates)){for(var c=0;c<a.allBillingStates.length;c++){var d=a.allBillingStates[c];d.country_id==a.billingAddress.country_id&&b.push(d)}b.length||(a.billingAddress.state_id=null)}},a.nextStep=function(){a.shippingErrors=[],a.billingErrors=[];var c=ezdVars.EnableCartShipping?"shippingMethod":"reviewOrder";ezdVars.EnableCartShipping||(a.billingAddress=state.billingAddress=a.shipToAddress);var d=ezdVars.EnableCartShipping,e=(a.billingAddress.first_name||a.billingAddress.first_name||a.billingAddress.last_name||a.billingAddress.street1||a.billingAddress.city||a.billingAddress.postcode||a.billingAddress.phone)&&(!a.addressesSame||!d),f=function(b,c){var d=b.trim().split("\n");"shipping"==c||a.allowOnlyOneAddress?a.shippingErrors=d:a.billingErrors=d,a.$apply()};d?service.saveCartShippingAddress(state.currentUserToken,a.shipToAddress,function(d){a.shipToAddress.address_id=d,e?service.saveCartBillingAddress(state.currentUserToken,a.billingAddress,function(d){a.billingAddress.address_id=d,a.close(),showModal(c,a,b)},function(a){f(a,"billing")}):(a.billingAddress=a.shipToAddress,a.close(),showModal(c,a,b))},function(a){f(a,"shipping")}):e&&service.saveCartBillingAddress(state.currentUserToken,a.billingAddress,function(d){a.billingAddress.address_id=d,a.close(),showModal(c,a,b)},function(a){f(a,"billing")})}):(a.close(),showModal("enterPayment",a,b))},ui.controllers.EditImageController=function(a,b,c,d,e){var f=searchInArray(state.selectedDesign.canvas_art,c.id,"id");if(f){a.imageName=f.data.art&&f.data.art.art_name?f.data.art.art_name:f.data.art_name,a.disableResolutionMeter=ezdVars.DisableResolutionMeter,eventManager.trigger("elementSelected",f.id),a.canvasArt=f;var g=function(){if(f.colors){a.colors=[];for(var b=0;b<f.colors.length;b++){var c=getColorString(f.colors[b]);a.colors.push(c)}}};g(),a.showChangeColorModal=function(c,d){var g={currentColor:getColorString(f.colors[c]),onSelect:function(a){a=getColorString(a),"undefined"!=typeof f.setColor?f.setColor(c,a):f.colors="string"==typeof f.colors[c]?{index:c,color:a}:{index:c,color:getColorString(a,!0)},delete f.previewHtml,eventManager.trigger("designColorsChanged")},allowTransparent:!0};showColorModal(a,b,e,g,d)},a.changeAlignment=function(a){state.designer.changeElementAlignment(f.id,a)},a.delobj=function(){ezd.deleteElements(f)},a.align_horizontal=function(){ezd.centerElement(f.id,"h")},a.align_vertical=function(){ezd.centerElement(f.id,"v")},a.resize_vertical=function(){ezd.changeElementFlip(f.id,"v")},a.resize_horizontal=function(){ezd.changeElementFlip(f.id,"h")},a.nudge=function(a){ezd.nudgeElement(f.id,a,1)};var h=function(){var b=state.designer.getElementById(c.id);!a.$$destroyed&&b&&b.object&&"undefined"!=typeof b.object.quality&&(a.quality=b.object.quality,a.qualityWidth=205*b.object.quality+"px",a.$$phase||a.$apply())},i=[];i.push(eventManager.on("designColorsChanged",g)),i.push(eventManager.on("rasterQualityChanged",h)),i.push(eventManager.on("elementDeleted",function(b){a.$$destroyed||searchInArray(state.selectedDesign.canvas_art,c.id,"id")||(d.path("/editImagePane"),a.$$phase||a.$apply())})),i.push(eventManager.on("undoRedo",function(b){a&&!a.$$destroyed&&b.change&&b.change.length&&findMatch(b.change,function(a){return a.id==f.id})&&(g(),a.$$phase||a.$apply())})),h(),a.$on("$destroy",function(){if(i)for(var a=0;a<i.length;a++)i[a]()})}else d.path("/editImagePane")},ui.controllers.EditSvgController=function(a,b,c,d,e){var f=searchInArray(state.selectedDesign.canvas_art,c.id,"id");if(f){eventManager.trigger("elementSelected",f.id),a.imageSrc=f.data.canvas_art_rendered,a.canvasArt=f;var g=function(){if(f.colors){a.colors=[];for(var b=0;b<f.colors.length;b++){var c=getColorString(f.colors[b]);a.colors.push(c)}}};g(),a.showChangeColorModal=function(c,d){var h={currentColor:getColorString(f.colors[c]),onSelect:function(a){a=getColorString(a),"string"==typeof f.colors[c]?f.colors[c]=a:f.colors[c].value=getColorString(a,!0),state.designer.updateArtColor(f.id,c,a),delete f.previewHtml,g()},allowTransparent:!0};showColorModal(a,b,e,h,d)},a.changeAlignment=function(a){state.designer.changeElementAlignment(f.id,a)},a.delobj=function(){ezd.deleteElements(f)},a.align_horizontal=function(){ezd.centerElement(f.id,"h")},a.align_vertical=function(){ezd.centerElement(f.id,"v")},a.resize_vertical=function(){ezd.changeElementFlip(f.id,"v")},a.resize_horizontal=function(){ezd.changeElementFlip(f.id,"h")},a.nudge=function(a){ezd.nudgeElement(f.id,a,1)};var h=[];h.push(eventManager.on("designColorsChanged",g)),h.push(eventManager.on("elementDeleted",function(b){searchInArray(state.selectedDesign.canvas_art,c.id,"id")||(d.path("/editImagePane"),a.$$phase||a.$apply())})),h.push(eventManager.on("undoRedo",function(b){g(),a&&!a.$$destroyed&&!a.$$phase&&b.change&&b.change.length&&findMatch(b.change,function(a){return a.id==f.id})&&a.$apply()})),a.$on("$destroy",function(){if(h)for(var a=0;a<h.length;a++)h[a]()})}else d.path("/editImagePane")},ui.controllers.EditImagePane=function(a,b,c,d,e){$(".design-tool .nav-tabs li").removeClass("active"),$(".design-tool .nav-tabs li:eq(1)").addClass("active")},ui.controllers.EditMultipleController=function(a,b,c,d,e){a.$$phase||a.$apply(),a.nudge=function(a){ezd.nudgeElement(null,a,1,state.designer.activeSide.boundingBox.getSelections())},eventManager.on("elementPropertyChanged",function(a){}),eventManager.on("elementDeleted",function(b){b=searchInArray(state.selectedDesign.canvas_text,c.id,"id"),!a||b||a.$$destroyed||(d.path("/layers"),a.$$phase||a.$apply())})},ui.controllers.GetQuoteController=function(a,b,c){if(state.quoteInformation&&state.quoteInformation.sizeStyles)for(c=0;c<state.quoteInformation.sizeStyles.length;c++){var d=state.quoteInformation.sizeStyles[c];if(d.sizes)for(var e=0;e<d.sizes.length;e++)delete d.sizes[e].priceGrid,delete d.sizes[e].priceData}var f=function(a){for(var b={style:a,sizes:[]},c=a.sizes.split(","),d=a.sizeids.split(","),e=0;e<c.length;e++){var f=c[e],g=d[e],h=findMatch(a.sizeData,function(a){return a.name==f});b.sizes.push({name:f,size_id:h?h.id||h.size_id:g,quantity:0})}return b};if(a.pageOffset=0,a.pageSize=5,a.previousPage=function(){a.pageOffset=Math.max(0,a.pageOffset-a.pageSize)},state.selectedProductStyle&&state.selectedProductStyle.sizes)for(d=state.selectedProductStyle.sizes.split(","),e=state.selectedProductStyle.sizeids.split(","),a.productStyleSizes=[],c=0;c<e.length;c++)a.productStyleSizes.push({name:d[c],size_id:e[c]});if((!state.quoteInformation||state.quoteInformation.isEmpty())&&(state.quoteInformation={sizeStyles:[],isEmpty:function(){if(!this.sizeStyles||!this.sizeStyles.length)return!0;for(var a=0;a<this.sizeStyles.length;a++)for(var b=this.sizeStyles[a],c=0;c<b.sizes.length;c++)if(0<b.sizes[c].quantity)return!1;return!0},getCartItemByID:function(a){for(var b=state.quoteInformation,c=0;c<b.sizeStyles.length;c++)for(var d=b.sizeStyles[c],e=0;e<d.sizes.length;e++){var f=d.sizes[e];if(f.cart_retail_item_size_id==a)return f}return null},getProductStyleSizeByID:function(a){for(var b=state.quoteInformation,c=0;c<b.sizeStyles.length;c++)for(var d=b.sizeStyles[c],e=0;e<d.sizes.length;e++){var f=d.sizes[e];if(f.size_id==a)return f}return null}},state.quoteInformation.sizeStyles.push(f(state.selectedProductStyle)),state.namesNumbers&&state.namesNumbers.items))for(c=0;c<state.namesNumbers.items.length;c++){var g=state.namesNumbers.items[c];g.size&&(g.name||g.number)&&(d=state.quoteInformation.sizeStyles[0],d=findMatch(d.sizes,function(a){return a.name==g.size.name}))&&(d.quantity++,d.namesNumbers||(d.namesNumbers=[]),d.namesNumbers.push(g))}a.sizeStyles=state.quoteInformation.sizeStyles,service.getProductColors(state.selectedProductID,function(b){a.allProductStyles=b,a.$$phase||a.$apply()}),a.updateProductColorDescription=function(){for(var b="",c=0;c<state.quoteInformation.sizeStyles.length;c++)b+=", "+state.quoteInformation.sizeStyles[c].style.color;a.productColor=b.substring(2)},a.showStyleModal=function(b,c){a.readOnly||(a.styleModalVisible=!0,a.styleModalIndex=c,a.selectStyle=function(b){var d=state.quoteInformation.sizeStyles[c+a.pageOffset];d.style=b,b.sizeids.split(",").length!=d.sizes.length&&console.log("改变产品款式时，尺寸不匹配，这不应该发生.");for(var e=b.sizes.split(","),g=b.sizeids.split(","),h=0;h<e.length;h++){var i=e[h];i.size_id=g[h],delete i.priceGrid,delete i.priceData,delete i.cart_retail_item_size_id}for(e={},h=0;h<d.sizes.length;h++)e[d.sizes[h].name]=d.sizes[h].quantity;for(state.quoteInformation.sizeStyles[c+a.pageOffset]=f(b),d=state.quoteInformation.sizeStyles[c+a.pageOffset],h=0;h<d.sizes.length;h++)e[d.sizes[h].name]&&(d.sizes[h].quantity=e[d.sizes[h].name]);d.cart_retail_item_id&&(service.removeCartItem(state.currentSessionToken,d.cart_retail_item_id),delete d.cart_retail_item_id),a.styleModalVisible=!1,a.updateProductColorDescription()})},a.quantityChanged=function(b){b||(b=this.size),parseInt(b.quantity,10)?0>b.quantity&&(b.quantity*=-1):b.quantity=0,a.quantity=h()},a.changeQuantity=function(b,c){b.quantity=parseInt(b.quantity,10),b.quantity=Math.max(0,b.quantity+c),a.quantityChanged(b)},a.removeStyle=function(b,c){state.quoteInformation.sizeStyles.splice(c+a.pageOffset,1),c==a.pageOffset&&(a.pageOffset=Math.max(0,a.pageOffset-1)),state.quoteInformation.sizeStyles.length||state.quoteInformation.sizeStyles.push(f(state.selectedProductStyle)),a.pageOffset=Math.max(0,state.quoteInformation.sizeStyles.length-a.pageSize),a.styleModalVisible=!1,a.updateProductColorDescription()},a.addProductStyle=function(){var b=null;a.allProductStyles&&a.allProductStyles.length&&(b=a.allProductStyles[0]),state.quoteInformation.sizeStyles.push(f(b)),a.pageOffset=Math.max(0,state.quoteInformation.sizeStyles.length-a.pageSize),a.updateProductColorDescription()};var h=function(){for(var a=0,b=0;b<state.quoteInformation.sizeStyles.length;b++)for(var c=state.quoteInformation.sizeStyles[b],d=0;d<c.sizes.length;d++)c.sizes[d].quantity.toString().match(/\d+/)&&(c.sizes[d].quantity=parseInt(c.sizes[d].quantity,10),a+=parseInt(c.sizes[d].quantity,10));return a};a.getColorString=getColorString,a.productColor=state.selectedProductStyle.color,a.productDescription=state.selectedProduct.name,a.quantity=h();var i=state.dsUtils.getPricingColorData();a.numFrontColors=i.isFrontVector?i.numFrontColors:"N/A - Digital Print",a.numSleeveLeftColors=i.isSleeveLeftVector?i.numSleeveLeftColors:"N/A - Digital Print",a.numSleeveRightColors=i.isSleeveRightVector?i.numSleeveRightColors:"N/A - Digital Print",a.numBackColors=i.isBackVector?i.numBackColors:"N/A - Digital Print",a.numColorsString=i.sideColorString,state.namesNumbers&&state.namesNumbers.totals&&(a.numNames=state.namesNumbers.totals.numNames,a.numNumbers=state.namesNumbers.totals.numNumbers,a.numNameNumberItems=state.namesNumbers.totals.numItems),a.checkout=function(){delete state.designSaveResult,showModal("selectSizes",a,b)};var j=function(){var b={total:0,complete:!0},c=h();if(0==c)alert("Please add at least one size to get a quote.");else{if(c<a.minimumQuantity)return a.minimumNotMet=!0,a.$$phase||a.$apply(),b;a.minimumNotMet=!1;for(var d=0;d<state.quoteInformation.sizeStyles.length;d++)for(var e=state.quoteInformation.sizeStyles[d],f=0;f<e.sizes.length;f++){var g=e.sizes[f];0<g.quantity&&(g.priceData?b.total+=g.priceData.totalPrice:g.priceGrid?b.total+=l(g.priceGrid,g.quantity,c):b.complete=!1)}b.total=parseFloat(b.total),state.namesNumbers&&state.namesNumbers.totals.totalPrice&&(b.total+=parseFloat(state.namesNumbers.totals.totalPrice)),b.total=k(b.total).toFixed(2),b.averagePer=k(b.total/c).toFixed(2),b.complete?(b.total=ezdVars.CurrencySymbol+b.total,b.averagePer=ezdVars.CurrencySymbol+b.averagePer):b.total=b.averagePer="Calculating...",a.priceTotals=b,a.$$phase||a.$apply()}},k=function(a){var b=a-Math.floor(a),c=Math.round(100*b)/100;return a-b+c},l=function(b,c,d){var e=findMatch(b,function(a){return a.low<=d&&a.high>=d});e||(e=b[0]),a.minimumNotMet=!1,b=0;var f=e.price||0,g=e.setup||0,h=e.priceDiscountable||0,i=e.printSetup||0,j=e.qtyDiscPercent/100,l=e.combinePrintAndProduct,m=e.applyQtyDiscToPrinting,n=0;return e.qtyDiscPercent?n=0:(n=e.priceDiscountable,j=0),1==l&&0==m&&(console.log("Calculating price with formula -(quoteQtyDiscAmount * sizeStyleQuantity) + (round(quotePrice + (quoteSetup / totalQuantity)) * sizeStyleQuantity) - (((quotePriceDiscountable) * sizeStyleQuantity) * quoteQtyDiscPercent)"),console.log("feed data: "),console.log(e),console.log("formula data: quoteQtyDiscAmount: "+n+" sizeStyleQuantity: "+c+" quotePrice: "+f+" quoteSetup: "+g+" totalQuantity: "+d+" quotePriceDiscountable: "+h+" quoteQtyDiscPercent: "+j+" "),b=-(n*c)+k(f+g/d)*c-h*c*j),1==l&&1==m&&(console.log("Calculating price with formula -(quoteQtyDiscAmount * sizeStyleQuantity) + ((quotePrice + round(quoteSetup / totalQuantity)) * sizeStyleQuantity) - round(((quotePriceDiscountable + (quotePrintSetup / sizeStyleQuantity)) * sizeStyleQuantity) * quoteQtyDiscPercent);"),console.log("feed data: "),console.log(e),console.log("formula data: quoteQtyDiscAmount: "+n+" sizeStyleQuantity: "+c+" quotePrice: "+f+" quoteSetup: "+g+" totalQuantity: "+d+" quotePriceDiscountable: "+h+" quoteQtyDiscPercent: "+j+" quotePrintSetup: "+i+" "),b=-(n*c)+(f+k(g/d))*c-k((h+i/c)*c*j)),0==l&&1==m&&(console.log("Calculating price with formula -(quoteQtyDiscAmount * sizeStyleQuantity) + (quotePrice * sizeStyleQuantity) + quoteSetup - round(((quotePriceDiscountable * sizeStyleQuantity)) * quoteQtyDiscPercent)"),console.log("feed data: "),console.log(e),console.log("formula data: quoteQtyDiscAmount: "+n+" sizeStyleQuantity: "+c+" quotePrice: "+f+" quoteSetup: "+g+" quotePriceDiscountable: "+h+" quoteQtyDiscPercent: "+j+" "),b=-(n*c)+f*c+g-k(h*c*j)),0==l&&0==m&&(console.log("Calculating price with formula -(quoteQtyDiscAmount * sizeStyleQuantity) + (round(quotePrice + (quoteSetup / totalQuantity)) * sizeStyleQuantity) - round(((quotePriceDiscountable * sizeStyleQuantity)) * quoteQtyDiscPercent)"),console.log("feed data: "),console.log(e),console.log("formula data: quoteQtyDiscAmount: "+n+" sizeStyleQuantity: "+c+" quotePrice: "+f+" quoteSetup: "+g+" quotePriceDiscountable: "+h+" quoteQtyDiscPercent: "+j+" totalQuantity: "+d),b=-(n*c)+k(f+g/d)*c-k(h*c*j)),b};a.updateQuote=function(){for(var b=0,c=0;c<state.quoteInformation.sizeStyles.length;c++)for(var d=state.quoteInformation.sizeStyles[c],e=0;e<d.sizes.length;e++){var f=d.sizes[e];f.quantity&&(b+=f.quantity)}for(c=0;c<state.quoteInformation.sizeStyles.length;c++)for(d=state.quoteInformation.sizeStyles[c],e=0;e<d.sizes.length;e++)f=d.sizes[e],0<f.quantity&&!f.priceGrid&&function(){var c=f;service.getQuote(state.selectedProductID,d.style.product_style_id,c.size_id,c.quantity,b,c.quantity,i.numFrontColors,i.numBackColors,i.numSleeveLeftColors,i.numSleeveRightColors,i.isAllVector,0,0,function(b){b.totalPrice?(a.minimumQuantity=0,c.priceData=b):(c.priceGrid=b,a.minimumQuantity=b[0].low),j()},function(a){alert(a)})}();j()},a.maxScreenPrintColors=ezdVars.MaxScreenPrintColors,a.canPrintDesign=state.dsUtils.canPrintDesign(),setTimeout(function(){a.centerModal()},10)},ui.controllers.DistressController=function(a,b,c){a.showingInlineModal=!0,a.loadedDistressList=!0,a.showDistressList=function(){a.hasDesign(!0)&&(a.distress_id=null,state.designer.activeSide.distressObj&&(a.distress_id=state.designer.activeSide.distressObj.distress_id),a.showingInlineModal=!0,service.getDistressList(function(b){for(var c=0;c<b.length;c++){var d=b[c];"0"==d.distress_uri&&(d.distress_thumb_path=state.theme.url(ezdVars.DesignerLocation+"/ds/images/blankDistress.png"),a.distress_id||(a.distress_id=d.distress_id))}a.distressEffects=b,a.$$phase||a.$apply()}))},a.selectDistress=function(b){a.distress_id=b.distress_id,state.designer.changeDistress(b),state.designer.addSnapshotEvent("changeDistress",b)}},ui.controllers.BackgroundColorController=function(a,b,c){a.backgroundColor={color:state.designer.product.information.html_color},a.backgroundColorChanged=function(){ezdVars.ArtToolsMode&&(state.designer.product.information.html_color=a.backgroundColor.color,$("#raphael").css("background-color",getColorString(a.backgroundColor.color)))}},ui.controllers.AdminController=function(a){a.skin={},a.skin.name=$("#minimalSkin").length&&!$("#minimalSkin").prop("disabled")?"minimal":"standard",a.skinChanged=function(){"minimal"==a.skin.name?(document.getElementById("minimalSkin")||$('<link rel="stylesheet" href="'+ezdVars.DesignerLocation+'/ds/css/minimal.css" type="text/css" id="minimalSkin" />').appendTo("head"),$("#minimalSkin").prop("disabled",!1)):$("#minimalSkin").prop("disabled",!0)}},ui.controllers.PunchInController=function(a,b,c,d){"/designs"==c.path()?showModalDrawer("designIdeas",a,d):"/login"==c.path()?showModal("saveAndShare",a,d,{loginOnly:!0}):"/savedArt"==c.path()?showModalDrawer("myArt",a,d):c.path(),eventManager.trigger("punchIn",{screenName:c.path().replace(/\//gi,"")}),c.path("/layers")},ui.controllers.LayersController=function(a,b,c,d,e,f){var g=function(){if(a.$$destroyed)console.log("$scope销毁之后，调用updateLayers");else{0==state.designer.activeSide.elements.length&&state.dsUtils.addRenderedHandlerOneTime(g),a.layers=[];for(var b=0;b<state.designer.activeSide.elements.length;b++){var d=state.designer.activeSide.elements[b];if(d.layerBackgroundColor=state.selectedProductStyle?getColorString(state.selectedProductStyle.html_color):"#FFFFFF",d.previewHtml||(a.svgPreviewSize||(a.svgPreviewSize={width:90,height:90},0<=c.path().indexOf("edit-design")&&(a.svgPreviewSize={width:45,height:45})),d.previewHtml=f.trustAsHtml(state.designer.getElementPreview(d.id,a.svgPreviewSize.width,a.svgPreviewSize.height)),console.log("调用代价极大的 getElementPreview -值得吗？值得吗？")),d.colors){var e=d.colors,h=!0;if(e&&e.length)for(var i=0;i<e.length;i++)if(!colorsAreClose(e[i].value,d.layerBackgroundColor,.1)){h=!1;break}h&&(d.layerBackgroundColor="#aaaaaa")}else colorsAreClose(d.layerBackgroundColor,.001<d.stroke?d.strokeColor:d.color,.1)&&(d.layerBackgroundColor="#aaaaaa");a.layers.push(d)}a.layers.sort(function(a,b){return-1*(parseFloat(a.z)-parseFloat(b.z))}),a.$$phase||a.$apply()}};g(),a.updateLayers=g,a.moveLayerUp=function(b){if(0!==$.inArray(b,a.layers)){b.z++;for(var c=0;c<a.layers.length;c++){var d=a.layers[c];d.id!=b.id&&d.z==b.z&&d.z--}state.designer.changeLayer(b.id,"up"),a.layers.sort(function(a,b){return-1*(parseFloat(a.z)-parseFloat(b.z))})}},a.moveLayerDown=function(b){if($.inArray(b,a.layers)!==a.layers.length-1){b.z--;for(var c=0;c<a.layers.length;c++){var d=a.layers[c];d.id!=b.id&&d.z==b.z&&d.z++}state.designer.changeLayer(b.id,"down"),a.layers.sort(function(a,b){return-1*(parseFloat(a.z)-parseFloat(b.z))})}},a.selectLayer=function(a){eventManager.trigger("elementSelected",a.id);var b=state.designer.getElementById(a.id);console.log("检查元素对象",b,b.object,a.id,a),eventManager.trigger("elementsSelected",[b.object])},a.deleteLayer=function(a){state.designer.getElementById(a.id)&&state.designer.deleteElements(a),eventManager.trigger("designColorsChanged")};var h=[];h.push(eventManager.on("designChanged",g)),h.push(eventManager.on("designColorsChanged",g)),h.push(eventManager.on("designCanvasChanged",g)),h.push(eventManager.on("layersChanged",g)),h.push(eventManager.on("productChanged",g)),h.push(eventManager.on("productColorChanged",g)),h.push(eventManager.on("selectedProductLoaded",g)),h.push(eventManager.on("stackingOrderChanged",function(){g()})),h.push(eventManager.on("designChanging",function(){a.layers=[],a.$$phase||a.$apply()})),h.push(eventManager.on("undoRedo",function(a){})),h.push(eventManager.on("elementDeleted",function(a){g()})),a.$on("$destroy",function(){if(h)for(var a=0;a<h.length;a++)h[a]()})},ui.controllers.NamesAndNumbersController=function(a,b,c){a.onShow=function(){var b=a.selectedProductID||state.selectedProductID,d=a.selectedProductStyleID||state.selectedProductStyleID,e=a.sizeData||state.selectedProductStyle.sizeData;if(a.productStyleSizes=e,!state.namesNumbers){if(state.namesNumbers={},state.namesNumbers.namesFontOptions=[{label:"1 inch",fontSize:"60px",size:1},{label:"2 inches",fontSize:"60px",size:2}],state.namesNumbers.numbersFontOptions=[{label:"6 inches",fontSize:"155px",size:6},{label:"8 inches",fontSize:"155px",size:8}],state.namesNumbers.fonts=[{fontFamily:"Varsity",fontID:1660,cssFontFamily:"Varsity"},{fontFamily:"Academy",fontID:1659,cssFontFamily:"Academy"},{fontFamily:"Yearbook",fontID:1662,cssFontFamily:"Yearbook"},{fontFamily:"College02",fontID:70,cssFontFamily:"College02"}],ezdVars.HasGoogleFonts&&(state.namesNumbers.fonts=[{fontFamily:"Collegiate 05",fontID:2349,cssFontFamily:"collegiate05"},{fontFamily:"Modern 12",fontID:2034,cssFontFamily:"modern12"},{fontFamily:"Modern 20",fontID:2339,cssFontFamily:"modern20"},{fontFamily:"Modern 21",fontID:2347,cssFontFamily:"modern21"},{fontFamily:"Modern 22",fontID:2348,cssFontFamily:"modern22"},{fontFamily:"Western 12",fontID:2376,cssFontFamily:"western12"}]),state.excludedFontIDs&&state.excludedFontIDs.length)for(var f=0;f<state.namesNumbers.fonts.length;f++)findMatch(state.excludedFontIDs,function(a){return a===state.namesNumbers.fonts[f].fontID})&&(state.namesNumbers.fonts.splice(f,1),f--);state.namesNumbers.names={},state.namesNumbers.names.font=state.namesNumbers.fonts[0],state.namesNumbers.names.textSize=state.namesNumbers.namesFontOptions[1],state.namesNumbers.names.color="#000000",state.namesNumbers.names.quantity=0,state.namesNumbers.numbers={},state.namesNumbers.numbers.font=state.namesNumbers.fonts[0],state.namesNumbers.numbers.textSize=state.namesNumbers.numbersFontOptions[1],state.namesNumbers.numbers.color="#000000",state.namesNumbers.numbers.quantity=0,e=e[0],a.namesNumbers||(state.namesNumbers.items=[{name:"",number:"",size:e},{name:"",number:"",size:e},{name:"",number:"",size:e}]),service.loadCss(ezdVars.DesignerLocation+"/common/css/namesNumbersFonts.css")}a.namesFontOptions=state.namesNumbers.namesFontOptions,a.numbersFontOptions=state.namesNumbers.numbersFontOptions,a.fonts=state.namesNumbers.fonts,e=state.dsUtils.getPricingColorData(),hideLoaderForNext(),a.namesPrice="Calculating...",a.numbersPrice="Calculating...",service.getProductQuote(b,d,null,e.numFrontColors,e.numBackColors,e.numSleeveLeftColors,e.numSleeveRightColors,e.isAllVector,function(b){var d=b[0];state.namesNumbers.priceGrid=b,a.namesPriceFloat=d.namePrice,a.numbersPriceFloat=d.numberPrice,a.namesPrice=c.formatPrice(d.namePrice)+" Each",a.numbersPrice=c.formatPrice(d.numberPrice)+" Each",a.totals=state.namesNumbers.totals=a.countTotals(),a.$$phase||a.$apply(),setTimeout(function(){a.centerModal&&a.centerModal()},10)}),a.pageOffset=0,a.pageSize=5,a.names=state.namesNumbers.names,a.numbers=state.namesNumbers.numbers,a.namesNumbers||(a.namesNumbers=state.namesNumbers.items),a.cartItem&&(state.namesNumbers.names.font=findMatch(state.namesNumbers.fonts,function(b){return b.fontID===parseInt(a.cartItem.name_font_id,10)}),state.namesNumbers.names.textSize=findMatch(state.namesNumbers.namesFontOptions,function(b){return b.size===parseInt(a.cartItem.name_size,10)}),state.namesNumbers.names.color=getColorString(a.cartItem.name_number_color),state.namesNumbers.numbers.font=findMatch(state.namesNumbers.fonts,function(b){return b.fontID===parseInt(a.cartItem.number_font_id,10)}),state.namesNumbers.numbers.textSize=findMatch(state.namesNumbers.numbersFontOptions,function(b){return b.size===parseInt(a.cartItem.number_size,10)}),state.namesNumbers.numbers.color=getColorString(a.cartItem.number_color)),a.previewData={name:"Name",number:"10",nameFontFamily:state.namesNumbers.names.font.cssFontFamily,numberFontFamily:state.namesNumbers.numbers.font.cssFontFamily,nameFontSize:state.namesNumbers.names.textSize.fontSize,numberFontSize:state.namesNumbers.numbers.textSize.fontSize},state.namesNumbers.countTotals=a.countTotals,a.totals=state.namesNumbers.totals=a.countTotals()},a.countTotals=function(){for(var b={numNames:0,numNumbers:0,numItems:0,totalPrice:0},c=0;c<a.namesNumbers.length;c++){var d=a.namesNumbers[c];(d.name||d.number)&&(b.numItems++,d.name&&b.numNames++,d.number&&b.numNumbers++)}return b.totalPrice=b.numNames*a.namesPriceFloat+b.numNumbers*a.numbersPriceFloat,b.totalPrice||(b.totalPrice=0),b.totalPrice=b.totalPrice.toFixed(2),b},a.namesFontSizeChanged=function(){a.previewData.nameFontSize=state.namesNumbers.names.textSize.fontSize,console.log("call k() ---- 10"),e()},a.numbersFontSizeChanged=function(){a.previewData.numberFontSize=state.namesNumbers.numbers.textSize.fontSize,console.log("call k() ---- 11"),e()},a.chooseNamesColor=function(d){if(!a.readOnly){var f={currentColor:state.namesNumbers.names.color,onSelect:function(a){state.namesNumbers.names.color=a,console.log("call k() ---- 12"),e()},allowTransparent:!1,onlyNames:!0};showColorModal(a.$new(),b,c,f,d)}},a.chooseNumbersColor=function(d){if(!a.readOnly){var f={currentColor:state.namesNumbers.numbers.color,onSelect:function(a){state.namesNumbers.numbers.color=a,console.log("call k() ---- 13"),e()},allowTransparent:!1,onlyNumbers:!0};showColorModal(a.$new(),b,c,f,d)}},a.namesFontChanged=function(){a.previewData.nameFontFamily=state.namesNumbers.names.font.cssFontFamily,console.log("call k() ---- 15"),e()},a.numbersFontChanged=function(){a.previewData.numberFontFamily=state.namesNumbers.numbers.font.cssFontFamily,console.log("call k() ---- 16"),e()},a.nameChanged=function(b){a.totals=state.namesNumbers.totals=a.countTotals(),d(b)},a.numberChanged=function(b){a.totals=state.namesNumbers.totals=a.countTotals(),d(b)},a.sizeChanged=function(b){a.totals=state.namesNumbers.totals=a.countTotals(),b.changedSize=!0,d(b)};var d=function(a){if(a.cart_retail_item_size_namenumber_id){var b=!1;if(state.cart){var c=state.cart.getNameNumber(a.cart_retail_item_size_namenumber_id);c&&(b=c.name!=a.name||c.number!=a.number||a.changedSize,c.name=a.name,c.number=a.number,delete a.changedSize)}b&&service.updateNameNumber(state.currentUserToken,a.cart_retail_item_id,a.size.id,a.cart_retail_item_size_namenumber_id,a.name,a.number,function(){})}},e=function(){for(var b=!1,c=0;c<a.namesNumbers.length;c++){var d=a.namesNumbers[c];if(d.cart_retail_item_size_namenumber_id){b=!0;break}}b&&(b={color:getColorString(state.namesNumbers.names.color,!0),size:state.namesNumbers.names.textSize.size,font_id:state.namesNumbers.names.font.fontID},c={color:getColorString(state.namesNumbers.numbers.color,!0),size:state.namesNumbers.numbers.textSize.size,font_id:state.namesNumbers.numbers.font.fontID},service.updateNameNumberFont(state.currentUserToken,d.cart_retail_item_id,b,c,function(){},function(){}))};a.addNameNumber=function(){a.namesNumbers.push({name:"",number:"",size:a.productStyleSizes[0]}),a.pageOffset=Math.max(0,a.namesNumbers.length-a.pageSize)},a.deleteNameNumber=function(b,c){a.namesNumbers.splice(b+a.pageOffset,1),b==a.pageOffset&&(a.pageOffset=Math.max(0,a.pageOffset-1)),a.pageOffset=Math.max(0,a.namesNumbers.length-a.pageSize),c==a.previewData.nn&&(a.previewData.number="10",a.previewData.name="Name",delete a.previewData.nn),c.cart_retail_item_size_namenumber_id&&service.removeNameNumberFromCart(state.currentUserToken,c.cart_retail_item_id,c.cart_retail_item_size_namenumber_id)},a.previewNameNumber=function(b,c){a.previewData.name=c.name,a.previewData.number=c.number,a.previewData.nn=c},a.addToOrder=function(){for(var b=0,d=0,e=function(){d++,d!==b||a.readOnly||c.$emit("updateNamesAndNumbersQuote")},f=0;f<a.namesNumbers.length;f++){var g=a.namesNumbers[f];
if(g.name||g.number||(a.namesNumbers.splice(f,1),f--),a.inCart&&!g.cart_retail_item_size_namenumber_id){var h={color:getColorString(state.namesNumbers.names.color,!0),size:state.namesNumbers.names.textSize.size,font_id:state.namesNumbers.names.font.fontID,name:g.name},i={color:getColorString(state.namesNumbers.numbers.color,!0),size:state.namesNumbers.numbers.textSize.size,font_id:state.namesNumbers.numbers.font.fontID,number:g.number};b++,service.addItemToCartWithName(state.currentSessionToken,a.cartItem.product_id,a.cartItem.product_style_id,g.size.id,a.cartItem.design_id,1,h,i,e)}}0!==b||a.readOnly||c.$emit("updateNamesAndNumbersQuote"),a.close()},a.onShow()},ui.controllers.SaveAndShareController=function(a,b,c,d){var e=function(){a.close(),a.loginOnly||showModal("saveAndNameDesign",a,d)};console.log("call k() ---- 19"),state.activeUserToken?e():(ui.controllers.LogInOrCreateAccountController(a,b,c),a.loggedIn=function(a){console.log("call k() ---- 20"),e()})},ui.controllers.SaveAndNameDesignController=function(a,b,c){a.designName=state.designer.design.information.name,a.note=state.designer.design.information.notes,a.hideNote=ezdVars.EmbeddedPartner,a.saveDesign=function(){state.designer.design.information.notes=a.note,ajaxCallStarted("SaveDesignTemplate","保存设计..."),state.designer.saveDesign({designId:state.selectedDesignID,productStyleId:state.selectedProductStyle.product_style_id,UserToken:state.currentUserToken,UserToken:state.activeUserToken,name:a.designName,notes:state.designer.design.information.notes||"",success:function(d,e){if(state.designer.design.information.name=a.designName,state.selectedDesignID=state.selectedDesign.design_id=e.designID,ajaxCallEnded("SaveDesignTemplate"),state.designSaveResult=e,e.UserToken&&(state.currentUserToken=parseInt(e.UserToken.trim(),10)),e.UserToken&&(state.activeUserToken=parseInt(e.UserToken,10)),e.sessionToken&&(state.currentSessionToken=e.sessionToken.trim()),ezdVars.NextURL){var f=ezdVars.NextURL.replace("designID=0","designID="+state.selectedDesignID);try{window.onbeforeunload=null,window.top.onbeforeunload=null,window.top.location.href=f}catch(g){location.href=f}}a.close(),b.isAdmin||b.disableShareDesign||showModal("saveAndShareEmail",a,c)},error:function(a){ajaxCallEnded("SaveDesignTemplate"),alert("There was an unexpected error saving this design.  The error returned was: "+a)}})}},ui.controllers.SaveAndShareEmailController=function(a,b){a.startPrint=!1,a.emailChanged=function(){"autotest"==a.emailDesignInfo.emailTo&&showModal("autotest",a,$compile)},state.cart&&state.cart.orderID&&(a.orderNumber=state.cart.orderID,a.$parent.beforeClose=function(){delete state.cart,delete state.quoteInformation,delete state.namesNumbers}),a.sendToPrinter=function(){a.startPrint=!0,setTimeout(function(){a.startPrint=!1,a.$apply()},100)},a.hideSocialMedia=ezdVars.EmbeddedPartner},ui.controllers.ShareWithSocialMediaController=function(a,b,c,d){a.designID=state.selectedDesign.design_id,a.designName=state.designer.design.information.name},ui.controllers.EmailDesignController=function(a,b){a.emailDesignInfo={emailTo:"",emailFrom:ezdVars.UserEmail,nameFrom:ezdVars.UserName,message:"Check out the design I just created!"},a.emailSent=!1,a.emailDesign=function(){service.sendDesignEmail(state.currentUserToken,state.activeUserToken,state.selectedDesign.design_id,a.emailDesignInfo.emailTo,a.emailDesignInfo.emailFrom,a.emailDesignInfo.nameFrom,a.emailDesignInfo.nameTo,a.emailDesignInfo.message,function(){a.emailSent=!0,a.$apply()})},a.emailChanged=function(){"autotest"==a.emailDesignInfo.emailTo&&showModal("viewTestCaseXml",a,b)}},ui.controllers.DesignsAndClipArtController=function(a,b,c){a.disableUserArt=ezdVars.DisableUserArt,a.disableClipArt=ezdVars.DisableClipArt,a.disableDesigns=ezdVars.DisableDesigns},ui.controllers.MyArtController=function(a,b,c){a.searching=0,a.offset=0,a.pageSize=8;var d=function(){a.searching++,service.getDesignsByUser(state.activeUserToken,function(b){a.searching--,a.offset=0,a.artItems=b,a.$apply()}),service.getArtForUser(state.activeUserToken,function(b){a.searching--,a.clipArtItems=b,a.$apply()})};a.onShow=function(){state.activeUserToken?(a.isLoggedIn=!0,d()):a.isLoggedIn=!1},a.onShow(),a.$on("loggedIn",function(){a.isLoggedIn=!0,d()}),a.selectClipArt=function(b){state.dsUtils.addClipArt(b,function(){a.$$phase||a.$apply()}),a.close()},a.beforeSelect=function(){"undefined"!=typeof window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),a.artItems=[],a.$$phase||a.$apply()},a.selectArt=function(c){a.beforeSelect(),state.dsUtils.selectNewDesign(c.design_id,a,b),b.path("/layers"),a.close()}},ui.controllers.DesignIdeasController=function(a,b,c){a.searching=0,a.searching++,service.getDesignCategoryList(null,function(b){a.searching--,a.topCategories=a.categories=b,a.selectedCategoryID&&(b=findMatch(b,function(b){return b.design_category_id==a.selectedCategoryID}),delete a.selectedCategoryID,b&&a.selectCategory(b)),a.$$phase||a.$apply()}),a.searchTerm="",a.offset=0,a.pageSize=6,a.selectCategory=function(b){a.selectedCategory=b,e(!1),a.searching++,service.getDesignCategoryList(b.design_category_id,function(c){a.searching--,a.offset=0,a.categories=c,b.subcategories=c;for(var d=0;d<c.length;d++)c[d].parentCategory=b;a.categoryOffset=0,a.$$phase||a.$apply()}),a.searching++,service.getDesignsByCategory(b.design_category_id,null,function(b){a.searching--,a.offset=0,a.artItems=b,a.$$phase||a.$apply()})};var d=function(b){if(b==a.selectedCategory)return!0;if(!b.subcategories)return!1;for(var c=0;c<b.subcategories.length;c++)if(b.subcategories[c]==a.selectedCategory||d(b.subcategories[c]))return!0;return!1};a.showSubcategories=function(a){return a.subcategories&&a.subcategories.length?d(a):!1};var e=function(b){if(a.crumbs=[{label:"Design Ideas",click:function(){a.categories=a.topCategories,delete a.selectedCategory,a.artItems=[],e()}}],b)a.crumbs.push({label:"Search:"+a.searchTerm,click:function(){}});else{for(var c=a.selectedCategory,d=[];c;)!function(b){d.push({label:c.name,click:function(){a.selectCategory(b)}})}(c),c=c.parentCategory;d.reverse(),a.crumbs=a.crumbs.concat(d)}};a.searchDesigns=function(){a.searching++,service.getDesignsByCategory(null,a.searchTerm,function(b){a.searching--,e(!0),a.artItems=b,a.categories=null,a.$$phase||a.$apply()})},a.beforeSelect=function(){"undefined"!=typeof window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),a.artItems=[],a.$$phase||a.$apply()},a.onShow=function(){a.selectedCategory&&a.selectCategory(a.selectedCategory)},a.selectArt=function(c){a.beforeSelect(),state.dsUtils.selectNewDesign(c.design_id,a,b),b.path("/layers"),a.close()},console.log("call k() ---- 1"),e()},ui.controllers.ClipArtController=function(a,b,c){b=function(){a.searching=0,a.searching++,a.artItems=[],a.categories=a.topCategories=[],service.getArtCategoryList(null,ezdVars.EmbroideryMode,function(b){a.searching--,a.embroideryOnly&&deleteMatches(b,function(a){return"0"==a.can_embroider}),a.topCategories=a.categories=b,a.$$phase||a.$apply()}),service.getArtInCategory(null,null,null,function(b){a.searching--,a.offset=0,a.artItems=b,a.$$phase||a.$apply()}),a.searchTerm="",a.offset=0,a.pageSize=6,a.selectCategory=function(c,d){a.selectedCategory=c,a.searching++,service.getArtCategoryList(c.art_category_id,ezdVars.EmbroideryMode,function(b){a.searching--,a.offset=0,a.embroideryOnly&&deleteMatches(b,function(a){return"0"==a.can_embroider}),a.categories=b,c.subcategories=b;for(var d=0;d<b.length;d++)b[d].parentCategory=c;c.subcategories.length>0?($(".isd-clipart-category-list").addClass("active"),a.$$phase||a.$apply()):a.$$phase||a.$apply()}),a.searching++,service.getArtInCategory(c.art_category_id,null,null,function(b){a.searching--,a.offset=0,a.artItems=b,a.$$phase||a.$apply()}),$(d.currentTarget).addClass("active").parent().siblings().find("a").removeClass("active"),b(!1)},a.searchArt=function(){a.searching++,service.getArtInCategory(null,a.searchTerm,null,function(c){a.searching--,a.artItems=c,a.categories=null,b(!0),a.$$phase||a.$apply()})},a.selectArt=function(b){a.beforeSelect(),state.dsUtils.addClipArt(b,function(b){a.$$phase||a.$apply(),a.clipArtAdded&&(a.clipArtAdded(b),delete a.clipArtAdded)}),a.close()};var b=function(c){if(a.crumbs=[{label:"Design Ideas",click:function(){a.categories=a.topCategories,delete a.selectedCategory,a.artItems=[],b(!1)}}],c)a.crumbs.push({label:"Search:"+a.searchTerm,click:function(){}});else{for(var d=a.selectedCategory,e=[];d;)!function(b){e.push({label:d.name,click:function(){a.selectCategory(b)}})}(d),d=d.parentCategory;e.reverse(),a.crumbs=a.crumbs.concat(e)}};b(!1)},a.onShow=b,a.beforeSelect=function(){"undefined"!=typeof window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),a.artItems=[],a.$$phase||a.$apply()},b()},ui.controllers.ActionController=function(a,b,c,d,e,f){a.showProductModal=function(){productChanger.showProductsModal()},a.showUploadModal=function(){mobileUploader.showMobileUploadModal()},a.showHelpModal=function(){var b=f.trustAsResourceUrl("//www.youtube.com/embed/"+ezdVars.HelpVideoOverview+"?autoplay=1");showModal("video",a,e,{videoUrl:b})},a.toggleZoom=function(){b.hasDesign(!0)?state.designer.doZoom():state.designer.zoomOut()},a.selectAll=function(){b.hasDesign(!0)&&state.designer.selectAll()},a.copySelection=function(){var a=state.designer.copySelection();eventManager.trigger("elementsAdded",a)},a.openCategoryDrawer=function(b){showModalDrawer("browseProductsSingle",a,e,{selectedCategory:b,inDrawer:!0,product:state.selectedProduct,noToggleOnClick:!0},"759px",null)},a.showCheckoutModal=function(){delete state.designSaveResult,showModal("selectSizes",a,e)},a.SaveDesign=function(){state.selectedDesign.isEmpty()||state.designer.saveDesign({designId:state.selectedDesignID,productStyleId:state.selectedProductStyle.product_style_id,UserToken:state.currentUserToken,UserToken:state.activeUserToken,name:a.designName,notes:state.designer.design.information.notes||"",success:function(b,c){if(state.designer.design.information.name=a.designName,state.selectedDesignID=state.selectedDesign.design_id=c.designID,ajaxCallEnded("SaveDesignTemplate"),state.designSaveResult=c,c.UserToken&&(state.currentUserToken=parseInt(c.UserToken.trim(),10)),c.UserToken&&(state.activeUserToken=parseInt(c.UserToken,10)),c.sessionToken&&(state.currentSessionToken=c.sessionToken.trim()),ezdVars.NextURL){var d=ezdVars.NextURL.replace("designID=0","designID="+state.selectedDesignID);try{window.onbeforeunload=null,window.top.onbeforeunload=null,window.top.location.href=d}catch(f){location.href=d}}showModal("saveDesignTip",a,e),setTimeout(function(){hideModalDrawer("#saveDesignTip")},1e3)},error:function(a){ajaxCallEnded("SaveDesignTemplate"),alert("保存时发生错误: "+a)}})}},ui.controllers.DesignerController=function(a,b,c,d,e,f){if(console.log("DesignerController init"),b.isZoomedIn=!1,b.ezdLocation=ezdVars.DesignerLocation,b.UserToken=state.activeUserToken,b.UserToken=state.currentUserToken,b.AppToken=window.ezdAppToken,b.hasDesign=function(a){return state.selectedDesign&&!state.selectedDesign.isEmpty(a)},b.saving=!1,b.alphabroderEmbed="alphabroder"==ezdVars.EmbeddedPartner,b.videoTutorialsUrl=ezdVars.VideoTutorialsURL,b.isTestEnvironment=0<location.href.indexOf("open.dev.jzw.la")||0<=location.href.indexOf("file://"),b.artToolsMode=ezdVars.ArtToolsMode=!ezdVars.ProductID&&!ezdVars.DefaultProductID,ezdVars.EmbroideryMode=ezdVars.EmbroideryMode||"embroidery_demo"==ezdVars.AppURI,ezdVars.AutoZoom=ezdVars.AutoZoom&&!ezdVars.ArtToolsMode,ezdVars.EnforceBoundaries=ezdVars.EnforceBoundaries||ezdVars.ArtToolsMode,ezdVars.StartPage&&"Designs"!==ezdVars.StartPage&&(ezdVars.StartPageCategoryID=null,ezdVars.StartPage=null),ezdVars.ArtToolsMode&&(ezdVars.DisableProducts=!0,ezdVars.EnableNameNumbers=!1,ezdVars.EnableCartCheckout=!1,ezdVars.DisableAddToCart=!0,ezdVars.OrderSummary=!1,ezdVars.AutoZoom=!1,state.designer.activeSide.boundingBox.enableRegionBorder=!1),b.transparentClass=function(a){return a=getColorString(a),"none"==a?"isd-transparentColor":""},b.getColorName=function(a){if(a=getColorString(a),"none"==a)return"Transparent";if(state.storeInkColors){for(var b=0;b<state.storeInkColors.length;b++){var c=state.storeInkColors[b];if(c.html_color==a)return c.name}return a}},b.getColorString=getColorString,b.isAdmin=ezdVars.Admin&&"none"!=ezdVars.Admin.toString().toLowerCase(),b.disableShareDesign=ezdVars.DisableShareDesign,b.requireDesign=state.selectedProduct&&0!=state.selectedProduct.require_design,b.allowCheckout=!ezdVars.DisableAddToCart&&!b.isAdmin,a.disableDistress=ezdVars.DisableDistress,a.disableGetQuote=!ezdVars.OrderSummary,b.disableUserArt=ezdVars.DisableUserArt,b.disableDesigns=ezdVars.DisableDesigns,a.disableClipArt=ezdVars.DisableClipArt,a.disableAllArt=ezdVars.DisableClipArt&&ezdVars.DisableUserArt&&ezdVars.DisableDesigns,a.disableProducts=ezdVars.DisableProducts,a.disableUploadImage=ezdVars.DisableUploadImage||ezdVars.DisableUploadRasterArt&&ezdVars.DisableUploadVectorArt,a.disableNamesNumbers=!ezdVars.EnableNameNumbers||ezdVars.EmbeddedPartner||state.selectedProduct&&"0"==state.selectedProduct.enable_team_name_numbers,a.showBranding=!ezdVars.PB,a.canUndo=!1,a.canRedo=!1,e="/designs"==c.path()||"/login"==c.path()||"/uploadArt"==c.path()||"/savedArt"==c.path(),ezdVars.DesignID||ezdVars.ArtID||ezdVars.StartPageCategoryID||"LANDING"!=ezdVars.GreetBoxSetting||e||b.disableDesigns&&b.disableUserArt||showModal("landingPage",a,d,{noCenter:!0}),ezdVars.ArtID?service.getArtByID(ezdVars.ArtID,function(b){getImageData(b.thumb_cached,!1,function(c){b.width||(b.width=c.width),b.height||(b.height=c.height);var d=eventManager.on("rendered",function(){eventManager.trigger("designColorsChanged"),a.$$phase||a.$apply(),d&&d()});c=state.designer.addClipArt(b),c=c.id;for(var e=0;e<b.art_colors.length;e++)b.art_colors[e].value=b.art_colors[e].color,delete b.art_colors[e].color;c={table_name:"canvas_art",location:"Front",canvas_art_id:0,canvas_art_rendered:b.thumb_jit,colors:b.art_colors,art:b,id:c,z:1e6},state.selectedDesign.canvas_art.push(c),eventManager.trigger("designColorsChanged"),eventManager.trigger("designChanged")})}):"Designs"==ezdVars.StartPage&&ezdVars.StartPageCategoryID&&showModalDrawer("designIdeas",a,d,{selectedCategoryID:ezdVars.StartPageCategoryID}),b.currencySymbol=ezdVars.CurrencySymbol||"$",b.prewImageHtml="",b.step=1,b.checkState=function(a){switch(a){case"prev":return 1==b.step?!1:!0;case"next":return 1==b.step||2==b.step?!0:!1;case"save":return 3==b.step?!0:!1}},b.goToStep=function(d){if(!$(event.target).hasClass("isd-disabled")&&!$(event.target).parent().hasClass("isd-disabled")&&(2!=d&&3!=d||b.hasDesign())){var e=b.step;switch(d){case 1:c.path("/step1");break;case 2:1==e&&(state.isInitialDesign||state.isChangedDesign)?($(".step").addClass("isd-disabled"),service.ajaxCallStarted("disabledDesign","正在处理，请稍后..."),a.SaveDesign(function(b,d){state.isInitialDesign=!1,eventManager.trigger("updateStep2View",function(){$(".step").removeClass("isd-disabled"),c.path("/step2"),a.$apply()})})):c.path("/step2");break;case 3:if(2!=e)return;eventManager.trigger("validateActivity",function(){if("0"==ezdVars.UserToken){var b=window.location.href;window.location.href="/login?relurl="+encodeURIComponent(b)}else $(".step").addClass("isd-disabled"),eventManager.trigger("saveActivity",function(){$(".step").removeClass("isd-disabled"),c.path("/step3"),a.$apply()})})}}},eventManager.on("toAddTextPath",function(){c.path("/addText"),b.$$phase||b.$apply()}),b.goStep=function(c){if(!event||!$(event.target).hasClass("isd-disabled")){var d=b.step;b.step=c;var c=$(".isd-step"),e=$(".isd-step .isd-step-1"),f=$(".isd-step .isd-step-2"),g=$(".isd-step .isd-step-3");switch(b.step){case 1:2==d&&f.animate({left:"100%"},300,function(){e.animate({width:"100%"},300,function(){e.find(".design-tool").animate({left:10},300,function(){e.find(".design-product").animate({right:10},200,function(){})})})}),3==d&&g.animate({left:"100%"},300,function(){e.animate({width:"100%"},300,function(){e.find(".design-tool").animate({left:10},300,function(){e.find(".design-product").animate({right:10},200,function(){})})})});break;case 2:1==d&&e.find(".design-product").animate({right:-360},300,function(){e.find(".design-tool").animate({left:-310},200,function(){e.animate({width:"50%"},500,function(){service.ajaxCallEnded("disabledDesign")}),f.animate({left:"50%"},500)})}),3==d&&g.animate({left:"100%"},500,function(){f.animate({left:"50%"},500)}),state.designer.activeSide.boundingBox.hide();break;case 3:1==d&&e.find(".design-product").animate({right:-360},300,function(){e.find(".design-tool").animate({left:-310},200,function(){e.animate({width:"50%"},500),g.animate({left:"50%"},500)})}),2==d&&f.animate({left:"100%"},500,function(){g.animate({left:"50%"},500)}),state.designer.activeSide.boundingBox.hide()}a.$$phase||a.$apply()}},eventManager.on("goStep",function(a){b.goStep(a)}),b.prevStep=function(){b.goToStep(b.step-1)},b.nextStep=function(){b.goToStep(b.step+1)},b.done=function(){console.log("done"),eventManager.trigger("doneActivity",function(){state.isDone=!0,setTimeout(function(){window.location.href=$("#activityDirect").attr("href")},2e3),$("#doneDialog").show()})},b.save=function(){a.SaveDesign()},b.isStep1=function(){return 1==b.step?!0:!1},a.SaveDesign=function(b){state.selectedDesign.isEmpty()||state.designer.saveDesign({designId:state.selectedDesignID,productStyleId:state.selectedProductStyle.product_style_id,UserToken:state.currentUserToken,UserToken:state.activeUserToken,name:a.designName,notes:state.designer.design.information.notes||"",success:function(c,d){state.designer.design.information.name=a.designName,state.selectedDesignID=state.selectedDesign.design_id=d.designID,ajaxCallEnded("SaveDesignTemplate"),state.designSaveResult=d,d.UserToken&&(state.currentUserToken=parseInt(d.UserToken.trim(),10)),d.UserToken&&(state.activeUserToken=parseInt(d.UserToken,10)),d.sessionToken&&(state.currentSessionToken=d.sessionToken.trim()),b&&b(state.selectedDesignID,d.activityId)},error:function(a){ajaxCallEnded("SaveDesignTemplate"),alert("保存时发生错误: "+a)}})},b.formatPrice=function(a){var c=a;return"undefined"==typeof a||""===a||null===a||"object"==typeof a?"":"string"!=typeof a||(a=a.replace(b.currencySymbol,""),/^[0-9\.\,]+$/.test(a))?(a=a.toString(),a=a.replace(/[^0-9\.]/,""),a=Math.round(100*parseFloat(a)),a=b.currencySymbol+(a/100).toFixed(2).toString()):c},b.formatNumber=function(a,b){return a=parseFloat(a),a.toFixed(b)},a.undo=function(){state.designer.hm.back},a.redo=function(){state.designer.hm.next},b.url=function(a){return a},state.theme&&state.theme.url&&(b.url=state.theme.url),a.saveShareLabel=b.isAdmin||b.disableShareDesign||b.artToolsMode?b.artToolsMode?"Share":"Save":"Save & Share",eventManager.on("undoStackChanged",function(){a.canUndo=state.designer.hm.canUndo(),a.canRedo=state.designer.hm.canRedo(),a.$$phase||a.$apply()}),eventManager.on("zoomChanged",function(c){b.isZoomedIn=c.isZoomedIn,a.$$phase||a.$apply()}),eventManager.on("userLoggedIn",function(a){state.currentUserToken=a.UserToken,state.activeUserToken=a.UserToken,state.currentSessionToken=a.sessionToken,b.UserToken=a.UserToken,b.UserToken=a.UserToken,window.LoadLogonUserDS&&LoadLogonUserDS(ezdVars.AppURI,ezdVars.AppToken,"",!1,a.UserToken,a.userName,a.userRole),window.AccountSignIn&&window.AccountSignIn(a.userName,a.userRole)}),eventManager.on("gotSession",function(a){a.UserToken&&(b.UserToken=state.activeUserToken=ezdVars.UserToken=a.UserToken),b.UserToken=state.currentUserToken=ezdVars.UserToken=a.UserToken,state.currentSessionToken=ezdVars.SessionToken=a.sessionToken}),eventManager.on("elementsSelected",function(b){if(angular.isArray(b)&&1!=b.length)1<b.length&&(c.path("/editMultipleSelection/"),a.$$phase||a.$apply());else{b=angular.isArray(b)?b[0]:b;var d=b.data.type;c.path("/edit"+("text"==d?"Text":"vector"==d?"Svg":"embroideryText"==d?"TextEmbroidery":"embroideryArt"==d?"ArtEmbroidery":"Image")+"/"+b.data.id),a.$$phase||a.$apply()}}),eventManager.on("designChanged",function(){state.selectedDesign&&!state.selectedDesign.isEmpty(!0)&&ezdVars.AutoZoom&&setTimeout(function(){state.designer.zoomIn()},2e3)}),eventManager.on("productChanged",function(){delete state.quoteInformation,"0"==state.selectedProduct.enable_team_name_numbers&&delete state.namesNumbers,state.selectedDesign&&!state.selectedDesign.isEmpty(!0)&&ezdVars.AutoZoom&&state.dsUtils.addRenderedHandlerOneTime(function(){setTimeout(function(){state.designer.zoomIn()},2e3)}),b.requireDesign=0!=state.selectedProduct.require_design}),eventManager.on("selectedProductLoaded",function(){a.disableNamesNumbers=!ezdVars.EnableNameNumbers||ezdVars.EmbeddedPartner||"0"==state.selectedProduct.enable_team_name_numbers,a.$$phase||a.$apply()}),eventManager.on("elementsAdded",function(a){a&&a.length&&eventManager.trigger("layersChanged")}),eventManager.on("designChanged",function(){delete state.quoteInformation}),eventManager.on("designColorsChanged",function(){delete state.quoteInformation}),eventManager.on("elementDeleted",function(a){state.selectedDesign.isEmpty(!0)&&state.designer.zoomOut(),eventManager.trigger("designColorsChanged"),eventManager.trigger("layersChanged")}),$(document).keydown(function(b){var d=document.activeElement&&("INPUT"==document.activeElement.tagName||"TEXTAREA"==document.activeElement.tagName);if(90===b.which&&b.ctrlKey&&!d)state.designer.hm.back,console.debug("Undo");else if(89===b.which&&b.ctrlKey&&!d)state.designer.hm.next,console.debug("Redo");else{if((46==b.which||8==b.which)&&!d)return(b=state.designer.activeSide.boundingBox.getSelections())&&(state.designer.deleteElements(b),c.path("/layers"),state.designer.addSnapshotEvent("deleteElement",b),a.$$phase||a.$apply()),!1;if(null!=state.designer.activeSide.boundingBox.getSelections()&&!d){var e=state.designer.activeSide.boundingBox.getSelections();if(37==b.keyCode)return state.designer.nudgeElement(null,"left",1,e),!1;if(38==b.keyCode)return state.designer.nudgeElement(null,"up",1,e),!1;if(39==b.keyCode)return state.designer.nudgeElement(null,"right",1,e),!1;if(40==b.keyCode)return state.designer.nudgeElement(null,"down",1,e),!1;if(8==b.keyCode&&!d)return!1}}}),!e&&(ezdVars.WelcomeVideo||ezdVars.WelcomeScreen)){var g={};g.welcomeScreen=ezdVars.WelcomeScreen,ezdVars.WelcomeVideo&&(0<=ezdVars.WelcomeVideo.indexOf("http")?g.videoUrl=ezdVars.WelcomeVideo+"?autoplay=1":g.videoUrl="//www.youtube.com/embed/"+ezdVars.WelcomeVideo+"?autoplay=1"),showModal("video",a,d,g)}state.selectedDesign&&!state.selectedDesign.isEmpty(!0)&&ezdVars.AutoZoom&&setTimeout(function(){state.designer.zoomIn()},2e3),state.cart&&state.cart.orderID&&(state.cart.orderID?showModal("emailDesign",a,d):showModal("reviewOrder",a,d))},Namespace("ui.controllers"),ui.controllers.SaleGoalController=function(a){function b(a,b){service.getProductDetails(a.product_id,null,null,function(c){for(var d=0;d<c.product_styles.length;d++){var e=c.product_styles[d];e.selected=!1}a.product_styles=c.product_styles,a.product_selected_styles=[],b(a)})}function c(){g(),h(),a.$$phase||a.$apply()}function d(){for(var b=[],c=0;c<a.products.length;c++)if(a.products[c].unit_price)b.push(a.products[c].unit_price);else for(var d=a.products[c],e=0;e<d.product_selected_styles.length;e++){var f=d.product_selected_styles[e];b.push(f.unit_price)}return b=quickSort(b,0,b.length-1),parseFloat(b[b.length-1])}function e(a){if(a.unit_price)return a.unit_price;for(var b=[],c=0;c<a.product_selected_styles.length;c++){var d=a.product_selected_styles[c];b.push(d.unit_price)}return b=quickSort(b,0,b.length-1),parseFloat(b[b.length-1])}function f(b){for(var c=[],d=0;d<a.products.length;d++)a.products[d].price||(a.products[d].price=parseInt(1.5*b)),c.push(a.products[d].price);return c=quickSort(c,0,c.length-1),parseFloat(c[0])}function g(){var b=parseInt(a.saleGoal),c=m(b),e=d(),g=e+c,h=f(g),i=h-g,j=parseFloat(i.toFixed(2))*b;a.preTotalProfit=.1>j?0:j.toFixed(2)}function h(){for(var b=m(parseInt(a.saleGoal)),c=a.products,d=0;d<c.length;d++){var f=c[d],g=parseFloat(e(f))+b,h=f.price-g;f.profit=parseFloat(h.toFixed(2))}a.product=c}function i(b){var c=m(parseInt(a.saleGoal)),d=e(b)+c,f=parseInt(1.5*d),g=f-d;b.price=f,b.profit=parseFloat(g.toFixed(2))}function j(b){for(var c=a.products,d=0;d<c.length;d++){var e=c[d];if(e.product_id==b.product_id)return e}return!1}function k(){var a=[],b=[1,2,3,4,5,6,7,8,9,10],c=[10,20,30,40,50,100,150,200,300,400,500,600,700,800,900,1e3],d=[];d[10]=[],d[10][1]=15,d[10][10]=45;for(var e=0,f=b.length;f>e;e++){var g=b[e];g>1&&10>g&&(d[10][f-g+1]=d[10][f-g+2]-(d[10][10]-d[10][1])/f)}d[20]=[],d[20][1]=13.5,d[20][2]=19.5,d[20][3]=22,d[20][4]=25,d[20][5]=27.5,d[20][6]=30,d[20][7]=32,d[20][8]=34,d[20][9]=38,d[20][10]=41.5,d[500]=[],d[500][1]=7.5,d[500][2]=11,d[500][3]=12,d[500][4]=14,d[500][5]=15,d[500][6]=16.4,d[500][7]=17,d[500][8]=18,d[500][9]=20,d[500][10]=23;var h=[];h[1]=5,h[2]=6.4,h[3]=7.1,h[4]=7.8,h[5]=8.5,h[6]=9.2,h[7]=9.9,h[8]=10.6,h[9]=11.3,h[10]=12;for(var i=10,e=0;e<c.length;e++){for(var j=c[e],k=0;k<b.length;k++){var g=b[k],l="";d[j]&&d[j][g]?l=d[j][g]:30==j?l=a[i][g]-(d[i][g]-h[g])/c.length:j>30&&(l=a[i][g]-(d[10][g]-h[g])/c.length),void 0==a[j]&&(a[j]=[]),a[j][g]=l}i=j}return a}function l(a,b){if(0==a)return 0;var c=null,d=k(),e=10,f=[];for(var g in d){var h=d[g];if(b==g){c=void 0!=h[a]?h[a]:null;break}if(g>b){f=d[e],c=Math.formatFloat(f[a]+(h[a]-f[a])*(b-e)/(g-e),2);break}e=g}return null==c?0:c}function m(a){return l(getDesignColors(),a)}a.saleGoal=50,a.preTotalProfit=0,a.products=[],a.activityName="",a.description="",a.deadline="7",a.deliveryType=!1,a.freePostage=!1,a.addressId="",a.addressInfo="",eventManager.on("saleGoal-selectedProduct",function(b){a.selectedProduct=b}),a.addProduct=function(){if(j(a.selectedProduct))console.info("重复添加");else{i(a.selectedProduct);var c={color:a.selectedProduct.color,html_color:a.selectedProduct.html_color,product_style_id:a.selectedProduct.product_style_id};b(a.selectedProduct,function(b){b.product_selected_styles.push(c);for(var d=0;d<b.product_styles.length;d++){var e=b.product_styles[d];c.product_style_id==e.product_style_id&&(e.selected=!0)}a.products.push(b),a.$$phase||a.$apply()})}},a.productPriceInputCheck=function(a){var b=event.target.value;null!=b.match(/\d{1,}\.{0,1}\d{0,2}/g)?(b=b.match(/\d{1,}\.{0,1}\d{0,2}/g)[0],event.target.value=b,a.price=b,c()):(b="",event.target.value=b)},a.saleGoalInputChange=function(){var a=event.target.value;a=null!=a.match(/[0-9]/g)?a.match(/[0-9]/g).join(""):"",a>1e3&&(a=1e3),event.target.value=a,$("#point_slider").honest_slider("value",a)},a.saleGoalInputBlur=function(){var a=event.target.value;a=null!=a.match(/[0-9]/g)?a.match(/[0-9]/g).join(""):10,10>a&&(a=10),a>1e3&&(a=1e3),event.target.value=a,$("#point_slider").honest_slider("value",a)},a.toggleColor=function(b,c,d){b.stopPropagation();for(var e,f=!1,g=0;g<c.product_selected_styles.length;g++){var h=c.product_selected_styles[g];if(h.product_style_id==d.product_style_id){f=!0,e=g;break}}if(f){if(1==c.product_selected_styles.length)return;d.selected=!1,c.product_selected_styles.splice(e,1)}else d.selected=!0,c.product_selected_styles.push(d);$(b.target).parent().toggleClass("active"),a.$$phase||a.$apply()},a.isErrorProTotalProfit=function(){return 0==a.preTotalProfit?!0:!1},a.isErrorProfitOfProduct=function(){for(var b,c=0;c<a.products.length;c++){var d=a.products[c];if(0==d.price.length){b=c;break}}return void 0==b?!1:!0},eventManager.on("validateActivity",function(b){for(var c=0;c<a.products.length;c++){var d=a.products[c];if(0==d.price.length)return void $("#product_price_input_"+d.product_id).focus()}return a.preTotalProfit<=0?(a.proTotalProfitError=!0,void a.$apply()):void b()}),eventManager.on("saveActivity",function(b){for(var c=[],d=0;d<a.products.length;d++){var e=a.products[d],f={};f.id=e.product_id,f.price=e.price,f.styles=[];for(var g=e.product_selected_styles,h=0;h<g.length;h++)f.styles.push({id:g[h].product_style_id});c.push(f)}var i={dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,type:0,activityId:ezdVars.ActivityID,designId:state.selectedDesignID,target:parseInt(a.saleGoal),products:c};$.ajax({url:"//"+ezdVars.ApiDomain+"/activity/save/",type:"post",dataType:"json",data:i,success:function(a){b()},failure:function(){console.log("failure")}})}),a.deleteProduct=function(b){for(var d,e=0;e<a.products.length;e++){var f=a.products[e];if(f.product_id==b.product_id){d=e;break}}void 0!=d&&(a.products.splice(d,1),c())},eventManager.on("doneActivity",function(b){var c={dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,designId:ezdVars.DesignID,activityId:ezdVars.ActivityID,name:a.activityName,description:a.description,deadline:a.deadline,deliveryType:a.deliveryType?"unity":"custom",freePostage:a.freePostage,addressId:$("[name=selectedAddressGroup]","#addressTable").val(),addressInfo:a.addressInfo};return null==c.name||0==c.name.trim().length?($("[ng-model=activityName]").parents(".form-group").addClass("has-error"),void $("[ng-model=activityName]").focus()):($("[ng-model=activityName]").parents(".form-group").removeClass("has-error"),null==c.description||0==c.description.trim().length?($("[ng-model=description]").parents(".form-group").addClass("has-error"),void $("[ng-model=description]").focus()):($("[ng-model=description]").parents(".form-group").removeClass("has-error"),void $.ajax({url:"//"+ezdVars.ApiDomain+"/activity/saveActivityInfo/",type:"post",dataType:"json",data:c,success:function(a){b()},failure:function(){console.log("failure")}})))}),eventManager.on("updateStep2View",function(b){service.ajaxCallStarted("activityInfo","获取活动数据"),$("#activityDirect").attr("href","/activity/"+ezdVars.ActivityID),a.products=[],$.ajax({url:"//"+ezdVars.ApiDomain+"/activity/activityInfo/",type:"post",dataType:"json",data:{dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,activityId:ezdVars.ActivityID},success:function(d){a.saleGoal=d.target,a.activityName=d.name,a.description=d.description||"",a.deadline=0==d.deadline?"7":d.deadline,a.deliveryType="custom"==d.deliveryType?!1:!0,a.freePostage="1"==d.freePostage?!0:!1,a.addressId=d.addressId,a.addressInfo=d.notes;for(var f=[],g=0;g<d.products.length;g++){for(var h,i=d.products[g],j=[],k=0;k<i.product_selected_styles.length;k++){var l=i.product_selected_styles[k];0==k&&(h=l.image),j.push({product_style_id:l.id,color:l.color,unit_price:l.unit_price,html_color:l.html_color})}for(var m=[],k=0;k<i.product_styles.length;k++){for(var l=i.product_styles[k],n=0;n<i.product_selected_styles.length;n++){var o=i.product_selected_styles[n];if(l.id==o.id){l.selected=!0;break}}m.push({product_style_id:l.id,color:l.color,html_color:l.html_color,unit_price:l.unit_price,selected:l.selected?!0:!1})}f.push({product_id:i.id,thumburl_front:h,name:i.name,product_selected_styles:j,product_styles:m,price:i.price,manufacturer:i.manufacturer_name,unit_price:e(i)})}a.products=f,c(),b&&b(),service.ajaxCallEnded("activityInfo")}})}),a.changeDeliveryType=function(){a.deliveryType=!a.deliveryType},setTimeout(function(){$("#point_slider").honest_slider({scope:a,scales:[[0,10],[.05,50],[.1,100],[.3,300],[.5,500],[.7,700],[1,1e3]],slider:function(b,d){d&&(a.saleGoal=parseInt(b)),c()}})},1)},Namespace("ui.controllers"),ui.controllers.Step1Controller=function(a,b,c,d,e){eventManager.trigger("goStep",1),d.path("/addText")},Namespace("ui.controllers"),ui.controllers.Step2Controller=function(a,b,c,d,e){eventManager.trigger("goStep",2)},Namespace("ui.controllers"),ui.controllers.Step3Controller=function(a,b,c,d,e){eventManager.trigger("goStep",3)},Namespace("ui.controllers"),ui.controllers.AddressController=function(a,b,c,d,e){a.onShow=function(b,c){if(c.addressId){var d={dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,addressId:c.addressId};$.ajax({url:"//"+ezdVars.ApiDomain+"/Address/get/",type:"post",
data:d,success:function(a){a&&console.log(a)}})}else a.address={name:"",tel:"",province:a.province,city:a.city,area:a.area,address:""},a.$apply()},a.saveAndUse=function(){var b={dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,name:a.address.name,tel:a.address.tel,province:a.province,city:a.city,area:a.area,addr:a.address.address},c=$('[ng-model="address.name"]');if(!c.val())return c.focus().parents(".form-group").addClass("has-error").find("label.control-label").text("姓名不能为空"),!1;c.parents(".form-group").removeClass("has-error").find("label.control-label").text("姓名");var d=$('[ng-model="address.tel"]');if(!d.val())return d.focus().parents(".form-group").addClass("has-error").find("label.control-label").text("手机不能为空"),!1;d.parents(".form-group").removeClass("has-error").find("label.control-label").text("手机号码");var e=/^((1[0-9]{1})+\d{9})$/;if(!e.test(d.val()))return d.focus().parents(".form-group").addClass("has-error").find("label.control-label").text("手机号码格式错误"),!1;d.parents(".form-group").removeClass("has-error").find("label.control-label").text("手机号码");var f=$('[ng-model="address.address"]');if(!f.val())return f.focus().parents(".form-group").addClass("has-error").find("label.control-label").text("详细地址不能为空"),!1;f.parents(".form-group").removeClass("has-error").find("label.control-label").text("详细地址");var g=$(event.target);g.text("保存中..."),$.ajax({url:"//"+ezdVars.ApiDomain+"/Address/save/",type:"post",data:b,success:function(b){b&&(g.text("保存并使用该地址"),eventManager.trigger("loadAddressList",b.id),a.close())}})},a.save=function(){var b={dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,id:a.address.id,name:a.address.name,tel:a.address.tel,province:a.province,city:a.city,area:a.area,addr:a.address.address};$.ajax({url:"//"+ezdVars.ApiDomain+"/Address/save/",type:"post",data:b,success:function(a){}})}},Namespace("ui.controllers"),ui.controllers.AddressListController=function(a,b,c,d,e){function f(b){a.addressList=[];var c;$.ajax({url:"//"+ezdVars.ApiDomain+"/Address/getList/",type:"post",data:{dataType:"json",appKey:ezdVars.AppToken,userToken:ezdVars.UserToken,"default":!0},success:function(d){if(d){for(var e=0;e<d.length;e++){var f=d[e].UserAddress;0==e&&(c=f.id),a.addressList.push({id:f.id,receiver:f.name,address:f.province+f.city+f.county+f.address,tel:f.mobile})}a.$apply(),b&&b(c)}}})}function g(a){$("#addressTable").find("tr").removeClass("active"),$("input[value="+a+"]").prop("checked",!0).parents("tr").addClass("active")}eventManager.on("addressSelectedRow",function(b){g(b),a.$apply()}),eventManager.on("loadAddressList",function(a){a?f(function(){g(a),$("#addressListTable").scrollTop(0)}):f()}),a.selectAddress=function(){if("A"==event.target.tagName)return!1;var a=$(event.target).parents("tr").find("input[type=radio]");a[0]!=event.target?0==a.prop("checked")&&(a.prop("checked",!0),g(a.attr("value"))):g(a.attr("value"))},f(function(a){a&&g(a)})},ui.controllers.DesignColorsController=function(a,b,c){function d(){var a=[],b=[1,2,3,4,5,6,7,8,9,10],c=[10,20,30,40,50,100,150,200,300,400,500,600,700,800,900,1e3],d=[];d[10]=[],d[10][1]=15,d[10][10]=45;for(var e=0,f=b.length;f>e;e++){var g=b[e];g>1&&10>g&&(d[10][f-g+1]=d[10][f-g+2]-(d[10][10]-d[10][1])/f)}d[20]=[],d[20][1]=13.5,d[20][2]=19.5,d[20][3]=22,d[20][4]=25,d[20][5]=27.5,d[20][6]=30,d[20][7]=32,d[20][8]=34,d[20][9]=38,d[20][10]=41.5,d[500]=[],d[500][1]=7.5,d[500][2]=11,d[500][3]=12,d[500][4]=14,d[500][5]=15,d[500][6]=16.4,d[500][7]=17,d[500][8]=18,d[500][9]=20,d[500][10]=23;var h=[];h[1]=5,h[2]=6.4,h[3]=7.1,h[4]=7.8,h[5]=8.5,h[6]=9.2,h[7]=9.9,h[8]=10.6,h[9]=11.3,h[10]=12;for(var i=10,e=0;e<c.length;e++){for(var j=c[e],k=0;k<b.length;k++){var g=b[k],l="";d[j]&&d[j][g]?l=d[j][g]:30==j?l=parseFloat((a[i][g]-(d[i][g]-h[g])/c.length).toFixed(2)):j>30&&(l=parseFloat((a[i][g]-(d[10][g]-h[g])/c.length).toFixed(2))),void 0==a[j]&&(a[j]=[]),a[j][g]=l}i=j}return a}function e(a,b){var c=null,e=d(),f=10,g=[];for(var h in e){var i=e[h];if(b==h){c=void 0!=i[a]?i[a]:null;break}if(h>b){g=e[f],c=g[a]+(i[a]-g[a])*(b-f)/(h-f);break}f=h}return null==c?0:parseFloat(c.toFixed(2))}function f(){var b=e(getDesignColors(),50)+parseFloat(state.selectedProductStyle.unit_price);0==getDesignColors()?a.price_preview=(b+10).toFixed(2):a.price_preview=b.toFixed(2)}a.canPrint=!0,a.price_preview=(parseFloat(state.selectedProductStyle.unit_price)+10).toFixed(2),a.maxScreenPrintColors=ezdVars.MaxScreenPrintColors;var g=function(){f(),a.$$phase||a.$apply(),a.canPrint=state.dsUtils.canPrintDesign()};eventManager.on("designCanvasChanged",g),eventManager.on("designChanged",g),eventManager.on("designColorsChanged",g),eventManager.on("undoRedo",g),state.dsUtils.addRenderedHandlerOneTime(g),g()},ui.controllers.ProductColorsController=function(a,b,c){b=function(){service.getProductColors(state.selectedProductID,function(b){a.styles=b,a.$$phase||a.$apply()}),state.selectedProductStyle&&(a.colorDescription=state.selectedProductStyle.color,a.colorDescriptionDrawer=state.selectedProductStyle.color,a.shortDescription=state.selectedProduct.name,a.selectedColor=state.selectedProductStyle.color,a.selectedColorDrawer=state.selectedProductStyle.color,a.hoverStyle=state.selectedProductStyle),a.selectStyle=function(b){var c=parseInt(b.product_style_id,10);state.selectedProductStyle=a.selectedProductStyle=b,state.selectedProductStyleID=b.product_style_id,a.colorDescription=b.color,a.colorDescriptionDrawer=b.color,a.selectedColor=b.color,a.hoverStyle=state.selectedProductStyle,c>0?state.designer.parseProduct(state.selectedProductID,state.selectedProductStyleID):(state.designer.product.information.html_color=b.html_color,$("#raphael").css("background-color",getColorString(b.html_color)))}},a.mouseOverStyle=function(b){a.hoverStyle=b},a.mouseOutStyle=function(b){a.hoverStyle=state.selectedProductStyle},b(),eventManager.on("productChanged",b),eventManager.on("selectedProductLoaded",b)},ui.controllers.AddTextController=function(a,b,c,d,e){$(".design-tool .nav-tabs li").removeClass("active"),$(".design-tool .nav-tabs li:eq(0)").addClass("active"),a.addTextFromUI=function(){var b=a.text.text;if(!b)return $("#isd-text-textarea").focus(),!1;var c=new ui.FontManager(!1),e=state.dsUtils.getColorsInUse();c.getFontDefaults(function(c){var f=function(){var f=c.font;state.dsUtils.addRenderedHandlerOneTime(function(){searchInArray(e,b.color)||eventManager.trigger("designColorsChanged"),eventManager.trigger("layersChanged"),d.path("/editText/"+b.id),a.$$phase||a.$apply($("#isd-text-textarea").focus())});var g=findMatch(state.storeInkColors,function(a){return"#000000"==a.html_color});g||(g=state.storeInkColors[0]),b=state.designer.addNewText(f,{fill_color:g.html_color,stroke_color:g.html_color},b).object};"Microsoft"!=c.font.fontFamily?service.loadFont(c.font,f,b):f()}),a.$$phase||a.$apply()},a.isAddText=function(){return a.text?0==a.text.text.trim().length?!0:!1:!0}},ui.controllers.BrowseProductsController=function(a,b,c,d){a.hideProductPricing=ezdVars.HideProductPricing;var e=$("#designerContainer svg");a.showMore=!1,a.previewProductStyle=function(){$(document).on("mouseover",".isd-product-colors li.colortip__color",function(a){e.css("background-color",$(this).css("background-color")),a.stopPropagation()}).on("mouseout",".isd-product-colors li.colortip__color",function(a){e.css("background-color","#"+state.selectedProductStyle.html_color),a.stopPropagation()})},a.showmore=function(){$(".isd-product-colors").toggleClass("isd-product-colors-auto-width"),$(".isd-product-colors").find("li.colortip__color:gt(3)").toggle(),a.$$phase||a.$apply()},eventManager.on("browseProducts-productSelected",function(b){a.selectProduct(b)}),a.selectProduct=function(b,c){return b.product_id==state.selectedProductID&&c?(c&&c.product_style_id!=state.selectedProductStyleID&&(a.selectProductStyle(c||b.defaultStyle),a.loadProduct()),eventManager.trigger("updatePricePreview"),a.$$phase||a.$apply()):service.getProductDetails(b.product_id,null,null,function(b){b.name=d.trustAsHtml(b.name),b.long_description=d.trustAsHtml(b.long_description),a.product=b,a.selectProductStyle(c||b.defaultStyle),a.loadProduct(),eventManager.trigger("updatePricePreview"),a.$$phase||a.$apply()}),$(".isd-product-colors").addClass("isd-product-colors-auto-width").find("ul li:not(.more)").each(function(a,b){a>3&&$(b).hide()}),!1},a.selectProductStyle=function(b){a.productStyle=a.hoverStyle=b,a.selectProductRegion(b.defaultRegion),a.colorDescriptionDrawer=a.productStyle},a.mouseOverStyle=function(b){a.hoverStyle=b},a.mouseOutStyle=function(b){a.hoverStyle=a.productStyle},a.selectProductRegion=function(b){a.productRegion=b},a.loadProduct=function(){state.selectedProduct=a.product,state.selectedProductID=a.product.product_id,state.selectedProductStyle=a.productStyle,state.selectedProductStyle.selectedRegion=state.selectedProductStyle.defaultRegion,state.selectedProductStyleID=a.productStyle.product_style_id,eventManager.trigger("productChanged",null),eventManager.trigger("designCanvasChanged",null),state.designer.parseProduct(a.product.product_id,a.productStyle.product_style_id)}},ui.controllers.EditTextController=function(a,b,c,d,e){var f=null,g=null;$(".design-tool .nav-tabs li").removeClass("active"),$(".design-tool .nav-tabs li:eq(0)").addClass("active"),a.ThemeName=ezdVars.ThemeName,a.shapes=[{name:"none",id:0,image:"/images/shape-none.png"},{name:"curve",id:7,image:"/images/shape-curve.png"},{name:"arch",id:3,image:"/images/shape-arch.png"},{name:"archway",id:2,image:"/images/shape-archway.png"},{name:"bulge",id:4,image:"/images/shape-bulge.png"},{name:"bird's eye",id:5,image:"/images/shape-birds-eye.png"},{name:"pinch",id:1,image:"/images/shape-pinch.png"},{name:"slope",id:6,image:"/images/shape-slope.png"}];var h=function(){if(g=new ui.FontManager(!1),c.id||a.navigation&&a.navigation.currentItem){if(c.id){if(f=searchInArray(state.selectedDesign.canvas_text,c.id,"id"),!f)return void d.path("/addText")}else f=a.navigation.currentItem;a.action="Edit",a.$parent.selectedElement=f,a.elementOriginalRotation=f.rotation,eventManager.trigger("elementSelected",f.id)}if(f){a.text=f,delete f.previewHtml,a.isMultiLine=f&&f.text&&1<f.text.split("\n").length,"undefined"==typeof f.lineHeight&&(f.lineHeight=0),"undefined"==typeof f.alignment&&(f.alignment=0),f.selectedShape=.01<Math.abs(f.arching)?a.shapes[1]:findMatch(a.shapes,function(a){return a.id==f.wrap}),a.oldTextValue=f.text;var b=a.fontCategories=g.getCategories();f.fontId&&f.fontStyleId?searchInArray(b,f.fontStyleId,"font_style_id")&&g.getFontsByCategory(f.fontStyleId,function(b){a.fonts=b,(b=searchInArray(b,f.fontId,"font_id"))&&(f.fontObject=b),a.$$phase||a.$apply()}):console.log("错误:  无法找到对应的字体或字体样式."),a.$$phase||a.$apply()}};a.$on("sidePanelNavigation",function(){"editText"==a.navigation.sidePanel&&h()}),(c.id||"/addText"==d.$$path)&&h(),a.fontCategorySelected=function(){g.getFontsByCategory(a.text.fontStyleId,function(b){a.fonts=b;var c=searchInArray(a.fontCategories,a.text.fontStyleId,"font_style_ID");for(c.fonts=b,b=0;b<a.fonts.length;b++)a.fonts[b].fontStyle=c;a.$$phase||a.$apply()})},a.toggleFontList=function(){$(".ds-fonts .dropdown-menu").find("select").off("click").on("click",function(a){a.stopPropagation()})},a.isEditText=function(){return a.text&&0==a.text.text.trim().length?!0:!1},a.updateText=function(){a.updateTextFont(function(){a.updateTextValue()})},a.updateTextFont=function(b){var c=searchInArray(a.fonts,f.fontId,"font_id");f.fontObject=c,state.designer.updateTextFont(f.id,c,c.font_style_id||c.old_font_style_id,b),state.designer.activeSide.boundingBox.checkElementSize(f)},a.updateTextValue=function(){a.isMultiLine=f.text&&1<f.text.split("\n").length;var b=1<(a.oldTextValue+"").split("\n").length;state.designer.updateTextValue(f.id,f.text),a.oldTextValue=f.text,b&&!a.isMultiLine&&a.changeTextShape(f.selectedShape),state.designer.activeSide.boundingBox.checkElementSize(f)},a.timerChange=function(){eventManager.trigger("textChanged"),state.designer.chanPropertyEvent()},a.increaseStrokeWidth=function(){var a=1e-8>=Math.abs(f.stroke);f.stroke=Math.round(100*Math.min(20,f.stroke+.2))/100,state.designer.updateTextStrokeWidth(f.id,f.stroke),f.stroke_old=f.stroke,a&&eventManager.trigger("designColorsChanged")},a.decreaseStrokeWidth=function(){var a=.20000001>=f.stroke;f.stroke=Math.round(100*Math.max(0,f.stroke-.2))/100,state.designer.updateTextStrokeWidth(f.id,f.stroke),f.stroke_old=f.stroke,a&&eventManager.trigger("designColorsChanged")},a.strokeWidthChanged=function(){if(null!=f){var a=1e-7>=Math.abs(f.stroke_old)||1e-7>=Math.abs(f.stroke);f.stroke=Math.round(10*f.stroke)/10,state.designer.updateTextStrokeWidth(f.id,f.stroke),f.stroke_old=f.stroke,a&&eventManager.trigger("designColorsChanged")}},a.increaseShadowWidth=function(){var a=0==f.shadow_value;f.shadow_value=Math.min(20,f.shadow_value+.2),state.designer.updateShadowValue(f.id,f.shadow_value),a&&eventManager.trigger("designColorsChanged")},a.decreaseShadowWidth=function(){var a=1==f.shadow_value;f.shadow_value=Math.max(0,f.shadow_value-.2),state.designer.updateShadowValue(f.id,f.shadow_value),a&&eventManager.trigger("designColorsChanged")},a.increaseTextSpacing=function(){state.designer.startEvent("changeTextSpacing",[]),f.letterSpacing=Math.round(100*(f.letterSpacing+.05))/100,state.designer.activeSide.boundingBox.checkElementSize(f),state.designer.endEvent("changeTextSpacing",[])},a.decreaseTextSpacing=function(){state.designer.startEvent("changeTextSpacing",[]),f.letterSpacing=Math.round(100*(f.letterSpacing-.05))/100,state.designer.endEvent("changeTextSpacing",[])},a.increaseTextHeight=function(){var a=Math.min(20,f.lineHeight+1);a!=f.lineHeight&&(f.lineHeight=a)},a.decreaseTextHeight=function(){var a=Math.max(0,f.lineHeight-1);a!=f.lineHeight&&(f.lineHeight=a)},a.lineHeightChanged=function(){state.designer.setTextHeight(f.id,f.lineHeight)},a.nudge=function(a){ezd.nudgeElement(f.id,a,1)},a.increaseShapeSize=function(){f.selectedShape&&"curve"==f.selectedShape.name?f.arching=Math.round(Math.min(360,f.arching+5)):f.selectedShape&&"none"!=f.selectedShape.name&&(f.wrapAmmount=Math.min(10,f.wrapAmmount+1))},a.decreaseShapeSize=function(){f.selectedShape&&"curve"==f.selectedShape.name?f.arching=Math.round(Math.min(360,f.arching-5)):f.selectedShape&&"none"!=f.selectedShape.name&&(f.wrapAmmount=Math.min(10,f.wrapAmmount-1))},a.changeTextShape=function(b){b||(b=f.selectedShape||a.shapes[0]),f.selectedShape=b,f.wrap="curve"!=b.name?b.id:0,"curve"==b.name?0==f.arching&&(f.arching=45):f.wrapAmmount||(f.wrapAmmount=5)},a.changeAlignment=function(a){state.designer.changeElementAlignment(f.id,a)},a.changeTextAlignment=function(a){f.alignment=a},a.showStrokeColorModal=function(c){showColorModal(a,b,e,{currentColor:f.strokeColor,onSelect:function(b){f.strokeColor=b,0==f.stroke&&a.increaseStrokeWidth(),state.designer.updateTextStrokeColor(f.id,b),eventManager.trigger("updatePricePreview",!0)},allowTransparent:!1},c)},a.showShadowColorModal=function(c){showColorModal(a,b,e,{currentColor:f.shadow_color,onSelect:function(b){f.shadow_color=b,0==f.shadow_value&&a.increaseShadowWidth(),state.designer.updateShadowColor(f.id,b),eventManager.trigger("updatePricePreview",!0)},allowTransparent:!1},c)},a.showFillColorModal=function(c){showColorModal(a,b,e,{currentColor:f.color,onSelect:function(a){f.color=a,state.designer.updateTextColor(f.id,a),eventManager.trigger("updatePricePreview",!0)},allowTransparent:!0},c)};var i=[];i.push(eventManager.on("undoRedo",function(b){a&&!a.$$destroyed&&!a.$$phase&&b.change&&b.change.length&&findMatch(b.change,function(a){return a.id==canvasText.id})&&(a.$$phase||a.$apply())})),i.push(eventManager.on("productChanged",function(){state.dsUtils.addRenderedHandlerOneTime(function(){h()})})),i.push(eventManager.on("elementDeleted",function(b){!c.id||0>d.path().indexOf("editText")||(b=searchInArray(state.selectedDesign.canvas_text,c.id,"id"),!a||b||a.$$destroyed||(d.path("/addText"),a.$$phase||a.$apply()))})),a.$on("$destroy",function(){if(i)for(var a=0;a<i.length;a++)i[a]()})},ui.controllers.ProductCategoriesController=function(a,b,c,d){a.selectedProductID=state.selectedProductID||0,a.products=[],a.categories=[],a.selectCategoryByID=function(){var b=findMatch(a.categoriesFlat,function(b){return b.id==a.selectedCategoryID});b&&a.selectCategory(b.category)},a.selectCategory=function(b){a.selectedCategoryID=b.product_category_id,a.product=null,a.selectedCategory=b,a.categories=b.children?b.children:[],service.getProductsByCategory(b.product_category_id,null,!1,function(b){a.products=b;for(var c=0;c<b.length;c++)b[c].name=d.trustAsHtml(b[c].name),b[c].unit_price=parseFloat(b[c].unit_price);a.categories=[],a.products.product=b[0],a.$apply()})},a.selectProductChange=function(){eventManager.trigger("saleGoal-selectedProduct",a.products.product)},a.selectProduct=function(a,b){var c=b?$(b.currentTarget):$(".design-product li.list-group-item:eq(0)"),d=50;if(c.length){if(c.hasClass("active"))return!1;c.siblings().removeClass("active"),c.addClass("active"),d=c.position().top}$(".isd-product-colors").animate({top:d},300),eventManager.trigger("browseProducts-productSelected",a)},service.getProductCategories(function(b){a.topCategories=a.categories=b;var c=[],e=function(a,b){for(var f=0;f<a.length;f++){for(var g=a[f],h=g.name,i=0;b>i;i++)h="    "+h;h=d.trustAsHtml(h),c.push({name:h,id:g.product_category_id,isParent:g.children&&g.children.length,category:g}),g.children&&g.children.length&&e(g.children,b+1)}};e(b,0),a.categoriesFlat=c,a.selectedCategoryID=a.selectedCategory?a.selectedCategory.product_category_id:a.topCategories[0].product_category_id,a.selectCategoryByID(),a.$apply()}),a.openDetailPage=function(a){window.open("/design/productInfo/"+a)}},ui.controllers.ProductRegionController=function(a,b,c){a.showingInlineModal=!0,a.loadPreview=function(b,c){setTimeout(function(){if(null!=document.getElementById("canvasPreview"+b)){state.designer.sides[c].boundingBox.selectElement(null);var d=state.designer.regions[b],e=("undefined"==typeof state.designer.sides[c].defaultRegion[2]?state.designer.sides[c].defaultRegion.region:state.designer.sides[c].defaultRegion)[2]/d.region[2],f=-d.region[0]*e,g=-d.region[1]*e,h=c+1,i=$("#side"+h).children().clone(!0,!0);$("#canvasPreview"+b).empty();for(var j="previewSvg"+b,k=i[0].childNodes.length-1;k>=0;k--)"g"==i[0].childNodes[k].tagName&&"bbGroup"==i[0].childNodes[k].id||"rect"==i[0].childNodes[k].tagName||"desc"==i[0].childNodes[k].tagName||"text"==i[0].childNodes[k].tagName||"defs"==i[0].childNodes[k].tagName?i[0].childNodes[k].parentNode.removeChild(i[0].childNodes[k]):(i[0].childNodes[k].id=="designGroup"+h&&(i[0].childNodes[k].id="designGroupPreview"+b,-1<navigator.userAgent.toLowerCase().indexOf("firefox")||i[0].childNodes[k].setAttribute("style","clip-path:url('#designMaskPreview"+b+"')"),"none"!=$("#designGroup"+h).css("mask")&&void 0!=$("#designGroup"+h).css("mask")&&(1<$("#designGroup"+h).css("mask").split("distress").length?i[0].childNodes[k].setAttribute("mask","url('#distressMaskPreview"+b+"')"):i[0].childNodes[k].setAttribute("mask","url('#designMaskPreview"+b+"')"))),i[0].childNodes[k].id=="designMask"+h&&(i[0].childNodes[k].id="designMaskPreview"+b,i[0].childNodes[k].firstChild&&1>=$("#designMask"+h)[0].firstChild.id.split("Rect").length&&(i[0].childNodes[k].firstChild.id="coverMaskImagePreview"+b,i[0].childNodes[k].firstChild.setAttribute("filter","url('#coverFilterPreview"+b+"')"))),i[0].childNodes[k].id=="distressMask"+h&&(i[0].childNodes[k].id="distressMaskPreview"+b,i[0].childNodes[k].firstChild&&"image"==$("#designMask"+h)[0].firstChild.tagName&&i[0].childNodes[k].firstChild.setAttribute("mask","url('#designMaskPreview"+b+"')")),i[0].childNodes[k].id=="coverFilter"+h&&(i[0].childNodes[k].id="coverFilterPreview"+b));h=[f,g,state.designer.originalCanvasSize*e,state.designer.originalCanvasSize*e],k=document.createElementNS("http://www.w3.org/2000/svg","rect"),k.setAttribute("id","rectangle"+b),k.setAttributeNS(null,"x",d.region[0]*e+f+1),k.setAttributeNS(null,"y",d.region[1]*e+g+1),k.setAttributeNS(null,"height",d.region[3]*e-2),k.setAttributeNS(null,"width",d.region[2]*e-2),k.setAttributeNS(null,"stroke-width",4*e+"px"),k.setAttributeNS(null,"stroke","#fe199d"),k.setAttributeNS(null,"fill","transparent"),i[0].appendChild(k),i[0].setAttributeNS(null,"viewBox",h.join(" ")),i[0].setAttributeNS(null,"width","80"),i[0].setAttributeNS(null,"height","80"),i[0].setAttributeNS(null,"id",j),i[0].setAttributeNS(null,"preserveAspectRatio","xMinYMin"),i[0].setAttribute("viewBox",h.join(" ")),i[0].setAttribute("width","80"),i[0].setAttribute("height","80"),i[0].setAttribute("id",j),i[0].setAttribute("preserveAspectRatio","xMinYMin"),$("#canvasPreview"+b).append(i),a.$$phase||a.$apply()}},1e3)},a.changePrintRegion=function(a,b){state.designer.activeSide.boundingBox.visibleRegion=!0,b||state.designer.selectRegion(a),console.log("选择了新的设计区域",state.designer.zoom),eventManager.trigger("designCanvasChanged"),eventManager.trigger("toAddTextPath")},a.productStyle=state.selectedProductStyle;var d=function(){clearInterval(a._interval),a._interval=setInterval(function(){console.log("call k() ---- 2"),e()},1e3)},e=function(){clearInterval(a._interval),console.log("更行了图形位置"),a.productSides=[],state.designer.previews||(state.designer.previews=[]),a.numRegions=0,a.current_view=state.selectedDesign.canvas.activeRegion.name.toLowerCase(),a.current_side=state.selectedDesign.canvas.name.toLowerCase(),a.current_sideID=state.selectedDesign.canvas.activeRegion.sideIndex-1;var b=0,c="";if(state.selectedProductStyle){a.html_color=getColorString(state.selectedProductStyle.html_color);for(var d=0;d<state.selectedProductStyle.product_regions.length;d++){a.numRegions++;var e=state.selectedProductStyle.product_regions[d];e.side=e.side.toLowerCase(),e.name=e.name.toLowerCase(),e.regionIndex=d,e.canvasId="canvasPreview"+d,state.designer.previews[d]||state.designer.previews.push({});var f=findMatch(a.productSides,function(a){return a.name==e.side});f||(f={name:e.side,ui_name:e.side_name,regions:[]},3==e.side_order&&state.selectedProduct.third_side_name&&(f.ui_name=state.selectedProduct.third_side_name),4==e.side_order&&state.selectedProduct.fourth_side_name&&(f.ui_name=state.selectedProduct.fourth_side_name),a.productSides.push(f)),c!=f.name&&b++,c=f.name,e.description=String(f.ui_name).charAt(0).toLocaleUpperCase()+String(f.ui_name).substr(1)+"-"+String(e.name).charAt(0).toLocaleUpperCase()+String(e.name).substr(1),e.sideIndex=b-1,f.regions.push(e),f.showName=f.ui_name,f.tabName=f.showName+"("+f.regions.length+")";for(var g=0;g<state.designer.sides.length;g++)state.designer.sides[g].activeRegion.side==c&&e.name==state.designer.sides[g].activeRegion.name.toLocaleLowerCase()&&(f.activeRegion=e)}}a.$$phase||a.$apply()};e(),a.showArtLocations=function(){a.showingInlineModal=!0},a.selectFirstPrintRegionWithDesign=function(){for(var b=0;b<state.selectedProductStyle.product_regions.length;b++){var c=state.selectedProductStyle.product_regions[b];if(c.hasLayers){console.log("call changePrintRegion 1"),a.changePrintRegion(c.regionIndex);break}}},state.selectedProductStyle&&"undefined"==typeof state.selectedDesign.currentCanvasIndex&&a.selectFirstPrintRegionWithDesign();var f=[];f.push(eventManager.on("elementsAdded",function(){console.debug("event","elementsAdded"),e()})),f.push(eventManager.on("designCanvasChanged",function(){console.debug("event","designCanvasChanged"),e()})),f.push(eventManager.on("designLiveEdition",function(){console.debug("event","designLiveEdition"),d()})),f.push(eventManager.on("productRegionsChanged",function(){console.debug("event","productRegionsChanged");for(var b=0;b<state.selectedProductStyle.product_regions.length;b++){var c=state.selectedProductStyle.product_regions[b],d=searchInArray(state.designer.regions,c.product_region_id,"product_region_id");d&&(c.region=d.region,a.loadPreview(c.regionIndex,c.sideIndex))}e()})),f.push(eventManager.on("productColorChanged",function(){console.debug("event","productColorChanged"),e()})),f.push(eventManager.on("productChanged",function(){console.debug("event","productChanged"),a.productStyle=state.selectedProductStyle,a.changePrintRegion(state.selectedProductStyle.product_regions.indexOf(state.selectedProductStyle.selectedRegion),!0),e(),a.$$phase||a.$apply()})),f.push(eventManager.on("selectedProductLoaded",function(){console.debug("event","selectedProductLoaded"),a.productStyle=state.selectedProductStyle,e(),a.selectFirstPrintRegionWithDesign(),a.$$phase||a.$apply()})),a.$on("$destroy",function(){if(f)for(var a=0;a<f.length;a++)f[a]()})};var modals={landingPage:"/ds/html/modals/landingPage.html",addNote:"/ds/html/modals/addNote.html",browseProducts:"/ds/html/modals/browseProducts.html",browseProductsSingle:"/ds/html/modals/browseProductsSingle.html",clipArt:"/ds/html/modals/clipArt.html",designIdeas:"/ds/html/modals/designIdeas.html",designsAndClipArt:"/ds/html/modals/designsAndClipArt.html",getQuote:"/ds/html/modals/getQuote.html",login:"/ds/html/modals/login.html",namesAndNumbers:"/ds/html/modals/namesAndNumbers.html",productCategories:"/ds/html/modals/productCategories.html",saveAndShare:"/ds/html/modals/saveAndShare.html",saveAndShareEmail:"/ds/html/modals/saveAndShareEmail.html",myArt:"/ds/html/modals/myArt.html",saveAndNameDesign:"/ds/html/modals/saveAndNameDesign.html",cartLogin:"/ds/html/cart/cartLogin.html",cartRegister:"/ds/html/cart/cartRegister.html",emailDesign:"/ds/html/cart/emailDesign.html",enterAddresses:"/ds/html/cart/enterAddresses.html",enterPayment:"/ds/html/cart/enterPayment.html",shippingMethod:"/ds/html/cart/shippingMethod.html",reviewOrder:"/ds/html/cart/reviewOrder.html",saveDesign:"/ds/html/cart/saveDesign.html",selectSizes:"/ds/html/cart/selectSizes.html",shareDesign:"/ds/html/cart/shareDesign.html",viewCart:"/ds/html/cart/viewCart.html",printReceipt:"/ds/html/cart/printReceipt.html",viewTestCaseXml:"/ds/html/cart/viewTestCaseXml.html",colorPicker:"/ds/html/modals/colorPicker.html",video:"/ds/html/modals/video.html",chooseNumberOfColors:"/ds/html/modals/uploader/chooseNumberOfColors.html",embroideryMapColors:"/ds/html/modals/uploader/embroideryMapColors.html",matchAndCombineColors:"/ds/html/modals/uploader/matchAndCombineColors.html",mobileUploadFromDevice:"/ds/html/modals/uploader/mobileUpload.html",mobileUploadConfirm:"/ds/html/modals/uploader/mobileUploadConfirm.html",selectImageType:"/ds/html/modals/uploader/selectImageType.html",uploaderLanding:"/ds/html/modals/uploader/uploaderLanding.html",colorOrBW:"/ds/html/modals/uploader/colorOrBW.html",warningProduct:"/ds/html/modals/warningProduct.html",saveDesignTip:"/ds/html/modals/saveDesignTip.html",addressList:"/ds/html/modals/addressList.html",address:"/ds/html/modals/address.html",upImageLoading:"/ds/html/modals/uploader/upImageLoading.html"},EasyTeeService=function(a){function b(b){var e=b,l=e.methodName,m=e.parameters,n=e.queryStringParameters||{};n.appKey=a.AppToken;var o,p=e.successRootTagName,q=e.error,r=e.postData,s=e.useSSL,t=e.useAppURI,u=e.returnSync;"undefined"==typeof a.useCache&&(a.useCache=!0),o=a.useCache&&e.useCache?!0:!1;var v="";switch(l){case"GetProduct":v="product/get";break;case"GetProductCategoryList":v="product/getCategoryList";break;case"GetProductList":v="product/getList";break;case"GetFontList":v="font/getList";break;case"GetDesign":v="design/get";break;case"GetDesignCategoryList":v="design/getCategoryList";break;case"GetDesignCategoryTexts":v="design/getCategoryTexts";break;case"GetDesignList":v="design/getList";break;case"GetArtList":v="art/getList";break;case"GetArtCategoryList":v="art/getCategoryList";break;case"GetUserDesignList":v="user/getDesignList";break;default:v=l}for(q||(q=b.error=f),q=t?"/"+a.AppURI+"/":"/",s&&a.sslDomain&&(q="https://"+a.sslDomain+q),q+=v+"/",s=-1,t=0;t<m.length;t++)"undefined"!=typeof m[t]&&m[t]&&(s=t);for(t=0;s>=t;t++)"undefined"!==m[t]&&m[t]?m[t]&&(q+=escape(m[t])+"/"):q+="0/";var w=n;if(w){var x=[];for(var y in w)x.push(y+"="+encodeURIComponent(w[y]));q+="?"+x.join("&")}a.enableLocalFeeds&&(q="../common/data/"+l+".xml"),console.log("%c methodName: "+l,"color:green"),console.log("%c reqUrl: "+q,"color:green"),service.ajaxCallStarted&&service.ajaxCallStarted(l,b.loadingMessage);var z=i?j[g(l,m)]:!1;if(o&&z)u?c(z,b):setTimeout(function(){c(z,b)},10);else{var A="xml";"OK"==p&&(A=null),$.ajax({type:r?"POST":"GET",url:h.adjustUrl(q),xhrFields:k,dataType:A,data:r,success:function(a){console.log("%c 首次请求 url->"+h.adjustUrl(q),"color:green"),c(a,b)},error:function(a,c,e){d(b,a,c,e)}})}}function c(a,b){var c=b.methodName,d=b.successRootTagName,h=b.deserializationSettings,k=b.processResults,l=b.success,m=b.error;if(service.ajaxCallEnded&&service.ajaxCallEnded(c,b.loadingMessage),"OK"==d&&"string"==typeof a&&0>a.indexOf("<"))l&&l(a);else{if("string"==typeof a){if(!a||0==a.length)if(m){var n="请求： "+c+" 时服务器返回了长度为 0 的数据，这是不应该的.";m(n,n)}else alert(n);a=$.parseXML(a)}var o=a,p=d,q=c,p=d,r=l,s=m;c=a.documentElement.nodeName;var t=f,q=c;if(p&&p!=q){if("error"==q.toLowerCase())s?s($(o.documentElement).text(),$(o.documentElement).text(),null,!0):t({},$(o.documentElement).text(),$(o.documentElement).text(),!0);else if("errors"==q.toLowerCase()){var u=e($(o).children()[0],{Error:{name:"errors",mode:"array"}});console.log("调用成功，但返回一个错误: ",u),s&&s(u.errors,null,null,!0)}}else{var v=k,m=e($(o).children()[0],h);v&&(v=v(m))&&(m=v),r&&r(m);var l=o;i&&(j[g(b.methodName,b.parameters)]=l)}}}function d(a,b,d,e){return service.ajaxCallEnded&&service.ajaxCallEnded(a.methodName,a.loadingMessage),"OK"==a.successRootTagName&&"parsererror"==d?c("OK",a):void(a.error?a.error(b,d,e,!1):f(b,d,e,null))}function e(a,b){if(!a)return null;var c=$(a),d=null;if(a.attributes&&0<a.attributes.length||0<c.children().length){if(d={},a.attributes)for(var f=0;f<a.attributes.length;f++){var g=a.attributes[f].name,h=a.attributes[f].value;0<=h.indexOf("REPLACE_DOMAIN_WITH")?h=l(h):"0"===h||"1"===h?h=parseInt(h):("false"===h.toLowerCase()||"true"===h.toLowerCase())&&(h="true"===h.toLowerCase()),d[g]=h}for(0===c.children().length&&c.text().trim()&&(d.textValue=c.text()),c=c.children(),f=0;f<c.length;f++){var i=c[f];if($(i),h=i.tagName,g=null==b||"undefined"==typeof b[h]?{mode:"array",name:h}:b[h],"undefined"!=typeof g.name&&g.name?h=g.name:h&&g&&!g.name&&(g.name=h),i=e(i,b),d[h])(h=d[g.name])&&"undefined"!=typeof h.push?h.push(i):(d[g.name]=[],d[g.name].push(h),d[g.name].push(i));else if("single"==g.mode)d[g.name]=i;else if("merge"==g.mode)for(var j in i)d[j]=i[j];else d[g.name]=[],d[g.name].push(i)}}else d=c.text();return d}function f(a,b,c,d){console.log("Ajax请求失败: "+b+"\r\n"+c),d&&alert("错误: "+b),window.defaultAjaxErrorHandler&&window.defaultAjaxErrorHandler(a,b,c,d)}function g(a,b){var c=a;if(b)for(var d=0;d<b.length;d++)c+="_"+b[d];return c}var h=this,i=!0,j={};this.ajaxCallEnded=this.ajaxCallStarted=null,a||(a={domain:window.ezdDomain,sslDomain:window.ezdSSLDomain,AppToken:window.ezdAppToken,publisherID:window.ezdPublisherID,AppURI:window.ezdAppURI,addDomainToUrls:!0});var k=null,l=window.fixImageUrl||function(a){return a};this.getThemeInfo=function(a,b){$.ajax({type:"GET",url:a,xhrFields:k,dataType:"text/xml",complete:function(a){if(b){var c=a.responseXML;!c&&a.responseText&&(c=$.parseXML(a.responseText)),(a=e(c,{customization:{mode:"single"},rule:{name:"rules"},file:{name:"files"},theme:{mode:"single"}}))&&a.theme&&(a=a.theme),b(a)}}})},this.saveThemeCustomizations=function(){},this.getThemeCustomizations=function(){},this.adjustUrl=function(b){if(!b)return b;var c=a.addDomainToUrls;return b=l(b),c&&0!=b.indexOf("http")&&0!=b.indexOf("//")&&(b="http://"+a.domain+b),document.location.href.startsWith("file")||(b=b.replace("http://","//")),b},this.getStoreAddress=function(a,c){return"undefined"!=typeof j.address&&a?(a(j.address),j.address):b({methodName:"GetStoreAddress",parameters:[],successRootTagName:"StoreAddress",deserializationSettings:{stores:{
mode:"merge"},addresses:{mode:"merge"},states:{mode:"single",name:"state"},countries:{mode:"single",name:"country"}},processResults:function(a){},loadingMessage:"获取地址",useCache:!0,success:a,error:c})},this.getEmbroideryImageInfo=function(a,b,c){$.ajax({type:"GET",headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},url:a,xhrFields:k,success:function(c){b({url:a,dataUrl:c.url,stitchWidth:c.width,stitchHeight:c.height})},error:c})},this.getSizeChartUrl=function(b,c,d){b=encodeURIComponent(b.replace(/ /gi,""));var e="http://"+a.domain+"/images/publishers/"+a.publisherID+"/brands/"+b+"/SizeChart.jpg";c(e)},this.getInitialLoad=function(b,c,d,e,i){service.ajaxCallStarted("InitialLoad","初始化设计工具..."),$.ajax({type:"POST",xhrFields:k,url:h.adjustUrl("/init/getConfig/?appKey="+a.AppToken+"&productId="+b+"&embroideryMode="+d),success:function(c){$(".design-tool, .design-product").fadeIn(),service.ajaxCallEnded&&service.ajaxCallEnded("InitialLoad");var h={},k=c.getElementsByTagName("error");if(k.length)i?i($(k[0]).text()):f(null,$(k[0]).text(),null,$(k[0]).text());else{var k=c.getElementsByTagName("FontList");k.length&&(h.fontCategoriesXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0]))),k=c.getElementsByTagName("InkColorList"),k.length&&(h.inkColorsXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0]))),k=c.getElementsByTagName("ProductResult"),k.length?h.productResultXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0])):0==b?h.productResultXml=$.parseXML(service.createProductXml()):(i=i||f)(null,"Product not found or store suspended.","Product not found or store suspended.",!0),k=c.getElementsByTagName("DesignerToolTips"),k.length&&(h.toolTipsXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0]))),k=c.getElementsByTagName("ExcludedFontIDs"),k.length&&(h.excludedFontsXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0]))),k=c.getElementsByTagName("ThreadChartResult"),k.length&&(h.threadChartsXml=$.parseXML(k[0].xml||(new XMLSerializer).serializeToString(k[0]))),k=c.getElementsByTagName("UploadImageTerms"),k.length&&(h.uploadImageTerms=k[0].xml||(new XMLSerializer).serializeToString(k[0]),h.uploadImageTerms=htmlUnescape(h.uploadImageTerms.replace("<UploadImageTerms>","").replace("</UploadImageTerms>",""))),j[g("GetFontList",[d])]=h.fontCategoriesXml||$.parseXML("<FontList></FontList>"),j[g("GetInkColorList",[])]=h.inkColorsXml||$.parseXML("<InkColorList></InkColorList>"),j[g("GetProduct",[b,""])]=h.productResultXml||$.parseXML("<ProductResult></ProductResult>"),j[g("GetStoreDesignerToolTips",[])]=h.toolTipsXml||$.parseXML("<DesignerToolTips></DesignerToolTips>"),j[g("GetExcludedFonts",[a.publisherID])]=h.excludedFontsXml||$.parseXML("<ExcludedFontIDs></ExcludedFontIDs>"),j[g("EmbroideryGetThreadChartList",[])]=h.threadChartsXml||$.parseXML("<ThreadChartResult></ThreadChartResult>"),console.debug("service.getFontCategories"),service.getFontCategories(d,function(a){h.fontCategories=a}),service.getStoreInkColors(function(a){h.inkColors=a}),service.getProductDetails(b,null,null,function(a){h.product=a}),service.getStoreDesignerToolTips(function(a){h.tooltips=a}),service.getExcludedFontIDs(function(a){h.excludedFontIDs=a}),service.getStoreThreadCharts(function(a){h.threadCharts=a}),h.hasGoogleFonts=!!findMatch(h.fontCategories,function(a){return 1e6>a.font_style_id&&100<=a.font_style_id}),ezdVars.HasGoogleFonts=h.hasGoogleFonts,e&&(h.hasGoogleFonts?(c=ezdVars.DesignerLocation.replace("/designer/html5","/designer/fonts/galleries/2/replacements.txt"),".."===c&&(c="http://"+ezdVars.ApiDomain+"/designer/fonts/galleries/2/replacements.txt"),$.ajax({type:"GET",url:c,success:function(a){state.fontReplacements=[],a=a.split("\n");for(var b=0;b<a.length;b++){var c=a[b].split("	"),c={new_font_id:c[0],old_font_id:c[1],new_font_style_id:c[2],new_font_name:c[3],new_font_style_name:c[3].split(" ")[0]};c.jspath="REPLACE_DOMAIN_WITH/designer/fonts/galleries/2/"+c.new_font_style_name+"/"+c.new_font_name.replace(" ","")+".ttf.js",c.gifpath=c.jspath.replace(".ttf.js",".gif"),c.swfpath=c.jspath.replace(".ttf.js",".swf"),state.fontReplacements.push(c)}e(h)}})):e(h))}},error:function(a,b,c){service.ajaxCallEnded&&service.ajaxCallEnded("InitialLoad"),i&&i(null,a,b,c)}})},this.getStoreThreadCharts=function(a,c){return b({methodName:"EmbroideryGetThreadChartList",parameters:[],successRootTagName:"ThreadChartList",deserializationSettings:{},processResults:function(a){var b=[];if(!a||!a.ink_color_maps)return b;for(var c=0;c<a.ink_color_maps.length;c++)b=b.concat(a.ink_color_maps[c].ink_colors);return b},loadingMessage:"获取开发者颜色配置",useCache:!0,returnSync:!0,success:a,error:c})},this.getStoreThreadChartColors=function(a,c,d){return b({methodName:"EmbroideryGetThreadColorList",parameters:[a],successRootTagName:"ThreadColorList",deserializationSettings:{},processResults:function(a){return a},loadingMessage:"获取开发者颜色配置",useCache:!0,returnSync:!0,success:c,error:d})},this.getStoreInkColors=function(a,c){return b({methodName:"GetInkColorList",parameters:[],successRootTagName:"InkColorList",deserializationSettings:{ink_color_map_colors:{mode:"merge"}},processResults:function(a){var b=[];if(!a||!a.ink_color_maps)return b;for(var c=0;c<a.ink_color_maps.length;c++)a.ink_color_maps[c].ink_colors&&(b=b.concat(a.ink_color_maps[c].ink_colors));return b},loadingMessage:"获取开发者颜色配置",useCache:!0,returnSync:!0,success:a,error:c})},this.getStoreToolTips=function(a,c){return b({methodName:"GetStoreDesignerToolTips",parameters:[],successRootTagName:"DesignerToolTips",deserializationSettings:{},processResults:function(a){return a.ToolTips},loadingMessage:"获取工具提示",useCache:!0,returnSync:!0,success:a,error:c})},this.logIn=function(a,c,d,e,f){return b({methodName:"LoginUser",parameters:[d],successRootTagName:"Login",deserializationSettings:{UserToken:{mode:"single",name:"UserToken"},SessionToken:{mode:"single",name:"sessionToken"},UserToken:{mode:"single",name:"UserToken"},UserName:{mode:"single",name:"userName"},UserRole:{mode:"single",name:"userRole"},Status:{mode:"single",name:"status"}},loadingMessage:"登录中",processResults:function(a){return window.eventManager&&a.UserToken&&(window.eventManager.trigger("gotSession",a),window.eventManager.trigger("userLoggedIn",a)),a},success:e,error:f,postData:{Email:a,Password:c}})},this.createAccount=function(a,c,d,e,f,g,h,i){return b({methodName:"RegisterUser",parameters:[g],successRootTagName:"Account",deserializationSettings:{UserToken:{mode:"single",name:"UserToken"},SessionToken:{mode:"single",name:"sessionToken"},UserToken:{mode:"single",name:"UserToken"},UserName:{mode:"single",name:"userName"},UserRole:{mode:"single",name:"userRole"},Status:{mode:"single",name:"status"}},loadingMessage:"注册中",processResults:function(a){return window.eventManager&&a.UserToken&&(window.eventManager.trigger("gotSession",a),window.eventManager.trigger("userLoggedIn",a)),a},success:h,error:i,postData:{Email:d,Password:e,FirstName:a,LastName:c,ConfirmPassword:f}})},this.resetPassword=function(b,c,d){var e={methodName:"ResetPassword",loadingMessage:"重置密码",success:c,error:d,postData:{Email:b}};$.ajax({type:"POST",url:h.adjustUrl("/ResetPassword/"+a.AppToken),xhrFields:k,data:e.postData,success:function(a){service.ajaxCallEnded&&service.ajaxCallEnded("ResetPassword",e.loadingMessage),"OK"==a&&c?c():($(a),a=$(a).find("Error").text(),d(a))},error:function(a,b,c){service.ajaxCallEnded&&service.ajaxCallEnded("ResetPassword",e.loadingMessage),d&&d(e,a,b,c)}})},this.logOff=function(b){var c="/"+a.AppURI+"/Account/LogOff/";service.ajaxCallStarted&&service.ajaxCallStarted("LogOff","注销..."),$.ajax({type:"GET",url:h.adjustUrl(c),xhrFields:k,dataType:"text/html",complete:function(a){service.ajaxCallEnded&&service.ajaxCallEnded("LogOff"),b&&b(a)}})},this.createNewSession=function(b,c){delete j.currentSessionInfo,$.ajax({type:"POST",url:h.adjustUrl("/"+a.AppURI+"/Cart/GetCartSession/"),xhrFields:k,data:{},dataType:"xml",success:function(a){var c=parseInt($(a).find("UserToken").text()),d=$(a).find("SessionToken").text();a=$(a).find("UserToken").text(),c={UserToken:c,UserToken:a,sessionToken:d},j.currentSessionInfo=c,window.eventManager&&window.eventManager.trigger("gotSession",c),b&&b(c)},error:function(a,b,c){handleError(a,b,c)}})},this.getOrCreateSession=function(b,c){j.currentSessionInfo&&b?b(j.currentSessionInfo):$.ajax({type:"POST",url:h.adjustUrl("/GetNewSession/"+a.AppToken),xhrFields:k,data:{},dataType:"xml",success:function(a){var c=parseInt($(a).find("UserToken").text()),d=$(a).find("SessionToken").text();a=$(a).find("UserToken").text(),c={UserToken:c,UserToken:a,sessionToken:d},j.currentSessionInfo=c,window.eventManager&&window.eventManager.trigger("gotSession",c),b&&b(c)},error:function(a,b,c){handleError(a,b,c)}})},this.getArtByID=function(a,c,d){return b({methodName:"GetArtList",parameters:[0,a,0,0],queryStringParameters:{ArtId:a},successRootTagName:"ArtList",deserializationSettings:{},loadingMessage:"获取剪贴画",processResults:function(a){return a=""===a?null:a.art[0]},success:c,error:d})},this.saveUserArt=function(b,e,g,i,j){var l={methodName:"SaveArt",parameters:[b,e],successRootTagName:"Art",deserializationSettings:{ArtID:{mode:"single"},UserToken:{mode:"single"},SessionToken:{mode:"single"},ArtName:{mode:"single"}},loadingMessage:"保存剪贴画",processResults:function(a){return a},success:i,error:j};j||(j=f),b="/art/save/?appKey="+a.AppToken+"&userToken="+b+"&DesignID="+ezdVars.DesignID,service.ajaxCallStarted&&service.ajaxCallStarted("SaveArt","处理图像中..."),$.ajax({type:"POST",url:h.adjustUrl(b),xhrFields:k,dataType:"xml",data:g,cache:!1,contentType:!1,processData:!1,success:function(a){c(a,l)},error:function(a){service.ajaxCallEnded&&service.ajaxCallEnded("SaveArt"),j&&d(a)}})},this.getArtInCategory=function(a,c,d,e,f){return b({methodName:"GetArtList",parameters:[],successRootTagName:"ArtList",deserializationSettings:{},postData:{ArtCategoryId:a},loadingMessage:"获取剪贴画",processResults:function(a){a=""===a?[]:a.art;for(var b=/.*\/images\/userart\/images\/(.*)\.[a-zA-Z0-9]{3}/,c=0;c<a.length;c++){var d=a[c];if(d.thumburl_large=changeJITImageSize(d.thumb_jit,250,".png"),d.art_path&&b.test(d.art_path)){var e=b.exec(d.art_path);e&&1<e.length&&(d.art_name_full=e[1])}}return a},success:e,error:f})},this.getArtForUser=function(a,c,d){return b({methodName:"GetArtList",parameters:[0,0,a,""],successRootTagName:"ArtList",deserializationSettings:{},loadingMessage:"获取剪贴画",processResults:function(a){a=""===a?[]:a.art;for(var b=0;b<a.length;b++){var c=a[b];c.thumburl_large=changeJITImageSize(c.thumb_jit,250,".png")}return a},success:c,error:d})},this.getArtCategoryList=function(a,c,d,e){return b({methodName:"GetArtCategoryList",parameters:[a,c],queryStringParameters:{ArtCategoryId:a},successRootTagName:"ArtCategoryList",deserializationSettings:{},loadingMessage:"获取剪贴画分类",processResults:function(b){if(b=""===b?[]:b.gallery_art_categories,a)for(var c=0;c<b.length;c++)b[c].parent_id=a;for(c=0;c<b.length;c++){var d=b[c];d.thumburl_large=changeJITImageSize(d.thumb_jit,250,".png")}return b},success:d,error:e})},this.checkMobileUploads=function(a,c,d,g){return g||(g=f),b({methodName:"CheckMobileUpload",parameters:[a],successRootTagName:"Art",deserializationSettings:{art_url:{mode:"single"},art_id:{mode:"single"},art_name:{mode:"single"},width:{mode:"single"},height:{mode:"single"},Status:{mode:"single"}},loadingMessage:"检查Email",processResults:function(a){return a},success:c,error:function(a,b,c,f){if(f){var h=e($(a),{});"PENDING"===h.status?d(h):g(a,b,c,f)}else g(a,b,c,f)}})},this.getMobileUploadUserKey=function(b){var c="000"+parseInt(a.AppToken,10).toString(36),c=c.substring(c.length-3);return b=parseInt(b,10),c+=b.toString(36)},this.getProductCategories=function(a,c){return c||(c=f),b({methodName:"GetProductCategoryList",parameters:[],successRootTagName:"ProductCategoryList",deserializationSettings:{vw_product_categories:{name:"categories"}},loadingMessage:"获取产品分类",useCache:!0,processResults:function(a){a=a.categories;for(var b=0;b<a.length;b++){var c=a[b],d=c.thumburl;"undefined"==typeof d&&(d=c.thumburl_front),c.thumburl=l(d),c.thumburl_large=changeJITImageSize(c.thumburl,150,".png")}return b=arrangeHierarchy(a,function(a){return a.product_category_id},function(a){return a.parent_id}),b.categoriesFlat=a,b},success:a,error:c})},this.findProductCategoryByID=function(a,b){if(!a)return null;for(var c=0;c<a.length;c++){if(a[c].product_category_id==b)return a[c];if("undefined"!=typeof a[c].children){var d=h.findProductCategoryByID(a[c].children,b);if(d)return d}}return null},this.getProductsByCategory=function(a,c,d,e,f){var g=h.findProductCategoryByID(j.productCategories,a),i={};return a?i.productCategoryId=a:i.keyWord=c,g&&g.products&&!c&&d?(e&&e(g.products),g.products):b({methodName:"GetProductList",parameters:[a,c?c:"",d],queryStringParameters:i,successRootTagName:"ProductList",deserializationSettings:{products:{name:"product",mode:"merge"}},loadingMessage:"获取产品列表",useCache:!0,processResults:function(a){if(a=a.CS,g&&!c&&d&&(g.products=a),a&&a.length)for(var b=0;b<a.length;b++){var e=a[b];e.thumburl_large=changeJITImageSize(l(e.thumburl_front),150,".png")}return a},success:e,error:f})},this.getProductDetails=function(a,c,d,f,h){var i={};d?i.productId=d:(i.productId=a,i.productStyleId=c||"");var k={methodName:d?"GetProductFromBarCode":"GetProduct",parameters:d?[d]:[a,c?c:""],queryStringParameters:i,successRootTagName:"ProductResult",useCache:!0,returnSync:!0,deserializationSettings:{products:{name:"product",mode:"merge"}},loadingMessage:"获取产品详情",processResults:function(b){b.product_styles&&1===b.product_styles.length?b.product_style=b.product_styles[0]:b.product_styles&&c&&(b.product_style=findMatch(b.product_styles,function(a){return a.product_style_id==c}));for(var d=0;d<b.product_styles.length;d++){var e=b.product_styles[d];"GetProduct"!=k.methodName||c||(j[g("GetProduct",[a,e.product_style_id])]=j[g("GetProduct",[a,""])]),(e.is_default||!b.defaultStyle)&&(b.defaultStyle=e),e.product_regions&&1==e.product_regions.length&&"undefined"==typeof e.product_regions[0].is_default&&(e.product_regions=[]);for(var f=0;f<e.product_regions.length;f++){var h=e.product_regions[f];1!=h.is_default||e.defaultRegion||(e.defaultRegion=h),h.originalRegion=h.region,h.region=h.region.split(",");for(var i=0;i<h.region.length;i++)h.region[i]*=.5;h.region[0]+=.5*(500-e["image_width_"+h.side])}if(!e.defaultRegion&&b.regions&&b.regions.length&&(e.defaultRegion=b.regions[0]),e.sizes&&e.sizeids)for(h=e.sizes.split(","),i=e.sizeids.split(","),e.sizeData=[],f=0;f<h.length;f++)e.sizeData.push({name:h[f],id:i[f]})}return b},success:f,error:h};return a||d?b(k):(d=$.parseXML(this.createProductXml()),d=e($(d).children()[0],k.deserializationSettings),h=k.processResults(d),f&&f(h||d),h||d)},this.createProductXml=function(){return'<ProductResult><products product_id="0" manufacturer="Default" manufacturer_sku="0" sku="0" name="Placeholder Product" customizable="1" can_print="1" can_digital_print="1" can_screen_print="0" can_embroider="0" can_handle_sleeves="0" enable_team_name_numbers="1" has_back="0" has_third_side="0" has_fourth_side="0" third_side_name="Left Sleeve" fourth_side_name="Right Sleeve" is_static="0" long_description=" "><product_styles product_style_id="0" is_default="1" color="WHITE" html_color="FFFFFF" customizable="1" can_print="1" can_digital_print="1" can_screen_print="1" can_embroider="1" unit_price="0.00" canvas_price="0.00" name_price="0.00" number_price="0.00" sizes="11 Size" sizeids="0" image_width_front="500" image_height_front="500"><product_regions product_region_id="0" side="front" is_default="1" name="Full" region="80,30,840,830" render_width_inches="12.00" side_order="1" region_order="1" imgurl="REPLACE_DOMAIN_WITH/designer/html5/ds/images/productImage.png" thumburl="REPLACE_DOMAIN_WITH/designer/html5/ds/images/productImage.png"><print_mask/></product_regions></product_styles></products></ProductResult>'},this.getProductColors=function(a,c,d){return d={methodName:"GetProduct",parameters:[a,""],successRootTagName:"ProductResult",deserializationSettings:{products:{name:"product",mode:"merge"}},loadingMessage:"获取产品颜色（款式）",useCache:!0,processResults:function(a){for(var b=0;b<a.product_styles.length;b++){var c=a.product_styles[b];if(c.sizes&&c.sizeids){var d=c.sizes.split(","),e=c.sizeids.split(",");c.sizeData=[];for(var f=0;f<d.length;f++)c.sizeData.push({name:d[f],id:e[f]})}}return a.product_styles},success:c,error:d},a?b(d):(a=$.parseXML(this.createBlankProductColors()),a=e($(a).children()[0],d.deserializationSettings),d=d.processResults(a),c&&c(d||a),d||a)},this.createBlankProductColors=function(){var a;return a='<ProductResult><products product_id="0"><product_styles product_style_id="-1" is_default="0" color="ASH" html_color="D1D4D3"></product_styles><product_styles product_style_id="-2" is_default="0" color="BLACK" html_color="000000"></product_styles><product_styles product_style_id="-3" is_default="0" color="CACTUS GREEN" html_color="939871"></product_styles><product_styles product_style_id="-4" is_default="0" color="CAROLINA BLUE" html_color="6299DD"></product_styles><product_styles product_style_id="-5" is_default="0" color="CHARITY PINK" html_color="F8B4BE"></product_styles><product_styles product_style_id="-6" is_default="0" color="CITY GREEN" html_color="3E4723"></product_styles><product_styles product_style_id="-7" is_default="0" color="HEATHER GREY" html_color="B7B7B7"></product_styles><product_styles product_style_id="-8" is_default="0" color="KELLY GREEN" html_color="009A63"></product_styles><product_styles product_style_id="-9" is_default="0" color="KEY LIME" html_color="BAD97E"></product_styles><product_styles product_style_id="-10" is_default="0" color="LIGHT BLUE" html_color="6AB2E7"></product_styles><product_styles product_style_id="-11" is_default="0" color="NEON YELLOW" html_color="EEEA84"></product_styles><product_styles product_style_id="-12" is_default="0" color="PURPLE" html_color="4D2379"></product_styles><product_styles product_style_id="-13" is_default="0" color="RED" html_color="C10435"></product_styles><product_styles product_style_id="-14" is_default="0" color="ROYAL BLUE" html_color="0079DB"></product_styles><product_styles product_style_id="-15" is_default="0" color="STORM GREY" html_color="326AAE"></product_styles><product_styles product_style_id="-16" is_default="0" color="TEXAS ORANGE" html_color="AE6134"></product_styles><product_styles product_style_id="0" is_default="1" color="WHITE" html_color="FFFFFF"></product_styles></products></ProductResult>'.replace(/\<\/product_styles/gi,'<product_regions product_region_id="0" side="front" is_default="1" name="Full" region="80,30,840,830" render_width_inches="12.00" side_order="1" region_order="1" imgurl="REPLACE_DOMAIN_WITH/designer/html5/ds/images/productImage.png" thumburl="REPLACE_DOMAIN_WITH/designer/html5/ds/images/productImage.png"><print_mask/></product_regions></product_styles')},this.getDistress=function(a,b,c){this.getDistressList(function(d){for(var e=0;e<d.length;e++)if(d[e].distress_id==a)return void b(d[e]);c&&c("Distress not found.")},c)},this.getDistressList=function(a,c){return b({methodName:"GetDistressList",parameters:[],successRootTagName:"DistressList",deserializationSettings:{},loadingMessage:"获取印刷特效",useCache:!0,processResults:function(a){for(var b=0;b<a.distresses.length;b++){var c=a.distresses[b];c.distress_path=l(c.distress_path),c.distress_small_path=l(c.distress_small_path),c.distress_thumb_path=l(c.distress_thumb_path),c.distress_path_jpg=c.distress_path.replace(".png",".jpg"),c.distress_small_path_jpg=c.distress_small_path.replace(".png",".jpg"),c.distress_thumb_path_jpg=c.distress_thumb_path.replace(".png",".jpg")}return a.distresses},success:a,error:c})},this.loadFont=function(b,c,d,e,f){var g=b.font||b.fontFamily,h=b.font_id||b.fontId,i="//"+a.domain+"/font/getJsFont/?appKey="+a.AppToken+"&fontid="+h+"&text="+encodeURIComponent(d);service.loadScript(i,g,c,e,f)},this.getExcludedFontIDs=function(c,d){return b({methodName:"GetExcludedFonts",parameters:[a.publisherID],successRootTagName:"ExcludedFontIDs",deserializationSettings:{},loadingMessage:"获取字体信息",useCache:!0,returnSync:!0,processResults:function(a){return a.Font},success:c,error:d,noAppTokenInUrl:!0})},this.getFontCategories=function(a,c,d){return b({methodName:"GetFontList",parameters:[a],successRootTagName:"FontList",deserializationSettings:{},loadingMessage:"获取字体信息",useCache:!0,returnSync:!0,processResults:function(a){if(!a||!a.font_styles)return[];for(var b=0;b<a.font_styles.length;b++){var c=a.font_styles[b];c.font_style=c.style,0==c.FontCount&&(a.font_styles.splice(b,1),b--)}return a.font_styles},success:c,error:d})},this.getFontsByCategory=function(a,c,d){return b({methodName:"GetFontList",queryStringParameters:{fontCategorieId:a},parameters:[a,"true"],successRootTagName:"FontList",deserializationSettings:{},loadingMessage:"获取字体信息",useCache:!0,processResults:function(a){for(var b=0;b<a.fonts.length;b++){var c=a.fonts[b];c.jspath.split("/");c.fontFamily=c.name,c.font=c.name}return a.fonts},success:c,error:d})},this.getStoreDesignerToolTips=function(a,c){return b({methodName:"GetStoreDesignerToolTips",parameters:[],successRootTagName:"DesignerToolTips",deserializationSettings:{},loadingMessage:"获取工具提示",useCache:!0,processResults:function(a){return a},success:a,error:c})},this.loadScript=function(a,b,c,d,e){var f=document.getElementsByTagName("head")[0],g=document.createElement("script"),h=b.replace(/ /g,"");g.setAttribute("id",h),g.type="text/javascript",g.src=a,$("#"+b.replace(/ /g,"")).remove(),f.appendChild(g),g.onload=function(){c.call(),e&&e.call()},g.onerror=d},this.loadCss=function(a){var b=document.createElement("link");return b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b),b},this.getDesignCategoryList=function(a,c,d){return b({methodName:"GetDesignCategoryList",parameters:[a],successRootTagName:"StoreDesignCategoryList",deserializationSettings:{},loadingMessage:"获取模版市场素材分类",useCache:!0,processResults:function(a){var b="undefined"!=typeof kioskFlowType&&"NAMEDROP"===kioskFlowType?["Bachelorette","Choir","Baseball Tournament","Fashion"]:[],c=a,c=a&&a.store_design_categories?a.store_design_categories:[];for(a=0;a<c.length;a++){var d=c[a];searchInArray(b,d.name)&&(d.enableKioskNameDrop=!0),d.thumburl_large=changeJITImageSize(d.thumburl,250,".png")}return c},success:c,error:d})},this.getDesignCategoryTexts=function(a,c,d){return b({methodName:"GetDesignCategoryTexts",parameters:[a],successRootTagName:"CategoryCanvasTexts",deserializationSettings:{},loadingMessage:"获取模版市场素材 Texts",useCache:!0,processResults:function(a){var b=a;return b=a&&a.canvas_text?a.canvas_text:[]},success:c,error:d})},this.getDesignsByCategory=function(a,c,d,e){return b({methodName:"GetDesignList",parameters:[a,c?c:""],successRootTagName:"StoreDesignList",deserializationSettings:{},loadingMessage:"获取模版市场素材",useCache:!0,processResults:function(a){var b=a,b=a&&0!==a.length?a.designs:[];for(a=0;a<b.length;a++){var c=b[a];c.isFrame=0<=c.name.toUpperCase().indexOf("FRAME"),c.thumburl_large=changeJITImageSize(c.thumburl,250,".png")}return b},success:d,error:e})},this.getDesignsByUser=function(a,c,d){return b({methodName:"GetUserDesignList",parameters:[a],successRootTagName:"UserDesignList",deserializationSettings:{},loadingMessage:"获取模版市场素材",processResults:function(a){var b=a,b=a&&0!==a.length?a.designs:[];for(a=0;a<b.length;a++){var c=b[a];c.thumburl_large=changeJITImageSize(c.imgurl,250,".png")}return b},success:c,error:d})},this.createDesignXml=function(){return'<ThisDesign><designs table_name="design" name="未命名" can_customize="1" can_screen_print="1" is_embroidery="0" designer_version="" disable_product_update_front="0" disable_product_update_color="0" disable_product_update_back="0" disable_canvas_add="0"><product_styles /></designs><canvases table_name="canvas" location="Front"  width="500" height="500" bgcolor="ffffff" is_distressed="0" shadow="0" region_name="Full" disable_image_add="0" disable_text_add="0" disable_image_delete="0" disable_text_delete="0" imgurl=""><canvas_embroidery /></canvases></ThisDesign>'},this.getDesign=function(a,c,d){return d={methodName:"GetDesign",parameters:[a],successRootTagName:"ThisDesign",deserializationSettings:{font_styles:{mode:"single",name:"fontStyle"},designs:{mode:"merge",name:"designInfo"},art:{mode:"single",name:"art"},fonts:{mode:"single",name:"font"},canvas_text_embroidery:{mode:"single"},product_styles:{mode:"single",name:"productStyle"}},loadingMessage:"获取模版市场素材",useCache:!0,processResults:function(a){if(a.isFrame=0<=a.name.toUpperCase().indexOf("FRAME"),a.canvas_text)for(var b=0;b<a.canvas_text.length;b++){var c=a.canvas_text[b];c.type="text";var d=c.font;d.font_id=c.font_id;var e=d.fontStyle.jspath.split("/");if(d.fontStyle.canvas_text_embroidery){c.canvas_text_embroidery=d.fontStyle.canvas_text_embroidery,delete d.fontStyle.canvas_text_embroidery;for(var f in c.canvas_text_embroidery)c[f]=c.canvas_text_embroidery[f],c.isEmbroidery=!0}e=e[e.length-1].split(".")[0].replace("'",""),d.fontStyle.font_family=d.font_family=d.fontFamily=e,d.jspath=service.adjustUrl(d.fontStyle.jspath),d.fontttfpath=service.adjustUrl(d.fontStyle.fontttfpath),d.altfontttfpath=service.adjustUrl(d.fontStyle.altfontttfpath),d.fontswfpath=service.adjustUrl(d.fontStyle.fontswfpath),d.localswfpath=service.adjustUrl(d.fontStyle.localswfpath),d.gifpath=service.adjustUrl(d.fontswfpath.replace(/swf/gi,"gif")),c.shadow_color="#000000",c.shadow_value=0,c.wrap_amount&&(c.wrap_amount=parseFloat(c.wrap_amount)),c.kerning&&(c.kerning=parseFloat(c.kerning)),c.stroke_width&&(c.stroke_width=parseFloat(c.stroke_width)/2)}else a.canvas_text=[];if(a.canvas_art)for(b=0;b<a.canvas_art.length;b++){c=[],d=a.canvas_art[b],d.canvas_art_rendered&&(d.canvas_art_rendered=d.canvas_art_rendered.replace("\\","~"));for(var g in d)"color"===g.substring(0,5)&&(f=getColorString(d[g],!0),c.push({name:g,value:f}));for(f=[],d=0;d<c.length;d++)if(e=c[d],-1==e.name.search("_mapped")){var h=searchInArray(c,e.name+"_mapped","name");!1!==h&&(e.value=h.value),"ffffffff"==e.value&&(e.value="ffffff"),f.push({name:e.name,value:e.value})}c=f,a.canvas_art[b].colors=c}else a.canvas_art=[];for(normalizeColorStrings(a),b=0;b<a.canvases.length;b++){var i=a.canvases[b];for(i.canvas_text=[],i.canvas_art=[],d=0;d<a.canvas_text.length;d++)c=a.canvas_text[d],c.canvas_id==i.canvas_id&&i.canvas_text.push(c);for(d=0;d<a.canvas_art.length;d++)g=a.canvas_art[d],g.canvas_id==i.canvas_id&&i.canvas_art.push(g);!function(){var a=i;a.isEmpty=function(){return!(a.canvas_text&&a.canvas_text.length||a.canvas_art&&a.canvas_art.length)}}()}delete a.canvas_text,delete a.canvas_art,a.currentCanvasIndex=0,Object.defineProperty(a,"canvas",{get:function(){return a.canvases[a.currentCanvasIndex]}}),Object.defineProperty(a,"canvas_text",{get:function(){return a.canvas.canvas_text}}),Object.defineProperty(a,"canvas_art",{get:function(){return a.canvas.canvas_art}}),a.isEmpty=function(){var b;if(!a.canvases||!a.canvases.length)return!0;for(var c=0;c<a.canvases.length;c++)if(b=a.canvases[c],!b.isEmpty())return!1;return!0}},success:c,error:d},a?b(d):(a=$.parseXML(this.createDesignXml()),a=e($(a).children()[0],d.deserializationSettings),d=d.processResults(a),c&&c(d||a),d||a)},this.getCartPaymentMethods=function(a,c,d){return b({methodName:"GetCartPaymentMethods",parameters:[a],successRootTagName:"payment_methods",deserializationSettings:{},loadingMessage:"获取付款方式",processResults:function(a){return a.payment_method},useSSL:jQuery.support.cors,success:c,error:d})},this.getProductQuote=function(a,c,d,e,f,g,h,i,j,k){return a={methodName:"GetProductQuote",parameters:[a,c,d],successRootTagName:"ProductPriceGrid",deserializationSettings:{Range:{name:"ranges",mode:"array"},Low:{name:"low",mode:"single"},High:{name:"high",mode:"single"},Price:{name:"price",mode:"single"},CombinePrintAndProduct:{name:"combinePrintAndProduct",mode:"single"},ApplyQtyDiscToPrinting:{name:"applyQtyDiscToPrinting",mode:"single"},Setup:{name:"setup",mode:"single"},NamePrice:{name:"namePrice",mode:"single"},NumberPrice:{name:"numberPrice",mode:"single"},QtyDiscPercent:{name:"qtyDiscPercent",mode:"single"},PriceDiscountable:{name:"priceDiscountable",mode:"single"}},loadingMessage:"获取报价",processResults:function(a){for(var b=0;b<a.ranges.length;b++){var c=a.ranges[b];c.low=parseFloat(c.low),c.high=parseFloat(c.high),c.high<a.min_quantity?(a.ranges.splice(b,1),b--):(c.low<a.min_quantity&&(c.low=a.min_quantity),c.price=parseFloat(c.price),c.combinePrintAndProduct="true"==c.combinePrintAndProduct.toLowerCase(),c.applyQtyDiscToPrinting="true"==c.applyQtyDiscToPrinting.toLowerCase(),c.setup=c.setup?parseFloat(c.setup):0,c.namePrice=c.namePrice?parseFloat(c.namePrice):0,c.numberPrice=c.numberPrice?parseFloat(c.numberPrice):0,c.qtyDiscPercent=c.qtyDiscPercent?parseFloat(c.qtyDiscPercent):0,c.priceDiscountable=c.priceDiscountable?parseFloat(c.priceDiscountable):0)}return a.ranges.sort(function(a,b){return a.low-b.low}),a.ranges},success:j,error:k},a.postData={ColorsFront:e,ColorsSleeveRight:h,ColorsBack:f,ColorsSleeveLeft:g,AllVector:i},b(a)},this.getQuote=function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a={methodName:"GetProductQuoteByQty",parameters:[a,c,d,e,f,g,h,i,j,k,m,n],successRootTagName:null,processResults:function(a){if(a.ranges){for(var b=0;b<a.ranges.length;b++){var c=a.ranges[b];c.low=parseFloat(c.low),c.high=parseFloat(c.high),c.high<a.min_quantity?(a.ranges.splice(b,1),b--):(c.low<a.min_quantity&&(c.low=a.min_quantity),c.price=parseFloat(c.price),c.combinePrintAndProduct="true"==c.combinePrintAndProduct.toLowerCase(),c.applyQtyDiscToPrinting="true"==c.applyQtyDiscToPrinting.toLowerCase(),c.setup=c.setup?parseFloat(c.setup):0,c.namePrice=c.namePrice?parseFloat(c.namePrice):0,c.numberPrice=c.numberPrice?parseFloat(c.numberPrice):0,c.qtyDiscPercent=c.qtyDiscPercent?parseFloat(c.qtyDiscPercent):0,c.priceDiscountable=c.priceDiscountable?parseFloat(c.priceDiscountable):0)}return a.ranges.sort(function(a,b){return a.low-b.low}),a.ranges}for(b in a)a[b]=parseFloat(a[b])},deserializationSettings:{Range:{name:"ranges",mode:"array"},Low:{name:"low",mode:"single"},High:{name:"high",mode:"single"},Price:{name:"price",mode:"single"},CombinePrintAndProduct:{name:"combinePrintAndProduct",mode:"single"},ApplyQtyDiscToPrinting:{name:"applyQtyDiscToPrinting",mode:"single"},Setup:{name:"setup",mode:"single"},NamePrice:{name:"namePrice",mode:"single"},NumberPrice:{name:"numberPrice",mode:"single"},QtyDiscPercent:{name:"qtyDiscPercent",mode:"single"},PriceDiscountable:{name:"priceDiscountable",mode:"single"},AppToken:{name:"AppToken",mode:"single"},ProductID:{name:"productID",mode:"single"},ProductStyleID:{name:"productStyleID",mode:"single"},ProductStyleSizeID:{name:"productStyleSizeID",mode:"single"},Qty:{name:"qty",mode:"single"},PrintPrice:{name:"printPrice",mode:"single"},SetupPrice:{name:"setupPrice",mode:"single"},EachProduct:{name:"eachProduct",mode:"single"},NameNumberPrice:{name:"nameNumberPrice",mode:"single"},EachTotal:{name:"eachTotal",mode:"single"},TotalPrice:{name:"totalPrice",mode:"single"},QuantityDiscount:{name:"quantityDiscount",mode:"single"}},loadingMessage:"获取报价",success:o,error:p},a.postData={ColorsFront:h,ColorsSleeveRight:k,ColorsBack:i,ColorsSleeveLeft:j,AllVector:l},b(a)},this.checkStyleInventory=function(a,c,d){return b({methodName:"CheckStyleInventory",parameters:[a],successRootTagName:"Sizes",deserializationSettings:{Size:{name:"sizes"}},loadingMessage:"检查库存",processResults:function(a){return a},success:c,error:d})},this.addItemToCart=function(b,c,d,e,g,i,j,l){if(h.lockCart)setTimeout(function(){h.addItemToCart(b,c,d,e,g,i,j,l)},100);else{l||(l=f);var m="/"+a.AppURI+"/Cart/Add/"+b+"/"+c+"/"+d+"/"+e+"/"+g+"/"+i;
service.ajaxCallStarted&&service.ajaxCallStarted("AddItemToCart","保存到购物车..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl(m),xhrFields:k,dataType:"text",data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("AddItemToCart"),j&&j(a)},error:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("AddItemToCart"),l&&l(a)}})}},this.addItemToCartWithName=function(b,c,d,e,g,i,j,l,m,n){if(h.lockCart)setTimeout(function(){h.addItemToCartWithName(b,c,d,e,g,i,j,l,m,n)},100);else{n||(n=f);var o="/"+a.AppURI+"/Cart/AddWithName/"+b+"/"+c+"/"+d+"/"+e+"/"+g+"/"+i,o=o+("/"+(j.name||"-")+"/"+(l.number||"-")+"/"+j.color+"/"+j.size+"/"+j.font_id+"/"+l.size+"/"+l.font_id+"/"+l.color);service.ajaxCallStarted&&service.ajaxCallStarted("AddItemToCart","添加到购物车..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl(o),xhrFields:k,dataType:"text",data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("AddItemToCart"),m&&m(a)},error:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("AddItemToCart"),n&&n(a)}})}},this.removeNameNumberFromCart=function(a,c,d,e,f){return h.lockCart?void setTimeout(function(){h.removeNameNumberFromCart(a,c,d,e,f)},100):b({methodName:"SaveCartItemNameNumberRemove",parameters:[a,c,d],successRootTagName:"OK",deserializationSettings:{},loadingMessage:"获取 球衣模式 子项",processResults:null,success:e,error:f,postData:{designer:1},lockCart:!0})},this.updateNameNumberFont=function(a,c,d,e,f,g){if(!h.lockCart){var i={methodName:"SaveCartItemNameNumberFont",parameters:[a,c],successRootTagName:"OK",deserializationSettings:{},loadingMessage:"更新 球衣模式 子项",processResults:null,success:f,error:g,postData:{designer:1},lockCart:!0},j=i.postData;return j.Color=d.color,j.NameSize=d.size,j.NameFontID=d.font_id,j.NumberColor=e.color,j.NumberSize=e.size,j.NumberFontID=e.font_id,b(i)}setTimeout(function(){h.updateNameNumberFont(a,c,d,e,f,g)},100)},this.updateNameNumber=function(a,c,d,e,f,g,i,j){if(!h.lockCart){var k={methodName:"SaveCartItemNameNumber",parameters:[a,c,d,e],successRootTagName:"OK",deserializationSettings:{},loadingMessage:"更新 球衣模式 子项",processResults:null,success:i,error:j,postData:{designer:1},lockCart:!0},l=k.postData;return l.Name=f,l.Number=g,b(k)}setTimeout(function(){h.updateNameNumber(a,c,d,e,f,g,i,j)},100)},this.saveCartCouponCode=function(a,c,d,e){return h.lockCart?void setTimeout(function(){h.saveCartCouponCode(a,c,d,e)},100):b({methodName:"SaveCartCouponCode",parameters:[a,c],successRootTagName:"OK",deserializationSettings:{},loadingMessage:"检查优惠券",processResults:null,success:d,error:e,postData:{designer:1},lockCart:!0})},this.removeCartItemSize=function(b,c,d,e){if(h.lockCart)setTimeout(function(){h.removeCartItemSize(b,c,d,e)},100);else{e||(e=f);var g="/"+a.AppURI+"/Cart/RemoveSize/"+b+"/"+c;service.ajaxCallStarted&&service.ajaxCallStarted("RemoveCartItemSize","删除尺码..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl(g),xhrFields:k,dataType:"text",data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItemSize"),d&&d(a)},error:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItemSize"),e&&e(a)}})}},this.removeCartItem=function(b,c,d,e){if(h.lockCart)setTimeout(function(){h.removeCartItem(b,c,d,e)},100);else{e||(e=f);var g="/"+a.AppURI+"/Cart/Remove/"+b+"/"+c;service.ajaxCallStarted&&service.ajaxCallStarted("RemoveCartItem","删除购买项目..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl(g),xhrFields:k,dataType:"text",data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItem"),d&&d(a)},error:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItem"),e&&e(a)}})}},this.updateCartItemQuantity=function(b,c,d,e,g,i){if(h.lockCart)setTimeout(function(){h.updateCartItemQuantity(b,c,d,e,g,i)},100);else{i||(i=f);var j="/"+a.AppURI+"/Cart/UpdateQty/"+b+"/"+c+"/"+d+"/"+e;service.ajaxCallStarted&&service.ajaxCallStarted("UpdateCartItemQuantity","更新数量..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl(j),xhrFields:k,dataType:"text",data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("UpdateCartItemQuantity"),g&&g(a)},error:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("UpdateCartItemQuantity"),i&&i(a)}})}},this.saveCartItemNotes=function(a,c,d,e,f){return h.lockCart?void setTimeout(function(){h.saveCartItemNotes(a,c,d,e,f)},100):b({methodName:"SaveCartItemNotes",parameters:[a,c],successRootTagName:"OK",deserializationSettings:{},loadingMessage:"保存备注",processResults:null,success:e,error:f,postData:{designer:1,Notes:d},lockCart:!0})},this.clearCart=function(a,b,c,d){service.getCart(a,!1,function(a){for(var d=0,e=0;e<a.cart_retail_items.length;e++)service.removeCartItem(b,a.cart_retail_items[e].cart_retail_item_id,function(){d++,d==a.cart_retail_items.length&&c&&c()})},function(a,b,c,e){d&&d(a,b,c,e)})},this.removeCartItem=function(b,c,d,e){h.lockCart?setTimeout(function(){h.removeCartItem(b,c,d,e)},100):(service.ajaxCallStarted&&service.ajaxCallStarted("RemoveCartItem","从购物车中删除..."),h.lockCart=!0,$.ajax({type:"POST",url:h.adjustUrl("/"+a.AppURI+"/Cart/Remove/"+b+"/"+c),xhrFields:k,data:{Designer:1},success:function(a){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItem"),d&&d(a)},error:function(a,b,c){h.lockCart=!1,service.ajaxCallEnded&&service.ajaxCallEnded("RemoveCartItem"),e&&e(a,b,c)}}))},this.saveCartEmail=function(a,c,d,e){if(!h.lockCart){var f={methodName:"SaveCartEmail",parameters:[a],successRootTagName:"OK",loadingMessage:"保存 Cart E-mail",success:d,error:e,lockCart:!0};return f.postData={email:c},b(f)}setTimeout(function(){h.saveCartEmail(a,c,d,e)},100)},this.getCart=function(a,c,d,e){return b({methodName:"GetCart",parameters:[a],queryStringParameters:{ReadyToOrder:c},successRootTagName:"Cart",deserializationSettings:{carts:{name:"cart",mode:"single"},retail_products:{mode:"merge"},cart_retail_item_sizes:{name:"selectedSizes",mode:"array"},validation_messages:{mode:"single"}},loadingMessage:"获取购物车",processResults:function(a){if(""==a)return{};var b=a.cart;if(b.validation_messages&&b.validation_messages.validation_message)for(b.validation_messages=b.validation_messages.validation_message,a=b.validation_messages.length-1;a>=0;a--){var c=b.validation_messages[a];if(c.cart_retail_item_id){b.validation_messages.splice(a,1);var d=findMatch(b.cart_retail_items,function(a){return a.cart_retail_item_id===c.cart_retail_item_id});if(c.cartRetailItem=d,c.cart_retail_item_size_id){var e=findMatch(d.sizes,function(a){return a.cart_retail_item_size_id===c.cart_retail_item_size_id});c.cartRetailItemSize=e,e.validation_messages||(e.validation_messages=[]),e.validation_messages.push(c)}d.validation_messages||(d.validation_messages=[]),d.validation_messages.push(c)}else b.validation_messages[a]=c.replace("~","")}else b.can_checkout=!0;for(a=0;a<b.cart_retail_items.length;a++){if(d=b.cart_retail_items[a],"null"==d.note&&(d.note=null),d.original_note=d.note,d.sidePreviews=[],d.design_product_image_url_front&&d.sidePreviews.push({name:"Front",imgUrl:d.design_product_image_url_front}),d.design_product_image_url_back&&d.sidePreviews.push({name:"Back",imgUrl:d.design_product_image_url_back}),d.design_product_image_url_sleeveleft&&d.sidePreviews.push({name:"Left Sleeve",imgUrl:d.design_product_image_url_sleeveleft}),d.design_product_image_url_sleeveright&&d.sidePreviews.push({name:"Right Sleeve",imgUrl:d.design_product_image_url_sleeveright}),0==d.sidePreviews.length&&d.sidePreviews.push({name:"Front",imgUrl:d.design_product_image_url}),d.sizes&&d.sizeids){var e=d.sizes.split(","),f=d.sizeids.split(",");d.sizeData=[];for(var g=0;g<e.length;g++)d.sizeData.push({name:e[g],id:f[g]})}for(e=0;e<d.selectedSizes.length;e++)f=d.selectedSizes[e],f.quantity=parseInt(f.quantity||0),0==f.quantity?(d.selectedSizes.splice(e,1),e--):f.cart_retail_item_size_namenumbers&&f.cart_retail_item_size_namenumbers.length?f.cart_retail_item_size_namenumbers[0]?d.hasNamesNumbers=!0:(d.hasNamesNumbers=!1,f.cart_retail_item_size_namenumbers=null):f.cart_retail_item_size_namenumbers=null,f.subtotal&&f.quantity&&(f.subtotal=parseFloat(f.subtotal)*parseFloat(f.quantity)),f.original_product_style_size_id=f.product_style_size_id;var h=","+d.sizes+",";d.selectedSizes.sort(function(a,b){return h.indexOf(","+a.product_style_size_name+",")-h.indexOf(","+b.product_style_size_name+",")})}return b.getNameNumber=function(a){for(var c=0;c<b.cart_retail_items.length;c++){var d=b.cart_retail_items[c];if(d.hasNamesNumbers)for(var e=0;e<d.selectedSizes.length;e++){var f=d.selectedSizes[e];if(f.cart_retail_item_size_namenumbers&&f.cart_retail_item_size_namenumbers.length)for(var g=0;g<f.cart_retail_item_size_namenumbers.length;g++){var h=f.cart_retail_item_size_namenumbers[g];if(h.cart_retail_item_size_namenumber_id==a)return h}}}return null},b},success:d,error:e})},this.getCartShippingCountryList=function(a,c,d){return b({methodName:"GetCartShippingCountryList",parameters:[a],successRootTagName:"countries",deserializationSettings:{country:{name:"countries",mode:"array"}},loadingMessage:"获取列表-1",processResults:function(a){for(var b=0;b<a.countries.length;b++){var c=a.countries[b];c.require_state=1==c.country_id||2==c.country_id?!0:!1}return a.countries},useCache:!0,success:c,error:d})},this.getCartBillingCountryList=function(a,c,d){return b({methodName:"GetCartBillingCountryList",parameters:[a],successRootTagName:"countries",deserializationSettings:{country:{name:"countries",mode:"array"}},loadingMessage:"获取列表-2",processResults:function(a){for(var b=0;b<a.countries.length;b++){var c=a.countries[b];c.require_state=1==c.country_id||2==c.country_id?!0:!1}return a.countries},useCache:!0,success:c,error:d})},this.getCartShippingStateList=function(a,c,d){return b({methodName:"GetCartShippingStateList",parameters:[a],successRootTagName:"states",deserializationSettings:{state:{name:"states",mode:"array"}},loadingMessage:"获取列表-3",processResults:function(a){return a.states},useCache:!0,success:c,error:d})},this.getCartBillingStateList=function(a,c,d){return b({methodName:"GetCartBillingStateList",parameters:[a],successRootTagName:"states",deserializationSettings:{state:{name:"states",mode:"array"}},loadingMessage:"获取列表-4",processResults:function(a){return a.states},useCache:!0,success:c,error:d})},this.getCartShippingAddresses=function(a,c,d){return b({methodName:"GetCartShippingAddresses",parameters:[a],successRootTagName:"addresses",deserializationSettings:{address:{name:"addresses",mode:"array"}},loadingMessage:"获取以保存的地址",processResults:function(a){return a.addresses},success:c,error:d})},this.saveCartShippingAddress=function(a,c,d,e){return b({methodName:"SaveCartShippingAddress",parameters:[a],successRootTagName:"address_id",deserializationSettings:{},loadingMessage:"保存地址",processResults:function(a){},success:d,error:e,postData:c})},this.saveCartBillingAddress=function(a,c,d,e){return b({methodName:"SaveCartBillingAddress",parameters:[a],successRootTagName:"address_id",deserializationSettings:{},loadingMessage:"保存地址",processResults:function(a){},success:d,error:e,postData:c})},this.getCartShippingMethods=function(a,c,d){return b({methodName:"GetCartShippingMethods",parameters:[a],successRootTagName:"shipping_methods",deserializationSettings:{},loadingMessage:"获取购物设置",processResults:function(a){return a.shipping_method},success:c,error:d})},this.saveCartShippingMethod=function(a,c,d,e){return b({methodName:"SaveCartShippingMethod",parameters:[a],successRootTagName:"method_id",deserializationSettings:{},loadingMessage:"保存购物设置",processResults:function(a){return a},postData:{method_id:c},success:d,error:e})},this.saveCartOrder=function(c,d,e,f){return b({methodName:"SaveCartOrder",parameters:[c],successRootTagName:"OrderNumber",deserializationSettings:{},loadingMessage:"保存订单",processResults:function(a){},success:e,error:f,postData:d,useSSL:"Credit Card"==d.payment_method?!0:a.sslDomain&&jQuery.support.cors?!0:!1})},this.getCartOrder=function(a,c,d){return b({methodName:"GetCartOrder",parameters:[UserToken],successRootTagName:"OrderNumber",deserializationSettings:{},loadingMessage:"获取订单",processResults:function(a){},success:c,error:d,postData:order})},this.sendDesignEmail=function(a,c,d,e,f,g,h,i,j,k){return e='<?xml version="1.0"?><xml><designs><to_email>'+htmlEscape(e)+"</to_email><from_email>"+htmlEscape(f)+"</from_email><from_name>"+htmlEscape(g)+"</from_name><to_name>"+htmlEscape(h)+"</to_name><message>"+htmlEscape(i)+"</message></designs></xml>",b({methodName:"SendDesignEmail",parameters:[a,c,d],successRootTagName:"Design",deserializationSettings:{},loadingMessage:"发送电子邮件",processResults:function(a){},success:j,error:k,postData:{designer:1,xmlTemplate:e}})},this.getAccountDetails=function(a,c){return b({methodName:"Account/EditUserXml",parameters:[],successRootTagName:"User",deserializationSettings:{},loadingMessage:"检索帐户",processResults:function(a){},success:a,error:c,noAppTokenInUrl:!0})},this.updateAccountDetails=function(a,c,d){return b({methodName:"Account/EditUserXml",parameters:[],successRootTagName:"Success",deserializationSettings:{},loadingMessage:"更新账号",processResults:function(){},success:c,error:d,postData:a,noAppTokenInUrl:!0})},this.getOrderHistory=function(a,c){return b({methodName:"Account/OrderHistoryXml",parameters:[],successRootTagName:"OrderSearchResult",deserializationSettings:{retail_products:{mode:"merge"},addresses:{mode:"merge"},billing_address:{name:"billing_address",mode:"single"},shipping_address:{name:"shipping_address",mode:"single"},order_retail_item_sizes:{name:"selectedSizes",mode:"array"}},loadingMessage:"获取订单",processResults:function(a){return""===a?[]:a.orders},success:a,error:c,noAppTokenInUrl:!0,useAppURI:!0})},this.deserializeCartTests=function(a){return e($.parseXML(a).children[0],{tests:{mode:"merge"},billing_address:{mode:"single"},shipping_address:{mode:"single"},result:{mode:"single"},cart:{mode:"single"},cart_item:{name:"cart_items"},size:{name:"sizes"},name_number:{name:"names_numbers"}}).test},this.resultCache=j},numErrorsLogged=0;window.onerror=function(a,b,c){return console&&console.log&&console.log("错误: "+a+"\n"+b+":"+c),10>numErrorsLogged&&(jQuery.post(service.adjustUrl("/"+(ezdVars&&ezdVars.ApiDomain?ezdVars.ApiDomain:"open.dev.jzw.la/clientapi")+"/DesignerInterface/LogJavascriptError"),{msg:a,jsUrl:b,line:c,pageUrl:window.location.href,UserToken:ezdVars?ezdVars.UserToken:null,AppToken:ezdVars?ezdVars.AppToken:null}),numErrorsLogged++),!1};var WINDOW_ONBEFOREUNLOAD=function(){if(0==ezdVars.UserToken);else if(!state.isDone&&state.selectedDesign&&(state.isInitialDesign||state.isChangedDesign))return"您的设计还没保存，为避免丢失，建议保存后再执行。"};window.onbeforeunload=WINDOW_ONBEFOREUNLOAD,window.console||(window.console={}),window.console.log||(window.console.log=function(){}),window.console.debug||(window.console.debug=function(){}),window.service=new EasyTeeService({domain:ezdVars.ApiDomain,sslDomain:ezdVars.SSLApiDomain,AppToken:ezdVars.AppToken,publisherID:ezdVars.PublisherID,AppURI:ezdVars.AppURI,addDomainToUrls:!0});var dsLocation=ezdVars.DesignerLocation+"/ds";(!window.state||window.state.designer)&&(console.log("window.state init"),window.state={selectedDesignID:null,selectedDesign:null,selectedProductID:null,selectedProduct:null,selectedProductStyleID:null,selectedProductStyle:null,fontCategories:null,designer:null,storeInkColors:null,cart:{},namesNumbers:null,quoteInformation:null,currentUserToken:ezdVars.UserToken,activeUserToken:ezdVars.UserToken,currentSessionToken:ezdVars.SessionToken}),state.selectedProductID=ezdVars.ProductID,state.selectedDesignID=ezdVars.DesignID,state.selectedProductStyleID=ezdVars.ProductStyleID,state.dsUtils=new ui.DSUtils,$(document).ready(function(){getUrlParam&&getUrlParam("themeName")&&(ezdVars.ThemeName=getUrlParam("themeName")),"default"==ezdVars.ThemeName&&(ezdVars.ThemeName=null);var a=navigator.userAgent.match(/(MSIE 8)/g)||navigator.userAgent.match(/(MSIE 7)/g)||navigator.userAgent.match(/(MSIE 6)/g),b=navigator.userAgent.match(/(MSIE 9)/g);$.browser&&(a=$.browser.msie&&9>parseFloat($.browser.version,10),b=$.browser.msie&&10>parseFloat($.browser.version,10)),a?getHtmlContent($("#dsContainer"),ezdVars.DesignerLocation+"/ds/html/modals/browserWarningIE8.html",function(){}):(b&&(a=$("<div></div>"),a.insertBefore($("#dsContainer")),getHtmlContent(a,ezdVars.DesignerLocation+"/ds/html/modals/browserWarningIE9.html",function(){})),ezdVars.ThemeName?service.getThemeInfo(ezdVars.DesignerLocation+"/ds/themes/"+ezdVars.ThemeName+"/theme.xml",function(a){for(state.theme=a,state.theme.hasFile=function(a){if(!a)return!1;a=a.toLowerCase();for(var b=0;b<state.theme.files.length;b++)if(a.endsWith(state.theme.files[b].toLowerCase()))return!0},state.theme.url=function(a){return state.theme.hasFile(a)?(a=a.replace("/ds/html/","/ds/themes/"+ezdVars.ThemeName+"/html/"),a=a.replace("/ds/images/","/ds/themes/"+ezdVars.ThemeName+"/images/"),a=a.replace("/ds/css/","/ds/themes/"+ezdVars.ThemeName+"/css/"),ezdVars.Version&&(a=0<=a.indexOf("?")?a+("&version="+ezdVars.Version):a+("?version="+ezdVars.Version)),a):a},a=0;a<state.theme.files.length;a++){var b=state.theme.files[a];if(b.endsWith(".css"))service.loadCss(ezdVars.DesignerLocation+"/ds/themes/"+ezdVars.ThemeName+"/"+b);else if(b.endsWith(".less")&&window.less){var c=document.createElement("link");c.setAttribute("rel","stylesheet/less"),c.setAttribute("type","text/css"),c.setAttribute("href",ezdVars.DesignerLocation+"/ds/themes/"+ezdVars.ThemeName+"/"+b),document.getElementsByTagName("head")[0].appendChild(c),less.sheets.push(c),less.refresh()}}getHtmlContent($("#dsContainer"),state.theme.url(ezdVars.DesignerLocation+"/ds/html/dsStructure.html"),function(){state.dsUtils.loadDesignInformation(function(){startAngularApp()});var a=document.getElementById("designerParentContainer");a&&"iframe"==ezdVars.EmbedType||(a=document.getElementById("dsContainer")),ezdVars.BackgroundColor?$(a).css("background-color",getColorString(ezdVars.BackgroundColor)):ezdVars.Background&&0==ezdVars.Background.indexOf("http")&&$(a).css("background-image","url("+ezdVars.Background+")")})}):(state.theme={url:function(a){return a}},state.theme.hasFile=function(a){return!1},getHtmlContent($("#dsContainer"),state.theme.url(ezdVars.DesignerLocation+"/ds/html/dsStructure.html"),function(){state.dsUtils.loadDesignInformation(function(){startAngularApp()})})))});var hideLoader=null,pendingAjaxCalls=[],excludedAjaxCalls="LogOff CheckMobileUpload GetStoreDesignerToolTips GetFontList GetCartBillingCountryList GetCartShippingCountryList GetCartBillingStateList GetCartShippingStateList".split(" ");service.ajaxCallStarted=ajaxCallStarted,service.ajaxCallEnded=ajaxCallEnded;